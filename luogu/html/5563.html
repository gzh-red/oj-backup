<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>[Celeste-B]No More Running - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573382756:6pnvQaM+ak83lTjHesjHg/OtY0gaBzfRWCAuMlT0Fnw=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3A%22%3E%20%5Cu9003%5Cu79bb%5Cu81ea%5Cu5df1%5Cu5185%5Cu5fc3%5Cu7684%5Cu4eba%5Cuff0c%5Cn%5Cn%3E%20%5Cu6c38%5Cu8fdc%5Cu4e5f%5Cu5230%5Cu8fbe%5Cu4e0d%5Cu4e86%5Cu9876%5Cu5cf0%5Cu3002%5Cn%5Cn%3E%20%5Cu60f3%5Cu8981%5Cu5230%5Cu8fbe%5Cu5c71%5Cu9876%5Cuff0c%5Cu4f60%5Cu80fd%5Cu505a%5Cu7684%5Cu53ea%5Cu6709%5Cn%5Cn%3E%20%5Cu4e0d%5Cu518d%5Cu9003%5Cu907f%22%2C%22description%22%3A%22%5Cu901a%5Cu5f80%5Cu5c71%5Cu9876%5Cu7684%5Cu8def%5Cu4e0a%5Cu6c34%5Cu6676%5Cu904d%5Cu5e03%5Cu3002%5Cn%5Cn%5Cu5728%5Cu6676%5Cu7c07%5Cu4e2d%5Cuff0cMadeline%20%5Cu53d1%5Cu73b0%5Cu4e86%5Cu4e00%5Cu4e2a%5Cu4e0d%5Cu540c%5Cu5bfb%5Cu5e38%5Cu7684%5Cu6c34%5Cu6676%5Cu6d1e%5Cu7a74%5Cuff0c%5Cu6d1e%5Cu7a74%5Cu4e2d%5Cu9576%5Cu5d4c%5Cu7740%5Cu4e94%5Cu5f69%5Cu6591%5Cu6593%5Cu7684%5Cu5b9d%5Cu77f3%5Cu3002%5Cn%5Cn%5Cu7ecf%5Cu8fc7%20Madeline%20%5Cu7684%5Cu89c2%5Cu5bdf%5Cuff0c%5Cu5979%5Cu53d1%5Cu73b0%5Cu8fd9%5Cu4e9b%5Cu5b9d%5Cu77f3%5Cu5f62%5Cu6210%5Cu4e86%5Cu4e00%5Cu4e2a%5Cu5947%5Cu5999%5Cu7684%5Cu673a%5Cu5173%5Cuff0c%5Cu53ea%5Cu8981%5Cu8ba9%5Cu5b9d%5Cu77f3%5Cu6536%5Cu96c6%5Cu5230%5Cu8db3%5Cu591f%5Cu7684%5Cu9b54%5Cu529b%5Cuff0c%5Cu5c31%5Cu80fd%5Cu6253%5Cu5f00%5Cu673a%5Cu5173%5Cuff0c%5Cu62ff%5Cu5230%5Cu6c34%5Cu6676%5Cu4e4b%5Cu5fc3%5Cu3002%5Cn%5Cn%5Cu5177%5Cu4f53%5Cu6765%5Cu8bf4%5Cuff0c%5Cu5728%5Cu8fd9%5Cu4e2a%5Cu5de8%5Cu5927%5Cu7684%5Cu6d1e%5Cu7a74%5Cu91cc%5Cu6709%5Cu7740%20%24n%24%20%5Cu9897%5Cu5b9d%5Cu77f3%5Cuff0c%5Cu6bcf%5Cu9897%5Cu5b9d%5Cu77f3%5Cu90fd%5Cu88ab%5Cu9576%5Cu5d4c%5Cu5728%2A%2A%5Cu5f62%5Cu6001%5Cu7ed3%5Cu6784%5Cu5b8c%5Cu5168%5Cu76f8%5Cu540c%2A%2A%5Cu4f46%2A%2A%5Cu76f8%5Cu4e92%5Cu72ec%5Cu7acb%2A%2A%5Cu7684%5Cu6811%5Cu5f62%5Cu7ed3%5Cu6784%5Cu91cc%5Cu3002%5Cu66f4%5Cu5177%5Cu4f53%5Cu5730%5Cuff0c%5Cu5728%5Cu8fd9%5Cu4e2a%5Cu6d1e%5Cu7a74%5Cu91cc%5Cu6709%20%24n%24%20%5Cu4e2a%5Cu76f8%5Cu540c%5Cu7684%5Cu6811%5Cu5f62%5Cu7ed3%5Cu6784%20%24T%24%5Cuff0c%5Cu6811%5Cu5f62%5Cu7ed3%5Cu6784%20%24T%24%20%5Cu6709%20%24n%24%20%5Cu4e2a%5Cu8282%5Cu70b9%5Cuff0c%5Cu800c%5Cu7b2c%20%24i%24%20%5Cu9897%5Cu5b9d%5Cu77f3%5Cu88ab%5Cu9576%5Cu5d4c%5Cu5230%5Cu4e86%5Cu7b2c%20%24i%24%20%5Cu4e2a%5Cu6811%5Cu5f62%5Cu7ed3%5Cu6784%20%24T%24%20%5Cu7684%5Cu7b2c%20%24i%24%20%5Cu53f7%5Cu8282%5Cu70b9%5Cu4e0a%5Cu3002%5Cn%5CnMadeline%20%5Cu80fd%5Cu591f%5Cu63a8%5Cu52a8%5Cu5b9d%5Cu77f3%5Cu4ece%5Cu800c%5Cu8ba9%5Cu5b9d%5Cu77f3%5Cu5728%5Cu6811%5Cu5f62%5Cu7ed3%5Cu6784%5Cu4e0a%5Cu6ed1%5Cu52a8%5Cu3002%5Cu5f53%5Cu5b9d%5Cu77f3%5Cu6ed1%5Cu8fc7%5Cu6811%5Cu5f62%5Cu7ed3%5Cu6784%5Cu7684%5Cu4e00%5Cu6761%5Cu8fb9%2A%2A%5Cu8fc7%5Cu540e%2A%2A%5Cuff0c%5Cu8fd9%5Cu6761%5Cu8fb9%5Cu5c31%5Cu4f1a%5Cu88ab%5Cu5173%5Cu95ed%5Cuff0c%5Cu5e76%5Cu4e14%5Cu8fb9%5Cu4e0a%5Cu50a8%5Cu5b58%5Cu7684%5Cu9b54%5Cu529b%5Cu5c31%5Cu4f1a%5Cu88ab%5Cu79ef%5Cu84c4%5Cu5230%5Cu5b9d%5Cu77f3%5Cu4e2d%5Cu3002%28%5Cu518d%5Cu6b21%5Cu63d0%5Cu9192%5Cuff0c%5Cu8fd9%20%24n%24%20%5Cu9897%5Cu5b9d%5Cu77f3%5Cu6240%5Cu5728%5Cu7684%5Cu6811%5Cu5f62%5Cu7ed3%5Cu6784%5Cu662f%5Cu76f8%5Cu4e92%5Cu72ec%5Cu7acb%5Cu7684%5Cuff0c%5Cu8fd9%5Cu610f%5Cu5473%5Cu7740%5Cu5728%5Cu4e00%5Cu4e2a%5Cu6811%5Cu5f62%5Cu7ed3%5Cu6784%5Cu4e2d%5Cu4e00%5Cu6761%5Cu8fb9%5Cu7684%5Cu5c01%5Cu95ed%5Cu5e76%5Cu4e0d%5Cu4f1a%5Cu5bfc%5Cu81f4%5Cu5728%5Cu5176%5Cu4ed6%5Cu6811%5Cu5f62%5Cu7ed3%5Cu6784%5Cu4e2d%5Cu8fd9%5Cu6761%5Cu8fb9%5Cu4e5f%5Cu88ab%5Cu5c01%5Cu95ed%29%5Cn%5Cn%5Cu5b9d%5Cu77f3%5Cu80fd%5Cu50a8%5Cu5b58%5Cu7684%5Cu9b54%5Cu529b%5Cu662f%5Cu6709%5Cu4e0a%5Cu9650%5Cu7684%5Cuff0c%5Cu66f4%5Cu5177%5Cu4f53%5Cu800c%5Cu8a00%5Cuff0c%5Cu6bcf%5Cu9897%5Cu5b9d%5Cu77f3%5Cu90fd%5Cu53ea%5Cu80fd%5Cu50a8%5Cu5b58%20%24mod%24%20%5Cu7684%5Cu9b54%5Cu529b%5Cuff0c%5Cu4e00%5Cu65e6%5Cu8d85%5Cu8fc7%5Cu8fd9%5Cu4e2a%5Cu9b54%5Cu529b%5Cu4e0a%5Cu754c%5Cuff0c%5Cu5b9d%5Cu77f3%5Cu7684%5Cu9b54%5Cu529b%5Cu5c31%5Cu4f1a%5Cu6ea2%5Cu51fa%5Cuff0c%5Cu4f60%5Cu53ef%5Cu4ee5%5Cu8ba4%5Cu4e3a%5Cu5b9d%5Cu77f3%5Cu6b64%5Cu65f6%5Cu50a8%5Cu5b58%5Cu7684%5Cu9b54%5Cu529b%5Cu4f1a%5Cu5bf9%20%24mod%24%20%5Cu53d6%5Cu6a21%5Cu3002%5Cn%5CnMadeline%20%5Cu60f3%5Cu8981%5Cu77e5%5Cu9053%5Cuff0c%5Cu9576%5Cu5d4c%5Cu5728%5Cu6bcf%5Cu4e2a%5Cu9876%5Cu70b9%5Cu4e0a%5Cu7684%5Cu5b9d%5Cu77f3%5Cu6700%5Cu7ec8%5Cu6700%5Cu591a%5Cu80fd%5Cu50a8%5Cu5b58%5Cu591a%5Cu5c11%5Cu9b54%5Cu529b%5Cuff0c%5Cu4f60%5Cu80fd%5Cu5e2e%5Cu5e2e%5Cu5979%5Cu5417%5Cuff1f%22%2C%22inputFormat%22%3A%22%5Cu7b2c%5Cu4e00%5Cu884c%5Cu4e3a%5Cu4e24%5Cu4e2a%5Cu6574%5Cu6570%20%24n%24%5Cuff0c%24mod%24%5Cuff0c%5Cu8868%5Cu793a%5Cu6811%5Cu5f62%5Cu7ed3%5Cu6784%5Cu7684%5Cu8282%5Cu70b9%5Cu6570%5Cu548c%20%24mod%24%5Cn%5Cn%5Cu63a5%5Cu4e0b%5Cu6765%20%24n-1%24%20%5Cu884c%5Cu4e00%5Cu884c%5Cu4e09%5Cu4e2a%5Cu6574%5Cu6570%20%24u%2Cv%2Cw%24%5Cuff0c%5Cu63cf%5Cu8ff0%5Cu6811%5Cu5f62%5Cu7ed3%5Cu6784%5Cu4e2d%5Cu4e00%5Cu6761%5Cu8fde%5Cu63a5%20%24u%2Cv%24%5Cuff0c%5Cu80fd%5Cu91cf%5Cu503c%5Cu4e3a%20%24w%24%20%5Cu7684%5Cu53cc%5Cu5411%5Cu8fb9%20%28%240%20%5C%5Cleq%20w%20%3C%20mod%24%20%29%5Cu3002%28%5Cu6ce8%5Cu610f%5Cuff0c%5Cu5c01%5Cu95ed%5Cu4e00%5Cu6761%5Cu8fb9%5Cu662f%5Cu53cc%5Cu5411%5Cu7684%5Cuff0c%5Cu8fd9%5Cu610f%5Cu5473%5Cu7740%5Cu4f60%5Cu4e0d%5Cu80fd%5Cu8d70%5Cu56de%5Cu5934%5Cu8def%29%5Cn%5Cn%5Cu4fdd%5Cu8bc1%5Cu8fd9%5Cu4e9b%5Cu8fb9%5Cu6784%5Cu6210%5Cu4e86%5Cu4e00%5Cu68f5%5Cu6811%5Cu3002%22%2C%22outputFormat%22%3A%22%24n%24%20%5Cu884c%20%24n%24%20%5Cu4e2a%5Cu6574%5Cu6570%5Cuff0c%5Cu7b2c%20%24i%24%20%5Cu4e2a%5Cu8868%5Cu793a%5Cu9576%5Cu5d4c%5Cu5728%5Cu7b2c%20%24i%24%20%5Cu4e2a%5Cu9876%5Cu70b9%5Cu7684%5Cu5b9d%5Cu77f3%5Cu6700%5Cu591a%5Cu80fd%5Cu50a8%5Cu5b58%5Cu7684%5Cu9b54%5Cu529b%5Cu3002%22%2C%22samples%22%3A%5B%5B%225%2016%5Cn1%202%2013%5Cn2%203%2015%5Cn3%204%207%5Cn3%205%203%5Cn%22%2C%2215%5Cn15%5Cn15%5Cn10%5Cn15%22%5D%5D%2C%22hint%22%3A%22%21%5B%5Cu56fe%5Cu6302%5Cu4e86%5D%28https%3A%5C%2F%5C%2Fi.loli.net%5C%2F2019%5C%2F08%5C%2F30%5C%2FsPwyQKUDANRCT2f.png%29%5Cn%5Cn%5C%22%5Cu7279%5Cu6b8a%5Cu7ea6%5Cu5b9a%5C%22%20%5Cu4e2d%5Cuff0c%5C%22%5Cu4e00%5Cu6761%5Cu94fe%5C%22%5Cu610f%5Cu5473%5Cu7740%5Cu6811%5Cu5f62%5Cu7ed3%5Cu6784%5Cu7684%5Cu7b2c%20%24i%24%20%5Cu6761%5Cu8fb9%5Cu8fde%5Cu63a5%5Cu7b2c%20%24i%24%20%5Cu4e2a%5Cu548c%5Cu7b2c%20%24i%2B1%24%20%5Cu4e2a%5Cu8282%5Cu70b9%5Cu3002%5Cn%5Cn%5Cu5bf9%5Cu4e8e%5Cu6240%5Cu6709%5Cu6570%5Cu636e%5Cu6709%20%240%5C%5Cleq%20w%3Cmod%24%20%5Cn%5Cn%5Cu4fdd%5Cu8bc1%5Cu8f93%5Cu5165%5Cu7684%5Cu6240%5Cu6709%5Cu8fb9%5Cu6784%5Cu6210%5Cu4e00%5Cu68f5%5Cu6811%5Cn%5Cn%5Cu5bf9%5Cu4e8e%20%241%24~%246%24%20%5Cu53f7%5Cu6d4b%5Cu8bd5%5Cu70b9%5Cuff0c%5Cu65f6%5Cu9650%5Cu4e3a%20%241s%24%5Cn%5Cn%5Cu5bf9%5Cu4e8e%20%247%24~%2412%24%20%5Cu53f7%5Cu6d4b%5Cu8bd5%5Cu70b9%5Cuff0c%5Cu65f6%5Cu9650%5Cu4e3a%20%242s%24%5Cn%5Cn%5Cu5bf9%5Cu4e8e%20%2413%24~%2420%24%20%5Cu53f7%5Cu6d4b%5Cu8bd5%5Cu70b9%5Cuff0c%5Cu65f6%5Cu9650%5Cu4e3a%20%243s%24%22%2C%22provider%22%3A%7B%22uid%22%3A27329%2C%22name%22%3A%22137_345_2814%22%2C%22slogan%22%3A%22qwq%22%2C%22badge%22%3Anull%2C%22isAdmin%22%3Afalse%2C%22color%22%3A%22Orange%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C2000%2C2000%2C2000%2C2000%2C2000%2C2000%2C3000%2C3000%2C3000%2C3000%2C3000%2C3000%2C3000%2C3000%5D%2C%22memory%22%3A%5B512000%2C512000%2C512000%2C512000%2C512000%2C512000%2C512000%2C512000%2C512000%2C512000%2C512000%2C512000%2C512000%2C512000%2C512000%2C512000%2C512000%2C512000%2C512000%2C512000%5D%7D%2C%22stdCode%22%3A%22%23include%20%3Ccstdio%3E%5Cn%23include%20%3Ccstring%3E%5Cn%23include%20%3Ciostream%3E%5Cn%23include%20%3Ccmath%3E%5Cn%23include%20%3Calgorithm%3E%5Cn%5Cnusing%20namespace%20std%3B%5Cn%5Cnstruct%20edge%5Cn%7B%5Cn%5Ctint%20v%2Cnxt%2Cw%3B%5Cn%7De%5B400050%5D%3B%5Cn%5Cnint%20fa%5B200050%5D%5B18%5D%2Cdep%5B200050%5D%3B%5Cnlong%20long%20dist%5B200050%5D%3B%5Cnint%20head%5B200050%5D%2Cecnt%3B%5Cnint%20mod%2Cmmxn%3B%5Cn%5Cnvoid%20adde%28int%20u%2Cint%20v%2Cint%20w%29%5Cn%7B%5Cn%5Cte%5B%2B%2Becnt%5D.v%20%3D%20v%3B%5Cn%5Cte%5Becnt%5D.nxt%20%3D%20head%5Bu%5D%3B%5Cn%5Cte%5Becnt%5D.w%20%3D%20w%3B%5Cn%5Cthead%5Bu%5D%20%3D%20ecnt%3B%5Cn%7D%5Cn%5Cnvoid%20pre_lca%28int%20pos%2Cint%20lst%29%5Cn%7B%5Cn%5Ctfa%5Bpos%5D%5B0%5D%20%3D%20lst%3B%20dep%5Bpos%5D%20%3D%20dep%5Blst%5D%20%2B%201%3B%20mmxn%20%3D%20max%28mmxn%2Cdep%5Bpos%5D%29%3B%5Cn%5Ctfor%28int%20i%20%3D%201%3Bi%20%3C%3D%2017%3B%20%2B%2B%20i%29%20fa%5Bpos%5D%5Bi%5D%20%3D%20fa%5Bfa%5Bpos%5D%5Bi%20-%201%5D%5D%5Bi%20-%201%5D%3B%5Cn%5Ctfor%28int%20i%20%3D%20head%5Bpos%5D%3Bi%3Bi%20%3D%20e%5Bi%5D.nxt%29%5Cn%5Ct%7B%5Cn%5Ct%5Ctint%20v%20%3D%20e%5Bi%5D.v%3B%5Cn%5Ct%5Ctif%28v%20%21%3D%20lst%29%5Cn%5Ct%5Ct%7B%5Cn%5Ct%5Ct%5Ctdist%5Bv%5D%20%3D%20dist%5Bpos%5D%20%2B%20e%5Bi%5D.w%3B%5Cn%5Ct%5Ct%5Ctpre_lca%28v%2Cpos%29%3B%5Cn%5Ct%5Ct%7D%5Cn%5Ct%7D%5Cn%7D%5Cn%5Cnint%20querydist%28int%20u%2Cint%20v%29%5Cn%7B%5Cn%5Ctlong%20long%20ans%20%3D%20dist%5Bu%5D%20%2B%20dist%5Bv%5D%3B%5Cn%5Ctif%28dep%5Bu%5D%20%3C%20dep%5Bv%5D%29%20swap%28u%2Cv%29%3B%5Cn%5Ctfor%28int%20i%20%3D%2017%3Bi%20%3E%3D%200%3B%20--%20i%29%5Cn%5Ct%5Ctif%28dep%5Bu%5D%20-%20%281%20%3C%3C%20i%29%20%3E%3D%20dep%5Bv%5D%29%20u%20%3D%20fa%5Bu%5D%5Bi%5D%3B%5Cn%5Ctif%28u%20%3D%3D%20v%29%20return%20%28ans%20-%20dist%5Bu%5D%20%2A%202%29%20%25%20mod%3B%5Cn%5Ctfor%28int%20i%20%3D%2017%3Bi%20%3E%3D%200%3B%20--%20i%29%5Cn%5Ct%5Ctif%28fa%5Bu%5D%5Bi%5D%20%21%3D%20fa%5Bv%5D%5Bi%5D%29%20u%20%3D%20fa%5Bu%5D%5Bi%5D%2Cv%20%3D%20fa%5Bv%5D%5Bi%5D%3B%20u%20%3D%20fa%5Bu%5D%5B0%5D%3B%5Cn%5Ctreturn%20%28ans%20-%20dist%5Bu%5D%20%2A%202%29%20%25%20mod%3B%5Cn%7D%5Cn%5Cnint%20sum%2Crt%3B%5Cnint%20sz%5B200050%5D%2Cmxsz%5B200050%5D%3B%5Cnbool%20vis%5B200050%5D%3B%5Cn%5Cnvoid%20dfs%28int%20pos%2Cint%20lst%29%5Cn%7B%5Cn%5Ctsz%5Bpos%5D%20%3D%201%3B%20mxsz%5Bpos%5D%20%3D%200%3B%20%5Cn%5Ctfor%28int%20i%20%3D%20head%5Bpos%5D%3Bi%3Bi%20%3D%20e%5Bi%5D.nxt%29%5Cn%5Ct%7B%5Cn%5Ct%5Ctint%20v%20%3D%20e%5Bi%5D.v%3B%5Cn%5Ct%5Ctif%28v%20%21%3D%20lst%20%26%26%20%21vis%5Bv%5D%29%5Cn%5Ct%5Ct%7B%5Cn%5Ct%5Ct%5Ctdfs%28v%2Cpos%29%3B%5Cn%5Ct%5Ct%5Ctsz%5Bpos%5D%20%2B%3D%20sz%5Bv%5D%3B%5Cn%5Ct%5Ct%5Ctmxsz%5Bpos%5D%20%3D%20max%28mxsz%5Bpos%5D%2Csz%5Bv%5D%29%3B%5Cn%5Ct%5Ct%7D%5Cn%5Ct%7D%5Cn%5Ctmxsz%5Bpos%5D%20%3D%20max%28mxsz%5Bpos%5D%2Csum%20-%20sz%5Bpos%5D%29%3B%5Cn%5Ctif%28mxsz%5Bpos%5D%20%3C%20mxsz%5Brt%5D%29%20rt%20%3D%20pos%3B%5Cn%7D%5Cn%5Cnint%20par%5B200050%5D%3B%5Cnint%20root1%5B200050%5D%2Croot2%5B200050%5D%3B%5Cnint%20son%5B32000000%5D%5B2%5D%2Cval%5B32000000%5D%2Cpcnt%3B%5Cn%5Cnvoid%20Push_Up%28int%20rt%29%5Cn%7B%5Cn%5Ctval%5Brt%5D%20%3D%20val%5Bson%5Brt%5D%5B0%5D%5D%20%2B%20val%5Bson%5Brt%5D%5B1%5D%5D%3B%5Cn%7D%5Cn%5Cnvoid%20insert%28int%20%26rt%2Cint%20l%2Cint%20r%2Cint%20valx%29%5Cn%7B%5Cn%5Ctif%28%21rt%29%20rt%20%3D%20%2B%2B%20pcnt%3B%5Cn%5Ctif%28l%20%3D%3D%20r%29%5Cn%5Ct%7B%5Cn%5Ct%5Ctval%5Brt%5D%20%2B%2B%3B%5Cn%5Ct%5Ctreturn%20%3B%5Cn%5Ct%7D%5Cn%5Ctint%20mid%20%3D%20%28l%20%2B%20r%29%20%3E%3E%201%3B%5Cn%5Ctif%28mid%20%3E%3D%20valx%29%20insert%28son%5Brt%5D%5B0%5D%2Cl%2Cmid%2Cvalx%29%3B%5Cn%5Ctelse%20insert%28son%5Brt%5D%5B1%5D%2Cmid%20%2B%201%2Cr%2Cvalx%29%3B%5Cn%5CtPush_Up%28rt%29%3B%5Cn%7D%5Cn%5Cnint%20Query%28int%20rt0%2Cint%20rt1%2Cint%20l%2Cint%20r%2Cint%20ll%2Cint%20rr%29%5Cn%7B%5Cn%5Ctif%28ll%20%3C%3D%20l%20%26%26%20r%20%3C%3D%20rr%29%20return%20val%5Brt1%5D%20-%20val%5Brt0%5D%3B%5Cn%5Ctint%20mid%20%3D%20%28l%20%2B%20r%29%20%3E%3E%201%3B%5Cn%5Ctif%28mid%20%3E%3D%20rr%29%20return%20Query%28son%5Brt0%5D%5B0%5D%2Cson%5Brt1%5D%5B0%5D%2Cl%2Cmid%2Cll%2Crr%29%3B%5Cn%5Ctif%28mid%20%3C%20ll%29%20return%20Query%28son%5Brt0%5D%5B1%5D%2Cson%5Brt1%5D%5B1%5D%2Cmid%20%2B%201%2Cr%2Cll%2Crr%29%3B%5Cn%5Ctreturn%20Query%28son%5Brt0%5D%5B0%5D%2Cson%5Brt1%5D%5B0%5D%2Cl%2Cmid%2Cll%2Crr%29%20%2B%20Query%28son%5Brt0%5D%5B1%5D%2Cson%5Brt1%5D%5B1%5D%2Cmid%20%2B%201%2Cr%2Cll%2Crr%29%3B%5Cn%7D%5Cn%5Cnint%20kth%28int%20rt0%2Cint%20rt1%2Cint%20l%2Cint%20r%2Cint%20k%29%5Cn%7B%5Cn%5Ctif%28l%20%3D%3D%20r%29%20return%20l%3B%5Cn%5Ctint%20mid%20%3D%20%28l%20%2B%20r%29%20%3E%3E%201%2Ccl%20%3D%20val%5Bson%5Brt1%5D%5B0%5D%5D%20-%20val%5Bson%5Brt0%5D%5B0%5D%5D%3B%5Cn%5Ctif%28cl%20%3E%3D%20k%29%20return%20kth%28son%5Brt0%5D%5B0%5D%2Cson%5Brt1%5D%5B0%5D%2Cl%2Cmid%2Ck%29%3B%5Cn%5Ctelse%20return%20kth%28son%5Brt0%5D%5B1%5D%2Cson%5Brt1%5D%5B1%5D%2Cmid%20%2B%201%2Cr%2Ck%20-%20cl%29%3B%5Cn%7D%5Cn%5Cnvoid%20getdist%28int%20u%2Cint%20lst%2Clong%20long%20dist%2Cint%20root%29%5Cn%7B%5Cn%5Ctinsert%28root1%5Broot%5D%2C0%2Cmod%20-%201%2Cdist%29%3B%5Cn%5Ctinsert%28root2%5Broot%5D%2C0%2Cmod%20-%201%2Cquerydist%28u%2Cpar%5Broot%5D%29%29%3B%5Cn%5Ctfor%28int%20i%20%3D%20head%5Bu%5D%3Bi%3Bi%20%3D%20e%5Bi%5D.nxt%29%5Cn%5Ct%7B%5Cn%5Ct%5Ctint%20v%20%3D%20e%5Bi%5D.v%3B%5Cn%5Ct%5Ctif%28v%20%21%3D%20lst%20%26%26%20%21vis%5Bv%5D%29%5Cn%5Ct%5Ct%5Ctgetdist%28v%2Cu%2C%28dist%20%2B%20e%5Bi%5D.w%29%20%25%20mod%2Croot%29%3B%5Cn%5Ct%7D%5Cn%7D%5Cn%5Cnint%20n%2Cm%3B%5Cn%5Cnvoid%20calc%28int%20pos%29%5Cn%7B%5Cn%5Ctinsert%28root1%5Bpos%5D%2C0%2Cmod%20-%201%2C0%29%3B%5Cn%5Ctinsert%28root2%5Bpos%5D%2C0%2Cmod%20-%201%2Cquerydist%28pos%2Cpar%5Bpos%5D%29%29%3B%5Cn%5Ctfor%28int%20i%20%3D%20head%5Bpos%5D%3Bi%3Bi%20%3D%20e%5Bi%5D.nxt%29%5Cn%5Ct%7B%5Cn%5Ct%5Ctint%20v%20%3D%20e%5Bi%5D.v%3B%5Cn%5Ct%5Ctif%28vis%5Bv%5D%29%20continue%3B%5Cn%5Ct%5Ctgetdist%28v%2Cpos%2Ce%5Bi%5D.w%2Cpos%29%3B%5Cn%5Ct%7D%5Cn%7D%5Cn%5Cnvoid%20solv%28int%20pos%29%5Cn%7B%5Cn%5Ctvis%5Bpos%5D%20%3D%201%3B%5Cn%5Ctcalc%28pos%29%3B%5Cn%5Ctfor%28int%20i%20%3D%20head%5Bpos%5D%3Bi%3Bi%20%3D%20e%5Bi%5D.nxt%29%5Cn%5Ct%7B%5Cn%5Ct%5Ctint%20v%20%3D%20e%5Bi%5D.v%3B%5Cn%5Ct%5Ctif%28%21vis%5Bv%5D%29%5Cn%5Ct%5Ct%7B%5Cn%5Ct%5Ct%5Ctsum%20%3D%20sz%5Bv%5D%3B%5Cn%5Ct%5Ct%5Ctmxsz%5Brt%20%3D%200%5D%20%3D%200x3f3f3f3f%3B%5Cn%5Ct%5Ct%5Ctdfs%28v%2C0%29%3B%20%5Cn%5Ct%5Ct%5Ctpar%5Brt%5D%20%3D%20pos%3Bsolv%28rt%29%3B%5Cn%5Ct%5Ct%7D%5Cn%5Ct%7D%5Cn%7D%5Cn%5Cnvoid%20query%28int%20pos%29%5Cn%7B%5Cn%5Ctint%20ans%20%3D%200%2Cpref%20%3D%200%3B%5Cn%5Ctfor%28int%20i%20%3D%20pos%2Clst%20%3D%200%3Bi%3Bpref%20%3D%20querydist%28pos%2Cpar%5Bi%5D%29%20%25%20mod%2Clst%20%3D%20i%2Ci%20%3D%20par%5Bi%5D%29%5Cn%5Ct%7B%5Cn%5Ct%5Ctans%20%3D%20max%28ans%2Cpref%29%3B%5Cn%5Ct%5Ctint%20k%20%3D%20Query%28root2%5Blst%5D%2Croot1%5Bi%5D%2C0%2Cmod%20-%201%2C0%2Cmod%20-%20pref%20-%201%29%3B%5Cn%5Ct%5Ctif%28k%29%20ans%20%3D%20max%28ans%2Cpref%20%2B%20kth%28root2%5Blst%5D%2Croot1%5Bi%5D%2C0%2Cmod%20-%201%2Ck%29%29%3B%5Cn%5Ct%7D%5Cn%5Ctprintf%28%5C%22%25d%5C%5Cn%5C%22%2Cans%29%3B%5Cn%7D%5Cn%5Cnint%20main%28%29%5Cn%7B%5Cn%5Ctscanf%28%5C%22%25d%25d%5C%22%2C%26n%2C%26mod%29%3B%5Cn%5Ctfor%28int%20i%20%3D%201%3Bi%20%3C%20n%3B%20%2B%2B%20i%29%5Cn%5Ct%7B%5Cn%5Ct%5Ctint%20u%2Cv%2Cw%3B%5Cn%5Ct%5Ctscanf%28%5C%22%25d%25d%25d%5C%22%2C%26u%2C%26v%2C%26w%29%3B%5Cn%5Ct%5Ctadde%28u%2Cv%2Cw%29%2Cadde%28v%2Cu%2Cw%29%3B%5Cn%5Ct%7D%5Cn%5Ctpre_lca%281%2C0%29%3B%20mxsz%5Brt%20%3D%200%5D%20%3D%200x3f3f3f3f%3B%20sum%20%3D%20n%3B%20dfs%281%2C0%29%3B%20solv%28rt%29%3B%5Cn%5C%2F%5C%2F%5Ctcerr%20%3C%3C%20mmxn%20%3C%3C%20%5C%22%20%5C%22%20%3C%3C%20pcnt%20%3C%3C%20endl%3B%5Cn%5Ctfor%28int%20i%20%3D%201%3Bi%20%3C%3D%20n%3B%20%2B%2B%20i%29%20query%28i%29%3B%5Cn%7D%22%2C%22tags%22%3A%5B108%5D%2C%22wantsTranslation%22%3Afalse%2C%22totalSubmit%22%3A186%2C%22totalAccepted%22%3A22%2C%22pid%22%3A%22P5563%22%2C%22title%22%3A%22%5BCeleste-B%5DNo%20More%20Running%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22P%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%7B%22pid%22%3A%22P3251%22%2C%22title%22%3A%22%5BJLOI2012%5D%5Cu65f6%5Cu95f4%5Cu6d41%5Cu901d%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22P%22%7D%2C%7B%22pid%22%3A%22P4719%22%2C%22title%22%3A%22%5Cu3010%5Cu6a21%5Cu677f%5Cu3011%5Cu52a8%5Cu6001%20DP%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22P%22%7D%2C%7B%22pid%22%3A%22P5564%22%2C%22title%22%3A%22%5BCeleste-B%5DSay%20Goodbye%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22P%22%7D%2C%7B%22pid%22%3A%22CF1209A%22%2C%22title%22%3A%22Paint%20the%20Numbers%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22CF%22%7D%2C%7B%22pid%22%3A%22CF1215E%22%2C%22title%22%3A%22Marbles%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22CF%22%7D%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22%5BCeleste-B%5DNo%20More%20Running%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1573295103;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>[Celeste-B]No More Running</h1>
<h2>题目背景</h2>
<div>> 逃离自己内心的人，
> 永远也到达不了顶峰。
> 想要到达山顶，你能做的只有
> 不再逃避</div>
<h2>题目描述</h2>
<div>通往山顶的路上水晶遍布。
在晶簇中，Madeline 发现了一个不同寻常的水晶洞穴，洞穴中镶嵌着五彩斑斓的宝石。
经过 Madeline 的观察，她发现这些宝石形成了一个奇妙的机关，只要让宝石收集到足够的魔力，就能打开机关，拿到水晶之心。
具体来说，在这个巨大的洞穴里有着 $n$ 颗宝石，每颗宝石都被镶嵌在**形态结构完全相同**但**相互独立**的树形结构里。更具体地，在这个洞穴里有 $n$ 个相同的树形结构 $T$，树形结构 $T$ 有 $n$ 个节点，而第 $i$ 颗宝石被镶嵌到了第 $i$ 个树形结构 $T$ 的第 $i$ 号节点上。
Madeline 能够推动宝石从而让宝石在树形结构上滑动。当宝石滑过树形结构的一条边**过后**，这条边就会被关闭，并且边上储存的魔力就会被积蓄到宝石中。(再次提醒，这 $n$ 颗宝石所在的树形结构是相互独立的，这意味着在一个树形结构中一条边的封闭并不会导致在其他树形结构中这条边也被封闭)
宝石能储存的魔力是有上限的，更具体而言，每颗宝石都只能储存 $mod$ 的魔力，一旦超过这个魔力上界，宝石的魔力就会溢出，你可以认为宝石此时储存的魔力会对 $mod$ 取模。
Madeline 想要知道，镶嵌在每个顶点上的宝石最终最多能储存多少魔力，你能帮帮她吗？</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>第一行为两个整数 $n$，$mod$，表示树形结构的节点数和 $mod$
接下来 $n-1$ 行一行三个整数 $u,v,w$，描述树形结构中一条连接 $u,v$，能量值为 $w$ 的双向边 ($0 \leq w < mod$ )。(注意，封闭一条边是双向的，这意味着你不能走回头路)
保证这些边构成了一棵树。</div>
<h3>输出格式</h3>
<br />
<div>$n$ 行 $n$ 个整数，第 $i$ 个表示镶嵌在第 $i$ 个顶点的宝石最多能储存的魔力。</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>5 16
1 2 13
2 3 15
3 4 7
3 5 3
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>15
15
15
10
15</code></pre>
<h2>说明</h2>
<div>![图挂了](https://i.loli.net/2019/08/30/sPwyQKUDANRCT2f.png)
"特殊约定" 中，"一条链"意味着树形结构的第 $i$ 条边连接第 $i$ 个和第 $i+1$ 个节点。
对于所有数据有 $0\leq w<mod$ 保证输入的所有边构成一棵树 对于 $1$~$6$ 号测试点，时限为 $1s$ 对于 $7$~$12$ 号测试点，时限为 $2s$ 对于 $13$~$20$ 号测试点，时限为 $3s$</div>
</article>
</div>
</div>
</body>
</html>
