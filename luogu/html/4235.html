<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Hash? - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573381175:QHx/VCUOsjkwZkNA3zGNYjTyJQY4V5Ys9m0vXRhxhuY=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3A%22%2A%2Azhoutb2333%2A%2A%5Cu5b66%5Cu4e60%5Cu4e86%5Cu54c8%5Cu5e0c%5Cu7b97%5Cu6cd5%5Cuff0c%5Cu4ed6%5Cu4e8e%5Cu662f%5Cu53bb%5Cu7edf%5Cu8ba1%5Cu7ed9%5Cu5b9a%5Cu4e00%5Cu4e9b%5Cu5b57%5Cu7b26%5Cu4e32%5Cuff0c%5Cu5176%5Cu4e2d%5Cu6709%5Cu591a%5Cu5c11%5Cu4e2a%5Cu672c%5Cu8d28%5Cu4e0d%5Cu540c%5Cu7684%5Cu5b57%5Cu7b26%5Cu4e32%5Cu3002%5Cn%5Cn%5Cn%5Cu4f46%5Cu662f%2A%2Azhoutb2333%2A%2A%5Cu7a81%5Cu53d1%5Cu5947%5Cu60f3%5Cuff0c%5Cu5982%5Cu679c%5Cu54c8%5Cu5e0c%5Cu91c7%5Cu7528%5Cu7684%24base%24%5Cu6bcf%5Cu6b21%5Cu968f%5Cu673a%5Cuff0c%5Cu90a3%5Cu4e48%5Cu7ed3%5Cu679c%5Cu4f1a%5Cu53d8%5Cu6210%5Cu4ec0%5Cu4e48%5Cu6837%5Cu5462%5Cuff1f%5Cn%5Cn%2A%2A%5Cu8fa3%5Cu9e21%5Cu51fa%5Cu9898%5Cu4eba%5Cu53c8%5Cu51fa%5Cu9505%5Cu4e86%5Cuff01subtask3%5Cu7684%5Cu6570%5Cu636e%5Cu6709%5Cu95ee%5Cu9898%5Cuff0c%5Cu73b0%5Cu5728%5Cu7edf%5Cu4e00%5Cu5c06%5Cu6a21%5Cu6570%5Cu6539%5Cu4e3a65537%2A%2A%5Cn%5Cn%5Cu9898%5Cu76ee%5Cu6765%5Cu6e90%5Cuff1a%5Bzhoutb2333%5D%28https%3A%5C%2F%5C%2Fwww.luogu.org%5C%2Fspace%5C%2Fshow%3Fuid%3D31564%29%22%2C%22description%22%3A%22%5Cu4ed6%5Cu901a%5Cu8fc7%5Cu67d0%5Cu79cd%5Cu529e%5Cu6cd5%5Cuff0c%5Cu83b7%5Cu5f97%5Cu4e86%5Cu4e00%5Cu4e2a%5Cu51fd%5Cu6570%3A%24int%20%5C%5C%20Rand%28int%20%20%5C%5C%20x%29%24%5Cuff0c%5Cu5b83%5Cu4f1a%5Cu7b49%5Cu6982%5Cu7387%5Cu5730%5Cu8fd4%5Cu56de%5Cu4e00%5Cu4e2a%24%5B0%2Cx%29%24%5Cu4e2d%5Cu7684%5Cu6574%5Cu6570%5Cu3002%5Cn%5Cn%5Cu4ed6%5Cu5199%5Cu4e0b%5Cu4e86%5Cu8fd9%5Cu6837%5Cu7684%5Cu4ee3%5Cu7801%5Cuff1a%5Cn%60%60%60%20cpp%5Cn%23include%3Cbits%5C%2Fstdc%2B%2B.h%3E%5Cnusing%20namespace%20std%3B%5Cn%5Cntypedef%20long%20long%20ll%3B%5Cnconst%20int%20x%3D10%2Cmaxn%3D35%2Cmaxlen%3D16010%3B%5Cnll%20HASH%5Bmaxn%5D%3B%5Cnconst%20ll%20p%3D65537%3B%5Cnchar%20str%5Bmaxlen%5D%3B%5Cnll%20Hash%28%29%7B%5Cn%20%20%20%20int%20base%3DRand%28x%29%3B%5Cn%20%20%20%20ll%20ret%3D0%3B%5Cn%20%20%20%20for%28int%20i%3D1%3Bstr%5Bi%5D%3Bi%2B%2B%29%5Cn%20%20%20%20%20%20%20%20ret%3D%28ret%2Abase%2Bstr%5Bi%5D-%27a%27%2B1%29%25p%3B%5Cn%20%20%20%20return%20ret%3B%5Cn%7D%5Cnint%20main%28%29%7B%5Cn%20%20%20%20int%20ans%3D0%2Cn%3B%5Cn%20%20%20%20scanf%28%5C%22%25d%5C%22%2C%26n%29%3B%5Cn%20%20%20%20for%28int%20i%3D1%3Bi%3C%3Dn%3Bi%2B%2B%29%5Cn%20%20%20%20%20%20%20%20scanf%28%5C%22%25s%5C%22%2Cstr%2B1%29%2CHASH%5Bi%5D%3DHash%28%29%3B%5Cn%20%20%20%20sort%28HASH%2B1%2CHASH%2Bn%2B1%29%3B%5Cn%20%20%20%20HASH%5B0%5D%3D-1%3B%5Cn%20%20%20%20for%28int%20i%3D1%3Bi%3C%3Dn%3Bi%2B%2B%29%5Cn%20%20%20%20%20%20%20%20ans%2B%3D%28HASH%5Bi%5D%21%3DHASH%5Bi-1%5D%29%3B%5Cn%20%20%20%20printf%28%5C%22%25d%5C%5Cn%5C%22%2Cans%29%3B%5Cn%20%20%20%20return%200%3B%5Cn%7D%5Cn%60%60%60%5Cn%2A%2Azhoutb2333%2A%2A%5Cu60f3%5Cu95ee%5Cu4f60%5Cuff0c%5Cu7ed9%5Cu5b9a%5Cu4e00%5Cu4e9b%5Cu5b57%5Cu7b26%5Cu4e32%5Cu548c%5Cu53c2%5Cu6570%24x%24%5Cuff0c%5Cu7b54%5Cu6848%24ans%24%5Cu7684%5Cu671f%5Cu671b%5Cu662f%5Cu591a%5Cu5c11%5Cu5462%5Cuff1f%5Cn%5Cn%2465537%3D%202%5E%7B16%7D%2B1%24%2A%2A%5Cu662f%5Cu8d28%5Cu6570%2A%2A%5Cn%5Cn%2A%2A%5Cu53c2%5Cu6570%24x%24%5Cu5728%5Cu8fd9%5Cu4e2a%5Cu7a0b%5Cu5e8f%5Cu4e2d%5Cu662f%5Cu786e%5Cu5b9a%5Cu7684%2410%24%5Cuff0c%5Cu4f46%5Cu662f%5Cu6bcf%5Cu6b21%5Cu8f93%5Cu5165%5Cu4f1a%5Cu7ed9%5Cu5b9a%5Cu3002%2A%2A%22%2C%22inputFormat%22%3A%22%5Cu7b2c%5Cu4e00%5Cu884c%5Cu4e09%5Cu4e2a%5Cu6574%5Cu6570%24x%2CN%24%5Cuff0c%5Cu8868%5Cu793a%24base%24%5Cu751f%5Cu6210%5Cu7684%5Cu53c2%5Cu6570%5Cu548c%5Cu5b57%5Cu7b26%5Cu4e32%5Cu7684%5Cu4e2a%5Cu6570%5Cn%5Cn%5Cu63a5%5Cu4e0b%5Cu6765%24N%24%5Cu884c%5Cu6bcf%5Cu884c%5Cu4e00%5Cu4e2a%5Cu5b57%5Cu7b26%5Cu4e32%5Cuff0c%5Cu5b57%5Cu7b26%5Cu4e32%5Cu4ec5%5Cu7531%5Cu5c0f%5Cu5199%5Cu5b57%5Cu6bcd%5Cu7ec4%5Cu6210%5Cu3002%22%2C%22outputFormat%22%3A%22%5Cu4e00%5Cu884c%5Cu4e00%5Cu4e2a%5Cu5c0f%5Cu6570%5Cuff0c%5Cu8868%5Cu793a%5Cu7b54%5Cu6848%24ans%24%5Cu7684%5Cu671f%5Cu671b%5Cuff0c%2A%2A%5Cu6a21%2465537%24%5Cu8f93%5Cu51fa%2A%2A%5Cu3002%5Cn%5Cn%5Cu5373%5Cuff1a%5Cu5982%5Cu679c%5Cu4f60%5Cu7684%5Cu7b54%5Cu6848%5Cu4e3a%24%5C%5Cfrac%7Bq%7D%7Bp%7D%24%5Cuff08%24gcd%28p%2Cq%29%3D1%24%5Cuff09%5Cuff0c%5Cu90a3%5Cu4e48%5Cu8f93%5Cu51fa%5Cu4f7f%5Cu5f97%24px%20%5C%5Cequiv%20q%20%5C%5C%20%28mod%20%5C%5C%2065537%24%5Cu7684%5Cu6700%5Cu5c0f%5Cu6b63%5Cu6574%5Cu6570%24x%24%5Cu3002%5Cu53ef%5Cu4ee5%5Cu8bc1%5Cu660e%5Cu7b54%5Cu6848%24ans%24%5Cu4e00%5Cu5b9a%5Cu4e3a%5Cu6b63%5Cu6709%5Cu7406%5Cu6570%5Cuff0c%5Cu5e76%5Cu4e14%5Cu8fd9%5Cu6837%5Cu7684%24x%24%5Cu4e00%5Cu5b9a%5Cu5b58%5Cu5728%5Cu3002%22%2C%22samples%22%3A%5B%5B%222%202%5Cnaa%5Cnaa%22%2C%2232770%5Cn%22%5D%2C%5B%223%206%5Cni%5Cndont%5Cnknow%5Cnwhat%5Cnto%5Cnsay%22%2C%2258261%5Cn%22%5D%5D%2C%22hint%22%3A%22%5Cu672c%5Cu9898%5Cu7531%243%24%5Cu4e2a%24subtask%24%5Cu7ec4%5Cu6210%5Cuff0c%5Cu8bbe%24M%24%5Cu4e3a%5Cu8fd9%24N%24%5Cu4e2a%5Cu5b57%5Cu7b26%5Cu4e32%5Cu4e2d%5Cuff0c%5Cu6bcf%5Cu4e2a%5Cu5b57%5Cu7b26%5Cu4e32%5Cu957f%5Cu5ea6%5Cu7684%5Cu6700%5Cu5927%5Cu503c%5Cu3002%5Cn%5Cn%5Cu5bf9%5Cu4e8e%24subtask%20%5C%5C%201%24%5Cuff1a%241%20%5C%5Cle%20N%20%5C%5Cle%208%20%2C%20M%20%5C%5Cle%2010%2Cx%20%5C%5Cle%204%24%5Cuff0c%5Cu5206%5Cu503c%5Cu4e3a%2420%24%5Cuff0c%5Cu65f6%5Cu95f4%5Cu9650%5Cu5236%5Cu4e3a%241s%24%5Cu3002%5Cn%5Cn%5Cu5bf9%5Cu4e8e%24subtask%20%5C%5C%202%24%5Cuff1a%241%20%5C%5Cle%20N%20%5C%5Cle%2030%20%2C%20M%20%5C%5Cle%20500%2Cx%20%5C%5Cle%20500%24%5Cuff0c%5Cu5206%5Cu503c%5Cu4e3a%2450%24%5Cuff0c%5Cu65f6%5Cu95f4%5Cu9650%5Cu5236%5Cu4e3a%241s%24%5Cu3002%5Cn%5Cn%5Cu5bf9%5Cu4e8e%24subtask%20%5C%5C%203%24%5Cuff1a%241%20%5C%5Cle%20N%20%5C%5Cle%205%20%2C%20M%20%5C%5Cle%2016000%2Cx%20%5C%5Cle%2016000%24%5Cuff0c%5Cu5206%5Cu503c%5Cu4e3a%2430%24%5Cuff0c%5Cu65f6%5Cu95f4%5Cu9650%5Cu5236%5Cu4e3a%244.5s%24%5Cu3002%5Cn%5Cn%2A%2A%5Cu6837%5Cu4f8b%231%5Cu89e3%5Cu91ca%5Cuff1a%2A%2A%5Cn%5Cn%5Cu53c2%5Cu6570%24x%3D2%24%5Cuff0c%5Cu90a3%5Cu4e48%5Cu53ef%5Cu80fd%5Cu7684%5Cu54c8%5Cu5e0c%24base%24%5Cu4e3a%240%2C1%24%5Cu3002%5Cn%5Cn%5Cu5982%5Cu679c%5Cu54c8%5Cu5e0c%5Cu7b2c%5Cu4e00%5Cu4e2a%60aa%60%5Cu91c7%5Cu7528%5Cu7684%24base%24%5Cu548c%5Cu7b2c%5Cu4e8c%5Cu4e2a%60aa%60%5Cu7684%24base%24%5Cu76f8%5Cu540c%5Cuff0c%5Cu90a3%5Cu4e48%5Cu7b54%5Cu6848%5Cu4e3a%241%24%5Cu3002%5Cn%5Cn%5Cu5982%5Cu679c%5Cu4e24%5Cu4e2a%24base%24%5Cu4e0d%5Cu76f8%5Cu540c%5Cuff0c%5Cu90a3%5Cu4e48%5Cu7b54%5Cu6848%5Cu4e3a%242%24%5Cu3002%5Cn%5Cn%5Cu5206%5Cu6790%5Cu53d1%5Cu73b0%5Cu8fd9%5Cu4e24%5Cu79cd%5Cu60c5%5Cu51b5%5Cu53d1%5Cu751f%5Cu7684%5Cu6982%5Cu7387%5Cu76f8%5Cu540c%5Cuff0c%5Cu90fd%5Cu662f%24%5C%5Cfrac%7B1%7D%7B2%7D%24%5Cuff0c%5Cu90a3%5Cu4e48%5Cu7b54%5Cu6848%24ans%24%5Cu7684%5Cu671f%5Cu671b%5Cu4e3a%241%20%2A%20%5C%5Cfrac%7B1%7D%7B2%7D%20%2B%202%20%2A%20%5C%5Cfrac%7B1%7D%7B2%7D%3D%5C%5Cfrac%7B3%7D%7B2%7D%24%5Cu3002%5Cu4f7f%5Cu5f97%242x%20%5C%5Cequiv%203%20%5C%5C%20%28mod%20%5C%5C%2065537%29%24%5Cu7684%5Cu6700%5Cu5c0f%5Cu6b63%5Cu6574%5Cu6570%24x%24%5Cu4e3a%2432770%24%5Cu3002%5Cn%5Cn%2A%2A%5Cu6837%5Cu4f8b%232%5Cu89e3%5Cu91ca%5Cuff1a%2A%2A%5Cn%5Cn%5Cu6c42%5Cu5f97%5Cu7b54%5Cu6848%5Cu4e3a%24%5C%5Cfrac%7B53%7D%7B9%7D%24%5Cu3002%5Cu4f7f%5Cu5f97%249x%20%5C%5Cequiv%2053%20%5C%5C%20%28mod%20%5C%5C%2065537%29%24%5Cu7684%5Cu6700%5Cu5c0f%5Cu6b63%5Cu6574%5Cu6570%24x%24%5Cu4e3a%2458261%24%5Cu3002%5Cn%5Cn%2A%2A%5Cu6ce8%5Cu610f%5Cuff1a%5Cu672c%5Cu9898%5Cu5141%5Cu8bb8%5Cu624b%5Cu52a8%5Cu5f00%24O2%24%5Cu4f18%5Cu5316%5Cu4ee5%5Cu907f%5Cu514d%5Cu88ab%5Cu5361%5Cu5e38%5Cu6570%5Cuff0c%5Cu65b9%5Cu6cd5%5Cu5982%5Cu4e0b%5Cuff1a%2A%2A%5Cn%60%60%60%20cpp%5Cn%25%3Apragma%20GCC%20optimize%282%29%5Cn%5C%2F%2A%5Cu7a0b%5Cu5e8f%2A%5C%2F%5Cn%60%60%60%22%2C%22provider%22%3A%7B%22uid%22%3A31564%2C%22name%22%3A%22zhoutb2333%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3Anull%2C%22isAdmin%22%3Afalse%2C%22color%22%3A%22Red%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C4500%2C4500%2C4500%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%5D%2C%22memory%22%3A%5B192000%2C192000%2C192000%2C192000%2C192000%2C192000%2C192000%2C192000%2C192000%2C192000%2C192000%2C192000%2C192000%2C192000%2C192000%2C192000%2C192000%2C192000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22tags%22%3A%5B2%2C235%2C266%5D%2C%22wantsTranslation%22%3Afalse%2C%22totalSubmit%22%3A118%2C%22totalAccepted%22%3A17%2C%22pid%22%3A%22P4235%22%2C%22title%22%3A%22Hash%3F%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22P%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%7B%22pid%22%3A%22P2086%22%2C%22title%22%3A%22%5BNOI2012%5D%5Cu9b54%5Cu5e7b%5Cu68cb%5Cu76d8%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22P%22%7D%2C%7B%22pid%22%3A%22P3175%22%2C%22title%22%3A%22%5BHAOI2015%5D%5Cu6309%5Cu4f4d%5Cu6216%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22P%22%7D%2C%7B%22pid%22%3A%22P3288%22%2C%22title%22%3A%22%5BSCOI2014%5D%5Cu65b9%5Cu4f2f%5Cu4f2f%5Cu8fd0%5Cu6930%5Cu5b50%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22P%22%7D%2C%7B%22pid%22%3A%22P3512%22%2C%22title%22%3A%22%5BPOI2010%5DPIL-Pilots%22%2C%22difficulty%22%3A5%2C%22type%22%3A%22P%22%7D%2C%7B%22pid%22%3A%22CF464E%22%2C%22title%22%3A%22The%20Classic%20Problem%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22CF%22%7D%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Hash%3F%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1573286098;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Hash?</h1>
<h2>题目背景</h2>
<div>**zhoutb2333**学习了哈希算法，他于是去统计给定一些字符串，其中有多少个本质不同的字符串。
但是**zhoutb2333**突发奇想，如果哈希采用的$base$每次随机，那么结果会变成什么样呢？
**辣鸡出题人又出锅了！subtask3的数据有问题，现在统一将模数改为65537**
题目来源：[zhoutb2333](https://www.luogu.org/space/show?uid=31564)</div>
<h2>题目描述</h2>
<div>他通过某种办法，获得了一个函数:$int \ Rand(int \ x)$，它会等概率地返回一个$[0,x)$中的整数。
他写下了这样的代码：
``` cpp
#include<bits/stdc++.h>
using namespace std;
typedef long long ll;
const int x=10,maxn=35,maxlen=16010;
ll HASH[maxn];
const ll p=65537;
char str[maxlen];
ll Hash(){
int base=Rand(x);
ll ret=0;
for(int i=1;str[i];i++)
ret=(ret*base+str[i]-'a'+1)%p;
return ret;
}
int main(){
int ans=0,n;
scanf("%d",&n);
for(int i=1;i<=n;i++)
scanf("%s",str+1),HASH[i]=Hash();
sort(HASH+1,HASH+n+1);
HASH[0]=-1;
for(int i=1;i<=n;i++)
ans+=(HASH[i]!=HASH[i-1]);
printf("%d\n",ans);
return 0;
}
```
**zhoutb2333**想问你，给定一些字符串和参数$x$，答案$ans$的期望是多少呢？
$65537= 2^{16}+1$**是质数**
**参数$x$在这个程序中是确定的$10$，但是每次输入会给定。**</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>第一行三个整数$x,N$，表示$base$生成的参数和字符串的个数
接下来$N$行每行一个字符串，字符串仅由小写字母组成。</div>
<h3>输出格式</h3>
<br />
<div>一行一个小数，表示答案$ans$的期望，**模$65537$输出**。
即：如果你的答案为$\frac{q}{p}$（$gcd(p,q)=1$），那么输出使得$px \equiv q \ (mod \ 65537$的最小正整数$x$。可以证明答案$ans$一定为正有理数，并且这样的$x$一定存在。</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>2 2
aa
aa</code></pre>
<h3>输出样例 #1</h3>
<pre><code>32770
</code></pre>
<h3>输入样例 #2</h3>
<pre><code>3 6
i
dont
know
what
to
say</code></pre>
<h3>输出样例 #2</h3>
<pre><code>58261
</code></pre>
<h2>说明</h2>
<div>本题由$3$个$subtask$组成，设$M$为这$N$个字符串中，每个字符串长度的最大值。
对于$subtask \ 1$：$1 \le N \le 8 , M \le 10,x \le 4$，分值为$20$，时间限制为$1s$。
对于$subtask \ 2$：$1 \le N \le 30 , M \le 500,x \le 500$，分值为$50$，时间限制为$1s$。
对于$subtask \ 3$：$1 \le N \le 5 , M \le 16000,x \le 16000$，分值为$30$，时间限制为$4.5s$。
**样例#1解释：**
参数$x=2$，那么可能的哈希$base$为$0,1$。
如果哈希第一个`aa`采用的$base$和第二个`aa`的$base$相同，那么答案为$1$。
如果两个$base$不相同，那么答案为$2$。
分析发现这两种情况发生的概率相同，都是$\frac{1}{2}$，那么答案$ans$的期望为$1 * \frac{1}{2} + 2 * \frac{1}{2}=\frac{3}{2}$。使得$2x \equiv 3 \ (mod \ 65537)$的最小正整数$x$为$32770$。
**样例#2解释：**
求得答案为$\frac{53}{9}$。使得$9x \equiv 53 \ (mod \ 65537)$的最小正整数$x$为$58261$。
**注意：本题允许手动开$O2$优化以避免被卡常数，方法如下：**
``` cpp
%:pragma GCC optimize(2)
/*程序*/
```</div>
</article>
</div>
</div>
</body>
</html>
