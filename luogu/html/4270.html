<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>[USACO18FEB]Cow Gymnasts - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573381222:SU3bkUBeRNEVyO27Z3+tsx1O99y9VSBLXJY0Jtjrsmk=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3A%22%22%2C%22description%22%3A%22Bored%20of%20farm%20life%2C%20the%20cows%20have%20sold%20all%20their%20earthly%20possessions%20and%20joined%20the%20crew%20of%20a%20traveling%20circus.%20So%20far%2C%20the%20cows%20had%20been%20given%20easy%20acts%3A%20juggling%20torches%2C%20walking%20tightropes%2C%20riding%20unicycles%20--%20nothing%20a%20handy-hoofed%20cow%20couldn%27t%20handle.%20However%2C%20the%20ringmaster%20wants%20to%20create%20a%20much%20more%20dramatic%20act%20for%20their%20next%20show.%5CnThe%20stage%20layout%20for%20the%20new%20act%20involves%20%24N%24%20platforms%20arranged%20in%20a%20circle.%20On%20each%20platform%2C%20between%20%241%24%20and%20%24N%24%20cows%20must%20form%20a%20stack%2C%20cow%20upon%20cow%20upon%20cow.%20When%20the%20ringmaster%20gives%20the%20signal%2C%20all%20stacks%20must%20simultaneously%20fall%20clockwise%2C%20so%20that%20the%20bottom%20cow%20in%20a%20stack%20doesn%27t%20move%2C%20the%20cow%20above%20her%20moves%20one%20platform%20clockwise%2C%20the%20next%20cow%20moves%20two%20platforms%20clockwise%2C%20and%20so%20forth.%20Being%20accomplished%20gymnasts%2C%20the%20cows%20know%20they%20will%20have%20no%20trouble%20with%20the%20technical%20aspect%20of%20this%20act.%20The%20various%20stacks%20of%20cows%20will%20not%20%5C%22interfere%5C%22%20with%20each%20other%20as%20they%20fall%2C%20so%20every%20cow%20will%20land%20on%20the%20intended%20platform.%20All%20of%20the%20cows%20landing%20on%20a%20platform%20form%20a%20new%20stack%2C%20which%20does%20not%20fall%20over.%5Cn%5CnThe%20ringmaster%20thinks%20the%20act%20will%20be%20particularly%20dramatic%20if%20after%20the%20stacks%20fall%2C%20the%20new%20stack%20on%20each%20platform%20contains%20the%20same%20number%20of%20cows%20as%20the%20original%20stack%20on%20that%20platform.%20We%20call%20a%20configuration%20of%20stack%20sizes%20%5C%22magical%5C%22%20if%20it%20satisfies%20this%20condition.%20Please%20help%20the%20cows%20by%20computing%20the%20number%20of%20magical%20configurations.%20Since%20this%20number%20may%20be%20very%20large%2C%20compute%20its%20remainder%20modulo%20%2410%5E9%20%2B%207%24.%5Cn%5CnTwo%20configurations%20are%20considered%20distinct%20if%20there%20is%20any%20platform%20for%20which%20the%20configurations%20assign%20a%20different%20number%20of%20cows.%22%2C%22inputFormat%22%3A%22The%20input%20is%20a%20single%20integer%2C%20%24N%24%20%28%241%20%5C%5Cleq%20N%20%5C%5Cleq%2010%5E%7B12%7D%24%29.%22%2C%22outputFormat%22%3A%22A%20single%20integer%20giving%20the%20number%20of%20magical%20configurations%20modulo%20%2410%5E9%20%2B%207%24.%22%2C%22samples%22%3A%5B%5B%224%22%2C%226%22%5D%5D%2C%22hint%22%3A%22For%20%24N%20%3D%204%24%2C%20the%20valid%20configurations%20are%20%24%281%2C1%2C1%2C1%29%24%2C%20%24%282%2C2%2C2%2C2%29%24%2C%20%24%283%2C3%2C3%2C3%29%24%2C%20%24%284%2C4%2C4%2C4%29%24%2C%20%24%282%2C3%2C2%2C3%29%24%2C%20and%20%24%283%2C2%2C3%2C2%29%24.%5Cn%5CnProblem%20credits%3A%20Dhruv%20Rohatgi%22%2C%22provider%22%3A%7B%22uid%22%3A20%2C%22name%22%3A%22FarmerJohn2%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3Anull%2C%22isAdmin%22%3Afalse%2C%22color%22%3A%22Gray%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%5D%2C%22memory%22%3A%5B128000%2C128000%2C128000%2C128000%2C128000%2C128000%2C128000%2C128000%2C128000%2C128000%2C128000%2C128000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22translation%22%3A%22%5Cu538c%5Cu5026%5Cu4e86%5Cu519c%5Cu573a%5Cu751f%5Cu6d3b%5Cuff0c%5Cu5976%5Cu725b%5Cu4eec%5Cu53d8%5Cu5356%5Cu4e86%5Cu6240%5Cu6709%5Cu5c18%5Cu4e16%5Cu7684%5Cu8d22%5Cu4ea7%5Cuff0c%5Cu52a0%5Cu5165%5Cu4e86%5Cu4e00%5Cu652f%5Cu5de1%5Cu56de%5Cu9a6c%5Cu620f%5Cu56e2%5Cu3002%5Cu5230%5Cu73b0%5Cu5728%5Cu4e3a%5Cu6b62%5Cuff0c%5Cu5976%5Cu725b%5Cu4eec%5Cu5df2%5Cu7ecf%5Cu80fd%5Cu591f%5Cu8fdb%5Cu884c%5Cu7b80%5Cu5355%5Cu7684%5Cu8868%5Cu6f14%5Cu4e86%5Cuff1a%5Cu800d%5Cu706b%5Cu628a%5Cu3001%5Cu8d70%5Cu94a2%5Cu4e1d%5Cu3001%5Cu9a91%5Cu72ec%5Cu8f6e%5Cu8f66%5Cu2014%5Cu2014%5Cu6ca1%5Cu4ec0%5Cu4e48%5Cu662f%5Cu62e5%5Cu6709%5Cu7075%5Cu5de7%5Cu8e44%5Cu5b50%5Cu7684%5Cu5976%5Cu725b%5Cu505a%5Cu4e0d%5Cu5230%5Cu7684%5Cu3002%5Cu4f46%5Cu662f%5Cuff0c%5Cu9a6c%5Cu620f%5Cu56e2%5Cu6307%5Cu6325%5Cu60f3%5Cu8981%5Cu4e3a%5Cu4ed6%5Cu4eec%5Cu7684%5Cu4e0b%5Cu4e00%5Cu6b21%5Cu6f14%5Cu51fa%5Cu521b%5Cu4f5c%5Cu4e00%5Cu4e2a%5Cu66f4%5Cu52a0%5Cu6fc0%5Cu52a8%5Cu4eba%5Cu5fc3%5Cu7684%5Cu8868%5Cu6f14%5Cu3002%5Cn%5Cn%5Cu65b0%5Cu7684%5Cu8868%5Cu6f14%5Cu6240%5Cu7528%5Cu7684%5Cu821e%5Cu53f0%5Cu7531%24N%24%5Cu4e2a%5Cu56f4%5Cu6210%5Cu4e00%5Cu5708%5Cu7684%5Cu5e73%5Cu53f0%5Cu7ec4%5Cu6210%5Cu3002%5Cu5728%5Cu6bcf%5Cu4e2a%5Cu5e73%5Cu53f0%5Cu4e0a%5Cuff0c%241%24%5Cu81f3%24N%24%5Cu5934%5Cu5976%5Cu725b%5Cu53e0%5Cu6210%5Cu4e00%5Cu645e%5Cuff0c%5Cu4e00%5Cu5934%5Cu53e0%5Cu5728%5Cu4e00%5Cu5934%5Cu4e0a%5Cu9762%5Cu3002%5Cu5f53%5Cu6307%5Cu6325%5Cu7ed9%5Cu51fa%5Cu4fe1%5Cu53f7%5Cu7684%5Cu65f6%5Cu5019%5Cuff0c%5Cu6bcf%5Cu645e%5Cu5976%5Cu725b%5Cu540c%5Cu65f6%5Cu987a%5Cu65f6%5Cu9488%5Cu843d%5Cu4e0b%5Cuff0c%5Cu6700%5Cu4e0b%5Cu9762%5Cu7684%5Cu5976%5Cu725b%5Cu4e0d%5Cu52a8%5Cuff0c%5Cu5728%5Cu5979%5Cu4e0a%5Cu9762%5Cu7684%5Cu5976%5Cu725b%5Cu987a%5Cu65f6%5Cu9488%5Cu79fb%5Cu52a8%5Cu4e00%5Cu4e2a%5Cu5e73%5Cu53f0%5Cuff0c%5Cu518d%5Cu4e0a%5Cu9762%5Cu7684%5Cu5976%5Cu725b%5Cu987a%5Cu65f6%5Cu9488%5Cu79fb%5Cu52a8%5Cu4e24%5Cu4e2a%5Cu5e73%5Cu53f0%5Cuff0c%5Cu7b49%5Cu7b49%5Cu3002%5Cu4f5c%5Cu4e3a%5Cu6280%5Cu827a%5Cu9ad8%5Cu8d85%5Cu7684%5Cu4f53%5Cu64cd%5Cu5bb6%5Cuff0c%5Cu5976%5Cu725b%5Cu4eec%5Cu660e%5Cu767d%5Cu5979%5Cu4eec%5Cu5728%5Cu8fd9%5Cu4e2a%5Cu8868%5Cu6f14%5Cu7684%5Cu6280%5Cu672f%5Cu65b9%5Cu9762%5Cu6ca1%5Cu6709%5Cu4efb%5Cu4f55%5Cu95ee%5Cu9898%5Cu3002%5Cu4e0d%5Cu540c%5Cu645e%5Cu7684%5Cu5976%5Cu725b%5Cu5728%5Cu4e0b%5Cu843d%5Cu7684%5Cu8fc7%5Cu7a0b%5Cu4e2d%5Cu4e0d%5Cu4f1a%5Cu76f8%5Cu4e92%5Cu201c%5Cu5e72%5Cu6270%5Cu201d%5Cuff0c%5Cu6240%5Cu4ee5%5Cu6bcf%5Cu5934%5Cu5976%5Cu725b%5Cu90fd%5Cu4f1a%5Cu843d%5Cu5728%5Cu9884%5Cu671f%5Cu7684%5Cu5e73%5Cu53f0%5Cu4e0a%5Cu3002%5Cu7136%5Cu540e%5Cu6240%5Cu6709%5Cu843d%5Cu5728%5Cu540c%5Cu4e00%5Cu5e73%5Cu53f0%5Cu4e0a%5Cu7684%5Cu5976%5Cu725b%5Cu53c8%5Cu4f1a%5Cu91cd%5Cu65b0%5Cu53e0%5Cu6210%5Cu4e00%5Cu645e%5Cuff0c%5Cu8fd9%5Cu6b21%5Cu5979%5Cu4eec%5Cu4e0d%5Cu4f1a%5Cu518d%5Cu843d%5Cu4e0b%5Cu6765%5Cu3002%5Cn%5Cn%5Cu6307%5Cu6325%5Cu8ba4%5Cu4e3a%5Cuff0c%5Cu5982%5Cu679c%5Cu5728%5Cu5976%5Cu725b%5Cu4eec%5Cu843d%5Cu4e0b%5Cu4e4b%5Cu540e%5Cuff0c%5Cu6bcf%5Cu4e2a%5Cu5e73%5Cu53f0%5Cu4e0a%5Cu65b0%5Cu7684%5Cu90a3%5Cu4e00%5Cu645e%5Cu5976%5Cu725b%5Cu7684%5Cu6570%5Cu91cf%5Cu548c%5Cu539f%5Cu6765%5Cu8fd9%5Cu4e2a%5Cu5e73%5Cu53f0%5Cu4e0a%5Cu7684%5Cu90a3%5Cu4e00%5Cu645e%5Cu5976%5Cu725b%5Cu6570%5Cu91cf%5Cu76f8%5Cu7b49%5Cu7684%5Cu8bdd%5Cuff0c%5Cu8fd9%5Cu6b21%5Cu8868%5Cu6f14%5Cu5c31%5Cu4f1a%5Cu683c%5Cu5916%5Cu6fc0%5Cu52a8%5Cu4eba%5Cu5fc3%5Cu3002%5Cu6211%5Cu4eec%5Cu628a%5Cu6ee1%5Cu8db3%5Cu8fd9%5Cu79cd%5Cu6027%5Cu8d28%5Cu7684%5Cu5404%5Cu645e%5Cu5976%5Cu725b%5Cu7684%5Cu6570%5Cu91cf%5Cu6392%5Cu5217%5Cu79f0%5Cu4e3a%5Cu662f%5Cu201c%5Cu9b54%5Cu5e7b%5Cu7684%5Cu201d%5Cu3002%5Cu8bf7%5Cu5e2e%5Cu52a9%5Cu5976%5Cu725b%5Cu8ba1%5Cu7b97%5Cu9b54%5Cu5e7b%5Cu7684%5Cu6392%5Cu5217%5Cu6570%5Cu3002%5Cu7531%5Cu4e8e%5Cu8fd9%5Cu4e2a%5Cu6570%5Cu5b57%5Cu53ef%5Cu80fd%5Cu975e%5Cu5e38%5Cu5927%5Cuff0c%5Cu8ba1%5Cu7b97%5Cu8be5%5Cu6570mod%20%2410%5E9%20%2B%207%24%5Cu7684%5Cu4f59%5Cu6570%5Cu3002%5Cn%5Cn%5Cu4e24%5Cu4e2a%5Cu6392%5Cu5217%5Cu88ab%5Cu8ba4%5Cu4e3a%5Cu662f%5Cu4e0d%5Cu540c%5Cu7684%5Cuff0c%5Cu5982%5Cu679c%5Cu8fd9%5Cu4e24%5Cu4e2a%5Cu6392%5Cu5217%5Cu5728%5Cu4efb%5Cu4f55%5Cu4e00%5Cu4e2a%5Cu5e73%5Cu53f0%5Cu4e0a%5Cu5206%5Cu914d%5Cu4e86%5Cu4e0d%5Cu540c%5Cu6570%5Cu91cf%5Cu7684%5Cu5976%5Cu725b%5Cu3002%5Cn%5Cn%5Cu8f93%5Cu5165%5Cu683c%5Cu5f0f%5Cuff08%5Cu6587%5Cu4ef6%5Cu540d%5Cuff1agymnasts.in%5Cuff09%5Cuff1a%5Cn%5Cu8f93%5Cu5165%5Cu5305%5Cu542b%5Cu4e00%5Cu4e2a%5Cu6574%5Cu6570%24N%24%5Cuff08%241%20%5C%5Cleq%20N%20%5C%5Cleq%2010%5E%7B12%7D%24%5Cuff09%5Cu3002%5Cn%5Cn%5Cu8f93%5Cu51fa%5Cu683c%5Cu5f0f%5Cuff08%5Cu6587%5Cu4ef6%5Cu540d%5Cuff1agymnasts.out%5Cuff09%5Cuff1a%5Cn%5Cu8f93%5Cu51fa%5Cu4e00%5Cu4e2a%5Cu6574%5Cu6570%5Cuff0c%5Cu4e3a%5Cu9b54%5Cu5e7b%5Cu7684%5Cu6392%5Cu5217%5Cu6570mod%20%2410%5E9%20%2B%207%24%5Cu7684%5Cu4f59%5Cu6570%5Cu3002%22%2C%22tags%22%3A%5B35%2C46%5D%2C%22wantsTranslation%22%3Afalse%2C%22totalSubmit%22%3A79%2C%22totalAccepted%22%3A31%2C%22pid%22%3A%22P4270%22%2C%22title%22%3A%22%5BUSACO18FEB%5DCow%20Gymnasts%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22P%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%7B%22pid%22%3A%22P4186%22%2C%22title%22%3A%22%5BUSACO18JAN%5DCow%20at%20Large%20G%22%2C%22difficulty%22%3A5%2C%22type%22%3A%22P%22%7D%2C%7B%22pid%22%3A%22P4187%22%2C%22title%22%3A%22%5BUSACO18JAN%5DStamp%20Painting%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22P%22%7D%2C%7B%22pid%22%3A%22P4088%22%2C%22title%22%3A%22%5BUSACO18FEB%5DSlingshot%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22P%22%7D%2C%7B%22pid%22%3A%22P4271%22%2C%22title%22%3A%22%5BUSACO18FEB%5DNew%20Barns%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22P%22%7D%2C%7B%22pid%22%3A%22P5202%22%2C%22title%22%3A%22%5BUSACO19JAN%5DRedistricting%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22P%22%7D%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22%5BUSACO18FEB%5DCow%20Gymnasts%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1573286098;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>[USACO18FEB]Cow Gymnasts</h1>
<h2>题意翻译</h2>
<div>厌倦了农场生活，奶牛们变卖了所有尘世的财产，加入了一支巡回马戏团。到现在为止，奶牛们已经能够进行简单的表演了：耍火把、走钢丝、骑独轮车——没什么是拥有灵巧蹄子的奶牛做不到的。但是，马戏团指挥想要为他们的下一次演出创作一个更加激动人心的表演。
新的表演所用的舞台由$N$个围成一圈的平台组成。在每个平台上，$1$至$N$头奶牛叠成一摞，一头叠在一头上面。当指挥给出信号的时候，每摞奶牛同时顺时针落下，最下面的奶牛不动，在她上面的奶牛顺时针移动一个平台，再上面的奶牛顺时针移动两个平台，等等。作为技艺高超的体操家，奶牛们明白她们在这个表演的技术方面没有任何问题。不同摞的奶牛在下落的过程中不会相互“干扰”，所以每头奶牛都会落在预期的平台上。然后所有落在同一平台上的奶牛又会重新叠成一摞，这次她们不会再落下来。
指挥认为，如果在奶牛们落下之后，每个平台上新的那一摞奶牛的数量和原来这个平台上的那一摞奶牛数量相等的话，这次表演就会格外激动人心。我们把满足这种性质的各摞奶牛的数量排列称为是“魔幻的”。请帮助奶牛计算魔幻的排列数。由于这个数字可能非常大，计算该数mod $10^9 + 7$的余数。
两个排列被认为是不同的，如果这两个排列在任何一个平台上分配了不同数量的奶牛。
输入格式（文件名：gymnasts.in）：
输入包含一个整数$N$（$1 \leq N \leq 10^{12}$）。
输出格式（文件名：gymnasts.out）：
输出一个整数，为魔幻的排列数mod $10^9 + 7$的余数。</div>
<h2>题目描述</h2>
<div>Bored of farm life, the cows have sold all their earthly possessions and joined the crew of a traveling circus. So far, the cows had been given easy acts: juggling torches, walking tightropes, riding unicycles -- nothing a handy-hoofed cow couldn't handle. However, the ringmaster wants to create a much more dramatic act for their next show.
The stage layout for the new act involves $N$ platforms arranged in a circle. On each platform, between $1$ and $N$ cows must form a stack, cow upon cow upon cow. When the ringmaster gives the signal, all stacks must simultaneously fall clockwise, so that the bottom cow in a stack doesn't move, the cow above her moves one platform clockwise, the next cow moves two platforms clockwise, and so forth. Being accomplished gymnasts, the cows know they will have no trouble with the technical aspect of this act. The various stacks of cows will not "interfere" with each other as they fall, so every cow will land on the intended platform. All of the cows landing on a platform form a new stack, which does not fall over.
The ringmaster thinks the act will be particularly dramatic if after the stacks fall, the new stack on each platform contains the same number of cows as the original stack on that platform. We call a configuration of stack sizes "magical" if it satisfies this condition. Please help the cows by computing the number of magical configurations. Since this number may be very large, compute its remainder modulo $10^9 + 7$.
Two configurations are considered distinct if there is any platform for which the configurations assign a different number of cows.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The input is a single integer, $N$ ($1 \leq N \leq 10^{12}$).</div>
<h3>输出格式</h3>
<br />
<div>A single integer giving the number of magical configurations modulo $10^9 + 7$.</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>4</code></pre>
<h3>输出样例 #1</h3>
<pre><code>6</code></pre>
<h2>说明</h2>
<div>For $N = 4$, the valid configurations are $(1,1,1,1)$, $(2,2,2,2)$, $(3,3,3,3)$, $(4,4,4,4)$, $(2,3,2,3)$, and $(3,2,3,2)$.
Problem credits: Dhruv Rohatgi</div>
</article>
</div>
</div>
</body>
</html>
