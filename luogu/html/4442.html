<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>[COCI2017-2018#3] Portal - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573381417:OgVBmmQg6X65C7KFHqNTfRbnB+P9cV9G13vtjGdTvCo=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3A%22%22%2C%22description%22%3A%22The%20protagonist%20of%20this%20task%2C%20Chell%2C%20must%20solve%20a%20new%20puzzle%20GLaDOS%20has%20come%20up%20with.%5Cn%5CnChell%20is%20in%20a%20room%20whose%20layout%20that%20can%20be%20represented%20as%20a%20matrix%20of%20dimensions%20N%20rows%20and%20M%20columns.%20Each%20field%20can%20be%20one%20of%20the%20following%3A%5Cn%5Cn-%20Obstructed%20field%20-%20there%20is%20a%20wall%20in%20it%20%28denoted%20as%20%5Cu2018%23%5Cu2019%29%2C%5Cn-%20The%20field%20where%20Chell%20is%20initially%20%28denoted%20as%20%5Cu2018C%5Cu2019%29%2C%5Cn-%20The%20field%20where%20Chell%20must%20get%20to%20in%20order%20to%20solve%20the%20puzzle%20%28denoted%20as%20%5Cu2018F%5Cu2019%29%2C%20or%5Cn-%20An%20empty%20field%20%28denoted%20as%20%5Cu2018.%5Cu2019%29.%5Cn%5CnChell%20is%20carrying%20a%20so-called%20portal%20gun%2C%20a%20gun%20with%20which%20you%20can%20create%20portals%20in%20the%20walls.%5Cn%5CnIn%20each%20move%2C%20she%20can%20do%20one%20of%20the%20following%3A%5Cn-%20Move%20to%20an%20adjacent%20field%20using%20one%20move%20up%2C%20down%2C%20left%20or%20right%20%28she%20cannot%20move%20to%20the%20field%20with%20a%20wall%20in%20it%29.%20This%20move%20lasts%20one%20unit%20of%20time.%5Cn-%20Create%20a%20portal%20in%20the%20wall%20by%20turning%20towards%20a%20wall%2C%20not%20necessarily%20an%20adjacent%20one%2C%20in%20the%20direction%20up%2C%20down%2C%20left%20or%20right%20and%20shooting.%20The%20portal%20will%20be%20created%20only%20on%20the%20side%20of%20the%20wall%20it%20was%20hit%20from.%20In%20each%20moment%2C%20%2A%2Aat%20most%20two%20portals%20can%20be%20active%2A%2A%5Cu200b.%20If%20a%20new%20portal%20is%20being%20created%20in%20the%20moment%20when%20two%20portals%20are%20already%20active%2C%20the%20one%20that%20was%20created%20earlier%20will%20disappear.%20It%20is%20not%20possible%20to%20create%20a%20new%20portal%20at%20the%20position%20of%20another%20existing%20portal.%20This%20move%20lasts%20a%20negligible%5Cnamount%20of%20time%2C%20i.e.%20zero%20amounts%20of%20time.%5Cn-%20If%20she%5Cu2019s%20at%20a%20field%20that%20is%20adjacent%20to%20a%20wall%20and%20there%5Cu2019s%20a%20portal%20on%20her%20side%20of%20the%20wall%2C%20she%20can%20step%20into%20the%20portal%20and%20exit%20to%20a%20non-obstructed%20field%20with%20another%20portal.%20This%20move%20is%20possible%20if%20there%20are%20two%20active%20portals%20and%20lasts%20one%20unit%20of%20time.%5Cn%5CnChell%20wants%20to%20know%20the%20minimal%20amount%20of%20time%20it%20takes%20for%20her%20to%20solve%20the%20puzzle%2C%20i.e.%20to%20reach%20the%20field%20denoted%20as%20%5Cu2018F%5Cu2019.%5Cn%5Cn%2A%2APlease%20note%2A%2A%3A%20The%20room%20will%20always%20have%20walls%20on%20the%20sides%2C%20and%20letters%20%5Cu2018C%5Cu2019%20and%20%5Cu2018F%5Cu2019%20will%20appear%20only%20once%20in%20the%20matrix.%5Cn%22%2C%22inputFormat%22%3A%22The%20first%20line%20of%20input%20contains%20the%20positive%20integers%20N%20and%20M%20%284%20%5Cu2264%20N%2C%20M%20%5Cu2264%20500%29%2C%20the%20numbers%20from%20the%20task.%5Cn%5CnEach%20of%20the%20following%20N%20lines%20contains%20M%20characters%20that%20describe%20the%20layout%20of%20the%20room.%5Cn%22%2C%22outputFormat%22%3A%22You%20must%20output%20the%20minimal%20amount%20of%20time%20it%20takes%20to%20solve%20the%20puzzle%2C%20or%20%5Cu201cnemoguce%5Cu201d%20%28without%20quotation%20marks%2C%20Croatian%20for%20impossible%29%20if%20it%20is%20not%20possible%20to%20solve%20it.%5Cn%22%2C%22samples%22%3A%5B%5B%224%204%5Cn%23%23%23%23%5Cn%23.F%23%5Cn%23C.%23%5Cn%23%23%23%23%5Cn%22%2C%222%22%5D%2C%5B%226%208%5Cn%23%23%23%23%23%23%23%23%5Cn%23.%23%23..F%23%5Cn%23C.%23%23..%23%5Cn%23..%23...%23%5Cn%23.....%23%23%5Cn%23%23%23%23%23%23%23%23%5Cn%22%2C%224%22%5D%2C%5B%224%205%5Cn%23%23%23%23%23%5Cn%23C%23.%23%5Cn%23%23%23F%23%5Cn%23%23%23%23%23%5Cn%22%2C%22nemoguce%5Cn%22%5D%5D%2C%22hint%22%3A%22In%20test%20cases%20worth%2050%25%20of%20total%20points%2C%20it%20will%20hold%204%20%5Cu2264%20N%2C%20M%20%5Cu2264%2015.%5Cn%5Cn%2A%2AClarification%5Cu200b%20%5Cu200bof%5Cu200b%20%5Cu200bthe%5Cu200b%20%5Cu200bsecond%5Cu200b%20%5Cu200btest%5Cu200b%20%5Cu200bcase%3A%2A%2A%5Cn%5CnThe%20puzzle%20can%20be%20solved%20in%208%20moves%2C%20illustrated%20in%20the%20pictures%20below.%5Cn%5CnIn%20the%20first%20move%2C%20we%20turn%20towards%20the%20left%20wall%2C%20shoot%20and%20create%20a%20portal%20that%20appears%20on%20the%20wall%20in%20the%20%243%5E%7Brd%7D%24%20row%20and%20%241%5E%7Bst%7D%24%20column%20%28coordinates%20%283%2C1%29%29%20from%20the%20right%20side.%5Cn%5CnIn%20the%20second%20move%2C%20we%20create%20a%20portal%20from%20the%20upper%20side%20of%20the%20wall%20at%20coordinates%20%286%2C2%29.%5Cn%5CnIn%20the%20third%20move%2C%20we%20step%20into%20the%20portal%20at%20coordinates%20%283%2C1%29%20and%20exit%20at%20coordinates%20%285%2C2%29%20-%20a%5Cnnon-obstructed%20field%20with%20the%20second%20portal.%5Cn%5CnIn%20the%20fourth%20move%2C%20we%20turn%20right%20and%20create%20a%20portal%20from%20the%20left%20side%20of%20the%20wall%20at%20coordinates%20%285%2C7%29.%5CnSince%20there%20are%20already%20two%20portals%2C%20the%20one%20at%20field%20%283%2C1%29%20disappears.%5Cn%5CnIn%20the%20fifth%20move%2C%20we%20step%20into%20the%20portal%20at%20coordinates%20%286%2C2%29%20and%20exit%20at%20coordinates%20%285%2C6%29%20with%20the%5Cnsecond%20portal.%5Cn%5CnIn%20the%20sixth%20move%2C%20we%20create%20a%20new%20portal%20from%20the%20lower%20side%20of%20the%20wall%20at%20coordinates%20%281%2C6%29%2C%20making%5Cnthe%20portal%20at%20coordinates%20%286%2C2%29%20disappear.%5Cn%5CnIn%20the%20seventh%20move%2C%20we%20step%20into%20the%20portal%20at%20coordinates%20%285%2C7%29%20and%20exit%20at%20coordinates%20%282%2C6%29.%5CnFinally%2C%20in%20the%20eighth%20move%2C%20we%20move%20one%20place%20to%20the%20right%20to%20end%20the%20game.%5Cn%5CnThe%20portal%20creation%20in%20moves%201%2C%202%2C%204%20and%206%20lasts%20zero%20amounts%20of%20time%2C%20whereas%20the%20rest%20of%20the%20move%5Cnlast%20one%20unit%20of%20time%2C%20so%20the%20total%20time%20needed%20to%20solve%20the%20puzzle%20is%204%20units%20of%20time.%5Cn%5Cn%21%5B%5D%28https%3A%5C%2F%5C%2Fcdn.luogu.com.cn%5C%2Fupload%5C%2Fpic%5C%2F17512.png%29%22%2C%22provider%22%3A%7B%22uid%22%3A50092%2C%22name%22%3A%22da32s1da%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3Anull%2C%22isAdmin%22%3Afalse%2C%22color%22%3A%22Blue%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%2C1000%5D%2C%22memory%22%3A%5B256000%2C256000%2C256000%2C256000%2C256000%2C256000%2C256000%2C256000%2C256000%2C256000%2C256000%2C256000%2C256000%2C256000%2C256000%2C256000%2C256000%2C256000%2C256000%2C256000%2C256000%2C256000%2C256000%2C256000%2C256000%2C256000%2C256000%2C256000%2C256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22translation%22%3A%22%5Cu9898%5Cu76ee%5Cu5927%5Cu610f%3A%5Cn%5Cn%5Cu7ed9%5Cu5b9a%5Cu4e00%5Cu4e2a%5Cu77e9%5Cu9635%5Cuff0c%5Cu6bcf%5Cu4e2a%5Cu683c%5Cu5b50%5Cu7531%5Cu4e0b%5Cu5217%5Cu5b57%5Cu6bcd%5Cu8868%5Cu793a%5Cuff1a%5Cn%5Cn%5Cu25cf%5Cu6709%5Cu969c%5Cu788d%5Cu7684%5Cu533a%5Cu57df%5Cu8868%5Cu793a%5Cu4e3a%5Cu2018%23%5Cu2019%5Cn%5Cn%5Cu25cf%20%5Cu521d%5Cu59cb%5Cu4f4d%5Cu7f6e%5Cu8868%5Cu793a%5Cu4e3a%5Cu2018C%5Cu2019%5Cn%5Cn%5Cu25cf%20%5Cu76ee%5Cu6807%5Cu4f4d%5Cu7f6e%5Cu8868%5Cu793a%5Cu4e3a%20%5Cu2018F%5Cu2019%5Cn%5Cn%5Cu25cf%20%5Cu7a7a%5Cu767d%5Cu533a%5Cu57df%5Cu8868%5Cu793a%5Cu4e3a%5Cu2018.%5Cu2019%5Cn%5Cn%5Cu53ef%5Cu4ee5%5Cu8fdb%5Cu884c%5Cu4e09%5Cu79cd%5Cu64cd%5Cu4f5c%5Cuff1a%5Cn%5Cu25cf%5Cu8d70%5Cu5230%5Cu4e0a%5Cu4e0b%5Cu5de6%5Cu53f3%5Cu76f8%5Cu90bb%5Cu7684%5Cu683c%5Cu5b50%5Cuff0c%5Cu4e0d%5Cu80fd%5Cu8d70%5Cu5230%5Cu6709%5Cu5899%5Cu7684%5Cu533a%5Cu57df%5Cu4e0a%5Cuff0c%5Cu6d88%5Cu8017%5Cu4e00%5Cu4e2a%5Cu5355%5Cu4f4d%5Cu65f6%5Cu95f4%5Cu3002%5Cn%5Cn%5Cu25cf%5Cu5728%5Cu5899%5Cu58c1%5Cu4e0a%5Cu521b%5Cu5efa%5Cu4f20%5Cu9001%5Cu95e8%5Cuff0c%5Cu7528%5Cu67aa%5Cu5411%5Cu4e0a%5Cu3001%5Cu5411%5Cu4e0b%5Cu3001%5Cu5411%5Cu5de6%5Cuff0c%5Cu5411%5Cu53f3%5Cu76f4%5Cu5c04%5Cu5411%5Cu7740%5Cu5899%5Cu58c1%5Cu3002%5Cu4f20%5Cu9001%5Cu95e8%5Cu4f1a%5Cu5728%5Cu88ab%5Cu51fb%5Cu4e2d%5Cu7684%5Cu5899%5Cu7684%5Cu4e00%5Cu4fa7%5Cu4ea7%5Cu751f%5Cu3002%5Cu5728%5Cu6bcf%5Cu4e00%5Cu65f6%5Cu523b%5Cuff0c%5Cu6700%5Cu591a%5Cu4e24%5Cu4e2a%5Cu4f20%5Cu9001%5Cu95e8%5Cu53ef%5Cu4ee5%5Cu662f%5Cu6d3b%5Cu52a8%5Cu7684%5Cu3002%5Cu5982%5Cu679c%5Cu5728%5Cu5df2%5Cu6709%5Cu4e24%5Cu4e2a%5Cu4f20%5Cu9001%5Cu95e8%5Cu7684%5Cu57fa%5Cu7840%5Cu4e0a%5Cu518d%5Cu5c04%5Cu51fb%5Cu521b%5Cu5efa%5Cu4e86%5Cu4e00%5Cu4e2a%5Cu65b0%5Cu7684%5Cuff0c%5Cu90a3%5Cu4e48%5Cu8f83%5Cu65e9%5Cu521b%5Cu5efa%5Cu7684%5Cu95e8%5Cu5c06%5Cu6d88%5Cu5931%5Cu3002%5Cu8fd9%5Cu4e2a%5Cu5c04%5Cu51fb%5Cu6d88%5Cu8017%5Cu7684%5Cu65f6%5Cu95f4%5Cu53ef%5Cu5ffd%5Cu7565%5Cu3002%5Cn%5Cn%5Cu25cf%5Cu5982%5Cu679c%5Cu5979%5Cu5728%5Cu4e00%5Cu4e2a%5Cu9760%5Cu8fd1%5Cu5899%5Cu7684%5Cu5730%5Cu65b9%5Cuff0c%5Cu5899%5Cu4e0a%5Cu6709%5Cu4e00%5Cu4e2a%5Cu4f20%5Cu9001%5Cu95e8%5Cuff0c%5Cu5979%5Cu53ef%5Cu4ee5%5Cu8fdb%5Cu5165%5Cuff0c%5Cu5230%5Cu8fbe%5Cu53e6%5Cu4e00%5Cu4e2a%5Cu95e8%5Cu5916%5Cu7684%5Cu65e0%5Cu969c%5Cu788d%5Cu533a%5Cu57df%5Cu51fa%5Cu6765%5Cuff0c%5Cu9700%5Cu8981%5Cu6d88%5Cu8017%5Cu4e00%5Cu4e2a%5Cu5355%5Cu4f4d%5Cu65f6%5Cu95f4%5Cu3002%5Cn%5Cn%5Cu6c42%5Cu5230%5Cu8fbe%5Cu76ee%5Cu7684%5Cu5730%5Cu201cF%5Cu201d%5Cu6240%5Cu9700%5Cu7684%5Cu6700%5Cu5c11%5Cu65f6%5Cu95f4%22%2C%22tags%22%3A%5B7%2C34%2C160%2C164%2C319%2C333%5D%2C%22wantsTranslation%22%3Afalse%2C%22totalSubmit%22%3A296%2C%22totalAccepted%22%3A63%2C%22pid%22%3A%22P4442%22%2C%22title%22%3A%22%5BCOCI2017-2018%233%5D%20Portal%20%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22P%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%7B%22id%22%3A58547%2C%22title%22%3A%22%5Cu8d21%5Cu732e%5Cu7ffb%5Cu8bd1%22%2C%22forum%22%3A%7B%22id%22%3A25161%2C%22name%22%3A%22P4442%20%5BCOCI2017-2018%233%5D%20Portal%20%22%2C%22slug%22%3A%22P4442%22%7D%7D%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%7B%22pid%22%3A%22P4139%22%2C%22title%22%3A%22%5Cu4e0a%5Cu5e1d%5Cu4e0e%5Cu96c6%5Cu5408%5Cu7684%5Cu6b63%5Cu786e%5Cu7528%5Cu6cd5%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22P%22%7D%2C%7B%22pid%22%3A%22CF451E%22%2C%22title%22%3A%22Devu%20and%20Flowers%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22CF%22%7D%2C%7B%22pid%22%3A%22P4443%22%2C%22title%22%3A%22%5BCOCI2017-2018%233%5D%20Dojave%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22P%22%7D%2C%7B%22pid%22%3A%22P4444%22%2C%22title%22%3A%22%5BCOCI2017-2018%233%5D%20Sa%5Cu017eetak%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22P%22%7D%2C%7B%22pid%22%3A%22CF1198C%22%2C%22title%22%3A%22Matching%20vs%20Independent%20Set%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22CF%22%7D%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22%5BCOCI2017-2018%233%5D%20Portal%20%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1573286098;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>[COCI2017-2018#3] Portal </h1>
<h2>题意翻译</h2>
<div>题目大意:
给定一个矩阵，每个格子由下列字母表示：
●有障碍的区域表示为‘#’
● 初始位置表示为‘C’
● 目标位置表示为 ‘F’
● 空白区域表示为‘.’
可以进行三种操作：
●走到上下左右相邻的格子，不能走到有墙的区域上，消耗一个单位时间。
●在墙壁上创建传送门，用枪向上、向下、向左，向右直射向着墙壁。传送门会在被击中的墙的一侧产生。在每一时刻，最多两个传送门可以是活动的。如果在已有两个传送门的基础上再射击创建了一个新的，那么较早创建的门将消失。这个射击消耗的时间可忽略。
●如果她在一个靠近墙的地方，墙上有一个传送门，她可以进入，到达另一个门外的无障碍区域出来，需要消耗一个单位时间。
求到达目的地“F”所需的最少时间</div>
<h2>题目描述</h2>
<div>The protagonist of this task, Chell, must solve a new puzzle GLaDOS has come up with.
Chell is in a room whose layout that can be represented as a matrix of dimensions N rows and M columns. Each field can be one of the following:
- Obstructed field - there is a wall in it (denoted as ‘#’),
- The field where Chell is initially (denoted as ‘C’),
- The field where Chell must get to in order to solve the puzzle (denoted as ‘F’), or
- An empty field (denoted as ‘.’).
Chell is carrying a so-called portal gun, a gun with which you can create portals in the walls.
In each move, she can do one of the following:
- Move to an adjacent field using one move up, down, left or right (she cannot move to the field with a wall in it). This move lasts one unit of time.
- Create a portal in the wall by turning towards a wall, not necessarily an adjacent one, in the direction up, down, left or right and shooting. The portal will be created only on the side of the wall it was hit from. In each moment, **at most two portals can be active**​. If a new portal is being created in the moment when two portals are already active, the one that was created earlier will disappear. It is not possible to create a new portal at the position of another existing portal. This move lasts a negligible
amount of time, i.e. zero amounts of time.
- If she’s at a field that is adjacent to a wall and there’s a portal on her side of the wall, she can step into the portal and exit to a non-obstructed field with another portal. This move is possible if there are two active portals and lasts one unit of time.
Chell wants to know the minimal amount of time it takes for her to solve the puzzle, i.e. to reach the field denoted as ‘F’.
**Please note**: The room will always have walls on the sides, and letters ‘C’ and ‘F’ will appear only once in the matrix.
</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line of input contains the positive integers N and M (4 ≤ N, M ≤ 500), the numbers from the task.
Each of the following N lines contains M characters that describe the layout of the room.
</div>
<h3>输出格式</h3>
<br />
<div>You must output the minimal amount of time it takes to solve the puzzle, or “nemoguce” (without quotation marks, Croatian for impossible) if it is not possible to solve it.
</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>4 4
####
#.F#
#C.#
####
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>2</code></pre>
<h3>输入样例 #2</h3>
<pre><code>6 8
########
#.##..F#
#C.##..#
#..#...#
#.....##
########
</code></pre>
<h3>输出样例 #2</h3>
<pre><code>4</code></pre>
<h3>输入样例 #3</h3>
<pre><code>4 5
#####
#C#.#
###F#
#####
</code></pre>
<h3>输出样例 #3</h3>
<pre><code>nemoguce
</code></pre>
<h2>说明</h2>
<div>In test cases worth 50% of total points, it will hold 4 ≤ N, M ≤ 15.
**Clarification​ ​of​ ​the​ ​second​ ​test​ ​case:**
The puzzle can be solved in 8 moves, illustrated in the pictures below.
In the first move, we turn towards the left wall, shoot and create a portal that appears on the wall in the $3^{rd}$ row and $1^{st}$ column (coordinates (3,1)) from the right side.
In the second move, we create a portal from the upper side of the wall at coordinates (6,2).
In the third move, we step into the portal at coordinates (3,1) and exit at coordinates (5,2) - a
non-obstructed field with the second portal.
In the fourth move, we turn right and create a portal from the left side of the wall at coordinates (5,7).
Since there are already two portals, the one at field (3,1) disappears.
In the fifth move, we step into the portal at coordinates (6,2) and exit at coordinates (5,6) with the
second portal.
In the sixth move, we create a new portal from the lower side of the wall at coordinates (1,6), making
the portal at coordinates (6,2) disappear.
In the seventh move, we step into the portal at coordinates (5,7) and exit at coordinates (2,6).
Finally, in the eighth move, we move one place to the right to end the game.
The portal creation in moves 1, 2, 4 and 6 lasts zero amounts of time, whereas the rest of the move
last one unit of time, so the total time needed to solve the puzzle is 4 units of time.
![](https://cdn.luogu.com.cn/upload/pic/17512.png)</div>
</article>
</div>
</div>
</body>
</html>
