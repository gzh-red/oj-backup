# 【模板】树链剖分

## 题目描述

如题，已知一棵包含N个结点的树（连通且无环），每个节点上包含一个数值，需要支持以下操作：

操作1： 格式： 1 x y z 表示将树从x到y结点最短路径上所有节点的值都加上z

操作2： 格式： 2 x y 表示求树从x到y结点最短路径上所有节点的值之和

操作3： 格式： 3 x z 表示将以x为根节点的子树内所有节点值都加上z

操作4： 格式： 4 x 表示求以x为根节点的子树内所有节点值之和

## 输入输出格式

### 输入格式

第一行包含4个正整数N、M、R、P，分别表示树的结点个数、操作个数、根节点序号和取模数（**即所有的输出结果均对此取模**）。

接下来一行包含N个非负整数，分别依次表示各个节点上初始的数值。

接下来N-1行每行包含两个整数x、y，表示点x和点y之间连有一条边（保证无环且连通）

接下来M行每行包含若干个正整数，每行表示一个操作，格式如下：

操作1： 1 x y z

操作2： 2 x y

操作3： 3 x z

操作4： 4 x

### 输出格式

输出包含若干行，分别依次表示每个操作2或操作4所得的结果（**对P取模**）

## 输入输出样例

### 输入样例 #1

```cpp
5 5 2 24
7 3 7 8 0 
1 2
1 5
3 1
4 1
3 4 2
3 2 2
4 5
1 5 1 3
2 1 3
```


### 输出样例 #1

```cpp
2
21
```


## 说明

时空限制：1s，128M

数据规模：

对于30%的数据： $ N \leq 10, M \leq 10 $

对于70%的数据： $ N \leq {10}^3, M \leq {10}^3 $

对于100%的数据： $ N \leq {10}^5, M \leq {10}^5 $

（ ~~其实，纯随机生成的树LCA+暴力是能过的，可是，你觉得可能是纯随机的么233~~ ）

样例说明：

树的结构如下：

![](https://cdn.luogu.com.cn/upload/pic/2319.png)

各个操作如下：

![](https://cdn.luogu.com.cn/upload/pic/2320.png)

故输出应依次为2、21(**重要的事情说三遍：记得取模**)

