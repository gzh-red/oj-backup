<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Paths in a Complete Binary Tree - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573397907:CeKp2AoPjBuxxZhn79mxfpONLgqjCfo1s8jtoBSKwWU=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22%20%24%20T%20%24%20is%20a%20complete%20binary%20tree%20consisting%20of%20%24%20n%20%24%20vertices.%20It%20means%20that%20exactly%20one%20vertex%20is%20a%20root%2C%20and%20each%20vertex%20is%20either%20a%20leaf%20%28and%20doesn%27t%20have%20children%29%20or%20an%20inner%20node%20%28and%20has%20exactly%20two%20children%29.%20All%20leaves%20of%20a%20complete%20binary%20tree%20have%20the%20same%20depth%20%28distance%20from%20the%20root%29.%20So%20%24%20n%20%24%20is%20a%20number%20such%20that%20%24%20n%2B1%20%24%20is%20a%20power%20of%20%24%202%20%24%20.%5Cn%5CnIn%20the%20picture%20you%20can%20see%20a%20complete%20binary%20tree%20with%20%24%20n%3D15%20%24%20.%5Cn%5Cn%20%21%5B%5D%28https%3A%5C%2F%5C%2Fcdn.luogu.com.cn%5C%2Fupload%5C%2Fvjudge_pic%5C%2FCF792D%5C%2F653f6c4875f17ae6f17eafa38c499699f6610ec9.png%29Vertices%20are%20numbered%20from%20%24%201%20%24%20to%20%24%20n%20%24%20in%20a%20special%20recursive%20way%3A%20we%20recursively%20assign%20numbers%20to%20all%20vertices%20from%20the%20left%20subtree%20%28if%20current%20vertex%20is%20not%20a%20leaf%29%2C%20then%20assign%20a%20number%20to%20the%20current%20vertex%2C%20and%20then%20recursively%20assign%20numbers%20to%20all%20vertices%20from%20the%20right%20subtree%20%28if%20it%20exists%29.%20In%20the%20picture%20vertices%20are%20numbered%20exactly%20using%20this%20algorithm.%20It%20is%20clear%20that%20for%20each%20size%20of%20a%20complete%20binary%20tree%20exists%20exactly%20one%20way%20to%20give%20numbers%20to%20all%20vertices.%20This%20way%20of%20numbering%20is%20called%20symmetric.%5Cn%5CnYou%20have%20to%20write%20a%20program%20that%20for%20given%20%24%20n%20%24%20answers%20%24%20q%20%24%20queries%20to%20the%20tree.%5Cn%5CnEach%20query%20consists%20of%20an%20integer%20number%20%24%20u_%7Bi%7D%20%24%20%28%20%24%201%3C%3Du_%7Bi%7D%3C%3Dn%20%24%20%29%20and%20a%20string%20%24%20s_%7Bi%7D%20%24%20%2C%20where%20%24%20u_%7Bi%7D%20%24%20is%20the%20number%20of%20vertex%2C%20and%20%24%20s_%7Bi%7D%20%24%20represents%20the%20path%20starting%20from%20this%20vertex.%20String%20%24%20s_%7Bi%7D%20%24%20doesn%27t%20contain%20any%20characters%20other%20than%20%27L%27%2C%20%27R%27%20and%20%27U%27%2C%20which%20mean%20traverse%20to%20the%20left%20child%2C%20to%20the%20right%20child%20and%20to%20the%20parent%2C%20respectively.%20Characters%20from%20%24%20s_%7Bi%7D%20%24%20have%20to%20be%20processed%20from%20left%20to%20right%2C%20considering%20that%20%24%20u_%7Bi%7D%20%24%20is%20the%20vertex%20where%20the%20path%20starts.%20If%20it%27s%20impossible%20to%20process%20a%20character%20%28for%20example%2C%20to%20go%20to%20the%20left%20child%20of%20a%20leaf%29%2C%20then%20you%20have%20to%20skip%20it.%20The%20answer%20is%20the%20number%20of%20vertex%20where%20the%20path%20represented%20by%20%24%20s_%7Bi%7D%20%24%20ends.%5Cn%5CnFor%20example%2C%20if%20%24%20u_%7Bi%7D%3D4%20%24%20and%20%24%20s_%7Bi%7D%3D%20%24%20%5Cu00abUURL%5Cu00bb%2C%20then%20the%20answer%20is%20%24%2010%20%24%20.%22%2C%22inputFormat%22%3A%22The%20first%20line%20contains%20two%20integer%20numbers%20%24%20n%20%24%20and%20%24%20q%20%24%20%28%20%24%201%3C%3Dn%3C%3D10%5E%7B18%7D%20%24%20%2C%20%24%20q%3E%3D1%20%24%20%29.%20%24%20n%20%24%20is%20such%20that%20%24%20n%2B1%20%24%20is%20a%20power%20of%20%24%202%20%24%20.%5Cn%5CnThe%20next%20%24%202q%20%24%20lines%20represent%20queries%3B%20each%20query%20consists%20of%20two%20consecutive%20lines.%20The%20first%20of%20these%20two%20lines%20contains%20%24%20u_%7Bi%7D%20%24%20%28%20%24%201%3C%3Du_%7Bi%7D%3C%3Dn%20%24%20%29%2C%20the%20second%20contains%20non-empty%20string%20%24%20s_%7Bi%7D%20%24%20.%20%24%20s_%7Bi%7D%20%24%20doesn%27t%20contain%20any%20characters%20other%20than%20%27L%27%2C%20%27R%27%20and%20%27U%27.%5Cn%5CnIt%20is%20guaranteed%20that%20the%20sum%20of%20lengths%20of%20%24%20s_%7Bi%7D%20%24%20%28for%20each%20%24%20i%20%24%20such%20that%20%24%201%3C%3Di%3C%3Dq%20%24%20%29%20doesn%27t%20exceed%20%24%2010%5E%7B5%7D%20%24%20.%22%2C%22outputFormat%22%3A%22Print%20%24%20q%20%24%20numbers%2C%20%24%20i%20%24%20-th%20number%20must%20be%20the%20answer%20to%20the%20%24%20i%20%24%20-th%20query.%22%2C%22samples%22%3A%5B%5B%2215%202%5Cn4%5CnUURL%5Cn8%5CnLRLLLLLLLL%5Cn%22%2C%2210%5Cn5%5Cn%22%5D%5D%2C%22hint%22%3A%22%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B3000%5D%2C%22memory%22%3A%5B256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F792%5C%2FD%22%2C%22id%22%3A%22792D%22%7D%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Atrue%2C%22totalSubmit%22%3A24%2C%22totalAccepted%22%3A9%2C%22pid%22%3A%22CF792D%22%2C%22title%22%3A%22Paths%20in%20a%20Complete%20Binary%20Tree%22%2C%22difficulty%22%3A5%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Paths%20in%20a%20Complete%20Binary%20Tree%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1572920822;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Paths in a Complete Binary Tree</h1>
<h2>题目描述</h2>
<div> $ T $ is a complete binary tree consisting of $ n $ vertices. It means that exactly one vertex is a root, and each vertex is either a leaf (and doesn't have children) or an inner node (and has exactly two children). All leaves of a complete binary tree have the same depth (distance from the root). So $ n $ is a number such that $ n+1 $ is a power of $ 2 $ .
In the picture you can see a complete binary tree with $ n=15 $ .
![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF792D/653f6c4875f17ae6f17eafa38c499699f6610ec9.png)Vertices are numbered from $ 1 $ to $ n $ in a special recursive way: we recursively assign numbers to all vertices from the left subtree (if current vertex is not a leaf), then assign a number to the current vertex, and then recursively assign numbers to all vertices from the right subtree (if it exists). In the picture vertices are numbered exactly using this algorithm. It is clear that for each size of a complete binary tree exists exactly one way to give numbers to all vertices. This way of numbering is called symmetric.
You have to write a program that for given $ n $ answers $ q $ queries to the tree.
Each query consists of an integer number $ u_{i} $ ( $ 1<=u_{i}<=n $ ) and a string $ s_{i} $ , where $ u_{i} $ is the number of vertex, and $ s_{i} $ represents the path starting from this vertex. String $ s_{i} $ doesn't contain any characters other than 'L', 'R' and 'U', which mean traverse to the left child, to the right child and to the parent, respectively. Characters from $ s_{i} $ have to be processed from left to right, considering that $ u_{i} $ is the vertex where the path starts. If it's impossible to process a character (for example, to go to the left child of a leaf), then you have to skip it. The answer is the number of vertex where the path represented by $ s_{i} $ ends.
For example, if $ u_{i}=4 $ and $ s_{i}= $ «UURL», then the answer is $ 10 $ .</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line contains two integer numbers $ n $ and $ q $ ( $ 1<=n<=10^{18} $ , $ q>=1 $ ). $ n $ is such that $ n+1 $ is a power of $ 2 $ .
The next $ 2q $ lines represent queries; each query consists of two consecutive lines. The first of these two lines contains $ u_{i} $ ( $ 1<=u_{i}<=n $ ), the second contains non-empty string $ s_{i} $ . $ s_{i} $ doesn't contain any characters other than 'L', 'R' and 'U'.
It is guaranteed that the sum of lengths of $ s_{i} $ (for each $ i $ such that $ 1<=i<=q $ ) doesn't exceed $ 10^{5} $ .</div>
<h3>输出格式</h3>
<br />
<div>Print $ q $ numbers, $ i $ -th number must be the answer to the $ i $ -th query.</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>15 2
4
UURL
8
LRLLLLLLLL
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>10
5
</code></pre>
</article>
</div>
</div>
</body>
</html>
