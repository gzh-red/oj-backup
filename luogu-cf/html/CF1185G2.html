<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Playlist for Polycarp (hard version) - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573402796:lHEc4lgLrP3EaPFsfU1Xfi2B9K9R9qBW5xTqOtURT48=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22The%20only%20difference%20between%20easy%20and%20hard%20versions%20is%20constraints.%5Cn%5CnPolycarp%20loves%20to%20listen%20to%20music%2C%20so%20he%20never%20leaves%20the%20player%2C%20even%20on%20the%20way%20home%20from%20the%20university.%20Polycarp%20overcomes%20the%20distance%20from%20the%20university%20to%20the%20house%20in%20exactly%20%24%20T%20%24%20minutes.%5Cn%5CnIn%20the%20player%2C%20Polycarp%20stores%20%24%20n%20%24%20songs%2C%20each%20of%20which%20is%20characterized%20by%20two%20parameters%3A%20%24%20t_i%20%24%20and%20%24%20g_i%20%24%20%2C%20where%20%24%20t_i%20%24%20is%20the%20length%20of%20the%20song%20in%20minutes%20%28%20%24%201%20%5C%5Cle%20t_i%20%5C%5Cle%2050%20%24%20%29%2C%20%24%20g_i%20%24%20is%20its%20genre%20%28%20%24%201%20%5C%5Cle%20g_i%20%5C%5Cle%203%20%24%20%29.%5Cn%5CnPolycarp%20wants%20to%20create%20such%20a%20playlist%20so%20that%20he%20can%20listen%20to%20music%20all%20the%20time%20on%20the%20way%20from%20the%20university%20to%20his%20home%2C%20and%20at%20the%20time%20of%20his%20arrival%20home%2C%20the%20playlist%20is%20over.%20Polycarp%20never%20interrupts%20songs%20and%20always%20listens%20to%20them%20from%20beginning%20to%20end.%20Thus%2C%20if%20he%20started%20listening%20to%20the%20%24%20i%20%24%20-th%20song%2C%20he%20would%20spend%20exactly%20%24%20t_i%20%24%20minutes%20on%20its%20listening.%20Polycarp%20also%20does%20not%20like%20when%20two%20songs%20of%20the%20same%20genre%20play%20in%20a%20row%20%28i.e.%20successively%5C%2Fadjacently%29%20or%20when%20the%20songs%20in%20his%20playlist%20are%20repeated.%5Cn%5CnHelp%20Polycarpus%20count%20the%20number%20of%20different%20sequences%20of%20songs%20%28their%20order%20matters%29%2C%20the%20total%20duration%20is%20exactly%20%24%20T%20%24%20%2C%20such%20that%20there%20are%20no%20two%20consecutive%20songs%20of%20the%20same%20genre%20in%20them%20and%20all%20the%20songs%20in%20the%20playlist%20are%20different.%22%2C%22inputFormat%22%3A%22The%20first%20line%20of%20the%20input%20contains%20two%20integers%20%24%20n%20%24%20and%20%24%20T%20%24%20%28%20%24%201%20%5C%5Cle%20n%20%5C%5Cle%2050%2C%201%20%5C%5Cle%20T%20%5C%5Cle%202500%20%24%20%29%20%5Cu2014%20the%20number%20of%20songs%20in%20the%20player%20and%20the%20required%20total%20duration%2C%20respectively.%5Cn%5CnNext%2C%20the%20%24%20n%20%24%20lines%20contain%20descriptions%20of%20songs%3A%20the%20%24%20i%20%24%20-th%20line%20contains%20two%20integers%20%24%20t_i%20%24%20and%20%24%20g_i%20%24%20%28%20%24%201%20%5C%5Cle%20t_i%20%5C%5Cle%2050%2C%201%20%5C%5Cle%20g_i%20%5C%5Cle%203%20%24%20%29%20%5Cu2014%20the%20duration%20of%20the%20%24%20i%20%24%20-th%20song%20and%20its%20genre%2C%20respectively.%22%2C%22outputFormat%22%3A%22Output%20one%20integer%20%5Cu2014%20the%20number%20of%20different%20sequences%20of%20songs%2C%20the%20total%20length%20of%20exactly%20%24%20T%20%24%20%2C%20such%20that%20there%20are%20no%20two%20consecutive%20songs%20of%20the%20same%20genre%20in%20them%20and%20all%20the%20songs%20in%20the%20playlist%20are%20different.%20Since%20the%20answer%20may%20be%20huge%2C%20output%20it%20modulo%20%24%2010%5E9%20%2B%207%20%24%20%28that%20is%2C%20the%20remainder%20when%20dividing%20the%20quantity%20by%20%24%2010%5E9%20%2B%207%20%24%20%29.%22%2C%22samples%22%3A%5B%5B%22%5Cn3%203%5Cn1%201%5Cn1%202%5Cn1%203%5Cn%22%2C%22%5Cn6%5Cn%22%5D%2C%5B%22%5Cn3%203%5Cn1%201%5Cn1%201%5Cn1%203%5Cn%22%2C%22%5Cn2%5Cn%22%5D%2C%5B%22%5Cn4%2010%5Cn5%203%5Cn2%201%5Cn3%202%5Cn5%201%5Cn%22%2C%22%5Cn10%5Cn%22%5D%5D%2C%22hint%22%3A%22In%20the%20first%20example%2C%20Polycarp%20can%20make%20any%20of%20the%20%24%206%20%24%20possible%20playlist%20by%20rearranging%20the%20available%20songs%3A%20%24%20%5B1%2C%202%2C%203%5D%20%24%20%2C%20%24%20%5B1%2C%203%2C%202%5D%20%24%20%2C%20%24%20%5B2%2C%201%2C%203%5D%20%24%20%2C%20%24%20%5B2%2C%203%2C%201%5D%20%24%20%2C%20%24%20%5B3%2C%201%2C%202%5D%20%24%20and%20%24%20%5B3%2C%202%2C%201%5D%20%24%20%28indices%20of%20the%20songs%20are%20given%29.%5Cn%5CnIn%20the%20second%20example%2C%20the%20first%20and%20second%20songs%20cannot%20go%20in%20succession%20%28since%20they%20have%20the%20same%20genre%29.%20Thus%2C%20Polycarp%20can%20create%20a%20playlist%20in%20one%20of%20%24%202%20%24%20possible%20ways%3A%20%24%20%5B1%2C%203%2C%202%5D%20%24%20and%20%24%20%5B2%2C%203%2C%201%5D%20%24%20%28indices%20of%20the%20songs%20are%20given%29.%5Cn%5CnIn%20the%20third%20example%2C%20Polycarp%20can%20make%20the%20following%20playlists%3A%20%24%20%5B1%2C%202%2C%203%5D%20%24%20%2C%20%24%20%5B1%2C%203%2C%202%5D%20%24%20%2C%20%24%20%5B2%2C%201%2C%203%5D%20%24%20%2C%20%24%20%5B2%2C%203%2C%201%5D%20%24%20%2C%20%24%20%5B3%2C%201%2C%202%5D%20%24%20%2C%20%24%20%5B3%2C%202%2C%201%5D%20%24%20%2C%20%24%20%5B1%2C%204%5D%20%24%20%2C%20%24%20%5B4%2C%201%5D%20%24%20%2C%20%24%20%5B2%2C%203%2C%204%5D%20%24%20and%20%24%20%5B4%2C%203%2C%202%5D%20%24%20%28indices%20of%20the%20songs%20are%20given%29.%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B5000%5D%2C%22memory%22%3A%5B256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F1185%5C%2FG2%22%2C%22id%22%3A%221185G2%22%7D%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Atrue%2C%22totalSubmit%22%3A7%2C%22totalAccepted%22%3A4%2C%22pid%22%3A%22CF1185G2%22%2C%22title%22%3A%22Playlist%20for%20Polycarp%20%28hard%20version%29%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Playlist%20for%20Polycarp%20%28hard%20version%29%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1572920822;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Playlist for Polycarp (hard version)</h1>
<h2>题目描述</h2>
<div>The only difference between easy and hard versions is constraints.
Polycarp loves to listen to music, so he never leaves the player, even on the way home from the university. Polycarp overcomes the distance from the university to the house in exactly $ T $ minutes.
In the player, Polycarp stores $ n $ songs, each of which is characterized by two parameters: $ t_i $ and $ g_i $ , where $ t_i $ is the length of the song in minutes ( $ 1 \le t_i \le 50 $ ), $ g_i $ is its genre ( $ 1 \le g_i \le 3 $ ).
Polycarp wants to create such a playlist so that he can listen to music all the time on the way from the university to his home, and at the time of his arrival home, the playlist is over. Polycarp never interrupts songs and always listens to them from beginning to end. Thus, if he started listening to the $ i $ -th song, he would spend exactly $ t_i $ minutes on its listening. Polycarp also does not like when two songs of the same genre play in a row (i.e. successively/adjacently) or when the songs in his playlist are repeated.
Help Polycarpus count the number of different sequences of songs (their order matters), the total duration is exactly $ T $ , such that there are no two consecutive songs of the same genre in them and all the songs in the playlist are different.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line of the input contains two integers $ n $ and $ T $ ( $ 1 \le n \le 50, 1 \le T \le 2500 $ ) — the number of songs in the player and the required total duration, respectively.
Next, the $ n $ lines contain descriptions of songs: the $ i $ -th line contains two integers $ t_i $ and $ g_i $ ( $ 1 \le t_i \le 50, 1 \le g_i \le 3 $ ) — the duration of the $ i $ -th song and its genre, respectively.</div>
<h3>输出格式</h3>
<br />
<div>Output one integer — the number of different sequences of songs, the total length of exactly $ T $ , such that there are no two consecutive songs of the same genre in them and all the songs in the playlist are different. Since the answer may be huge, output it modulo $ 10^9 + 7 $ (that is, the remainder when dividing the quantity by $ 10^9 + 7 $ ).</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>
3 3
1 1
1 2
1 3
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>
6
</code></pre>
<h3>输入样例 #2</h3>
<pre><code>
3 3
1 1
1 1
1 3
</code></pre>
<h3>输出样例 #2</h3>
<pre><code>
2
</code></pre>
<h3>输入样例 #3</h3>
<pre><code>
4 10
5 3
2 1
3 2
5 1
</code></pre>
<h3>输出样例 #3</h3>
<pre><code>
10
</code></pre>
<h2>说明</h2>
<div>In the first example, Polycarp can make any of the $ 6 $ possible playlist by rearranging the available songs: $ [1, 2, 3] $ , $ [1, 3, 2] $ , $ [2, 1, 3] $ , $ [2, 3, 1] $ , $ [3, 1, 2] $ and $ [3, 2, 1] $ (indices of the songs are given).
In the second example, the first and second songs cannot go in succession (since they have the same genre). Thus, Polycarp can create a playlist in one of $ 2 $ possible ways: $ [1, 3, 2] $ and $ [2, 3, 1] $ (indices of the songs are given).
In the third example, Polycarp can make the following playlists: $ [1, 2, 3] $ , $ [1, 3, 2] $ , $ [2, 1, 3] $ , $ [2, 3, 1] $ , $ [3, 1, 2] $ , $ [3, 2, 1] $ , $ [1, 4] $ , $ [4, 1] $ , $ [2, 3, 4] $ and $ [4, 3, 2] $ (indices of the songs are given).</div>
</article>
</div>
</div>
</body>
</html>
