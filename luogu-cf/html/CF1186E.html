<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Vus the Cossack and a Field - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573402810:24b81hI/wIel2idJvICUrNSlgPbFN0nPtymnfOtZW7w=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22Vus%20the%20Cossack%20has%20a%20field%20with%20dimensions%20%24%20n%20%5C%5Ctimes%20m%20%24%20%2C%20which%20consists%20of%20%5C%220%5C%22%20and%20%5C%221%5C%22.%20He%20is%20building%20an%20infinite%20field%20from%20this%20field.%20He%20is%20doing%20this%20in%20this%20way%3A%5Cn%5Cn1.%20He%20takes%20the%20current%20field%20and%20finds%20a%20new%20inverted%20field.%20In%20other%20words%2C%20the%20new%20field%20will%20contain%20%5C%221%5C%22%20only%20there%2C%20where%20%5C%220%5C%22%20was%20in%20the%20current%20field%2C%20and%20%5C%220%5C%22%20there%2C%20where%20%5C%221%5C%22%20was.%5Cn2.%20To%20the%20current%20field%2C%20he%20adds%20the%20inverted%20field%20to%20the%20right.%5Cn3.%20To%20the%20current%20field%2C%20he%20adds%20the%20inverted%20field%20to%20the%20bottom.%5Cn4.%20To%20the%20current%20field%2C%20he%20adds%20the%20current%20field%20to%20the%20bottom%20right.%5Cn5.%20He%20repeats%20it.%5Cn%5CnFor%20example%2C%20if%20the%20initial%20field%20was%3A%5Cn%5Cn%20%24%20%5C%5Cbegin%7Bmatrix%7D%201%20%26%200%20%26%20%5C%5C%5C%5C%201%20%26%201%20%26%20%5C%5C%5C%5C%20%5C%5Cend%7Bmatrix%7D%20%24%20After%20the%20first%20iteration%2C%20the%20field%20will%20be%20like%20this%3A%5Cn%5Cn%20%24%20%5C%5Cbegin%7Bmatrix%7D%201%20%26%200%20%26%200%20%26%201%20%5C%5C%5C%5C%201%20%26%201%20%26%200%20%26%200%20%5C%5C%5C%5C%200%20%26%201%20%26%201%20%26%200%20%5C%5C%5C%5C%200%20%26%200%20%26%201%20%26%201%20%5C%5C%5C%5C%20%5C%5Cend%7Bmatrix%7D%20%24%20After%20the%20second%20iteration%2C%20the%20field%20will%20be%20like%20this%3A%5Cn%5Cn%20%24%20%5C%5Cbegin%7Bmatrix%7D%201%20%26%200%20%26%200%20%26%201%20%26%200%20%26%201%20%26%201%20%26%200%20%5C%5C%5C%5C%201%20%26%201%20%26%200%20%26%200%20%26%200%20%26%200%20%26%201%20%26%201%20%5C%5C%5C%5C%200%20%26%201%20%26%201%20%26%200%20%26%201%20%26%200%20%26%200%20%26%201%20%5C%5C%5C%5C%200%20%26%200%20%26%201%20%26%201%20%26%201%20%26%201%20%26%200%20%26%200%20%5C%5C%5C%5C%200%20%26%201%20%26%201%20%26%200%20%26%201%20%26%200%20%26%200%20%26%201%20%5C%5C%5C%5C%200%20%26%200%20%26%201%20%26%201%20%26%201%20%26%201%20%26%200%20%26%200%20%5C%5C%5C%5C%201%20%26%200%20%26%200%20%26%201%20%26%200%20%26%201%20%26%201%20%26%200%20%5C%5C%5C%5C%201%20%26%201%20%26%200%26%200%20%26%200%20%26%200%20%26%201%20%26%201%20%5C%5C%5C%5C%20%5C%5Cend%7Bmatrix%7D%20%24%20And%20so%20on...%5Cn%5CnLet%27s%20numerate%20lines%20from%20top%20to%20bottom%20from%20%24%201%20%24%20to%20infinity%2C%20and%20columns%20from%20left%20to%20right%20from%20%24%201%20%24%20to%20infinity.%20We%20call%20the%20submatrix%20%24%20%28x_1%2C%20y_1%2C%20x_2%2C%20y_2%29%20%24%20all%20numbers%20that%20have%20coordinates%20%24%20%28x%2C%20y%29%20%24%20such%20that%20%24%20x_1%20%5C%5Cleq%20x%20%5C%5Cleq%20x_2%20%24%20and%20%24%20y_1%20%5C%5Cleq%20y%20%5C%5Cleq%20y_2%20%24%20.%5Cn%5CnThe%20Cossack%20needs%20sometimes%20to%20find%20the%20sum%20of%20all%20the%20numbers%20in%20submatrices.%20Since%20he%20is%20pretty%20busy%20right%20now%2C%20he%20is%20asking%20you%20to%20find%20the%20answers%21%22%2C%22inputFormat%22%3A%22The%20first%20line%20contains%20three%20integers%20%24%20n%20%24%20%2C%20%24%20m%20%24%20%2C%20%24%20q%20%24%20%28%20%24%201%20%5C%5Cleq%20n%2C%20m%20%5C%5Cleq%201%5C%5C%2C000%20%24%20%2C%20%24%201%20%5C%5Cleq%20q%20%5C%5Cleq%2010%5E5%20%24%20%29%20%5Cu2014%20the%20dimensions%20of%20the%20initial%20matrix%20and%20the%20number%20of%20queries.%5Cn%5CnEach%20of%20the%20next%20%24%20n%20%24%20lines%20contains%20%24%20m%20%24%20characters%20%24%20c_%7Bij%7D%20%24%20%28%20%24%200%20%5C%5Cleq%20c_%7Bij%7D%20%5C%5Cleq%201%20%24%20%29%20%5Cu2014%20the%20characters%20in%20the%20matrix.%5Cn%5CnEach%20of%20the%20next%20%24%20q%20%24%20lines%20contains%20four%20integers%20%24%20x_1%20%24%20%2C%20%24%20y_1%20%24%20%2C%20%24%20x_2%20%24%20%2C%20%24%20y_2%20%24%20%28%20%24%201%20%5C%5Cleq%20x_1%20%5C%5Cleq%20x_2%20%5C%5Cleq%2010%5E9%20%24%20%2C%20%24%201%20%5C%5Cleq%20y_1%20%5C%5Cleq%20y_2%20%5C%5Cleq%2010%5E9%20%24%20%29%20%5Cu2014%20the%20coordinates%20of%20the%20upper%20left%20cell%20and%20bottom%20right%20cell%2C%20between%20which%20you%20need%20to%20find%20the%20sum%20of%20all%20numbers.%22%2C%22outputFormat%22%3A%22For%20each%20query%2C%20print%20the%20answer.%22%2C%22samples%22%3A%5B%5B%22%5Cn2%202%205%5Cn10%5Cn11%5Cn1%201%208%208%5Cn2%204%205%206%5Cn1%202%207%208%5Cn3%203%206%208%5Cn5%206%207%208%5Cn%22%2C%22%5Cn32%5Cn5%5Cn25%5Cn14%5Cn4%5Cn%22%5D%2C%5B%22%5Cn2%203%207%5Cn100%5Cn101%5Cn4%2012%205%2017%5Cn5%204%209%204%5Cn1%204%2013%2018%5Cn12%201%2014%209%5Cn3%2010%207%2018%5Cn3%2015%2012%2017%5Cn8%206%208%2012%5Cn%22%2C%22%5Cn6%5Cn3%5Cn98%5Cn13%5Cn22%5Cn15%5Cn3%5Cn%22%5D%5D%2C%22hint%22%3A%22The%20first%20example%20is%20explained%20in%20the%20legend.%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B2000%5D%2C%22memory%22%3A%5B256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F1186%5C%2FE%22%2C%22id%22%3A%221186E%22%7D%2C%22translation%22%3A%22%5Cu7ed9%5Cu5b9a%5Cu4e00%5Cu4e2an%5Cu00d7m%20%5Cu7684%200101%20%5Cu77e9%5Cu9635%20a%20%5Cuff0c%5Cu5b9a%5Cu4e49%5Cu5bf9%5Cu77e9%5Cu9635%5Cu7684%5Cu53cd%5Cu8f6c%5Cu4e3a%5Cu5c06%5Cu77e9%5Cu9635%20aa%20%5Cu4e2d%5Cu539f%5Cu6765%5Cu7684%200%20%5Cu53d8%5Cu4e3a%201%20%5Cuff0c%201%20%5Cu53d8%5Cu4e3a%200%20%5Cuff0c%5Cu5f97%5Cu5230%5Cu4e00%5Cu4e2a%5Cu65b0%5Cu7684%5Cu77e9%5Cu9635%20r%20%5Cuff0c%5Cu5b9a%5Cu4e49%5Cu5bf9%5Cu77e9%5Cu9635%5Cu7684%5Cu6269%5Cu5c55%5Cu64cd%5Cu4f5c%5Cu4e3a%5Cu5c06%5Cu4e24%5Cu4e2a%5Cu539f%5Cu77e9%5Cu9635%20a%20%5Cu7684%5Cu53cd%5Cu8f6c%5Cu5206%5Cu522b%5Cu7f6e%5Cu4e8e%5Cu539f%5Cu77e9%5Cu9635%5Cu7684%5Cu53f3%5Cu4fa7%5Cu548c%5Cu4e0b%5Cu65b9%5Cuff0c%5Cu5c06%5Cu539f%5Cu77e9%5Cu9635%5Cu7684%5Cu590d%5Cu5236%5Cu7f6e%5Cu4e8e%5Cu539f%5Cu77e9%5Cu9635%5Cu7684%5Cu53f3%5Cu4e0b%5Cu89d2%5Cuff0c%5Cu5f97%5Cu5230%5Cu4e00%5Cu4e2a%5Cu4e8c%5Cu7ef4%5Cu5747%5Cu4e3a%5Cu539f%5Cu6765%5Cu7684%5Cu4e24%5Cu500d%5Cu7684%5Cu77e9%5Cu9635%5Cuff0c%5Cu5373%5Cuff0c%5Cu82e5%5Cu539f%5Cu6765%5Cu7684%5Cu77e9%5Cu9635%5Cu662f%20a%20%5Cuff0c%5Cu5219%5Cu6269%5Cu5c55%5Cu4e00%5Cu6b21%5Cu540e%5Cu7684%5Cu77e9%5Cu9635%5Cu662f%5Cr%5Cn%5Cr%5Cn%7B%5Cr%5Cna%5Cr%5Cnr%5Cr%5Cn%5Cu200b%5Cr%5Cnr%5Cr%5Cna%5Cr%5Cn%5Cu200b%20%7D%20%5Cu3002%5Cr%5Cn%5Cr%5Cn%5Cu73b0%5Cu5728%5Cu5c06%5Cu7ed9%5Cu5b9a%5Cu7684%5Cu77e9%5Cu9635%5Cu6269%5Cu5c55%5Cu65e0%5Cu6570%5Cu6b21%5Cuff0c%5Cu5f97%5Cu5230%5Cu77e9%5Cu9635%20c%20%2C%20q%20%5Cu6b21%5Cu8be2%5Cu95ee%5Cuff0c%5Cu6bcf%5Cu6b21%5Cu8be2%5Cu95ee%5Cu7ed9%5Cu5b9a%20x1%2Cy1%2Cx2%2Cy2x1%2Cy1%2Cx2%2Cy2%20%5Cuff0c%5Cu6c42%5Cu77e9%5Cu9635%5Cu4e2d%5Cu4ee5%5Cu5750%5Cu6807%20%28x1%2Cy1%29%28x1%2Cy1%29%20%5Cu4e3a%5Cu5de6%5Cu4e0a%5Cu89d2%5Cuff0c%20%28x2%2Cy2%29%28x2%2Cy2%29%20%5Cu4e3a%5Cu53f3%5Cu4e0a%5Cu89d2%5Cu7684%5Cu5b50%5Cu77e9%5Cu9635%5Cu4e2d%5Cu6570%5Cu7684%5Cu548c%5Cu3002%5Cu4e0b%5Cu6807%5Cu4ece%2011%20%5Cu5f00%5Cu59cb%5Cu3002%5Cr%5Cn%5Cr%5Cn1%5Cu2264n%2Cm%5Cu22641000%201%5Cu2264q%5Cu226410%20%5E5%5Cr%5Cn%5Cr%5Cn0%5Cu2264a%20i%2Cj%20%5Cu22641%5Cr%5Cn%5Cr%5Cn1%5Cu2264x1%5Cu2264x2%5Cu226410%201%5Cu2264y1%5Cu2264y2%5Cu226410%20%22%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Afalse%2C%22totalSubmit%22%3A66%2C%22totalAccepted%22%3A35%2C%22pid%22%3A%22CF1186E%22%2C%22title%22%3A%22Vus%20the%20Cossack%20and%20a%20Field%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%7B%22pid%22%3A%22CF1179A%22%2C%22title%22%3A%22Valeriy%20and%20Deque%22%2C%22difficulty%22%3A5%2C%22type%22%3A%22CF%22%7D%2C%7B%22pid%22%3A%22CF1186F%22%2C%22title%22%3A%22Vus%20the%20Cossack%20and%20a%20Graph%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22CF%22%7D%2C%7B%22pid%22%3A%22CF1186D%22%2C%22title%22%3A%22Vus%20the%20Cossack%20and%20Numbers%22%2C%22difficulty%22%3A5%2C%22type%22%3A%22CF%22%7D%2C%7B%22pid%22%3A%22CF1187C%22%2C%22title%22%3A%22Vasya%20And%20Array%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22CF%22%7D%2C%7B%22pid%22%3A%22CF1205B%22%2C%22title%22%3A%22Shortest%20Cycle%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22CF%22%7D%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Vus%20the%20Cossack%20and%20a%20Field%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1572920822;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Vus the Cossack and a Field</h1>
<h2>题意翻译</h2>
<div>给定一个n×m 的 0101 矩阵 a ，定义对矩阵的反转为将矩阵 aa 中原来的 0 变为 1 ， 1 变为 0 ，得到一个新的矩阵 r ，定义对矩阵的扩展操作为将两个原矩阵 a 的反转分别置于原矩阵的右侧和下方，将原矩阵的复制置于原矩阵的右下角，得到一个二维均为原来的两倍的矩阵，即，若原来的矩阵是 a ，则扩展一次后的矩阵是
{
a
r
​
r
a
​ } 。
现在将给定的矩阵扩展无数次，得到矩阵 c , q 次询问，每次询问给定 x1,y1,x2,y2x1,y1,x2,y2 ，求矩阵中以坐标 (x1,y1)(x1,y1) 为左上角， (x2,y2)(x2,y2) 为右上角的子矩阵中数的和。下标从 11 开始。
1≤n,m≤1000 1≤q≤10 ^5
0≤a i,j ≤1
1≤x1≤x2≤10 1≤y1≤y2≤10 </div>
<h2>题目描述</h2>
<div>Vus the Cossack has a field with dimensions $ n \times m $ , which consists of "0" and "1". He is building an infinite field from this field. He is doing this in this way:
1. He takes the current field and finds a new inverted field. In other words, the new field will contain "1" only there, where "0" was in the current field, and "0" there, where "1" was.
2. To the current field, he adds the inverted field to the right.
3. To the current field, he adds the inverted field to the bottom.
4. To the current field, he adds the current field to the bottom right.
5. He repeats it.
For example, if the initial field was:
$ \begin{matrix} 1 & 0 & \\ 1 & 1 & \\ \end{matrix} $ After the first iteration, the field will be like this:
$ \begin{matrix} 1 & 0 & 0 & 1 \\ 1 & 1 & 0 & 0 \\ 0 & 1 & 1 & 0 \\ 0 & 0 & 1 & 1 \\ \end{matrix} $ After the second iteration, the field will be like this:
$ \begin{matrix} 1 & 0 & 0 & 1 & 0 & 1 & 1 & 0 \\ 1 & 1 & 0 & 0 & 0 & 0 & 1 & 1 \\ 0 & 1 & 1 & 0 & 1 & 0 & 0 & 1 \\ 0 & 0 & 1 & 1 & 1 & 1 & 0 & 0 \\ 0 & 1 & 1 & 0 & 1 & 0 & 0 & 1 \\ 0 & 0 & 1 & 1 & 1 & 1 & 0 & 0 \\ 1 & 0 & 0 & 1 & 0 & 1 & 1 & 0 \\ 1 & 1 & 0& 0 & 0 & 0 & 1 & 1 \\ \end{matrix} $ And so on...
Let's numerate lines from top to bottom from $ 1 $ to infinity, and columns from left to right from $ 1 $ to infinity. We call the submatrix $ (x_1, y_1, x_2, y_2) $ all numbers that have coordinates $ (x, y) $ such that $ x_1 \leq x \leq x_2 $ and $ y_1 \leq y \leq y_2 $ .
The Cossack needs sometimes to find the sum of all the numbers in submatrices. Since he is pretty busy right now, he is asking you to find the answers!</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line contains three integers $ n $ , $ m $ , $ q $ ( $ 1 \leq n, m \leq 1\,000 $ , $ 1 \leq q \leq 10^5 $ ) — the dimensions of the initial matrix and the number of queries.
Each of the next $ n $ lines contains $ m $ characters $ c_{ij} $ ( $ 0 \leq c_{ij} \leq 1 $ ) — the characters in the matrix.
Each of the next $ q $ lines contains four integers $ x_1 $ , $ y_1 $ , $ x_2 $ , $ y_2 $ ( $ 1 \leq x_1 \leq x_2 \leq 10^9 $ , $ 1 \leq y_1 \leq y_2 \leq 10^9 $ ) — the coordinates of the upper left cell and bottom right cell, between which you need to find the sum of all numbers.</div>
<h3>输出格式</h3>
<br />
<div>For each query, print the answer.</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>
2 2 5
10
11
1 1 8 8
2 4 5 6
1 2 7 8
3 3 6 8
5 6 7 8
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>
32
5
25
14
4
</code></pre>
<h3>输入样例 #2</h3>
<pre><code>
2 3 7
100
101
4 12 5 17
5 4 9 4
1 4 13 18
12 1 14 9
3 10 7 18
3 15 12 17
8 6 8 12
</code></pre>
<h3>输出样例 #2</h3>
<pre><code>
6
3
98
13
22
15
3
</code></pre>
<h2>说明</h2>
<div>The first example is explained in the legend.</div>
</article>
</div>
</div>
</body>
</html>
