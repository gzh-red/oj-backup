<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Nauuo and Pictures (hard version) - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573402561:4i9AiuvEj6bxFQwkSZB077QIrDtWwXH4Ul5u6mdk1Xs=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22The%20only%20difference%20between%20easy%20and%20hard%20versions%20is%20constraints.%5Cn%5CnNauuo%20is%20a%20girl%20who%20loves%20random%20picture%20websites.%5Cn%5CnOne%20day%20she%20made%20a%20random%20picture%20website%20by%20herself%20which%20includes%20%24%20n%20%24%20pictures.%5Cn%5CnWhen%20Nauuo%20visits%20the%20website%2C%20she%20sees%20exactly%20one%20picture.%20The%20website%20does%20not%20display%20each%20picture%20with%20equal%20probability.%20The%20%24%20i%20%24%20-th%20picture%20has%20a%20non-negative%20weight%20%24%20w_i%20%24%20%2C%20and%20the%20probability%20of%20the%20%24%20i%20%24%20-th%20picture%20being%20displayed%20is%20%24%20%5C%5Cfrac%7Bw_i%7D%7B%5C%5Csum_%7Bj%3D1%7D%5Enw_j%7D%20%24%20.%20That%20is%20to%20say%2C%20the%20probability%20of%20a%20picture%20to%20be%20displayed%20is%20proportional%20to%20its%20weight.%5Cn%5CnHowever%2C%20Nauuo%20discovered%20that%20some%20pictures%20she%20does%20not%20like%20were%20displayed%20too%20often.%5Cn%5CnTo%20solve%20this%20problem%2C%20she%20came%20up%20with%20a%20great%20idea%3A%20when%20she%20saw%20a%20picture%20she%20likes%2C%20she%20would%20add%20%24%201%20%24%20to%20its%20weight%3B%20otherwise%2C%20she%20would%20subtract%20%24%201%20%24%20from%20its%20weight.%5Cn%5CnNauuo%20will%20visit%20the%20website%20%24%20m%20%24%20times.%20She%20wants%20to%20know%20the%20expected%20weight%20of%20each%20picture%20after%20all%20the%20%24%20m%20%24%20visits%20modulo%20%24%20998244353%20%24%20.%20Can%20you%20help%20her%3F%5Cn%5CnThe%20expected%20weight%20of%20the%20%24%20i%20%24%20-th%20picture%20can%20be%20denoted%20by%20%24%20%5C%5Cfrac%20%7Bq_i%7D%20%7Bp_i%7D%20%24%20where%20%24%20%5C%5Cgcd%28p_i%2Cq_i%29%3D1%20%24%20%2C%20you%20need%20to%20print%20an%20integer%20%24%20r_i%20%24%20satisfying%20%24%200%5C%5Cle%20r_i%3C998244353%20%24%20and%20%24%20r_i%5C%5Ccdot%20p_i%5C%5Cequiv%20q_i%5C%5Cpmod%7B998244353%7D%20%24%20.%20It%20can%20be%20proved%20that%20such%20%24%20r_i%20%24%20exists%20and%20is%20unique.%22%2C%22inputFormat%22%3A%22The%20first%20line%20contains%20two%20integers%20%24%20n%20%24%20and%20%24%20m%20%24%20%28%20%24%201%5C%5Cle%20n%5C%5Cle%202%5C%5Ccdot%2010%5E5%20%24%20%2C%20%24%201%5C%5Cle%20m%5C%5Cle%203000%20%24%20%29%20%5Cu2014%20the%20number%20of%20pictures%20and%20the%20number%20of%20visits%20to%20the%20website.%5Cn%5CnThe%20second%20line%20contains%20%24%20n%20%24%20integers%20%24%20a_1%2Ca_2%2C%5C%5Cldots%2Ca_n%20%24%20%28%20%24%20a_i%20%24%20is%20either%20%24%200%20%24%20or%20%24%201%20%24%20%29%20%5Cu2014%20if%20%24%20a_i%3D0%20%24%20%2C%20Nauuo%20does%20not%20like%20the%20%24%20i%20%24%20-th%20picture%3B%20otherwise%20Nauuo%20likes%20the%20%24%20i%20%24%20-th%20picture.%20It%20is%20guaranteed%20that%20there%20is%20at%20least%20one%20picture%20which%20Nauuo%20likes.%5Cn%5CnThe%20third%20line%20contains%20%24%20n%20%24%20positive%20integers%20%24%20w_1%2Cw_2%2C%5C%5Cldots%2Cw_n%20%24%20%28%20%24%20w_i%20%5C%5Cgeq%201%20%24%20%29%20%5Cu2014%20the%20initial%20weights%20of%20the%20pictures.%20It%20is%20guaranteed%20that%20the%20sum%20of%20all%20the%20initial%20weights%20does%20not%20exceed%20%24%20998244352-m%20%24%20.%22%2C%22outputFormat%22%3A%22The%20output%20contains%20%24%20n%20%24%20integers%20%24%20r_1%2Cr_2%2C%5C%5Cldots%2Cr_n%20%24%20%5Cu2014%20the%20expected%20weights%20modulo%20%24%20998244353%20%24%20.%22%2C%22samples%22%3A%5B%5B%22%5Cn2%201%5Cn0%201%5Cn2%201%5Cn%22%2C%22%5Cn332748119%5Cn332748119%5Cn%22%5D%2C%5B%22%5Cn1%202%5Cn1%5Cn1%5Cn%22%2C%22%5Cn3%5Cn%22%5D%2C%5B%22%5Cn3%203%5Cn0%201%201%5Cn4%203%205%5Cn%22%2C%22%5Cn160955686%5Cn185138929%5Cn974061117%5Cn%22%5D%5D%2C%22hint%22%3A%22In%20the%20first%20example%2C%20if%20the%20only%20visit%20shows%20the%20first%20picture%20with%20a%20probability%20of%20%24%20%5C%5Cfrac%202%203%20%24%20%2C%20the%20final%20weights%20are%20%24%20%281%2C1%29%20%24%20%3B%20if%20the%20only%20visit%20shows%20the%20second%20picture%20with%20a%20probability%20of%20%24%20%5C%5Cfrac1%203%20%24%20%2C%20the%20final%20weights%20are%20%24%20%282%2C2%29%20%24%20.%5Cn%5CnSo%2C%20both%20expected%20weights%20are%20%24%20%5C%5Cfrac2%203%5C%5Ccdot%201%2B%5C%5Cfrac%201%203%5C%5Ccdot%202%3D%5C%5Cfrac4%203%20%24%20.%5Cn%5CnBecause%20%24%20332748119%5C%5Ccdot%203%5C%5Cequiv%204%5C%5Cpmod%7B998244353%7D%20%24%20%2C%20you%20need%20to%20print%20%24%20332748119%20%24%20instead%20of%20%24%20%5C%5Cfrac4%203%20%24%20or%20%24%201.3333333333%20%24%20.%5Cn%5CnIn%20the%20second%20example%2C%20there%20is%20only%20one%20picture%20which%20Nauuo%20likes%2C%20so%20every%20time%20Nauuo%20visits%20the%20website%2C%20%24%20w_1%20%24%20will%20be%20increased%20by%20%24%201%20%24%20.%5Cn%5CnSo%2C%20the%20expected%20weight%20is%20%24%201%2B2%3D3%20%24%20.%5Cn%5CnNauuo%20is%20very%20naughty%20so%20she%20didn%27t%20give%20you%20any%20hint%20of%20the%20third%20example.%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B4000%5D%2C%22memory%22%3A%5B256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F1172%5C%2FC2%22%2C%22id%22%3A%221172C2%22%7D%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Atrue%2C%22totalSubmit%22%3A9%2C%22totalAccepted%22%3A6%2C%22pid%22%3A%22CF1172C2%22%2C%22title%22%3A%22Nauuo%20and%20Pictures%20%28hard%20version%29%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Nauuo%20and%20Pictures%20%28hard%20version%29%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1572920822;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Nauuo and Pictures (hard version)</h1>
<h2>题目描述</h2>
<div>The only difference between easy and hard versions is constraints.
Nauuo is a girl who loves random picture websites.
One day she made a random picture website by herself which includes $ n $ pictures.
When Nauuo visits the website, she sees exactly one picture. The website does not display each picture with equal probability. The $ i $ -th picture has a non-negative weight $ w_i $ , and the probability of the $ i $ -th picture being displayed is $ \frac{w_i}{\sum_{j=1}^nw_j} $ . That is to say, the probability of a picture to be displayed is proportional to its weight.
However, Nauuo discovered that some pictures she does not like were displayed too often.
To solve this problem, she came up with a great idea: when she saw a picture she likes, she would add $ 1 $ to its weight; otherwise, she would subtract $ 1 $ from its weight.
Nauuo will visit the website $ m $ times. She wants to know the expected weight of each picture after all the $ m $ visits modulo $ 998244353 $ . Can you help her?
The expected weight of the $ i $ -th picture can be denoted by $ \frac {q_i} {p_i} $ where $ \gcd(p_i,q_i)=1 $ , you need to print an integer $ r_i $ satisfying $ 0\le r_i<998244353 $ and $ r_i\cdot p_i\equiv q_i\pmod{998244353} $ . It can be proved that such $ r_i $ exists and is unique.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line contains two integers $ n $ and $ m $ ( $ 1\le n\le 2\cdot 10^5 $ , $ 1\le m\le 3000 $ ) — the number of pictures and the number of visits to the website.
The second line contains $ n $ integers $ a_1,a_2,\ldots,a_n $ ( $ a_i $ is either $ 0 $ or $ 1 $ ) — if $ a_i=0 $ , Nauuo does not like the $ i $ -th picture; otherwise Nauuo likes the $ i $ -th picture. It is guaranteed that there is at least one picture which Nauuo likes.
The third line contains $ n $ positive integers $ w_1,w_2,\ldots,w_n $ ( $ w_i \geq 1 $ ) — the initial weights of the pictures. It is guaranteed that the sum of all the initial weights does not exceed $ 998244352-m $ .</div>
<h3>输出格式</h3>
<br />
<div>The output contains $ n $ integers $ r_1,r_2,\ldots,r_n $ — the expected weights modulo $ 998244353 $ .</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>
2 1
0 1
2 1
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>
332748119
332748119
</code></pre>
<h3>输入样例 #2</h3>
<pre><code>
1 2
1
1
</code></pre>
<h3>输出样例 #2</h3>
<pre><code>
3
</code></pre>
<h3>输入样例 #3</h3>
<pre><code>
3 3
0 1 1
4 3 5
</code></pre>
<h3>输出样例 #3</h3>
<pre><code>
160955686
185138929
974061117
</code></pre>
<h2>说明</h2>
<div>In the first example, if the only visit shows the first picture with a probability of $ \frac 2 3 $ , the final weights are $ (1,1) $ ; if the only visit shows the second picture with a probability of $ \frac1 3 $ , the final weights are $ (2,2) $ .
So, both expected weights are $ \frac2 3\cdot 1+\frac 1 3\cdot 2=\frac4 3 $ .
Because $ 332748119\cdot 3\equiv 4\pmod{998244353} $ , you need to print $ 332748119 $ instead of $ \frac4 3 $ or $ 1.3333333333 $ .
In the second example, there is only one picture which Nauuo likes, so every time Nauuo visits the website, $ w_1 $ will be increased by $ 1 $ .
So, the expected weight is $ 1+2=3 $ .
Nauuo is very naughty so she didn't give you any hint of the third example.</div>
</article>
</div>
</div>
</body>
</html>
