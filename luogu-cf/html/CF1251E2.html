<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Voting (Hard Version) - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573403801:gNvhS675k+ivTZR/LGN0lnbPCTNNo5HuszBlmHuuFe0=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22The%20only%20difference%20between%20easy%20and%20hard%20versions%20is%20constraints.%5Cn%5CnNow%20elections%20are%20held%20in%20Berland%20and%20you%20want%20to%20win%20them.%20More%20precisely%2C%20you%20want%20everyone%20to%20vote%20for%20you.%5Cn%5CnThere%20are%20%24%20n%20%24%20voters%2C%20and%20two%20ways%20to%20convince%20each%20of%20them%20to%20vote%20for%20you.%20The%20first%20way%20to%20convince%20the%20%24%20i%20%24%20-th%20voter%20is%20to%20pay%20him%20%24%20p_i%20%24%20coins.%20The%20second%20way%20is%20to%20make%20%24%20m_i%20%24%20other%20voters%20vote%20for%20you%2C%20and%20the%20%24%20i%20%24%20-th%20voter%20will%20vote%20for%20free.%5Cn%5CnMoreover%2C%20the%20process%20of%20such%20voting%20takes%20place%20in%20several%20steps.%20For%20example%2C%20if%20there%20are%20five%20voters%20with%20%24%20m_1%20%3D%201%20%24%20%2C%20%24%20m_2%20%3D%202%20%24%20%2C%20%24%20m_3%20%3D%202%20%24%20%2C%20%24%20m_4%20%3D%204%20%24%20%2C%20%24%20m_5%20%3D%205%20%24%20%2C%20then%20you%20can%20buy%20the%20vote%20of%20the%20fifth%20voter%2C%20and%20eventually%20everyone%20will%20vote%20for%20you.%20Set%20of%20people%20voting%20for%20you%20will%20change%20as%20follows%3A%20%24%20%7B5%7D%20%5C%5Crightarrow%20%7B1%2C%205%7D%20%5C%5Crightarrow%20%7B1%2C%202%2C%203%2C%205%7D%20%5C%5Crightarrow%20%7B1%2C%202%2C%203%2C%204%2C%205%7D%20%24%20.%5Cn%5CnCalculate%20the%20minimum%20number%20of%20coins%20you%20have%20to%20spend%20so%20that%20everyone%20votes%20for%20you.%22%2C%22inputFormat%22%3A%22The%20first%20line%20contains%20one%20integer%20%24%20t%20%24%20%28%20%24%201%20%5C%5Cle%20t%20%5C%5Cle%202%20%5C%5Ccdot%2010%5E5%20%24%20%29%20%5Cu2014%20the%20number%20of%20test%20cases.%5Cn%5CnThe%20first%20line%20of%20each%20test%20case%20contains%20one%20integer%20%24%20n%20%24%20%28%20%24%201%20%5C%5Cle%20n%20%5C%5Cle%202%20%5C%5Ccdot%2010%5E5%20%24%20%29%20%5Cu2014%20the%20number%20of%20voters.%5Cn%5CnThe%20next%20%24%20n%20%24%20lines%20contains%20the%20description%20of%20voters.%20%24%20i%20%24%20-th%20line%20contains%20two%20integers%20%24%20m_i%20%24%20and%20%24%20p_i%20%24%20%28%20%24%201%20%5C%5Cle%20p_i%20%5C%5Cle%2010%5E9%2C%200%20%5C%5Cle%20m_i%20%3C%20n%20%24%20%29.%5Cn%5CnIt%20is%20guaranteed%20that%20the%20sum%20of%20all%20%24%20n%20%24%20over%20all%20test%20cases%20does%20not%20exceed%20%24%202%20%5C%5Ccdot%2010%5E5%20%24%20.%22%2C%22outputFormat%22%3A%22For%20each%20test%20case%20print%20one%20integer%20%5Cu2014%20the%20minimum%20number%20of%20coins%20you%20have%20to%20spend%20so%20that%20everyone%20votes%20for%20you.%22%2C%22samples%22%3A%5B%5B%22%5Cn3%5Cn3%5Cn1%205%5Cn2%2010%5Cn2%208%5Cn7%5Cn0%201%5Cn3%201%5Cn1%201%5Cn6%201%5Cn1%201%5Cn4%201%5Cn4%201%5Cn6%5Cn2%206%5Cn2%203%5Cn2%208%5Cn2%207%5Cn4%204%5Cn5%205%5Cn%22%2C%22%5Cn8%5Cn0%5Cn7%5Cn%22%5D%5D%2C%22hint%22%3A%22In%20the%20first%20test%20case%20you%20have%20to%20buy%20vote%20of%20the%20third%20voter.%20Then%20the%20set%20of%20people%20voting%20for%20you%20will%20change%20as%20follows%3A%20%24%20%7B3%7D%20%5C%5Crightarrow%20%7B1%2C%203%7D%20%5C%5Crightarrow%20%7B1%2C%202%2C%203%7D%20%24%20.%5Cn%5CnIn%20the%20second%20example%20you%20don%27t%20need%20to%20buy%20votes.%20The%20set%20of%20people%20voting%20for%20you%20will%20change%20as%20follows%3A%20%24%20%7B1%7D%20%5C%5Crightarrow%20%7B1%2C%203%2C%205%7D%20%5C%5Crightarrow%20%7B1%2C%202%2C%203%2C%205%7D%20%5C%5Crightarrow%20%7B1%2C%202%2C%203%2C%205%2C%206%2C%207%7D%20%5C%5Crightarrow%20%7B1%2C%202%2C%203%2C%204%2C%205%2C%206%2C%207%7D%20%24%20.%5Cn%5CnIn%20the%20third%20test%20case%20you%20have%20to%20buy%20votes%20of%20the%20second%20and%20the%20fifth%20voters.%20Then%20the%20set%20of%20people%20voting%20for%20you%20will%20change%20as%20follows%3A%20%24%20%7B2%2C%205%7D%20%5C%5Crightarrow%20%7B1%2C%202%2C%203%2C%204%2C%205%7D%20%5C%5Crightarrow%20%7B1%2C%202%2C%203%2C%204%2C%205%2C%206%7D%20%24%20.%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B2000%5D%2C%22memory%22%3A%5B256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F1251%5C%2FE2%22%2C%22id%22%3A%221251E2%22%7D%2C%22translation%22%3A%22%5Cu4e00%5Cu5171%5Cu6709%20%24n%24%20%5Cu4e2a%5Cu9009%5Cu6c11%5Cuff0c%5Cu4f60%5Cu53ef%5Cu4ee5%5Cu4ed8%5Cu51fa%20%24p_%7Bi%7D%24%20%5Cu7684%5Cu4ee3%5Cu4ef7%5Cu8ba9%5Cu7b2c%20%24i%24%20%5Cu4e2a%5Cu9009%5Cu6c11%5Cu4e3a%5Cu4f60%5Cu6295%5Cu7968%5Cuff0c%5Cu6216%5Cu8005%5Cuff0c%5Cu5728%5Cu4e3a%5Cu4f60%5Cu6295%5Cu7968%5Cu7684%5Cu4eba%5Cu6570%5Cu8fbe%5Cu5230%20%24m_%7Bi%7D%24%20%5Cu65f6%5Cuff0c%5Cu4ed6%5Cu4f1a%5Cu4e3b%5Cu52a8%5Cu4e3a%5Cu4f60%5Cu6295%5Cu7968%5Cu800c%5Cu4e0d%5Cu7528%5Cu4f60%5Cu4ed8%5Cu51fa%5Cu4efb%5Cu4f55%5Cu4ee3%5Cu4ef7%5Cu3002%5Cr%5Cn%5Cr%5Cn%5Cu95ee%5Cu5f97%5Cu5230%5Cu6240%5Cu6709%5Cu9009%5Cu6c11%5Cu6295%5Cu7968%5Cu7684%5Cu6700%5Cu5c0f%5Cu4ee3%5Cu4ef7%5Cu3002%22%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Afalse%2C%22totalSubmit%22%3A79%2C%22totalAccepted%22%3A57%2C%22pid%22%3A%22CF1251E2%22%2C%22title%22%3A%22Voting%20%28Hard%20Version%29%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%7B%22pid%22%3A%22CF817C%22%2C%22title%22%3A%22Really%20Big%20Numbers%22%2C%22difficulty%22%3A5%2C%22type%22%3A%22CF%22%7D%2C%7B%22pid%22%3A%22CF992A%22%2C%22title%22%3A%22Nastya%20and%20an%20Array%22%2C%22difficulty%22%3A1%2C%22type%22%3A%22CF%22%7D%2C%7B%22pid%22%3A%22CF1251E1%22%2C%22title%22%3A%22Voting%20%28Easy%20Version%29%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22CF%22%7D%2C%7B%22pid%22%3A%22CF1251D%22%2C%22title%22%3A%22Salary%20Changing%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22CF%22%7D%2C%7B%22pid%22%3A%22CF1225E%22%2C%22title%22%3A%22Rock%20Is%20Push%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22CF%22%7D%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Voting%20%28Hard%20Version%29%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1572920822;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Voting (Hard Version)</h1>
<h2>题意翻译</h2>
<div>一共有 $n$ 个选民，你可以付出 $p_{i}$ 的代价让第 $i$ 个选民为你投票，或者，在为你投票的人数达到 $m_{i}$ 时，他会主动为你投票而不用你付出任何代价。
问得到所有选民投票的最小代价。</div>
<h2>题目描述</h2>
<div>The only difference between easy and hard versions is constraints.
Now elections are held in Berland and you want to win them. More precisely, you want everyone to vote for you.
There are $ n $ voters, and two ways to convince each of them to vote for you. The first way to convince the $ i $ -th voter is to pay him $ p_i $ coins. The second way is to make $ m_i $ other voters vote for you, and the $ i $ -th voter will vote for free.
Moreover, the process of such voting takes place in several steps. For example, if there are five voters with $ m_1 = 1 $ , $ m_2 = 2 $ , $ m_3 = 2 $ , $ m_4 = 4 $ , $ m_5 = 5 $ , then you can buy the vote of the fifth voter, and eventually everyone will vote for you. Set of people voting for you will change as follows: $ {5} \rightarrow {1, 5} \rightarrow {1, 2, 3, 5} \rightarrow {1, 2, 3, 4, 5} $ .
Calculate the minimum number of coins you have to spend so that everyone votes for you.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line contains one integer $ t $ ( $ 1 \le t \le 2 \cdot 10^5 $ ) — the number of test cases.
The first line of each test case contains one integer $ n $ ( $ 1 \le n \le 2 \cdot 10^5 $ ) — the number of voters.
The next $ n $ lines contains the description of voters. $ i $ -th line contains two integers $ m_i $ and $ p_i $ ( $ 1 \le p_i \le 10^9, 0 \le m_i < n $ ).
It is guaranteed that the sum of all $ n $ over all test cases does not exceed $ 2 \cdot 10^5 $ .</div>
<h3>输出格式</h3>
<br />
<div>For each test case print one integer — the minimum number of coins you have to spend so that everyone votes for you.</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>
3
3
1 5
2 10
2 8
7
0 1
3 1
1 1
6 1
1 1
4 1
4 1
6
2 6
2 3
2 8
2 7
4 4
5 5
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>
8
0
7
</code></pre>
<h2>说明</h2>
<div>In the first test case you have to buy vote of the third voter. Then the set of people voting for you will change as follows: $ {3} \rightarrow {1, 3} \rightarrow {1, 2, 3} $ .
In the second example you don't need to buy votes. The set of people voting for you will change as follows: $ {1} \rightarrow {1, 3, 5} \rightarrow {1, 2, 3, 5} \rightarrow {1, 2, 3, 5, 6, 7} \rightarrow {1, 2, 3, 4, 5, 6, 7} $ .
In the third test case you have to buy votes of the second and the fifth voters. Then the set of people voting for you will change as follows: $ {2, 5} \rightarrow {1, 2, 3, 4, 5} \rightarrow {1, 2, 3, 4, 5, 6} $ .</div>
</article>
</div>
</div>
</body>
</html>
