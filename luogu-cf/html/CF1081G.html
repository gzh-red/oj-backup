<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Mergesort Strikes Back - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573401360:4cd3a9MXwZfSlEgLO4aMazklXWZJDxzPdElnjpOMp8o=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22Chouti%20thought%20about%20his%20very%20first%20days%20in%20competitive%20programming.%20When%20he%20had%20just%20learned%20to%20write%20merge%20sort%2C%20he%20thought%20that%20the%20merge%20sort%20is%20too%20slow%2C%20so%20he%20restricted%20the%20maximum%20depth%20of%20recursion%20and%20modified%20the%20merge%20sort%20to%20the%20following%3A%5Cn%5Cn%20%21%5B%5D%28https%3A%5C%2F%5C%2Fcdn.luogu.com.cn%5C%2Fupload%5C%2Fvjudge_pic%5C%2FCF1081G%5C%2Fd38c74fe6316fba88c7792a3db295863b73fa34d.png%29Chouti%20found%20his%20idea%20dumb%20since%20obviously%2C%20this%20%5C%22merge%20sort%5C%22%20sometimes%20cannot%20sort%20the%20array%20correctly.%20However%2C%20Chouti%20is%20now%20starting%20to%20think%20of%20how%20good%20this%20%5C%22merge%20sort%5C%22%20is.%20Particularly%2C%20Chouti%20wants%20to%20know%20for%20a%20random%20permutation%20%24%20a%20%24%20of%20%24%201%2C%202%2C%20%5C%5Cldots%2C%20n%20%24%20the%20expected%20number%20of%20inversions%20after%20calling%20MergeSort%28a%2C%201%2C%20n%2C%20k%29.%5Cn%5CnIt%20can%20be%20proved%20that%20the%20expected%20number%20is%20rational.%20For%20the%20given%20prime%20%24%20q%20%24%20%2C%20suppose%20the%20answer%20can%20be%20denoted%20by%20%24%20%5C%5Cfrac%7Bu%7D%7Bd%7D%20%24%20where%20%24%20gcd%28u%2Cd%29%3D1%20%24%20%2C%20you%20need%20to%20output%20an%20integer%20%24%20r%20%24%20satisfying%20%24%200%20%5C%5Cle%20r%3Cq%20%24%20and%20%24%20rd%20%5C%5Cequiv%20u%20%5C%5Cpmod%20q%20%24%20.%20It%20can%20be%20proved%20that%20such%20%24%20r%20%24%20exists%20and%20is%20unique.%22%2C%22inputFormat%22%3A%22The%20first%20and%20only%20line%20contains%20three%20integers%20%24%20n%2C%20k%2C%20q%20%24%20%28%20%24%201%20%5C%5Cleq%20n%2C%20k%20%5C%5Cleq%2010%5E5%2C%2010%5E8%20%5C%5Cleq%20q%20%5C%5Cleq%2010%5E9%20%24%20%2C%20%24%20q%20%24%20is%20a%20prime%29.%22%2C%22outputFormat%22%3A%22The%20first%20and%20only%20line%20contains%20an%20integer%20%24%20r%20%24%20.%22%2C%22samples%22%3A%5B%5B%223%201%20998244353%5Cn%22%2C%22499122178%5Cn%22%5D%2C%5B%223%202%20998244353%5Cn%22%2C%22665496236%5Cn%22%5D%2C%5B%229%203%20998244353%5Cn%22%2C%22449209967%5Cn%22%5D%2C%5B%229%204%20998244353%5Cn%22%2C%22665496237%5Cn%22%5D%5D%2C%22hint%22%3A%22In%20the%20first%20example%2C%20all%20possible%20permutations%20are%20%24%20%5B1%2C2%2C3%5D%2C%5B1%2C3%2C2%5D%2C%5B2%2C1%2C3%5D%2C%5B2%2C3%2C1%5D%2C%5B3%2C1%2C2%5D%2C%5B3%2C2%2C1%5D%20%24%20.%5Cn%5CnWith%20%24%20k%3D1%20%24%20%2C%20MergeSort%28a%2C%201%2C%20n%2C%20k%29%20will%20only%20return%20the%20original%20permutation.%20Thus%20the%20answer%20is%20%24%209%5C%2F6%3D3%5C%2F2%20%24%20%2C%20and%20you%20should%20output%20%24%20499122178%20%24%20because%20%24%20499122178%20%5C%5Ctimes%202%20%5C%5Cequiv%203%20%5C%5Cpmod%20%7B998244353%7D%20%24%20.%5Cn%5CnIn%20the%20second%20example%2C%20all%20possible%20permutations%20are%20%24%20%5B1%2C2%2C3%5D%2C%5B1%2C3%2C2%5D%2C%5B2%2C1%2C3%5D%2C%5B2%2C3%2C1%5D%2C%5B3%2C1%2C2%5D%2C%5B3%2C2%2C1%5D%20%24%20and%20the%20corresponding%20outputs%20of%20MergeSort%28a%2C%201%2C%20n%2C%20k%29%20are%20%24%20%5B1%2C2%2C3%5D%2C%5B1%2C2%2C3%5D%2C%5B2%2C1%2C3%5D%2C%5B1%2C2%2C3%5D%2C%5B2%2C3%2C1%5D%2C%5B1%2C3%2C2%5D%20%24%20respectively.%20Thus%20the%20answer%20is%20%24%204%5C%2F6%3D2%5C%2F3%20%24%20%2C%20and%20you%20should%20output%20%24%20665496236%20%24%20because%20%24%20665496236%20%5C%5Ctimes%203%20%5C%5Cequiv%202%20%5C%5Cpmod%20%7B998244353%7D%20%24%20.%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B1000%5D%2C%22memory%22%3A%5B256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F1081%5C%2FG%22%2C%22id%22%3A%221081G%22%7D%2C%22translation%22%3A%22%5Cu4e00%5Cu4e2a%5Cu957f%5Cu5ea6%5Cu4e3a%24n%24%5Cu7684%5Cu968f%5Cu673a%5Cu6392%5Cu5217%5Cuff0c%5Cu8fdb%5Cu884c%5Cu6df1%5Cu5ea6%5Cu4e3a%24k%24%5Cu7684%5Cu5f52%5Cu5e76%5Cu6392%5Cu5e8f%5Cuff08%24%5B1%5C%5Cdots%20n%5D%24%5Cu4e3a%5Cu7b2c%5Cu4e00%5Cu5c42%5Cuff09%5Cuff0c%5Cu6c42%5Cu671f%5Cu671b%5Cu9006%5Cu5e8f%5Cu5bf9%5Cu4e2a%5Cu6570%5Cu3002%5Cu7b54%5Cu6848%5Cu5bf9%5Cu4e00%5Cu4e2a%5Cu7d20%5Cu6570%5Cu53d6%5Cu6a21%5Cu3002%24n%2Ck%5C%5Cleq%2010%5E5%2C10%5E8%5C%5Cleq%20mod%5C%5Cleq%2010%5E9%24%20%5Cr%5Cn%5Cr%5Cn%22%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Afalse%2C%22totalSubmit%22%3A16%2C%22totalAccepted%22%3A12%2C%22pid%22%3A%22CF1081G%22%2C%22title%22%3A%22Mergesort%20Strikes%20Back%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Mergesort%20Strikes%20Back%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1572920822;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Mergesort Strikes Back</h1>
<h2>题意翻译</h2>
<div>一个长度为$n$的随机排列，进行深度为$k$的归并排序（$[1\dots n]$为第一层），求期望逆序对个数。答案对一个素数取模。$n,k\leq 10^5,10^8\leq mod\leq 10^9$
</div>
<h2>题目描述</h2>
<div>Chouti thought about his very first days in competitive programming. When he had just learned to write merge sort, he thought that the merge sort is too slow, so he restricted the maximum depth of recursion and modified the merge sort to the following:
![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF1081G/d38c74fe6316fba88c7792a3db295863b73fa34d.png)Chouti found his idea dumb since obviously, this "merge sort" sometimes cannot sort the array correctly. However, Chouti is now starting to think of how good this "merge sort" is. Particularly, Chouti wants to know for a random permutation $ a $ of $ 1, 2, \ldots, n $ the expected number of inversions after calling MergeSort(a, 1, n, k).
It can be proved that the expected number is rational. For the given prime $ q $ , suppose the answer can be denoted by $ \frac{u}{d} $ where $ gcd(u,d)=1 $ , you need to output an integer $ r $ satisfying $ 0 \le r<q $ and $ rd \equiv u \pmod q $ . It can be proved that such $ r $ exists and is unique.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first and only line contains three integers $ n, k, q $ ( $ 1 \leq n, k \leq 10^5, 10^8 \leq q \leq 10^9 $ , $ q $ is a prime).</div>
<h3>输出格式</h3>
<br />
<div>The first and only line contains an integer $ r $ .</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>3 1 998244353
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>499122178
</code></pre>
<h3>输入样例 #2</h3>
<pre><code>3 2 998244353
</code></pre>
<h3>输出样例 #2</h3>
<pre><code>665496236
</code></pre>
<h3>输入样例 #3</h3>
<pre><code>9 3 998244353
</code></pre>
<h3>输出样例 #3</h3>
<pre><code>449209967
</code></pre>
<h3>输入样例 #4</h3>
<pre><code>9 4 998244353
</code></pre>
<h3>输出样例 #4</h3>
<pre><code>665496237
</code></pre>
<h2>说明</h2>
<div>In the first example, all possible permutations are $ [1,2,3],[1,3,2],[2,1,3],[2,3,1],[3,1,2],[3,2,1] $ .
With $ k=1 $ , MergeSort(a, 1, n, k) will only return the original permutation. Thus the answer is $ 9/6=3/2 $ , and you should output $ 499122178 $ because $ 499122178 \times 2 \equiv 3 \pmod {998244353} $ .
In the second example, all possible permutations are $ [1,2,3],[1,3,2],[2,1,3],[2,3,1],[3,1,2],[3,2,1] $ and the corresponding outputs of MergeSort(a, 1, n, k) are $ [1,2,3],[1,2,3],[2,1,3],[1,2,3],[2,3,1],[1,3,2] $ respectively. Thus the answer is $ 4/6=2/3 $ , and you should output $ 665496236 $ because $ 665496236 \times 3 \equiv 2 \pmod {998244353} $ .</div>
</article>
</div>
</div>
</body>
</html>
