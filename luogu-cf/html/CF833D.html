<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Red-Black Cobweb - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573398395:04nD/vTM12WJmYLl3meyJlDyGh6BmnPfLTeBDYwEFPE=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22%20%21%5B%5D%28https%3A%5C%2F%5C%2Fcdn.luogu.com.cn%5C%2Fupload%5C%2Fvjudge_pic%5C%2FCF833D%5C%2F02351dacdd2e3ec0c6e1873274a6e20cc219ce83.png%29Slastyona%20likes%20to%20watch%20life%20of%20nearby%20grove%27s%20dwellers.%20This%20time%20she%20watches%20a%20strange%20red-black%20spider%20sitting%20at%20the%20center%20of%20a%20huge%20cobweb.%5Cn%5CnThe%20cobweb%20is%20a%20set%20of%20%24%20n%20%24%20nodes%20connected%20by%20threads%2C%20each%20of%20the%20treads%20is%20either%20red%20of%20black.%20Using%20these%20threads%2C%20the%20spider%20can%20move%20between%20nodes.%20No%20thread%20connects%20a%20node%20to%20itself%2C%20and%20between%20any%20two%20nodes%20there%20is%20a%20unique%20sequence%20of%20threads%20connecting%20them.%5Cn%5CnSlastyona%20decided%20to%20study%20some%20special%20qualities%20of%20the%20cobweb.%20She%20noticed%20that%20each%20of%20the%20threads%20has%20a%20value%20of%20clamminess%20%24%20x%20%24%20.%5Cn%5CnHowever%2C%20Slastyona%20is%20mostly%20interested%20in%20jelliness%20of%20the%20cobweb.%20Consider%20those%20of%20the%20shortest%20paths%20between%20each%20pair%20of%20nodes%20on%20which%20the%20numbers%20of%20red%20and%20black%20threads%20differ%20at%20most%20twice.%20For%20each%20such%20path%20compute%20the%20product%20of%20the%20clamminess%20of%20threads%20on%20the%20path.The%20jelliness%20of%20the%20cobweb%20is%20the%20product%20of%20all%20obtained%20values%20among%20all%20paths.%20Those%20paths%20that%20differ%20by%20direction%20only%20are%20counted%20only%20once.%5Cn%5CnOf%20course%2C%20this%20number%20can%20be%20huge%2C%20so%20Slastyona%20asks%20you%20to%20compute%20the%20jelliness%20of%20the%20given%20cobweb%20and%20print%20the%20answer%20modulo%20%24%2010%5E%7B9%7D%2B7%20%24%20.%22%2C%22inputFormat%22%3A%22The%20first%20line%20contains%20the%20number%20of%20nodes%20%24%20n%20%24%20%24%20%282%3C%3Dn%3C%3D10%5E%7B5%7D%29%20%24%20.%5Cn%5CnThe%20next%20%24%20n-1%20%24%20lines%20contain%20four%20integers%20each%2C%20denoting%20the%20%24%20i%20%24%20-th%20thread%20of%20the%20cobweb%3A%20the%20nodes%20it%20connects%20%24%20u_%7Bi%7D%2Cv_%7Bi%7D%20%24%20%24%20%281%3C%3Du_%7Bi%7D%3C%3Dn%2C1%3C%3Dv_%7Bi%7D%3C%3Dn%29%20%24%20%2C%20the%20clamminess%20of%20the%20thread%20%24%20x_%7Bi%7D%20%24%20%24%20%281%3C%3Dx%3C%3D10%5E%7B9%7D%2B6%29%20%24%20%2C%20and%20the%20color%20of%20the%20thread%20%24%20c_%7Bi%7D%20%24%20%28%21%5B%5D%28https%3A%5C%2F%5C%2Fcdn.luogu.com.cn%5C%2Fupload%5C%2Fvjudge_pic%5C%2FCF833D%5C%2F8320a08fee634ff59f9bc75d1dc7c9a91ef61c78.png%29%29.%20The%20red%20color%20is%20denoted%20by%20%24%200%20%24%20%2C%20and%20the%20black%20color%20is%20denoted%20by%20%24%201%20%24%20.%22%2C%22outputFormat%22%3A%22Print%20single%20integer%20the%20jelliness%20of%20the%20cobweb%20modulo%20%24%2010%5E%7B9%7D%2B7%20%24%20.%20If%20there%20are%20no%20paths%20such%20that%20the%20numbers%20of%20red%20and%20black%20threads%20differ%20at%20most%20twice%2C%20print%20%24%201%20%24%20.%22%2C%22samples%22%3A%5B%5B%225%5Cn1%202%209%200%5Cn2%203%205%201%5Cn2%204%205%200%5Cn2%205%205%201%5Cn%22%2C%221265625%5Cn%22%5D%2C%5B%228%5Cn1%202%207%201%5Cn2%203%204%201%5Cn3%204%2019%201%5Cn5%201%202%200%5Cn6%202%203%200%5Cn7%203%203%200%5Cn8%204%204%200%5Cn%22%2C%22452841614%5Cn%22%5D%5D%2C%22hint%22%3A%22In%20the%20first%20example%20there%20are%20%24%204%20%24%20pairs%20of%20nodes%20such%20that%20the%20numbers%20of%20threads%20of%20both%20colors%20on%20them%20differ%20at%20most%20twice.%20There%20pairs%20are%20%24%20%281%2C3%29%20%24%20with%20product%20of%20clamminess%20equal%20to%20%24%2045%20%24%20%2C%20%24%20%281%2C5%29%20%24%20with%20product%20of%20clamminess%20equal%20to%20%24%2045%20%24%20%2C%20%24%20%283%2C4%29%20%24%20with%20product%20of%20clamminess%20equal%20to%20%24%2025%20%24%20and%20%24%20%284%2C5%29%20%24%20with%20product%20of%20clamminess%20equal%20to%20%24%2025%20%24%20.%20The%20jelliness%20of%20the%20cobweb%20is%20equal%20to%201265625.%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B6000%5D%2C%22memory%22%3A%5B256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F833%5C%2FD%22%2C%22id%22%3A%22833D%22%7D%2C%22translation%22%3A%22%5Cu7ed9%5Cu5b9a%5Cu4e00%5Cu68f5%24n%28n%20%3C%3D%2010%5E5%29%24%5Cu4e2a%5Cu8282%5Cu70b9%5Cu7684%5Cu6811%5Cuff0c%5Cu8fb9%5Cu6709%5Cu9ed1%5Cu767d%5Cu4e24%5Cu8272%5Cu548c%5Cu6743%5Cu503c%5Cuff08%5Cu6743%5Cu503c%5Cu5c0f%5Cu4e8e%2410%5E9%20%2B%207%24%5Cuff09%5Cu3002%5Cu6c42%5Cu6ee1%5Cu8db3%5Cu9ed1%5Cu767d%5Cu8fb9%5Cu7684%5Cu6bd4%5Cu4f8b%5Cu5728%24%5B%5C%5Cfrac12%2C2%5D%24%5Cu7684%5Cu8def%5Cu5f84%5Cu8fb9%5Cu6743%5Cu4e58%5Cu79ef%5Cu7684%5Cu4e58%5Cu79ef%5Cu3002%22%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Afalse%2C%22totalSubmit%22%3A23%2C%22totalAccepted%22%3A16%2C%22pid%22%3A%22CF833D%22%2C%22title%22%3A%22Red-Black%20Cobweb%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Red-Black%20Cobweb%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1572920822;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Red-Black Cobweb</h1>
<h2>题意翻译</h2>
<div>给定一棵$n(n <= 10^5)$个节点的树，边有黑白两色和权值（权值小于$10^9 + 7$）。求满足黑白边的比例在$[\frac12,2]$的路径边权乘积的乘积。</div>
<h2>题目描述</h2>
<div> ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF833D/02351dacdd2e3ec0c6e1873274a6e20cc219ce83.png)Slastyona likes to watch life of nearby grove's dwellers. This time she watches a strange red-black spider sitting at the center of a huge cobweb.
The cobweb is a set of $ n $ nodes connected by threads, each of the treads is either red of black. Using these threads, the spider can move between nodes. No thread connects a node to itself, and between any two nodes there is a unique sequence of threads connecting them.
Slastyona decided to study some special qualities of the cobweb. She noticed that each of the threads has a value of clamminess $ x $ .
However, Slastyona is mostly interested in jelliness of the cobweb. Consider those of the shortest paths between each pair of nodes on which the numbers of red and black threads differ at most twice. For each such path compute the product of the clamminess of threads on the path.The jelliness of the cobweb is the product of all obtained values among all paths. Those paths that differ by direction only are counted only once.
Of course, this number can be huge, so Slastyona asks you to compute the jelliness of the given cobweb and print the answer modulo $ 10^{9}+7 $ .</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line contains the number of nodes $ n $ $ (2<=n<=10^{5}) $ .
The next $ n-1 $ lines contain four integers each, denoting the $ i $ -th thread of the cobweb: the nodes it connects $ u_{i},v_{i} $ $ (1<=u_{i}<=n,1<=v_{i}<=n) $ , the clamminess of the thread $ x_{i} $ $ (1<=x<=10^{9}+6) $ , and the color of the thread $ c_{i} $ (![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF833D/8320a08fee634ff59f9bc75d1dc7c9a91ef61c78.png)). The red color is denoted by $ 0 $ , and the black color is denoted by $ 1 $ .</div>
<h3>输出格式</h3>
<br />
<div>Print single integer the jelliness of the cobweb modulo $ 10^{9}+7 $ . If there are no paths such that the numbers of red and black threads differ at most twice, print $ 1 $ .</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>5
1 2 9 0
2 3 5 1
2 4 5 0
2 5 5 1
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>1265625
</code></pre>
<h3>输入样例 #2</h3>
<pre><code>8
1 2 7 1
2 3 4 1
3 4 19 1
5 1 2 0
6 2 3 0
7 3 3 0
8 4 4 0
</code></pre>
<h3>输出样例 #2</h3>
<pre><code>452841614
</code></pre>
<h2>说明</h2>
<div>In the first example there are $ 4 $ pairs of nodes such that the numbers of threads of both colors on them differ at most twice. There pairs are $ (1,3) $ with product of clamminess equal to $ 45 $ , $ (1,5) $ with product of clamminess equal to $ 45 $ , $ (3,4) $ with product of clamminess equal to $ 25 $ and $ (4,5) $ with product of clamminess equal to $ 25 $ . The jelliness of the cobweb is equal to 1265625.</div>
</article>
</div>
</div>
</body>
</html>
