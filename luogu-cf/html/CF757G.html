<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Can Bash Save the Day? - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573397526:e3cQLfADUVN3eP0WVLKa/GU14VBDsehaYEO2pHyv6g4=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22Whoa%21%20You%20did%20a%20great%20job%20helping%20Team%20Rocket%20who%20managed%20to%20capture%20all%20the%20Pokemons%20sent%20by%20Bash.%20Meowth%2C%20part%20of%20Team%20Rocket%2C%20having%20already%20mastered%20the%20human%20language%2C%20now%20wants%20to%20become%20a%20master%20in%20programming%20as%20well.%20He%20agrees%20to%20free%20the%20Pokemons%20if%20Bash%20can%20answer%20his%20questions.%5Cn%5CnInitially%2C%20Meowth%20gives%20Bash%20a%20weighted%20tree%20containing%20%24%20n%20%24%20nodes%20and%20a%20sequence%20%24%20a_%7B1%7D%2Ca_%7B2%7D...%2Ca_%7Bn%7D%20%24%20which%20is%20a%20permutation%20of%20%24%201%2C2%2C...%2Cn%20%24%20.%20Now%2C%20Mewoth%20makes%20%24%20q%20%24%20queries%20of%20one%20of%20the%20following%20forms%3A%5Cn%5Cn-%201%20l%20r%20v%3A%20meaning%20Bash%20should%20report%20%21%5B%5D%28https%3A%5C%2F%5C%2Fcdn.luogu.com.cn%5C%2Fupload%5C%2Fvjudge_pic%5C%2FCF757G%5C%2Fea8253b2e126f0f9a4f7e577c28110ed4a318c5a.png%29%2C%20where%20%24%20dist%28a%2Cb%29%20%24%20is%20the%20length%20of%20the%20shortest%20path%20from%20node%20%24%20a%20%24%20to%20node%20%24%20b%20%24%20in%20the%20given%20tree.%5Cn-%202%20x%3A%20meaning%20Bash%20should%20swap%20%24%20a_%7Bx%7D%20%24%20and%20%24%20a_%7Bx%2B1%7D%20%24%20in%20the%20given%20sequence.%20This%20new%20sequence%20is%20used%20for%20later%20queries.%5Cn%5CnHelp%20Bash%20to%20answer%20the%20questions%21%22%2C%22inputFormat%22%3A%22The%20first%20line%20contains%20two%20integers%20%24%20n%20%24%20and%20%24%20q%20%24%20%28%20%24%201%3C%3Dn%3C%3D2%5Cu00b710%5E%7B5%7D%20%24%20%2C%20%24%201%3C%3Dq%3C%3D2%5Cu00b710%5E%7B5%7D%20%24%20%29%20%5Cu2014%20the%20number%20of%20nodes%20in%20the%20tree%20and%20the%20number%20of%20queries%2C%20respectively.%5Cn%5CnThe%20next%20line%20contains%20%24%20n%20%24%20space-separated%20integers%20%5Cu2014%20the%20sequence%20%24%20a_%7B1%7D%2Ca_%7B2%7D%2C...%2Ca_%7Bn%7D%20%24%20which%20is%20a%20permutation%20of%20%24%201%2C2%2C...%2Cn%20%24%20.%5Cn%5CnEach%20of%20the%20next%20%24%20n-1%20%24%20lines%20contain%20three%20space-separated%20integers%20%24%20u%20%24%20%2C%20%24%20v%20%24%20%2C%20and%20%24%20w%20%24%20denoting%20that%20there%20exists%20an%20undirected%20edge%20between%20node%20%24%20u%20%24%20and%20node%20%24%20v%20%24%20of%20weight%20%24%20w%20%24%20%2C%20%28%20%24%201%3C%3Du%2Cv%3C%3Dn%20%24%20%2C%20%24%20u%5Cu2260v%20%24%20%2C%20%24%201%3C%3Dw%3C%3D10%5E%7B6%7D%20%24%20%29.%20It%20is%20guaranteed%20that%20the%20given%20graph%20is%20a%20tree.%5Cn%5CnEach%20query%20consists%20of%20two%20lines.%20First%20line%20contains%20single%20integer%20%24%20t%20%24%20%2C%20indicating%20the%20type%20of%20the%20query.%20Next%20line%20contains%20the%20description%20of%20the%20query%3A%5Cn%5Cn-%20t%20%3D%201%3A%20Second%20line%20contains%20three%20integers%20%24%20a%20%24%20%2C%20%24%20b%20%24%20and%20%24%20c%20%24%20%28%20%24%201%3C%3Da%2Cb%2Cc%26lt%3B2%5E%7B30%7D%20%24%20%29%20using%20which%20%24%20l%20%24%20%2C%20%24%20r%20%24%20and%20%24%20v%20%24%20can%20be%20generated%20using%20the%20formula%20given%20below%3A%20%5Cn%20%20-%20%21%5B%5D%28https%3A%5C%2F%5C%2Fcdn.luogu.com.cn%5C%2Fupload%5C%2Fvjudge_pic%5C%2FCF757G%5C%2F8aee8013a9e038e56ef819c034e3f838e39c5b69.png%29%2C%5Cn%20%20-%20%21%5B%5D%28https%3A%5C%2F%5C%2Fcdn.luogu.com.cn%5C%2Fupload%5C%2Fvjudge_pic%5C%2FCF757G%5C%2F8a6ca8e44774777b9443d62d70704ae5a8cbd864.png%29%2C%5Cn%20%20-%20%21%5B%5D%28https%3A%5C%2F%5C%2Fcdn.luogu.com.cn%5C%2Fupload%5C%2Fvjudge_pic%5C%2FCF757G%5C%2F2332d289771b1a35329bc48f3b3da516601f653d.png%29.%5Cn-%20t%20%3D%202%3A%20Second%20line%20contains%20single%20integer%20%24%20a%20%24%20%28%20%24%201%3C%3Da%26lt%3B2%5E%7B30%7D%20%24%20%29%20using%20which%20%24%20x%20%24%20can%20be%20generated%20using%20the%20formula%20given%20below%3A%20%5Cn%20%20-%20%21%5B%5D%28https%3A%5C%2F%5C%2Fcdn.luogu.com.cn%5C%2Fupload%5C%2Fvjudge_pic%5C%2FCF757G%5C%2Feb2a03b6eebdb7c4867abe4c7844cc3adf9f4a53.png%29.%5Cn%5CnThe%20%24%20ans_%7Bi%7D%20%24%20is%20the%20answer%20for%20the%20%24%20i%20%24%20-th%20query%2C%20assume%20that%20%24%20ans_%7B0%7D%3D0%20%24%20.%20If%20the%20%24%20i%20%24%20-th%20query%20is%20of%20type%202%20then%20%24%20ans_%7Bi%7D%20%24%20%3D%20%24%20ans_%7Bi-1%7D%20%24%20.%20It%20is%20guaranteed%20that%3A%5Cn%5Cn-%20for%20each%20query%20of%20type%201%3A%20%24%201%3C%3Dl%3C%3Dr%3C%3Dn%20%24%20%2C%20%24%201%3C%3Dv%3C%3Dn%20%24%20%2C%5Cn-%20for%20each%20query%20of%20type%202%3A%20%24%201%3C%3Dx%3C%3Dn-1%20%24%20.%5Cn%5CnThe%20%21%5B%5D%28https%3A%5C%2F%5C%2Fcdn.luogu.com.cn%5C%2Fupload%5C%2Fvjudge_pic%5C%2FCF757G%5C%2F4298d47c0191af3c0a3103f431751061bc7e2362.png%29%20operation%20means%20bitwise%20exclusive%20OR.%22%2C%22outputFormat%22%3A%22For%20each%20query%20of%20type%20%24%201%20%24%20%2C%20output%20a%20single%20integer%20in%20a%20separate%20line%2C%20denoting%20the%20answer%20to%20the%20query.%22%2C%22samples%22%3A%5B%5B%225%205%5Cn4%205%201%203%202%5Cn4%202%204%5Cn1%203%209%5Cn4%201%204%5Cn4%205%202%5Cn1%5Cn1%205%204%5Cn1%5Cn22%2020%2020%5Cn2%5Cn38%5Cn2%5Cn39%5Cn1%5Cn36%2038%2038%5Cn%22%2C%2223%5Cn37%5Cn28%5Cn%22%5D%5D%2C%22hint%22%3A%22In%20the%20sample%2C%20the%20actual%20queries%20are%20the%20following%3A%5Cn%5Cn-%201%201%205%204%5Cn-%201%201%203%203%5Cn-%202%203%5Cn-%202%202%5Cn-%201%201%203%203%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B5000%5D%2C%22memory%22%3A%5B768000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F757%5C%2FG%22%2C%22id%22%3A%22757G%22%7D%2C%22translation%22%3A%22%5Cu4e00%5Cu68f5%24n%24%5Cu4e2a%5Cu70b9%5Cu7684%5Cu6811%5Cu548c%5Cu4e00%5Cu4e2a%5Cu6392%5Cu5217%24p_i%24%5Cuff0c%5Cu8fb9%5Cu6709%5Cu8fb9%5Cu6743%5Cuff0c%5Cu652f%5Cu6301%5Cu4e24%5Cu79cd%5Cu64cd%5Cu4f5c%5Cuff1a%5Cr%5Cn-%20%24l%5C%5C%20r%5C%5C%20x%24%5Cuff0c%5Cu8be2%5Cu95ee%24%5C%5Csum%5C%5Climits%20_%7Bi%3Dl%7D%5E%7Br%7D%20dis%28p_i%2Cx%29%24%5Cr%5Cn-%20%24x%24%5Cuff0c%5Cu4ea4%5Cu6362%24p_x%2Cp_%7Bx%2B1%7D%24%5Cr%5Cn%5Cr%5Cn%24n%2Cq%5C%5Cleq%202%5C%5Ctimes%2010%5E5%24%5Cuff0c%5Cu5f3a%5Cu5236%5Cu5728%5Cu7ebf%5Cr%5Cn%22%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Afalse%2C%22totalSubmit%22%3A66%2C%22totalAccepted%22%3A17%2C%22pid%22%3A%22CF757G%22%2C%22title%22%3A%22Can%20Bash%20Save%20the%20Day%3F%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%7B%22pid%22%3A%22P2481%22%2C%22title%22%3A%22%5BSDOI2010%5D%5Cu4ee3%5Cu7801%5Cu62cd%5Cu5356%5Cu4f1a%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22P%22%7D%2C%7B%22pid%22%3A%22P3241%22%2C%22title%22%3A%22%5BHNOI2015%5D%5Cu5f00%5Cu5e97%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22P%22%7D%2C%7B%22pid%22%3A%22CF786E%22%2C%22title%22%3A%22ALT%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22CF%22%7D%2C%7B%22pid%22%3A%22P4156%22%2C%22title%22%3A%22%5BWC2016%5D%5Cu8bba%5Cu6218%5Cu6346%5Cu7af9%5Cu7aff%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22P%22%7D%2C%7B%22pid%22%3A%22P4542%22%2C%22title%22%3A%22%5BZJOI2011%5D%5Cu8425%5Cu6551%5Cu76ae%5Cu5361%5Cu4e18%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22P%22%7D%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Can%20Bash%20Save%20the%20Day%3F%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1573306449;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Can Bash Save the Day?</h1>
<h2>题意翻译</h2>
<div>一棵$n$个点的树和一个排列$p_i$，边有边权，支持两种操作：
- $l\ r\ x$，询问$\sum\limits _{i=l}^{r} dis(p_i,x)$
- $x$，交换$p_x,p_{x+1}$
$n,q\leq 2\times 10^5$，强制在线
</div>
<h2>题目描述</h2>
<div>Whoa! You did a great job helping Team Rocket who managed to capture all the Pokemons sent by Bash. Meowth, part of Team Rocket, having already mastered the human language, now wants to become a master in programming as well. He agrees to free the Pokemons if Bash can answer his questions.
Initially, Meowth gives Bash a weighted tree containing $ n $ nodes and a sequence $ a_{1},a_{2}...,a_{n} $ which is a permutation of $ 1,2,...,n $ . Now, Mewoth makes $ q $ queries of one of the following forms:
- 1 l r v: meaning Bash should report ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF757G/ea8253b2e126f0f9a4f7e577c28110ed4a318c5a.png), where $ dist(a,b) $ is the length of the shortest path from node $ a $ to node $ b $ in the given tree.
- 2 x: meaning Bash should swap $ a_{x} $ and $ a_{x+1} $ in the given sequence. This new sequence is used for later queries.
Help Bash to answer the questions!</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line contains two integers $ n $ and $ q $ ( $ 1<=n<=2·10^{5} $ , $ 1<=q<=2·10^{5} $ ) — the number of nodes in the tree and the number of queries, respectively.
The next line contains $ n $ space-separated integers — the sequence $ a_{1},a_{2},...,a_{n} $ which is a permutation of $ 1,2,...,n $ .
Each of the next $ n-1 $ lines contain three space-separated integers $ u $ , $ v $ , and $ w $ denoting that there exists an undirected edge between node $ u $ and node $ v $ of weight $ w $ , ( $ 1<=u,v<=n $ , $ u≠v $ , $ 1<=w<=10^{6} $ ). It is guaranteed that the given graph is a tree.
Each query consists of two lines. First line contains single integer $ t $ , indicating the type of the query. Next line contains the description of the query:
- t = 1: Second line contains three integers $ a $ , $ b $ and $ c $ ( $ 1<=a,b,c&lt;2^{30} $ ) using which $ l $ , $ r $ and $ v $ can be generated using the formula given below:
- ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF757G/8aee8013a9e038e56ef819c034e3f838e39c5b69.png),
- ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF757G/8a6ca8e44774777b9443d62d70704ae5a8cbd864.png),
- ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF757G/2332d289771b1a35329bc48f3b3da516601f653d.png).
- t = 2: Second line contains single integer $ a $ ( $ 1<=a&lt;2^{30} $ ) using which $ x $ can be generated using the formula given below:
- ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF757G/eb2a03b6eebdb7c4867abe4c7844cc3adf9f4a53.png).
The $ ans_{i} $ is the answer for the $ i $ -th query, assume that $ ans_{0}=0 $ . If the $ i $ -th query is of type 2 then $ ans_{i} $ = $ ans_{i-1} $ . It is guaranteed that:
- for each query of type 1: $ 1<=l<=r<=n $ , $ 1<=v<=n $ ,
- for each query of type 2: $ 1<=x<=n-1 $ .
The ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF757G/4298d47c0191af3c0a3103f431751061bc7e2362.png) operation means bitwise exclusive OR.</div>
<h3>输出格式</h3>
<br />
<div>For each query of type $ 1 $ , output a single integer in a separate line, denoting the answer to the query.</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>5 5
4 5 1 3 2
4 2 4
1 3 9
4 1 4
4 5 2
1
1 5 4
1
22 20 20
2
38
2
39
1
36 38 38
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>23
37
28
</code></pre>
<h2>说明</h2>
<div>In the sample, the actual queries are the following:
- 1 1 5 4
- 1 1 3 3
- 2 3
- 2 2
- 1 1 3 3</div>
</article>
</div>
</div>
</body>
</html>
