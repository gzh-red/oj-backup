<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Inversion Expectation - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573401587:pUY1r9OWQ9n8FhiuwEatmMSWZ3NIDK3TGKr1PKP3rL8=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22A%20permutation%20of%20size%20%24%20n%20%24%20is%20an%20array%20of%20size%20%24%20n%20%24%20such%20that%20each%20integer%20from%20%24%201%20%24%20to%20%24%20n%20%24%20occurs%20exactly%20once%20in%20this%20array.%20An%20inversion%20in%20a%20permutation%20%24%20p%20%24%20is%20a%20pair%20of%20indices%20%24%20%28i%2C%20j%29%20%24%20such%20that%20%24%20i%20%3E%20j%20%24%20and%20%24%20a_i%20%3C%20a_j%20%24%20.%20For%20example%2C%20a%20permutation%20%24%20%5B4%2C%201%2C%203%2C%202%5D%20%24%20contains%20%24%204%20%24%20inversions%3A%20%24%20%282%2C%201%29%20%24%20%2C%20%24%20%283%2C%201%29%20%24%20%2C%20%24%20%284%2C%201%29%20%24%20%2C%20%24%20%284%2C%203%29%20%24%20.%5Cn%5CnYou%20are%20given%20a%20permutation%20%24%20p%20%24%20of%20size%20%24%20n%20%24%20.%20However%2C%20the%20numbers%20on%20some%20positions%20are%20replaced%20by%20%24%20-1%20%24%20.%20Let%20the%20valid%20permutation%20be%20such%20a%20replacement%20of%20%24%20-1%20%24%20in%20this%20sequence%20back%20to%20numbers%20from%20%24%201%20%24%20to%20%24%20n%20%24%20in%20such%20a%20way%20that%20the%20resulting%20sequence%20is%20a%20permutation%20of%20size%20%24%20n%20%24%20.%5Cn%5CnThe%20given%20sequence%20was%20turned%20into%20a%20valid%20permutation%20randomly%20with%20the%20equal%20probability%20of%20getting%20each%20valid%20permutation.%5Cn%5CnCalculate%20the%20expected%20total%20number%20of%20inversions%20in%20the%20resulting%20valid%20permutation.%5Cn%5CnIt%20can%20be%20shown%20that%20it%20is%20in%20the%20form%20of%20%24%20%5C%5Cfrac%7BP%7D%7BQ%7D%20%24%20where%20%24%20P%20%24%20and%20%24%20Q%20%24%20are%20non-negative%20integers%20and%20%24%20Q%20%5C%5Cne%200%20%24%20.%20Report%20the%20value%20of%20%24%20P%20%5C%5Ccdot%20Q%5E%7B-1%7D%20%5C%5Cpmod%20%7B998244353%7D%20%24%20.%22%2C%22inputFormat%22%3A%22The%20first%20line%20contains%20a%20single%20integer%20%24%20n%20%24%20%28%20%24%201%20%5C%5Cle%20n%20%5C%5Cle%202%20%5C%5Ccdot%2010%5E5%20%24%20%29%20%5Cu2014%20the%20length%20of%20the%20sequence.%5Cn%5CnThe%20second%20line%20contains%20%24%20n%20%24%20integers%20%24%20p_1%2C%20p_2%2C%20%5C%5Cdots%2C%20p_n%20%24%20%28%20%24%20-1%20%5C%5Cle%20p_i%20%5C%5Cle%20n%20%24%20%2C%20%24%20p_i%20%5C%5Cne%200%20%24%20%29%20%5Cu2014%20the%20initial%20sequence.%5Cn%5CnIt%20is%20guaranteed%20that%20all%20elements%20not%20equal%20to%20%24%20-1%20%24%20are%20pairwise%20distinct.%22%2C%22outputFormat%22%3A%22Print%20a%20single%20integer%20%5Cu2014%20the%20expected%20total%20number%20of%20inversions%20in%20the%20resulting%20valid%20permutation.%5Cn%5CnIt%20can%20be%20shown%20that%20it%20is%20in%20the%20form%20of%20%24%20%5C%5Cfrac%7BP%7D%7BQ%7D%20%24%20where%20%24%20P%20%24%20and%20%24%20Q%20%24%20are%20non-negative%20integers%20and%20%24%20Q%20%5C%5Cne%200%20%24%20.%20Report%20the%20value%20of%20%24%20P%20%5C%5Ccdot%20Q%5E%7B-1%7D%20%5C%5Cpmod%20%7B998244353%7D%20%24%20.%22%2C%22samples%22%3A%5B%5B%22%5Cn3%5Cn3%20-1%20-1%5Cn%22%2C%22%5Cn499122179%5Cn%22%5D%2C%5B%22%5Cn2%5Cn1%202%5Cn%22%2C%22%5Cn0%5Cn%22%5D%2C%5B%22%5Cn2%5Cn-1%20-1%5Cn%22%2C%22%5Cn499122177%5Cn%22%5D%5D%2C%22hint%22%3A%22In%20the%20first%20example%20two%20resulting%20valid%20permutations%20are%20possible%3A%5Cn%5Cn-%20%24%20%5B3%2C%201%2C%202%5D%20%24%20%5Cu2014%20%24%202%20%24%20inversions%3B%5Cn-%20%24%20%5B3%2C%202%2C%201%5D%20%24%20%5Cu2014%20%24%203%20%24%20inversions.%5Cn%5CnThe%20expected%20value%20is%20%24%20%5C%5Cfrac%7B2%20%5C%5Ccdot%201%20%2B%203%20%5C%5Ccdot%201%7D%7B2%7D%20%3D%202.5%20%24%20.%5Cn%5CnIn%20the%20second%20example%20no%20%24%20-1%20%24%20are%20present%2C%20thus%20the%20only%20valid%20permutation%20is%20possible%20%5Cu2014%20the%20given%20one.%20It%20has%20%24%200%20%24%20inversions.%5Cn%5CnIn%20the%20third%20example%20there%20are%20two%20resulting%20valid%20permutations%20%5Cu2014%20one%20with%20%24%200%20%24%20inversions%20and%20one%20with%20%24%201%20%24%20inversion.%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B2000%5D%2C%22memory%22%3A%5B256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F1096%5C%2FF%22%2C%22id%22%3A%221096F%22%7D%2C%22translation%22%3A%22%5Cu7ed9%5Cu4f60%5Cu4e00%5Cu4e2a%5Cu957f%5Cu4e3a%20%24n%24%20%5Cu7684%5Cu6392%5Cu5217%5Cuff0c%5Cu82e5%5Cu67d0%5Cu4e00%5Cu4f4d%5Cu4e3a%20%24-1%24%20%5Cu5219%5Cu8fd9%5Cu4e00%5Cu4f4d%5Cu662f%5Cu4e0d%5Cu786e%5Cu5b9a%5Cu7684%5Cu3002%5Cu6bcf%5Cu79cd%5Cu53ef%5Cu80fd%5Cu7684%5Cu6392%5Cu5217%5Cu51fa%5Cu73b0%5Cu7684%5Cu6982%5Cu7387%5Cu76f8%5Cu7b49%5Cu3002%5Cu6c42%5Cu671f%5Cu671b%5Cu9006%5Cu5e8f%5Cu5bf9%5Cu6570%5Cu5bf9%20%24998244353%24%20%5Cu53d6%5Cu6a21%5Cu7684%5Cu7ed3%5Cu679c%5Cu3002%22%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Afalse%2C%22totalSubmit%22%3A110%2C%22totalAccepted%22%3A56%2C%22pid%22%3A%22CF1096F%22%2C%22title%22%3A%22Inversion%20Expectation%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%7B%22pid%22%3A%22CF896C%22%2C%22title%22%3A%22Willem%2C%20Chtholly%20and%20Seniorious%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22CF%22%7D%2C%7B%22pid%22%3A%22P4643%22%2C%22title%22%3A%22%5B%5Cu56fd%5Cu5bb6%5Cu96c6%5Cu8bad%5Cu961f%5D%5Cu963f%5Cu72f8%5Cu548c%5Cu6843%5Cu5b50%5Cu7684%5Cu6e38%5Cu620f%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22P%22%7D%2C%7B%22pid%22%3A%22CF1093E%22%2C%22title%22%3A%22Intersection%20of%20Permutations%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22CF%22%7D%2C%7B%22pid%22%3A%22CF1096G%22%2C%22title%22%3A%22Lucky%20Tickets%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22CF%22%7D%2C%7B%22pid%22%3A%22CF1096E%22%2C%22title%22%3A%22The%20Top%20Scorer%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22CF%22%7D%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Inversion%20Expectation%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1572920822;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Inversion Expectation</h1>
<h2>题意翻译</h2>
<div>给你一个长为 $n$ 的排列，若某一位为 $-1$ 则这一位是不确定的。每种可能的排列出现的概率相等。求期望逆序对数对 $998244353$ 取模的结果。</div>
<h2>题目描述</h2>
<div>A permutation of size $ n $ is an array of size $ n $ such that each integer from $ 1 $ to $ n $ occurs exactly once in this array. An inversion in a permutation $ p $ is a pair of indices $ (i, j) $ such that $ i > j $ and $ a_i < a_j $ . For example, a permutation $ [4, 1, 3, 2] $ contains $ 4 $ inversions: $ (2, 1) $ , $ (3, 1) $ , $ (4, 1) $ , $ (4, 3) $ .
You are given a permutation $ p $ of size $ n $ . However, the numbers on some positions are replaced by $ -1 $ . Let the valid permutation be such a replacement of $ -1 $ in this sequence back to numbers from $ 1 $ to $ n $ in such a way that the resulting sequence is a permutation of size $ n $ .
The given sequence was turned into a valid permutation randomly with the equal probability of getting each valid permutation.
Calculate the expected total number of inversions in the resulting valid permutation.
It can be shown that it is in the form of $ \frac{P}{Q} $ where $ P $ and $ Q $ are non-negative integers and $ Q \ne 0 $ . Report the value of $ P \cdot Q^{-1} \pmod {998244353} $ .</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line contains a single integer $ n $ ( $ 1 \le n \le 2 \cdot 10^5 $ ) — the length of the sequence.
The second line contains $ n $ integers $ p_1, p_2, \dots, p_n $ ( $ -1 \le p_i \le n $ , $ p_i \ne 0 $ ) — the initial sequence.
It is guaranteed that all elements not equal to $ -1 $ are pairwise distinct.</div>
<h3>输出格式</h3>
<br />
<div>Print a single integer — the expected total number of inversions in the resulting valid permutation.
It can be shown that it is in the form of $ \frac{P}{Q} $ where $ P $ and $ Q $ are non-negative integers and $ Q \ne 0 $ . Report the value of $ P \cdot Q^{-1} \pmod {998244353} $ .</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>
3
3 -1 -1
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>
499122179
</code></pre>
<h3>输入样例 #2</h3>
<pre><code>
2
1 2
</code></pre>
<h3>输出样例 #2</h3>
<pre><code>
0
</code></pre>
<h3>输入样例 #3</h3>
<pre><code>
2
-1 -1
</code></pre>
<h3>输出样例 #3</h3>
<pre><code>
499122177
</code></pre>
<h2>说明</h2>
<div>In the first example two resulting valid permutations are possible:
- $ [3, 1, 2] $ — $ 2 $ inversions;
- $ [3, 2, 1] $ — $ 3 $ inversions.
The expected value is $ \frac{2 \cdot 1 + 3 \cdot 1}{2} = 2.5 $ .
In the second example no $ -1 $ are present, thus the only valid permutation is possible — the given one. It has $ 0 $ inversions.
In the third example there are two resulting valid permutations — one with $ 0 $ inversions and one with $ 1 $ inversion.</div>
</article>
</div>
</div>
</body>
</html>
