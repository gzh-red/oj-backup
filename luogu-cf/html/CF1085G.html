<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Beautiful Matrix - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573401420:nkjdISobSmc4KFabexXc1vzrZJa+YM+/8HP+RWmFkWE=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22Petya%20collects%20beautiful%20matrix.%5Cn%5CnA%20matrix%20of%20size%20%24%20n%20%5C%5Ctimes%20n%20%24%20is%20beautiful%20if%3A%5Cn%5Cn-%20All%20elements%20of%20the%20matrix%20are%20integers%20between%20%24%201%20%24%20and%20%24%20n%20%24%20%3B%5Cn-%20For%20every%20row%20of%20the%20matrix%2C%20all%20elements%20of%20this%20row%20are%20different%3B%5Cn-%20For%20every%20pair%20of%20vertically%20adjacent%20elements%2C%20these%20elements%20are%20different.%5Cn%5CnToday%20Petya%20bought%20a%20beautiful%20matrix%20%24%20a%20%24%20of%20size%20%24%20n%20%5C%5Ctimes%20n%20%24%20%2C%20and%20now%20he%20wants%20to%20determine%20its%20rarity.%5Cn%5CnThe%20rarity%20of%20the%20matrix%20is%20its%20index%20in%20the%20list%20of%20beautiful%20matrices%20of%20size%20%24%20n%20%5C%5Ctimes%20n%20%24%20%2C%20sorted%20in%20lexicographical%20order.%20Matrix%20comparison%20is%20done%20row%20by%20row.%20%28The%20index%20of%20lexicographically%20smallest%20matrix%20is%20zero%29.%5Cn%5CnSince%20the%20number%20of%20beautiful%20matrices%20may%20be%20huge%2C%20Petya%20wants%20you%20to%20calculate%20the%20rarity%20of%20the%20matrix%20%24%20a%20%24%20modulo%20%24%20998%5C%5C%2C244%5C%5C%2C353%20%24%20.%22%2C%22inputFormat%22%3A%22The%20first%20line%20contains%20one%20integer%20%24%20n%20%24%20%28%20%24%201%20%5C%5Cle%20n%20%5C%5Cle%202000%20%24%20%29%20%5Cu2014%20the%20number%20of%20rows%20and%20columns%20in%20%24%20a%20%24%20.%5Cn%5CnEach%20of%20the%20next%20%24%20n%20%24%20lines%20contains%20%24%20n%20%24%20integers%20%24%20a_%7Bi%2Cj%7D%20%24%20%28%20%24%201%20%5C%5Cle%20a_%7Bi%2Cj%7D%20%5C%5Cle%20n%20%24%20%29%20%5Cu2014%20the%20elements%20of%20%24%20a%20%24%20.%5Cn%5CnIt%20is%20guaranteed%20that%20%24%20a%20%24%20is%20a%20beautiful%20matrix.%22%2C%22outputFormat%22%3A%22Print%20one%20integer%20%5Cu2014%20the%20rarity%20of%20matrix%20%24%20a%20%24%20%2C%20taken%20modulo%20%24%20998%5C%5C%2C244%5C%5C%2C353%20%24%20.%22%2C%22samples%22%3A%5B%5B%22%5Cn2%5Cn2%201%5Cn1%202%5Cn%22%2C%22%5Cn1%5Cn%22%5D%2C%5B%22%5Cn3%5Cn1%202%203%5Cn2%203%201%5Cn3%201%202%5Cn%22%2C%22%5Cn1%5Cn%22%5D%2C%5B%22%5Cn3%5Cn1%202%203%5Cn3%201%202%5Cn2%203%201%5Cn%22%2C%22%5Cn3%5Cn%22%5D%5D%2C%22hint%22%3A%22There%20are%20only%20%24%202%20%24%20beautiful%20matrices%20of%20size%20%24%202%20%5C%5Ctimes%202%20%24%20%3A%5Cn%5Cn%20%21%5B%5D%28https%3A%5C%2F%5C%2Fcdn.luogu.com.cn%5C%2Fupload%5C%2Fvjudge_pic%5C%2FCF1085G%5C%2Ff867c5eaa161b1f1aa9e5f2c90e4500d9ce0b908.png%29There%20are%20the%20first%20%24%205%20%24%20beautiful%20matrices%20of%20size%20%24%203%20%5C%5Ctimes%203%20%24%20in%20lexicographical%20order%3A%5Cn%5Cn%20%21%5B%5D%28https%3A%5C%2F%5C%2Fcdn.luogu.com.cn%5C%2Fupload%5C%2Fvjudge_pic%5C%2FCF1085G%5C%2F1658b23d01963b8d7e8ba033e0ef04c32e0bd4a6.png%29%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B4000%5D%2C%22memory%22%3A%5B256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F1085%5C%2FG%22%2C%22id%22%3A%221085G%22%7D%2C%22translation%22%3A%22%23%23%20%5Cu9898%5Cu76ee%5Cu63cf%5Cu8ff0%5Cr%5CnPetya%5Cu5728%5Cu6536%5Cu96c6%5Cu7f8e%5Cu4e3d%5Cu77e9%5Cu9635%5Cr%5Cn%5Cu4e00%5Cu4e2an%5Cu00d7n%5Cu7684%5Cu7f8e%5Cu4e3d%5Cu77e9%5Cu9635%5Cu8981%5Cu4fdd%5Cu8bc1%5Cuff1a%5Cr%5Cn1.%5Cu6240%5Cu6709%5Cu7684%5Cu77e9%5Cu9635%5Cu5185%5Cu7684%5Cu5143%5Cu7d20%5Cu90fd%5Cu662f1~n%5Cu7684%5Cu6574%5Cu6570%5Cuff1b%5Cr%5Cn2.%5Cu6bcf%5Cu4e00%5Cu884c%5Cu4e0d%5Cu80fd%5Cu6709%5Cu76f8%5Cu540c%5Cu7684%5Cu5143%5Cu7d20%5Cuff1b%5Cr%5Cn3.%5Cu6bcf%5Cu4e00%5Cu5bf9%5Cu7ad6%5Cu76f4%5Cu76f8%5Cu90bb%5Cu7684%5Cu5143%5Cu7d20%5Cu4e0d%5Cu80fd%5Cu76f8%5Cu540c%5Cu3002%5Cr%5CnPetya%5Cu5b9a%5Cu4e49%20%5Cu7a00%5Cu6709%5Cu5ea6%20%5Cu4e3a%5Cu5c06%5Cu6240%5Cu6709n%5Cu00d7n%5Cu7684%5Cu7f8e%5Cu4e3d%5Cu77e9%5Cu9635%5Cu6309%5Cu7167%5Cu5b57%5Cu5178%5Cu5e8f%5Cu6392%5Cu597d%5Cu5e8f%5Cuff08%5Cu4ece0%5Cu5f00%5Cu59cb%5Cu8ba1%5Cu6570%5Cuff09%5Cu8be5%5Cu7f8e%5Cu4e3d%5Cu77e9%5Cu9635%5Cu6240%5Cu5728%5Cu7684%5Cu7f16%5Cu53f7%5Cu3002%5Cr%5Cn%5Cu4ed6%5Cu5e0c%5Cu671b%5Cu4f60%5Cu6c42%5Cu51fa%5Cu4ed6%5Cu6240%5Cu7ed9%5Cu7684%5Cu77e9%5Cu9635%5Cu7684%5Cu7a00%5Cu6709%5Cu5ea6%5Cuff08%5Cu6a21%20998244353%20%5Cuff09%5Cr%5Cn%5Cu5982%202%5Cu00d72%20%5Cu7684%5Cu7f8e%5Cu4e3d%5Cu77e9%5Cu9635%5Cu6709%5Cr%5Cn%5Cr%5Cn1%202%20%7C%7C%7C%202%201%5Cr%5Cn%5Cr%5Cn2%201%20%7C%7C%7C%201%202%5Cr%5Cn%5Cr%5Cn0%5Cu53f7%20%7C%7C%7C%201%5Cu53f7%5Cr%5Cn%5Cr%5Cn%5Cu6240%5Cu4ee5%5Cu6837%5Cu4f8b%5Cu4e00%5Cu4e2d%5Cu7684%5Cu77e9%5Cu9635%5Cu7684%5Cu7a00%5Cu6709%5Cu5ea6%5Cu4e3a1%5Cu3002%5Cr%5Cn%23%23%20%5Cu8f93%5Cu5165%5Cu8f93%5Cu51fa%5Cu683c%5Cu5f0f%5Cr%5Cn%23%23%23%20%5Cu8f93%5Cu5165%5Cu683c%5Cu5f0f%5Cuff1a%5Cr%5Cn%5Cu7b2c%5Cu4e00%5Cu884c%5Cu4e3an%5Cr%5Cn%5Cu5269%5Cu4e0b%5Cu7684%5Cu662f%5Cu4e00%5Cu4e2an%5Cu00d7n%5Cu7684%5Cu7f8e%5Cu4e3d%5Cu77e9%5Cu9635%5Cu3002%5Cr%5Cn%23%23%23%20%5Cu8f93%5Cu51fa%5Cu683c%5Cu5f0f%5Cuff1a%5Cr%5Cn%5Cu4e00%5Cu884c%5Cuff0c%5Cu8be5%5Cu77e9%5Cu9635%5Cu7684%5Cu7a00%5Cu6709%5Cu5ea6%5Cu3002%22%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Afalse%2C%22totalSubmit%22%3A14%2C%22totalAccepted%22%3A8%2C%22pid%22%3A%22CF1085G%22%2C%22title%22%3A%22Beautiful%20Matrix%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Beautiful%20Matrix%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1572920822;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Beautiful Matrix</h1>
<h2>题意翻译</h2>
<div>## 题目描述
Petya在收集美丽矩阵
一个n×n的美丽矩阵要保证：
1.所有的矩阵内的元素都是1~n的整数；
2.每一行不能有相同的元素；
3.每一对竖直相邻的元素不能相同。
Petya定义 稀有度 为将所有n×n的美丽矩阵按照字典序排好序（从0开始计数）该美丽矩阵所在的编号。
他希望你求出他所给的矩阵的稀有度（模 998244353 ）
如 2×2 的美丽矩阵有
1 2 ||| 2 1
2 1 ||| 1 2
0号 ||| 1号
所以样例一中的矩阵的稀有度为1。
## 输入输出格式
### 输入格式：
第一行为n
剩下的是一个n×n的美丽矩阵。
### 输出格式：
一行，该矩阵的稀有度。</div>
<h2>题目描述</h2>
<div>Petya collects beautiful matrix.
A matrix of size $ n \times n $ is beautiful if:
- All elements of the matrix are integers between $ 1 $ and $ n $ ;
- For every row of the matrix, all elements of this row are different;
- For every pair of vertically adjacent elements, these elements are different.
Today Petya bought a beautiful matrix $ a $ of size $ n \times n $ , and now he wants to determine its rarity.
The rarity of the matrix is its index in the list of beautiful matrices of size $ n \times n $ , sorted in lexicographical order. Matrix comparison is done row by row. (The index of lexicographically smallest matrix is zero).
Since the number of beautiful matrices may be huge, Petya wants you to calculate the rarity of the matrix $ a $ modulo $ 998\,244\,353 $ .</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line contains one integer $ n $ ( $ 1 \le n \le 2000 $ ) — the number of rows and columns in $ a $ .
Each of the next $ n $ lines contains $ n $ integers $ a_{i,j} $ ( $ 1 \le a_{i,j} \le n $ ) — the elements of $ a $ .
It is guaranteed that $ a $ is a beautiful matrix.</div>
<h3>输出格式</h3>
<br />
<div>Print one integer — the rarity of matrix $ a $ , taken modulo $ 998\,244\,353 $ .</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>
2
2 1
1 2
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>
1
</code></pre>
<h3>输入样例 #2</h3>
<pre><code>
3
1 2 3
2 3 1
3 1 2
</code></pre>
<h3>输出样例 #2</h3>
<pre><code>
1
</code></pre>
<h3>输入样例 #3</h3>
<pre><code>
3
1 2 3
3 1 2
2 3 1
</code></pre>
<h3>输出样例 #3</h3>
<pre><code>
3
</code></pre>
<h2>说明</h2>
<div>There are only $ 2 $ beautiful matrices of size $ 2 \times 2 $ :
![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF1085G/f867c5eaa161b1f1aa9e5f2c90e4500d9ce0b908.png)There are the first $ 5 $ beautiful matrices of size $ 3 \times 3 $ in lexicographical order:
![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF1085G/1658b23d01963b8d7e8ba033e0ef04c32e0bd4a6.png)</div>
</article>
</div>
</div>
</body>
</html>
