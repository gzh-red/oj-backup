<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Appleman and Complicated Task - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573394344:vgq+9Nd8wNmIYlDQwuRzxbePEud3QObWKYAO/TF6FT8=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22Toastman%20came%20up%20with%20a%20very%20complicated%20task.%20He%20gives%20it%20to%20Appleman%2C%20but%20Appleman%20doesn%27t%20know%20how%20to%20solve%20it.%20Can%20you%20help%20him%3F%5Cn%5CnGiven%20a%20%24%20n%5Cu00d7n%20%24%20checkerboard.%20Each%20cell%20of%20the%20board%20has%20either%20character%20%27x%27%2C%20or%20character%20%27o%27%2C%20or%20nothing.%20How%20many%20ways%20to%20fill%20all%20the%20empty%20cells%20with%20%27x%27%20or%20%27o%27%20%28each%20cell%20must%20contain%20only%20one%20character%20in%20the%20end%29%20are%20there%2C%20such%20that%20for%20each%20cell%20the%20number%20of%20adjacent%20cells%20with%20%27o%27%20will%20be%20even%3F%20Find%20the%20number%20of%20ways%20modulo%20%24%201000000007%20%24%20%24%20%2810%5E%7B9%7D%2B7%29%20%24%20.%20Two%20cells%20of%20the%20board%20are%20adjacent%20if%20they%20share%20a%20side.%22%2C%22inputFormat%22%3A%22The%20first%20line%20contains%20two%20integers%20%24%20n%20%24%20%2C%20%24%20k%20%24%20%28%20%24%201%3C%3Dn%2Ck%3C%3D10%5E%7B5%7D%20%24%20%29%20%5Cu2014%20the%20size%20of%20the%20board%2C%20and%20the%20number%20of%20cells%20that%20has%20characters%20initially.%5Cn%5CnThen%20%24%20k%20%24%20lines%20follows.%20The%20%24%20i%20%24%20-th%20line%20contains%20two%20integers%20and%20a%20character%3A%20%24%20a_%7Bi%7D%20%24%20%2C%20%24%20b_%7Bi%7D%20%24%20%2C%20%24%20c_%7Bi%7D%20%24%20%28%20%24%201%3C%3Da_%7Bi%7D%2Cb_%7Bi%7D%3C%3Dn%20%24%20%3B%20%24%20c_%7Bi%7D%20%24%20is%20either%20%27o%27%20or%20%27x%27%29.%20This%20line%20means%3A%20there%20is%20a%20character%20%24%20c_%7Bi%7D%20%24%20in%20the%20cell%20that%20is%20located%20on%20the%20intersection%20of%20the%20%24%20a_%7Bi%7D%20%24%20-th%20row%20and%20%24%20b_%7Bi%7D%20%24%20-th%20column.%20All%20the%20given%20cells%20are%20distinct.%5Cn%5CnConsider%20that%20the%20rows%20are%20numbered%20from%20%24%201%20%24%20to%20%24%20n%20%24%20from%20top%20to%20bottom.%20Analogically%2C%20the%20columns%20are%20numbered%20from%20%24%201%20%24%20to%20%24%20n%20%24%20from%20left%20to%20right.%22%2C%22outputFormat%22%3A%22Print%20a%20single%20integer%20%5Cu2014%20the%20answer%20to%20the%20problem.%22%2C%22samples%22%3A%5B%5B%223%202%5Cn1%201%20x%5Cn2%202%20o%5Cn%22%2C%222%5Cn%22%5D%2C%5B%224%203%5Cn2%204%20x%5Cn3%204%20x%5Cn3%202%20x%5Cn%22%2C%222%5Cn%22%5D%5D%2C%22hint%22%3A%22In%20the%20first%20example%20there%20are%20two%20ways%3A%5Cn%5Cn%60%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20xxo%20%20%20%20%20%20%20%20%20%20xoo%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20xox%20%20%20%20%20%20%20%20%20%20ooo%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20oxx%20%20%20%20%20%20%20%20%20%20oox%3Cbr%3E%3C%5C%2Fbr%3E%60%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B2000%5D%2C%22memory%22%3A%5B256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F461%5C%2FD%22%2C%22id%22%3A%22461D%22%7D%2C%22translation%22%3A%22%23%23%23%23%20%5Cu95ee%5Cu9898%5Cu63cf%5Cu8ff0%5Cuff1aAppleman%5Cu548cToastman%5Cu5728%5Cu73a9%5Cu6e38%5Cu620f%5Cu3002%5Cu9996%5Cu5148Appleman%5Cu544a%5Cu8bc9Toastman%5Cu4e24%5Cu4e2a%5Cu4ec5%5Cu5305%5Cu542b%5Cu201cA%5Cu201d%5Cu3001%5Cu201cB%5Cu201d%5Cu3001%5Cu201cC%5Cu201d%5Cu3001%5Cu201cD%5Cu201d%5Cu7684%5Cu4e24%5Cu4e2a%5Cu5b57%5Cu7b26%5Cu4e32s%5Cu548ct%5Cuff0c%5Cu8981%5Cu6c42Toastman%5Cu6784%5Cu9020s%5Cu3002%5Cu4e00%5Cu5f00%5Cu59cbToastman%5Cu6709%5Cu4e2a%5Cu7a7a%5Cu4e32%5Cuff0c%5Cu6bcf%5Cu6b21%5Cu4ed6%5Cu9009%5Cu53d6t%5Cu7684%5Cu4e00%5Cu4e2a%5Cu8fde%5Cu7eed%5Cu5b50%5Cu4e32%5Cu8fde%5Cu63a5%5Cu5728%5Cu4ed6%5Cu7684%5Cu4e32%5Cu540e%5Cu9762%5Cuff0c%5Cu76f4%5Cu5230%5Cu4ed6%5Cu5f97%5Cu5230s%5Cu4e3a%5Cu6b62%5Cu3002Appleman%5Cu5f53%5Cu7136%5Cu5e0c%5Cu671b%5Cu8fd9%5Cu4e2a%5Cu6784%5Cu9020%5Cu5c3d%5Cu91cf%5Cu96be%5Cuff0c%5Cu73b0%5Cu5728%5Cu4ed6%5Cu5df2%5Cu7ecf%5Cu60f3%5Cu597d%5Cu4e86t%5Cuff0c%5Cu4ed6%5Cu9700%5Cu8981%5Cu4e00%5Cu4e2a%5Cu957f%5Cu5ea6%5Cu4e3an%5Cu7684s%5Cu4f7f%5Cu5f97Toastman%5Cu9700%5Cu8981%5Cu8fde%5Cu63a5%5Cu5c3d%5Cu91cf%5Cu591a%5Cu6b21%5Cu3002%5Cu73b0%5Cu5728%5Cu4f60%5Cu9700%5Cu8981%5Cu544a%5Cu8bc9Appleman%5Cuff0c%5Cu901a%5Cu8fc7%5Cu786e%5Cu5b9a%5Cu4e00%5Cu4e2as%5Cuff0c%5Cu6700%5Cu591a%5Cu80fd%5Cu4f7fToastman%5Cu8fde%5Cu63a5%5Cu591a%5Cu5c11%5Cu6b21%5Cu3002%5Cu5047%5Cu8bbeToastman%5Cu4e00%5Cu76f4%5Cu91c7%5Cu7528%5Cu6700%5Cu4f18%5Cu7b56%5Cu7565%5Cu3002%5Cr%5Cn%5Cr%5Cn%23%23%23%23%20%5Cu8f93%5Cu5165%5Cuff1a%5Cu7b2c%5Cu4e00%5Cu884c%5Cu4e00%5Cu4e2a%5Cu6574%5Cu6570n%5Cu3002%5Cu7b2c%5Cu4e8c%5Cu884c%5Cu4e00%5Cu4e2a%5Cu5b57%5Cu7b26%5Cu4e32t%5Cu3002%5Cr%5Cn%5Cr%5Cn%23%23%23%23%20%5Cu8f93%5Cu51fa%5Cuff1a%5Cu4e00%5Cu4e2a%5Cu6574%5Cu6570%5Cuff1a%5Cu6700%5Cu591a%5Cu80fd%5Cu4f7fToastman%5Cu8fde%5Cu63a5%5Cu591a%5Cu5c11%5Cu6b21%5Cu3002%22%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Afalse%2C%22totalSubmit%22%3A4%2C%22totalAccepted%22%3A3%2C%22pid%22%3A%22CF461D%22%2C%22title%22%3A%22Appleman%20and%20Complicated%20Task%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Appleman%20and%20Complicated%20Task%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1573306449;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Appleman and Complicated Task</h1>
<h2>题意翻译</h2>
<div>#### 问题描述：Appleman和Toastman在玩游戏。首先Appleman告诉Toastman两个仅包含“A”、“B”、“C”、“D”的两个字符串s和t，要求Toastman构造s。一开始Toastman有个空串，每次他选取t的一个连续子串连接在他的串后面，直到他得到s为止。Appleman当然希望这个构造尽量难，现在他已经想好了t，他需要一个长度为n的s使得Toastman需要连接尽量多次。现在你需要告诉Appleman，通过确定一个s，最多能使Toastman连接多少次。假设Toastman一直采用最优策略。
#### 输入：第一行一个整数n。第二行一个字符串t。
#### 输出：一个整数：最多能使Toastman连接多少次。</div>
<h2>题目描述</h2>
<div>Toastman came up with a very complicated task. He gives it to Appleman, but Appleman doesn't know how to solve it. Can you help him?
Given a $ n×n $ checkerboard. Each cell of the board has either character 'x', or character 'o', or nothing. How many ways to fill all the empty cells with 'x' or 'o' (each cell must contain only one character in the end) are there, such that for each cell the number of adjacent cells with 'o' will be even? Find the number of ways modulo $ 1000000007 $ $ (10^{9}+7) $ . Two cells of the board are adjacent if they share a side.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line contains two integers $ n $ , $ k $ ( $ 1<=n,k<=10^{5} $ ) — the size of the board, and the number of cells that has characters initially.
Then $ k $ lines follows. The $ i $ -th line contains two integers and a character: $ a_{i} $ , $ b_{i} $ , $ c_{i} $ ( $ 1<=a_{i},b_{i}<=n $ ; $ c_{i} $ is either 'o' or 'x'). This line means: there is a character $ c_{i} $ in the cell that is located on the intersection of the $ a_{i} $ -th row and $ b_{i} $ -th column. All the given cells are distinct.
Consider that the rows are numbered from $ 1 $ to $ n $ from top to bottom. Analogically, the columns are numbered from $ 1 $ to $ n $ from left to right.</div>
<h3>输出格式</h3>
<br />
<div>Print a single integer — the answer to the problem.</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>3 2
1 1 x
2 2 o
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>2
</code></pre>
<h3>输入样例 #2</h3>
<pre><code>4 3
2 4 x
3 4 x
3 2 x
</code></pre>
<h3>输出样例 #2</h3>
<pre><code>2
</code></pre>
<h2>说明</h2>
<div>In the first example there are two ways:
`<br></br> xxo xoo<br></br> xox ooo<br></br> oxx oox<br></br>`</div>
</article>
</div>
</div>
</body>
</html>
