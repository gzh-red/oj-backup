<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Tree - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573401863:l7LpkVCfQbSTu/l+lBvoOw3Cgy3PQZcKvWaTQFG+cJE=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3A%22%22%2C%22description%22%3A%22You%20are%20given%20a%20tree%20with%20%24%20n%20%24%20nodes%20and%20%24%20q%20%24%20queries.%5Cn%5CnEvery%20query%20starts%20with%20three%20integers%20%24%20k%20%24%20%2C%20%24%20m%20%24%20and%20%24%20r%20%24%20%2C%20followed%20by%20%24%20k%20%24%20nodes%20of%20the%20tree%20%24%20a_1%2C%20a_2%2C%20%5C%5Cldots%2C%20a_k%20%24%20.%20To%20answer%20a%20query%2C%20assume%20that%20the%20tree%20is%20rooted%20at%20%24%20r%20%24%20.%20We%20want%20to%20divide%20the%20%24%20k%20%24%20given%20nodes%20into%20at%20most%20%24%20m%20%24%20groups%20such%20that%20the%20following%20conditions%20are%20met%3A%5Cn%5Cn-%20Each%20node%20should%20be%20in%20exactly%20one%20group%20and%20each%20group%20should%20have%20at%20least%20one%20node.%5Cn-%20In%20any%20group%2C%20there%20should%20be%20no%20two%20distinct%20nodes%20such%20that%20one%20node%20is%20an%20ancestor%20%28direct%20or%20indirect%29%20of%20the%20other.%5Cn%5CnYou%20need%20to%20output%20the%20number%20of%20ways%20modulo%20%24%2010%5E%7B9%7D%2B7%20%24%20for%20every%20query.%22%2C%22inputFormat%22%3A%22The%20first%20line%20contains%20two%20integers%20%24%20n%20%24%20and%20%24%20q%20%24%20%28%20%24%201%20%5C%5Cle%20n%2C%20q%20%5C%5Cle%2010%5E%7B5%7D%20%24%20%29%20%5Cu2014%20the%20number%20of%20vertices%20in%20the%20tree%20and%20the%20number%20of%20queries%2C%20respectively.%5Cn%5CnEach%20of%20the%20next%20%24%20n-1%20%24%20lines%20contains%20two%20integers%20%24%20u%20%24%20and%20%24%20v%20%24%20%28%20%24%201%20%5C%5Cle%20u%2C%20v%20%5C%5Cle%20n%2C%20u%20%5C%5Cne%20v%20%24%20%29%2C%20denoting%20an%20edge%20connecting%20vertex%20%24%20u%20%24%20and%20vertex%20%24%20v%20%24%20.%20It%20is%20guaranteed%20that%20the%20given%20graph%20is%20a%20tree.%5Cn%5CnEach%20of%20the%20next%20%24%20q%20%24%20lines%20starts%20with%20three%20integers%20%24%20k%20%24%20%2C%20%24%20m%20%24%20and%20%24%20r%20%24%20%28%20%24%201%20%5C%5Cle%20k%2C%20r%20%5C%5Cle%20n%20%24%20%2C%20%24%201%20%5C%5Cle%20m%20%5C%5Cle%20min%28300%2Ck%29%20%24%20%29%20%5Cu2014%20the%20number%20of%20nodes%2C%20the%20maximum%20number%20of%20groups%20and%20the%20root%20of%20the%20tree%20for%20the%20current%20query%2C%20respectively.%20They%20are%20followed%20by%20%24%20k%20%24%20distinct%20integers%20%24%20a_1%2C%20a_2%2C%20%5C%5Cldots%2C%20a_k%20%24%20%28%20%24%201%20%5C%5Cle%20a_i%20%5C%5Cle%20n%20%24%20%29%2C%20denoting%20the%20nodes%20of%20the%20current%20query.%5Cn%5CnIt%20is%20guaranteed%20that%20the%20sum%20of%20%24%20k%20%24%20over%20all%20queries%20does%20not%20exceed%20%24%2010%5E%7B5%7D%20%24%20.%22%2C%22outputFormat%22%3A%22Print%20%24%20q%20%24%20lines%2C%20where%20the%20%24%20i%20%24%20-th%20line%20contains%20the%20answer%20to%20the%20%24%20i%20%24%20-th%20query.%22%2C%22samples%22%3A%5B%5B%227%202%5Cn5%204%5Cn2%206%5Cn5%203%5Cn1%202%5Cn7%205%5Cn4%206%5Cn3%203%202%207%204%203%5Cn3%201%204%206%202%201%5Cn%22%2C%222%5Cn0%5Cn%22%5D%2C%5B%227%202%5Cn4%207%5Cn2%205%5Cn4%201%5Cn5%201%5Cn5%206%5Cn4%203%5Cn3%203%202%207%201%204%5Cn2%201%206%203%202%5Cn%22%2C%221%5Cn1%5Cn%22%5D%2C%5B%225%202%5Cn3%205%5Cn4%205%5Cn4%202%5Cn1%204%5Cn2%202%203%201%202%5Cn2%202%204%205%204%5Cn%22%2C%222%5Cn1%5Cn%22%5D%5D%2C%22hint%22%3A%22Consider%20the%20first%20example.%5Cn%5CnIn%20the%20first%20query%2C%20we%20have%20to%20divide%20the%20three%20given%20nodes%20%28%20%24%207%20%24%20%2C%20%24%204%20%24%20and%20%24%203%20%24%20%29%2C%20into%20the%20maximum%20of%20three%20groups%20assuming%20that%20the%20tree%20is%20rooted%20at%20%24%202%20%24%20.%20When%20the%20tree%20is%20rooted%20at%20%24%202%20%24%20%2C%20%24%204%20%24%20is%20an%20ancestor%20of%20both%20%24%203%20%24%20and%20%24%207%20%24%20.%20So%20we%20can%27t%20put%20all%20the%20nodes%20into%20one%20group.%20There%20is%20only%20%24%201%20%24%20way%20to%20divide%20the%20given%20nodes%20into%20two%20groups%2C%20which%20are%20%24%20%5B4%5D%20%24%20and%20%24%20%5B3%2C%207%5D%20%24%20.%20Also%2C%20there%20is%20only%20one%20way%20to%20divide%20the%20given%20nodes%20into%20three%20groups%2C%20which%20are%20%24%20%5B7%5D%20%24%20%2C%20%24%20%5B4%5D%20%24%20and%20%24%20%5B3%5D%20%24%20.%20So%2C%20there%20are%20total%20%24%202%20%24%20ways%20to%20divide%20the%20given%20nodes%20into%20a%20maximum%20of%20three%20groups.%5Cn%5CnIn%20the%20second%20query%2C%20when%20the%20tree%20is%20rooted%20at%20%24%204%20%24%20%2C%20%24%206%20%24%20is%20an%20ancestor%20of%20%24%202%20%24%20and%20%24%202%20%24%20is%20an%20ancestor%20of%20%24%201%20%24%20.%20So%2C%20we%20can%27t%20put%20all%20the%20given%20nodes%20into%20one%20group.%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B1500%5D%2C%22memory%22%3A%5B256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F1111%5C%2FE%22%2C%22id%22%3A%221111E%22%7D%2C%22translation%22%3A%22%5Cu7ed9%5Cu4e00%5Cu68f5%24n%24%5Cu4e2a%5Cu7ed3%5Cu70b9%5Cu7684%5Cu6811%5Cuff0c%24q%24%5Cu6b21%5Cu8be2%5Cu95ee%5Cuff0c%5Cu6bcf%5Cu6b21%5Cu8be2%5Cu95ee%5Cu9996%5Cu5148%5Cu662f%5Cu4e09%5Cu4e2a%5Cu6570%24k%2Cm%2Cr%24%5Cuff0c%5Cu63a5%5Cu4e0b%5Cu6765%5Cu8ddf%5Cu7740%24k%24%5Cu4e2a%5Cu7ed3%5Cu70b9%5Cu7f16%5Cu53f7%5Cuff0c%5Cu8bf7%5Cu4f60%5Cu5c06%5Cu8fd9%24k%24%5Cu4e2a%5Cu7ed3%5Cu70b9%5Cu5206%5Cu6210%5Cu4e0d%5Cu8d85%5Cu8fc7%24m%24%5Cu7ec4%5Cuff0c%5Cu4f7f%5Cu5f97%5Cu5728%5Cu4ee5%24r%24%5Cu4e3a%5Cu6839%5Cu7684%5Cu60c5%5Cu51b5%5Cu4e0b%5Cuff0c%5Cu7ec4%5Cu5185%5Cu7684%5Cu4efb%5Cu610f%5Cu4e24%5Cu4e2a%5Cu7ed3%5Cu70b9%5Cu4e0d%5Cu5b58%5Cu5728%5Cu7956%5Cu5148%5Cu5173%5Cu7cfb%5Cuff0c%5Cu6c42%5Cu65b9%5Cu6848%5Cu6570%5Cu5bf9%2410%5E9%2B7%24%5Cu53d6%5Cu6a21%5Cu3002%22%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Afalse%2C%22totalSubmit%22%3A185%2C%22totalAccepted%22%3A91%2C%22pid%22%3A%22CF1111E%22%2C%22title%22%3A%22Tree%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%7B%22id%22%3A121920%2C%22title%22%3A%22%5Cu4e3a%5Cu5565%5Cu8fd9%5Cu4e2a%5Cu9898%5Cu8f6c%5Cu79fb%5Cu7684%5Cu65f6%5Cu5019%5Cu4e0d%5Cu5224%5Cu65ad%5Cu96c6%5Cu5408%5Cu6570%5Cu91cf%5Cu662f%5Cu5426%5Cu591f%5Cu4e5f%5Cu884c%5Cu3002%5Cu3002%22%2C%22forum%22%3A%7B%22id%22%3A34131%2C%22name%22%3A%22CF1111E%20Tree%22%2C%22slug%22%3A%22CF1111E%22%7D%7D%2C%7B%22id%22%3A101777%2C%22title%22%3A%22%5Cu611f%5Cu89c9%5Cu6709%5Cu4e00%5Cu6bb5%5Cu65f6%5Cu95f4%5Cu6ca1%5Cu6709%5Cu66f4%5Cu65b0CF%5Cu9898%5Cu5e93%5Cu4e86%22%2C%22forum%22%3A%7B%22id%22%3A34131%2C%22name%22%3A%22CF1111E%20Tree%22%2C%22slug%22%3A%22CF1111E%22%7D%7D%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%7B%22pid%22%3A%22P3649%22%2C%22title%22%3A%22%5BAPIO2014%5D%5Cu56de%5Cu6587%5Cu4e32%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22P%22%7D%2C%7B%22pid%22%3A%22P3175%22%2C%22title%22%3A%22%5BHAOI2015%5D%5Cu6309%5Cu4f4d%5Cu6216%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22P%22%7D%2C%7B%22pid%22%3A%22CF528D%22%2C%22title%22%3A%22Fuzzy%20Search%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22CF%22%7D%2C%7B%22pid%22%3A%22CF1111D%22%2C%22title%22%3A%22Destroy%20the%20Colony%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22CF%22%7D%2C%7B%22pid%22%3A%22CF1110F%22%2C%22title%22%3A%22Nearest%20Leaf%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22CF%22%7D%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Tree%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1572920822;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Tree</h1>
<h2>题意翻译</h2>
<div>给一棵$n$个结点的树，$q$次询问，每次询问首先是三个数$k,m,r$，接下来跟着$k$个结点编号，请你将这$k$个结点分成不超过$m$组，使得在以$r$为根的情况下，组内的任意两个结点不存在祖先关系，求方案数对$10^9+7$取模。</div>
<h2>题目描述</h2>
<div>You are given a tree with $ n $ nodes and $ q $ queries.
Every query starts with three integers $ k $ , $ m $ and $ r $ , followed by $ k $ nodes of the tree $ a_1, a_2, \ldots, a_k $ . To answer a query, assume that the tree is rooted at $ r $ . We want to divide the $ k $ given nodes into at most $ m $ groups such that the following conditions are met:
- Each node should be in exactly one group and each group should have at least one node.
- In any group, there should be no two distinct nodes such that one node is an ancestor (direct or indirect) of the other.
You need to output the number of ways modulo $ 10^{9}+7 $ for every query.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line contains two integers $ n $ and $ q $ ( $ 1 \le n, q \le 10^{5} $ ) — the number of vertices in the tree and the number of queries, respectively.
Each of the next $ n-1 $ lines contains two integers $ u $ and $ v $ ( $ 1 \le u, v \le n, u \ne v $ ), denoting an edge connecting vertex $ u $ and vertex $ v $ . It is guaranteed that the given graph is a tree.
Each of the next $ q $ lines starts with three integers $ k $ , $ m $ and $ r $ ( $ 1 \le k, r \le n $ , $ 1 \le m \le min(300,k) $ ) — the number of nodes, the maximum number of groups and the root of the tree for the current query, respectively. They are followed by $ k $ distinct integers $ a_1, a_2, \ldots, a_k $ ( $ 1 \le a_i \le n $ ), denoting the nodes of the current query.
It is guaranteed that the sum of $ k $ over all queries does not exceed $ 10^{5} $ .</div>
<h3>输出格式</h3>
<br />
<div>Print $ q $ lines, where the $ i $ -th line contains the answer to the $ i $ -th query.</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>7 2
5 4
2 6
5 3
1 2
7 5
4 6
3 3 2 7 4 3
3 1 4 6 2 1
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>2
0
</code></pre>
<h3>输入样例 #2</h3>
<pre><code>7 2
4 7
2 5
4 1
5 1
5 6
4 3
3 3 2 7 1 4
2 1 6 3 2
</code></pre>
<h3>输出样例 #2</h3>
<pre><code>1
1
</code></pre>
<h3>输入样例 #3</h3>
<pre><code>5 2
3 5
4 5
4 2
1 4
2 2 3 1 2
2 2 4 5 4
</code></pre>
<h3>输出样例 #3</h3>
<pre><code>2
1
</code></pre>
<h2>说明</h2>
<div>Consider the first example.
In the first query, we have to divide the three given nodes ( $ 7 $ , $ 4 $ and $ 3 $ ), into the maximum of three groups assuming that the tree is rooted at $ 2 $ . When the tree is rooted at $ 2 $ , $ 4 $ is an ancestor of both $ 3 $ and $ 7 $ . So we can't put all the nodes into one group. There is only $ 1 $ way to divide the given nodes into two groups, which are $ [4] $ and $ [3, 7] $ . Also, there is only one way to divide the given nodes into three groups, which are $ [7] $ , $ [4] $ and $ [3] $ . So, there are total $ 2 $ ways to divide the given nodes into a maximum of three groups.
In the second query, when the tree is rooted at $ 4 $ , $ 6 $ is an ancestor of $ 2 $ and $ 2 $ is an ancestor of $ 1 $ . So, we can't put all the given nodes into one group.</div>
</article>
</div>
</div>
</body>
</html>
