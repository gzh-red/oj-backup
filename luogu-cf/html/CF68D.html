<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Half-decay tree - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573390512:3mwN4GImFqqO5dI3q+eSF7dAc+Igafu5bHpUEZHghSQ=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22Recently%20Petya%20has%20become%20keen%20on%20physics.%20Anna%20V.%2C%20his%20teacher%20noticed%20Petya%27s%20interest%20and%20gave%20him%20a%20fascinating%20physical%20puzzle%20%5Cu2014%20a%20half-decay%20tree.%5Cn%5CnA%20half-decay%20tree%20is%20a%20complete%20binary%20tree%20with%20the%20height%20%24%20h%20%24%20.%20The%20height%20of%20a%20tree%20is%20the%20length%20of%20the%20path%20%28in%20edges%29%20from%20the%20root%20to%20a%20leaf%20in%20the%20tree.%20While%20studying%20the%20tree%20Petya%20can%20add%20electrons%20to%20vertices%20or%20induce%20random%20decay%20with%20synchrophasotron.%20Random%20decay%20is%20a%20process%20during%20which%20the%20edges%20of%20some%20path%20from%20the%20root%20to%20the%20random%20leaf%20of%20the%20tree%20are%20deleted.%20All%20the%20leaves%20are%20equiprobable.%20As%20the%20half-decay%20tree%20is%20the%20school%20property%2C%20Petya%20will%20return%20back%20the%20deleted%20edges%20into%20the%20tree%20after%20each%20decay.%5Cn%5CnAfter%20being%20desintegrated%2C%20the%20tree%20decomposes%20into%20connected%20components.%20Charge%20of%20each%20component%20is%20the%20total%20quantity%20of%20electrons%20placed%20in%20vertices%20of%20the%20component.%20Potential%20of%20desintegerated%20tree%20is%20the%20maximum%20from%20the%20charges%20of%20its%20connected%20components.%20Each%20time%20before%20inducing%20random%20decay%20Petya%20is%20curious%20about%20the%20mathematical%20expectation%20of%20potential%20of%20the%20tree%20after%20being%20desintegrated.%22%2C%22inputFormat%22%3A%22First%20line%20will%20contain%20two%20integers%20%24%20h%20%24%20and%20%24%20q%20%24%20%28%20%24%201%3C%3Dh%3C%3D30%2C1%3C%3Dq%3C%3D10%5E%7B5%7D%20%24%20%29.%20Next%20%24%20q%20%24%20lines%20will%20contain%20a%20query%20of%20one%20of%20two%20types%3A%5Cn%5Cn-%20add%20%24%20v%20%24%20%24%20e%20%24%20Petya%20adds%20%24%20e%20%24%20electrons%20to%20vertex%20number%20%24%20v%20%24%20%28%20%24%201%3C%3Dv%3C%3D2%5E%7Bh%2B1%7D-1%2C0%3C%3De%3C%3D10%5E%7B4%7D%20%24%20%29.%20%24%20v%20%24%20and%20%24%20e%20%24%20are%20integers.%5Cn%20%20%5Cn%20%20The%20vertices%20of%20the%20tree%20are%20numbered%20in%20the%20following%20way%3A%20the%20root%20is%20numbered%20with%201%2C%20the%20children%20of%20the%20vertex%20with%20number%20%24%20x%20%24%20are%20numbered%20with%20%24%202x%20%24%20and%20%24%202x%2B1%20%24%20.%5Cn-%20decayPetya%20induces%20tree%20decay.%22%2C%22outputFormat%22%3A%22For%20each%20query%20decay%20solution%20you%20should%20output%20the%20mathematical%20expectation%20of%20potential%20of%20the%20tree%20after%20being%20desintegrated.%20The%20absolute%20or%20relative%20error%20in%20the%20answer%20should%20not%20exceed%20%24%2010%5E%7B-4%7D%20%24%20.%22%2C%22samples%22%3A%5B%5B%221%204%5Cnadd%201%203%5Cnadd%202%2010%5Cnadd%203%2011%5Cndecay%5Cn%22%2C%2213.50000000%5Cn%22%5D%5D%2C%22hint%22%3A%22%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B3000%5D%2C%22memory%22%3A%5B256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F68%5C%2FD%22%2C%22id%22%3A%2268D%22%7D%2C%22translation%22%3A%22%23%23%20%5Cu9898%5Cu610f%5Cr%5Cn%5Cr%5Cn%5Cu5b9a%5Cu4e49%5Cu4e00%5Cu4e2a%5Cu5b8c%5Cu5168%5Cu4e8c%5Cu53c9%5Cu6811%5Cu6811%5Cu9ad8%5Cu4e3a%5Cu6839%5Cu8282%5Cu70b9%5Cu5230%5Cu53f6%5Cu5b50%5Cu8282%5Cu70b9%5Cu7ecf%5Cu8fc7%5Cu7684%5Cu8fb9%5Cu6570%5Cu3002%5Cr%5Cn%5Cr%5Cn%5Cu7ed9%5Cu5b9a%5Cu4e00%5Cu4e2a%5Cu6811%5Cu9ad8%5Cu4e3a%20%24h%281%20%5C%5Cle%20h%20%5C%5Cle%2030%29%24%20%5Cu7684%5Cu5b8c%5Cu5168%5Cu4e8c%5Cu53c9%5Cu6811%5Cuff0c%5Cu5176%5Cu4e2d%5Cu7b2c%20%24x%24%20%5Cu4e2a%5Cu8282%5Cu70b9%5Cu7684%5Cu5de6%5Cu513f%5Cu5b50%5Cu4e3a%5Cu7b2c%20%242x%24%20%5Cu4e2a%5Cu8282%5Cu70b9%5Cuff0c%5Cu53f3%5Cu513f%5Cu5b50%5Cu4e3a%5Cu7b2c%20%242x%2B1%24%20%5Cu4e2a%5Cu8282%5Cu70b9%5Cu3002%5Cr%5Cn%5Cr%5Cn%5Cu73b0%5Cu5728%5Cu6709%20%24q%281%20%5C%5Cle%20q%20%5C%5Cle%2010%5E%7B5%7D%29%24%20%5Cu4e2a%5Cuff0c%5Cu5206%5Cu4e3a%5Cu4e24%5Cu79cd%5Cu64cd%5Cu4f5c%5Cuff1a%5Cr%5Cn%5Cr%5Cn1.%20%60add%20v%20e%60%20%5Cuff08%20%241%20%5C%5Cle%20v%20%5C%5Cle%202%5E%7Bh%2B1%7D-1%2C1%20%5C%5Cle%20e%20%5C%5Cle%2010%5E4%24%20%5Cuff09%5Cu8868%5Cu793a%5Cu7ed9%5Cu7b2c%20%24v%24%20%5Cu4e2a%5Cu8282%5Cu70b9%5Cu7684%5Cu6743%5Cu503c%5Cu52a0%20%24e%24%20%5Cr%5Cn2.%20%60decay%60%20%5Cu64cd%5Cu4f5c%5Cu3002%5Cu6211%5Cu4eec%5Cu5728%5Cu8fd9%5Cu4e2a%5Cu4e8c%5Cu53c9%5Cu6811%5Cu91cc%5Cu9762%5Cu4ee5%5Cu7b49%5Cu6982%5Cu7387%5Cu9009%5Cu62e9%5Cu4e00%5Cu4e2a%5Cu53f6%5Cu5b50%5Cu8282%5Cu70b9%5Cuff0c%5Cu5c06%5Cu8fd9%5Cu4e2a%5Cu53f6%5Cu5b50%5Cu8282%5Cu70b9%5Cu5230%5Cu6839%5Cu7684%5Cu8def%5Cu5f84%5Cu4e0a%5Cu6240%5Cu6709%5Cu7684%5Cu8fb9%5Cu90fd%5Cu5220%5Cu53bb%5Cu3002%5Cu5728%5Cu5220%5Cu9664%5Cu540e%5Cuff0c%5Cu6811%5Cu4f1a%5Cu5f62%5Cu6210%5Cu82e5%5Cu5e72%5Cu4e2a%5Cu8054%5Cu901a%5Cu5757%5Cuff0c%5Cu6211%5Cu4eec%5Cu5b9a%5Cu4e49%5Cu67d0%5Cu4e2a%5Cu8054%5Cu901a%5Cu5757%5Cu7684%5Cu7684%5Cu6743%5Cu503c%5Cu4e3a%5Cu8fd9%5Cu4e2a%5Cu8054%5Cu901a%5Cu5757%5Cu5185%5Cu6240%5Cu6709%5Cu8282%5Cu70b9%5Cu7684%5Cu6743%5Cu503c%5Cu4e4b%5Cu548c%5Cu3002%5Cu6211%5Cu4eec%5Cu5b9a%5Cu4e49%5Cu5220%5Cu9664%5Cu540e%5Cu7684%5Cu6811%5Cu7684%5Cu6743%5Cu503c%5Cu4e3a%5Cu5f62%5Cu6210%5Cu7684%5Cu6240%5Cu6709%5Cu8054%5Cu901a%5Cu5757%5Cu7684%5Cu6743%5Cu503c%5Cu7684%5Cu6700%5Cu5927%5Cu503c%5Cu3002%5Cu8bf7%5Cu4f60%5Cu6c42%5Cu51fa%5Cu6811%5Cu7684%5Cu6743%5Cu503c%5Cu7684%5Cu671f%5Cu671b%5Cu3002%2A%2A%5Cu6bcf%5Cu6b21%5Cu5220%5Cu9664%5Cu540e%5Cu4f1a%5Cu6062%5Cu590d%5Cu6240%5Cu6709%5Cu5220%5Cu9664%5Cu7684%5Cu8fb9%5Cu3002%2A%2A%22%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Afalse%2C%22totalSubmit%22%3A18%2C%22totalAccepted%22%3A12%2C%22pid%22%3A%22CF68D%22%2C%22title%22%3A%22Half-decay%20tree%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Half-decay%20tree%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1572920822;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Half-decay tree</h1>
<h2>题意翻译</h2>
<div>## 题意
定义一个完全二叉树树高为根节点到叶子节点经过的边数。
给定一个树高为 $h(1 \le h \le 30)$ 的完全二叉树，其中第 $x$ 个节点的左儿子为第 $2x$ 个节点，右儿子为第 $2x+1$ 个节点。
现在有 $q(1 \le q \le 10^{5})$ 个，分为两种操作：
1. `add v e` （ $1 \le v \le 2^{h+1}-1,1 \le e \le 10^4$ ）表示给第 $v$ 个节点的权值加 $e$
2. `decay` 操作。我们在这个二叉树里面以等概率选择一个叶子节点，将这个叶子节点到根的路径上所有的边都删去。在删除后，树会形成若干个联通块，我们定义某个联通块的的权值为这个联通块内所有节点的权值之和。我们定义删除后的树的权值为形成的所有联通块的权值的最大值。请你求出树的权值的期望。**每次删除后会恢复所有删除的边。**</div>
<h2>题目描述</h2>
<div>Recently Petya has become keen on physics. Anna V., his teacher noticed Petya's interest and gave him a fascinating physical puzzle — a half-decay tree.
A half-decay tree is a complete binary tree with the height $ h $ . The height of a tree is the length of the path (in edges) from the root to a leaf in the tree. While studying the tree Petya can add electrons to vertices or induce random decay with synchrophasotron. Random decay is a process during which the edges of some path from the root to the random leaf of the tree are deleted. All the leaves are equiprobable. As the half-decay tree is the school property, Petya will return back the deleted edges into the tree after each decay.
After being desintegrated, the tree decomposes into connected components. Charge of each component is the total quantity of electrons placed in vertices of the component. Potential of desintegerated tree is the maximum from the charges of its connected components. Each time before inducing random decay Petya is curious about the mathematical expectation of potential of the tree after being desintegrated.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>First line will contain two integers $ h $ and $ q $ ( $ 1<=h<=30,1<=q<=10^{5} $ ). Next $ q $ lines will contain a query of one of two types:
- add $ v $ $ e $ Petya adds $ e $ electrons to vertex number $ v $ ( $ 1<=v<=2^{h+1}-1,0<=e<=10^{4} $ ). $ v $ and $ e $ are integers.
The vertices of the tree are numbered in the following way: the root is numbered with 1, the children of the vertex with number $ x $ are numbered with $ 2x $ and $ 2x+1 $ .
- decayPetya induces tree decay.</div>
<h3>输出格式</h3>
<br />
<div>For each query decay solution you should output the mathematical expectation of potential of the tree after being desintegrated. The absolute or relative error in the answer should not exceed $ 10^{-4} $ .</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>1 4
add 1 3
add 2 10
add 3 11
decay
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>13.50000000
</code></pre>
</article>
</div>
</div>
</body>
</html>
