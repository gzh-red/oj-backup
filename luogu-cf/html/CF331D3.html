<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Escaping on Beaveractor - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573392851:k3Mb4hHvYx0qcyoohUFBY2pBkyUqedEnA6UDeJ4hr58=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22Don%27t%20put%20up%20with%20what%20you%27re%20sick%20of%21%20The%20Smart%20Beaver%20decided%20to%20escape%20from%20the%20campus%20of%20Beaver%20Science%20Academy%20%28BSA%29.%20BSA%20is%20a%20%24%20b%5Cu00d7b%20%24%20square%20on%20a%20plane.%20Each%20point%20%24%20x%2Cy%20%24%20%24%20%280%3C%3Dx%2Cy%3C%3Db%29%20%24%20belongs%20to%20BSA.%20To%20make%20the%20path%20quick%20and%20funny%2C%20the%20Beaver%20constructed%20a%20Beaveractor%2C%20an%20effective%20and%20comfortable%20types%20of%20transport.%5Cn%5CnThe%20campus%20obeys%20traffic%20rules%3A%20there%20are%20%24%20n%20%24%20arrows%2C%20parallel%20to%20the%20coordinate%20axes.%20The%20arrows%20do%20not%20intersect%20and%20do%20not%20touch%20each%20other.%20When%20the%20Beaveractor%20reaches%20some%20arrow%2C%20it%20turns%20in%20the%20arrow%27s%20direction%20and%20moves%20on%20until%20it%20either%20reaches%20the%20next%20arrow%20or%20gets%20outside%20the%20campus.%20The%20Beaveractor%20covers%20exactly%20one%20unit%20of%20space%20per%20one%20unit%20of%20time.%20You%20can%20assume%20that%20there%20are%20no%20obstacles%20to%20the%20Beaveractor.%5Cn%5CnThe%20BSA%20scientists%20want%20to%20transport%20the%20brand%20new%20Beaveractor%20to%20the%20%5C%22Academic%20Tractor%5C%22%20research%20institute%20and%20send%20the%20Smart%20Beaver%20to%20do%20his%20postgraduate%20studies%20and%20sharpen%20pencils.%20They%20have%20%24%20q%20%24%20plans%2C%20representing%20the%20Beaveractor%27s%20initial%20position%20%24%20%28x_%7Bi%7D%2Cy_%7Bi%7D%29%20%24%20%2C%20the%20initial%20motion%20vector%20%24%20w_%7Bi%7D%20%24%20and%20the%20time%20%24%20t_%7Bi%7D%20%24%20that%20have%20passed%20after%20the%20escape%20started.%5Cn%5CnYour%20task%20is%20for%20each%20of%20the%20%24%20q%20%24%20plans%20to%20determine%20the%20Smart%20Beaver%27s%20position%20after%20the%20given%20time.%22%2C%22inputFormat%22%3A%22The%20first%20line%20contains%20two%20integers%3A%20the%20number%20of%20traffic%20rules%20%24%20n%20%24%20and%20the%20size%20of%20the%20campus%20%24%20b%20%24%20%2C%20%24%200%3C%3Dn%20%24%20%2C%20%24%201%3C%3Db%20%24%20.%20Next%20%24%20n%20%24%20lines%20contain%20the%20rules.%20Each%20line%20of%20the%20rules%20contains%20four%20space-separated%20integers%20%24%20x_%7B0%7D%20%24%20%2C%20%24%20y_%7B0%7D%20%24%20%2C%20%24%20x_%7B1%7D%20%24%20%2C%20%24%20y_%7B1%7D%20%24%20%5Cu2014%20the%20beginning%20and%20the%20end%20of%20the%20arrow.%20It%20is%20guaranteed%20that%20all%20arrows%20are%20parallel%20to%20the%20coordinate%20axes%20and%20have%20no%20common%20points.%20All%20arrows%20are%20located%20inside%20the%20campus%2C%20that%20is%2C%20%24%200%3C%3Dx_%7B0%7D%2Cy_%7B0%7D%2Cx_%7B1%7D%2Cy_%7B1%7D%3C%3Db%20%24%20holds.%5Cn%5CnNext%20line%20contains%20integer%20%24%20q%20%24%20%5Cu2014%20the%20number%20of%20plans%20the%20scientists%20have%2C%20%24%201%3C%3Dq%3C%3D10%5E%7B5%7D%20%24%20.%20The%20%24%20i%20%24%20-th%20plan%20is%20represented%20by%20two%20integers%2C%20%24%20x_%7Bi%7D%20%24%20%2C%20%24%20y_%7Bi%7D%20%24%20are%20the%20Beaveractor%27s%20coordinates%20at%20the%20initial%20time%2C%20%24%200%3C%3Dx_%7Bi%7D%2Cy_%7Bi%7D%3C%3Db%20%24%20%2C%20character%20%24%20w_%7Bi%7D%20%24%20%2C%20that%20takes%20value%20U%2C%20D%2C%20L%2C%20R%20and%20sets%20the%20initial%20direction%20up%2C%20down%2C%20to%20the%20left%20or%20to%20the%20right%20correspondingly%20%28the%20Y%20axis%20is%20directed%20upwards%29%2C%20and%20%24%20t_%7Bi%7D%20%24%20%5Cu2014%20the%20time%20passed%20after%20the%20escape%20started%2C%20%24%200%3C%3Dt_%7Bi%7D%3C%3D10%5E%7B15%7D%20%24%20.%5Cn%5Cn-%20to%20get%2030%20points%20you%20need%20to%20solve%20the%20problem%20with%20constraints%20%24%20n%2Cb%3C%3D30%20%24%20%28subproblem%20D1%29%3B%5Cn-%20to%20get%2060%20points%20you%20need%20to%20solve%20the%20problem%20with%20constraints%20%24%20n%2Cb%3C%3D1000%20%24%20%28subproblems%20D1%2BD2%29%3B%5Cn-%20to%20get%20100%20points%20you%20need%20to%20solve%20the%20problem%20with%20constraints%20%24%20n%2Cb%3C%3D10%5E%7B5%7D%20%24%20%28subproblems%20D1%2BD2%2BD3%29.%22%2C%22outputFormat%22%3A%22Print%20%24%20q%20%24%20lines.%20Each%20line%20should%20contain%20two%20integers%20%5Cu2014%20the%20Beaveractor%27s%20coordinates%20at%20the%20final%20moment%20of%20time%20for%20each%20plan.%20If%20the%20Smart%20Beaver%20manages%20to%20leave%20the%20campus%20in%20time%20%24%20t_%7Bi%7D%20%24%20%2C%20print%20the%20coordinates%20of%20the%20last%20point%20in%20the%20campus%20he%20visited.%22%2C%22samples%22%3A%5B%5B%223%203%5Cn0%200%200%201%5Cn0%202%202%202%5Cn3%203%202%203%5Cn12%5Cn0%200%20L%200%5Cn0%200%20L%201%5Cn0%200%20L%202%5Cn0%200%20L%203%5Cn0%200%20L%204%5Cn0%200%20L%205%5Cn0%200%20L%206%5Cn2%200%20U%202%5Cn2%200%20U%203%5Cn3%200%20U%205%5Cn1%203%20D%202%5Cn1%203%20R%202%5Cn%22%2C%220%200%5Cn0%201%5Cn0%202%5Cn1%202%5Cn2%202%5Cn3%202%5Cn3%202%5Cn2%202%5Cn3%202%5Cn1%203%5Cn2%202%5Cn1%203%5Cn%22%5D%5D%2C%22hint%22%3A%22%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B6000%5D%2C%22memory%22%3A%5B512000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F331%5C%2FD3%22%2C%22id%22%3A%22331D3%22%7D%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Atrue%2C%22totalSubmit%22%3A0%2C%22totalAccepted%22%3A0%2C%22pid%22%3A%22CF331D3%22%2C%22title%22%3A%22Escaping%20on%20Beaveractor%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Escaping%20on%20Beaveractor%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1573295103;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Escaping on Beaveractor</h1>
<h2>题目描述</h2>
<div>Don't put up with what you're sick of! The Smart Beaver decided to escape from the campus of Beaver Science Academy (BSA). BSA is a $ b×b $ square on a plane. Each point $ x,y $ $ (0<=x,y<=b) $ belongs to BSA. To make the path quick and funny, the Beaver constructed a Beaveractor, an effective and comfortable types of transport.
The campus obeys traffic rules: there are $ n $ arrows, parallel to the coordinate axes. The arrows do not intersect and do not touch each other. When the Beaveractor reaches some arrow, it turns in the arrow's direction and moves on until it either reaches the next arrow or gets outside the campus. The Beaveractor covers exactly one unit of space per one unit of time. You can assume that there are no obstacles to the Beaveractor.
The BSA scientists want to transport the brand new Beaveractor to the "Academic Tractor" research institute and send the Smart Beaver to do his postgraduate studies and sharpen pencils. They have $ q $ plans, representing the Beaveractor's initial position $ (x_{i},y_{i}) $ , the initial motion vector $ w_{i} $ and the time $ t_{i} $ that have passed after the escape started.
Your task is for each of the $ q $ plans to determine the Smart Beaver's position after the given time.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line contains two integers: the number of traffic rules $ n $ and the size of the campus $ b $ , $ 0<=n $ , $ 1<=b $ . Next $ n $ lines contain the rules. Each line of the rules contains four space-separated integers $ x_{0} $ , $ y_{0} $ , $ x_{1} $ , $ y_{1} $ — the beginning and the end of the arrow. It is guaranteed that all arrows are parallel to the coordinate axes and have no common points. All arrows are located inside the campus, that is, $ 0<=x_{0},y_{0},x_{1},y_{1}<=b $ holds.
Next line contains integer $ q $ — the number of plans the scientists have, $ 1<=q<=10^{5} $ . The $ i $ -th plan is represented by two integers, $ x_{i} $ , $ y_{i} $ are the Beaveractor's coordinates at the initial time, $ 0<=x_{i},y_{i}<=b $ , character $ w_{i} $ , that takes value U, D, L, R and sets the initial direction up, down, to the left or to the right correspondingly (the Y axis is directed upwards), and $ t_{i} $ — the time passed after the escape started, $ 0<=t_{i}<=10^{15} $ .
- to get 30 points you need to solve the problem with constraints $ n,b<=30 $ (subproblem D1);
- to get 60 points you need to solve the problem with constraints $ n,b<=1000 $ (subproblems D1+D2);
- to get 100 points you need to solve the problem with constraints $ n,b<=10^{5} $ (subproblems D1+D2+D3).</div>
<h3>输出格式</h3>
<br />
<div>Print $ q $ lines. Each line should contain two integers — the Beaveractor's coordinates at the final moment of time for each plan. If the Smart Beaver manages to leave the campus in time $ t_{i} $ , print the coordinates of the last point in the campus he visited.</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>3 3
0 0 0 1
0 2 2 2
3 3 2 3
12
0 0 L 0
0 0 L 1
0 0 L 2
0 0 L 3
0 0 L 4
0 0 L 5
0 0 L 6
2 0 U 2
2 0 U 3
3 0 U 5
1 3 D 2
1 3 R 2
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>0 0
0 1
0 2
1 2
2 2
3 2
3 2
2 2
3 2
1 3
2 2
1 3
</code></pre>
</article>
</div>
</div>
</body>
</html>
