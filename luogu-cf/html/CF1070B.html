<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Berkomnadzor - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573401216:6N35LJ/3FdXbJZZnA91rb20sjoip0JXfOwG0bYPegq4=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22Berkomnadzor%20%5Cu2014%20Federal%20Service%20for%20Supervision%20of%20Communications%2C%20Information%20Technology%20and%20Mass%20Media%20%5Cu2014%20is%20a%20Berland%20federal%20executive%20body%20that%20protects%20ordinary%20residents%20of%20Berland%20from%20the%20threats%20of%20modern%20internet.%5Cn%5CnBerkomnadzor%20maintains%20a%20list%20of%20prohibited%20IPv4%20subnets%20%28blacklist%29%20and%20a%20list%20of%20allowed%20IPv4%20subnets%20%28whitelist%29.%20All%20Internet%20Service%20Providers%20%28ISPs%29%20in%20Berland%20must%20configure%20the%20network%20equipment%20to%20block%20access%20to%20all%20IPv4%20addresses%20matching%20the%20blacklist.%20Also%20ISPs%20must%20provide%20access%20%28that%20is%2C%20do%20not%20block%29%20to%20all%20IPv4%20addresses%20matching%20the%20whitelist.%20If%20an%20IPv4%20address%20does%20not%20match%20either%20of%20those%20lists%2C%20it%27s%20up%20to%20the%20ISP%20to%20decide%20whether%20to%20block%20it%20or%20not.%20An%20IPv4%20address%20matches%20the%20blacklist%20%28whitelist%29%20if%20and%20only%20if%20it%20matches%20some%20subnet%20from%20the%20blacklist%20%28whitelist%29.%20An%20IPv4%20address%20can%20belong%20to%20a%20whitelist%20and%20to%20a%20blacklist%20at%20the%20same%20time%2C%20this%20situation%20leads%20to%20a%20contradiction%20%28see%20no%20solution%20case%20in%20the%20output%20description%29.%5Cn%5CnAn%20IPv4%20address%20is%20a%2032-bit%20unsigned%20integer%20written%20in%20the%20form%20%24%20a.b.c.d%20%24%20%2C%20where%20each%20of%20the%20values%20%24%20a%2Cb%2Cc%2Cd%20%24%20is%20called%20an%20octet%20and%20is%20an%20integer%20from%20%24%200%20%24%20to%20%24%20255%20%24%20written%20in%20decimal%20notation.%20For%20example%2C%20IPv4%20address%20%24%20192.168.0.1%20%24%20can%20be%20converted%20to%20a%2032-bit%20number%20using%20the%20following%20expression%20%24%20192%20%5C%5Ccdot%202%5E%7B24%7D%20%2B%20168%20%5C%5Ccdot%202%5E%7B16%7D%20%2B%200%20%5C%5Ccdot%202%5E8%20%2B%201%20%5C%5Ccdot%202%5E0%20%24%20.%20First%20octet%20%24%20a%20%24%20encodes%20the%20most%20significant%20%28leftmost%29%20%24%208%20%24%20bits%2C%20the%20octets%20%24%20b%20%24%20and%20%24%20c%20%24%20%5Cu2014%20the%20following%20blocks%20of%20%24%208%20%24%20bits%20%28in%20this%20order%29%2C%20and%20the%20octet%20%24%20d%20%24%20encodes%20the%20least%20significant%20%28rightmost%29%20%24%208%20%24%20bits.%5Cn%5CnThe%20IPv4%20network%20in%20Berland%20is%20slightly%20different%20from%20the%20rest%20of%20the%20world.%20There%20are%20no%20reserved%20or%20internal%20addresses%20in%20Berland%20and%20use%20all%20%24%202%5E%7B32%7D%20%24%20possible%20values.%5Cn%5CnAn%20IPv4%20subnet%20is%20represented%20either%20as%20%24%20a.b.c.d%20%24%20or%20as%20%24%20a.b.c.d%5C%2Fx%20%24%20%28where%20%24%200%20%5C%5Cle%20x%20%5C%5Cle%2032%20%24%20%29.%20A%20subnet%20%24%20a.b.c.d%20%24%20contains%20a%20single%20address%20%24%20a.b.c.d%20%24%20.%20A%20subnet%20%24%20a.b.c.d%5C%2Fx%20%24%20contains%20all%20IPv4%20addresses%20with%20%24%20x%20%24%20leftmost%20%28most%20significant%29%20bits%20equal%20to%20%24%20x%20%24%20leftmost%20bits%20of%20the%20address%20%24%20a.b.c.d%20%24%20.%20It%20is%20required%20that%20%24%2032%20-%20x%20%24%20rightmost%20%28least%20significant%29%20bits%20of%20subnet%20%24%20a.b.c.d%5C%2Fx%20%24%20are%20zeroes.%5Cn%5CnNaturally%20it%20happens%20that%20all%20addresses%20matching%20subnet%20%24%20a.b.c.d%5C%2Fx%20%24%20form%20a%20continuous%20range.%20The%20range%20starts%20with%20address%20%24%20a.b.c.d%20%24%20%28its%20rightmost%20%24%2032%20-%20x%20%24%20bits%20are%20zeroes%29.%20The%20range%20ends%20with%20address%20which%20%24%20x%20%24%20leftmost%20bits%20equal%20to%20%24%20x%20%24%20leftmost%20bits%20of%20address%20%24%20a.b.c.d%20%24%20%2C%20and%20its%20%24%2032%20-%20x%20%24%20rightmost%20bits%20are%20all%20ones.%20Subnet%20contains%20exactly%20%24%202%5E%7B32-x%7D%20%24%20addresses.%20Subnet%20%24%20a.b.c.d%5C%2F32%20%24%20contains%20exactly%20one%20address%20and%20can%20also%20be%20represented%20by%20just%20%24%20a.b.c.d%20%24%20.%5Cn%5CnFor%20example%20subnet%20%24%20192.168.0.0%5C%2F24%20%24%20contains%20range%20of%20256%20addresses.%20%24%20192.168.0.0%20%24%20is%20the%20first%20address%20of%20the%20range%2C%20and%20%24%20192.168.0.255%20%24%20is%20the%20last%20one.%5Cn%5CnBerkomnadzor%27s%20engineers%20have%20devised%20a%20plan%20to%20improve%20performance%20of%20Berland%27s%20global%20network.%20Instead%20of%20maintaining%20both%20whitelist%20and%20blacklist%20they%20want%20to%20build%20only%20a%20single%20optimised%20blacklist%20containing%20minimal%20number%20of%20subnets.%20The%20idea%20is%20to%20block%20all%20IPv4%20addresses%20matching%20the%20optimised%20blacklist%20and%20allow%20all%20the%20rest%20addresses.%20Of%20course%2C%20IPv4%20addresses%20from%20the%20old%20blacklist%20must%20remain%20blocked%20and%20all%20IPv4%20addresses%20from%20the%20old%20whitelist%20must%20still%20be%20allowed.%20Those%20IPv4%20addresses%20which%20matched%20neither%20the%20old%20blacklist%20nor%20the%20old%20whitelist%20may%20be%20either%20blocked%20or%20allowed%20regardless%20of%20their%20accessibility%20before.%5Cn%5CnPlease%20write%20a%20program%20which%20takes%20blacklist%20and%20whitelist%20as%20input%20and%20produces%20optimised%20blacklist.%20The%20optimised%20blacklist%20must%20contain%20the%20minimal%20possible%20number%20of%20subnets%20and%20satisfy%20all%20IPv4%20addresses%20accessibility%20requirements%20mentioned%20above.%5Cn%5CnIPv4%20subnets%20in%20the%20source%20lists%20may%20intersect%20arbitrarily.%20Please%20output%20a%20single%20number%20-1%20if%20some%20IPv4%20address%20matches%20both%20source%20whitelist%20and%20blacklist.%22%2C%22inputFormat%22%3A%22The%20first%20line%20of%20the%20input%20contains%20single%20integer%20%24%20n%20%24%20%28%20%24%201%20%5C%5Cle%20n%20%5C%5Cle%202%5C%5Ccdot10%5E5%20%24%20%29%20%5Cu2014%20total%20number%20of%20IPv4%20subnets%20in%20the%20input.%5Cn%5CnThe%20following%20%24%20n%20%24%20lines%20contain%20IPv4%20subnets.%20Each%20line%20starts%20with%20either%20%27-%27%20or%20%27%2B%27%20sign%2C%20which%20indicates%20if%20the%20subnet%20belongs%20to%20the%20blacklist%20or%20to%20the%20whitelist%20correspondingly.%20It%20is%20followed%2C%20without%20any%20spaces%2C%20by%20the%20IPv4%20subnet%20in%20%24%20a.b.c.d%20%24%20or%20%24%20a.b.c.d%5C%2Fx%20%24%20format%20%28%20%24%200%20%5C%5Cle%20x%20%5C%5Cle%2032%20%24%20%29.%20The%20blacklist%20always%20contains%20at%20least%20one%20subnet.%5Cn%5CnAll%20of%20the%20IPv4%20subnets%20given%20in%20the%20input%20are%20valid.%20Integer%20numbers%20do%20not%20start%20with%20extra%20leading%20zeroes.%20The%20provided%20IPv4%20subnets%20can%20intersect%20arbitrarily.%22%2C%22outputFormat%22%3A%22Output%20-1%2C%20if%20there%20is%20an%20IPv4%20address%20that%20matches%20both%20the%20whitelist%20and%20the%20blacklist.%20Otherwise%20output%20%24%20t%20%24%20%5Cu2014%20the%20length%20of%20the%20optimised%20blacklist%2C%20followed%20by%20%24%20t%20%24%20subnets%2C%20with%20each%20subnet%20on%20a%20new%20line.%20Subnets%20may%20be%20printed%20in%20arbitrary%20order.%20All%20addresses%20matching%20the%20source%20blacklist%20must%20match%20the%20optimised%20blacklist.%20All%20addresses%20matching%20the%20source%20whitelist%20must%20not%20match%20the%20optimised%20blacklist.%20You%20can%20print%20a%20subnet%20%24%20a.b.c.d%5C%2F32%20%24%20in%20any%20of%20two%20ways%3A%20as%20%24%20a.b.c.d%5C%2F32%20%24%20or%20as%20%24%20a.b.c.d%20%24%20.%5Cn%5CnIf%20there%20is%20more%20than%20one%20solution%2C%20output%20any.%22%2C%22samples%22%3A%5B%5B%221%5Cn-149.154.167.99%5Cn%22%2C%221%5Cn0.0.0.0%5C%2F0%5Cn%22%5D%2C%5B%224%5Cn-149.154.167.99%5Cn%2B149.154.167.100%5C%2F30%5Cn%2B149.154.167.128%5C%2F25%5Cn-149.154.167.120%5C%2F29%5Cn%22%2C%222%5Cn149.154.167.99%5Cn149.154.167.120%5C%2F29%5Cn%22%5D%2C%5B%225%5Cn-127.0.0.4%5C%2F31%5Cn%2B127.0.0.8%5Cn%2B127.0.0.0%5C%2F30%5Cn-195.82.146.208%5C%2F29%5Cn-127.0.0.6%5C%2F31%5Cn%22%2C%222%5Cn195.0.0.0%5C%2F8%5Cn127.0.0.4%5C%2F30%5Cn%22%5D%2C%5B%222%5Cn%2B127.0.0.1%5C%2F32%5Cn-127.0.0.1%5Cn%22%2C%22-1%5Cn%22%5D%5D%2C%22hint%22%3A%22%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B3000%5D%2C%22memory%22%3A%5B256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F1070%5C%2FB%22%2C%22id%22%3A%221070B%22%7D%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Atrue%2C%22totalSubmit%22%3A3%2C%22totalAccepted%22%3A3%2C%22pid%22%3A%22CF1070B%22%2C%22title%22%3A%22Berkomnadzor%22%2C%22difficulty%22%3A5%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Berkomnadzor%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1572920822;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Berkomnadzor</h1>
<h2>题目描述</h2>
<div>Berkomnadzor — Federal Service for Supervision of Communications, Information Technology and Mass Media — is a Berland federal executive body that protects ordinary residents of Berland from the threats of modern internet.
Berkomnadzor maintains a list of prohibited IPv4 subnets (blacklist) and a list of allowed IPv4 subnets (whitelist). All Internet Service Providers (ISPs) in Berland must configure the network equipment to block access to all IPv4 addresses matching the blacklist. Also ISPs must provide access (that is, do not block) to all IPv4 addresses matching the whitelist. If an IPv4 address does not match either of those lists, it's up to the ISP to decide whether to block it or not. An IPv4 address matches the blacklist (whitelist) if and only if it matches some subnet from the blacklist (whitelist). An IPv4 address can belong to a whitelist and to a blacklist at the same time, this situation leads to a contradiction (see no solution case in the output description).
An IPv4 address is a 32-bit unsigned integer written in the form $ a.b.c.d $ , where each of the values $ a,b,c,d $ is called an octet and is an integer from $ 0 $ to $ 255 $ written in decimal notation. For example, IPv4 address $ 192.168.0.1 $ can be converted to a 32-bit number using the following expression $ 192 \cdot 2^{24} + 168 \cdot 2^{16} + 0 \cdot 2^8 + 1 \cdot 2^0 $ . First octet $ a $ encodes the most significant (leftmost) $ 8 $ bits, the octets $ b $ and $ c $ — the following blocks of $ 8 $ bits (in this order), and the octet $ d $ encodes the least significant (rightmost) $ 8 $ bits.
The IPv4 network in Berland is slightly different from the rest of the world. There are no reserved or internal addresses in Berland and use all $ 2^{32} $ possible values.
An IPv4 subnet is represented either as $ a.b.c.d $ or as $ a.b.c.d/x $ (where $ 0 \le x \le 32 $ ). A subnet $ a.b.c.d $ contains a single address $ a.b.c.d $ . A subnet $ a.b.c.d/x $ contains all IPv4 addresses with $ x $ leftmost (most significant) bits equal to $ x $ leftmost bits of the address $ a.b.c.d $ . It is required that $ 32 - x $ rightmost (least significant) bits of subnet $ a.b.c.d/x $ are zeroes.
Naturally it happens that all addresses matching subnet $ a.b.c.d/x $ form a continuous range. The range starts with address $ a.b.c.d $ (its rightmost $ 32 - x $ bits are zeroes). The range ends with address which $ x $ leftmost bits equal to $ x $ leftmost bits of address $ a.b.c.d $ , and its $ 32 - x $ rightmost bits are all ones. Subnet contains exactly $ 2^{32-x} $ addresses. Subnet $ a.b.c.d/32 $ contains exactly one address and can also be represented by just $ a.b.c.d $ .
For example subnet $ 192.168.0.0/24 $ contains range of 256 addresses. $ 192.168.0.0 $ is the first address of the range, and $ 192.168.0.255 $ is the last one.
Berkomnadzor's engineers have devised a plan to improve performance of Berland's global network. Instead of maintaining both whitelist and blacklist they want to build only a single optimised blacklist containing minimal number of subnets. The idea is to block all IPv4 addresses matching the optimised blacklist and allow all the rest addresses. Of course, IPv4 addresses from the old blacklist must remain blocked and all IPv4 addresses from the old whitelist must still be allowed. Those IPv4 addresses which matched neither the old blacklist nor the old whitelist may be either blocked or allowed regardless of their accessibility before.
Please write a program which takes blacklist and whitelist as input and produces optimised blacklist. The optimised blacklist must contain the minimal possible number of subnets and satisfy all IPv4 addresses accessibility requirements mentioned above.
IPv4 subnets in the source lists may intersect arbitrarily. Please output a single number -1 if some IPv4 address matches both source whitelist and blacklist.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line of the input contains single integer $ n $ ( $ 1 \le n \le 2\cdot10^5 $ ) — total number of IPv4 subnets in the input.
The following $ n $ lines contain IPv4 subnets. Each line starts with either '-' or '+' sign, which indicates if the subnet belongs to the blacklist or to the whitelist correspondingly. It is followed, without any spaces, by the IPv4 subnet in $ a.b.c.d $ or $ a.b.c.d/x $ format ( $ 0 \le x \le 32 $ ). The blacklist always contains at least one subnet.
All of the IPv4 subnets given in the input are valid. Integer numbers do not start with extra leading zeroes. The provided IPv4 subnets can intersect arbitrarily.</div>
<h3>输出格式</h3>
<br />
<div>Output -1, if there is an IPv4 address that matches both the whitelist and the blacklist. Otherwise output $ t $ — the length of the optimised blacklist, followed by $ t $ subnets, with each subnet on a new line. Subnets may be printed in arbitrary order. All addresses matching the source blacklist must match the optimised blacklist. All addresses matching the source whitelist must not match the optimised blacklist. You can print a subnet $ a.b.c.d/32 $ in any of two ways: as $ a.b.c.d/32 $ or as $ a.b.c.d $ .
If there is more than one solution, output any.</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>1
-149.154.167.99
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>1
0.0.0.0/0
</code></pre>
<h3>输入样例 #2</h3>
<pre><code>4
-149.154.167.99
+149.154.167.100/30
+149.154.167.128/25
-149.154.167.120/29
</code></pre>
<h3>输出样例 #2</h3>
<pre><code>2
149.154.167.99
149.154.167.120/29
</code></pre>
<h3>输入样例 #3</h3>
<pre><code>5
-127.0.0.4/31
+127.0.0.8
+127.0.0.0/30
-195.82.146.208/29
-127.0.0.6/31
</code></pre>
<h3>输出样例 #3</h3>
<pre><code>2
195.0.0.0/8
127.0.0.4/30
</code></pre>
<h3>输入样例 #4</h3>
<pre><code>2
+127.0.0.1/32
-127.0.0.1
</code></pre>
<h3>输出样例 #4</h3>
<pre><code>-1
</code></pre>
</article>
</div>
</div>
</body>
</html>
