<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>The Doctor Meets Vader (Hard) - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573402757:9TShZM8GJSbP0OxL3VgQizg+790vFcHgTi2F7Xqb1Oo=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22The%20rebels%20have%20saved%20enough%20gold%20to%20launch%20a%20full-scale%20attack.%20Now%20the%20situation%20is%20flipped%2C%20the%20rebels%20will%20send%20out%20the%20spaceships%20to%20attack%20the%20Empire%20bases%21%5Cn%5CnThe%20galaxy%20can%20be%20represented%20as%20an%20undirected%20graph%20with%20%24%20n%20%24%20planets%20%28nodes%29%20and%20%24%20m%20%24%20wormholes%20%28edges%29%2C%20each%20connecting%20two%20planets.%5Cn%5CnA%20total%20of%20%24%20s%20%24%20rebel%20spaceships%20and%20%24%20b%20%24%20empire%20bases%20are%20located%20at%20different%20planets%20in%20the%20galaxy.%5Cn%5CnEach%20spaceship%20is%20given%20a%20location%20%24%20x%20%24%20%2C%20denoting%20the%20index%20of%20the%20planet%20on%20which%20it%20is%20located%2C%20an%20attacking%20strength%20%24%20a%20%24%20%2C%20a%20certain%20amount%20of%20fuel%20%24%20f%20%24%20%2C%20and%20a%20price%20to%20operate%20%24%20p%20%24%20.%5Cn%5CnEach%20base%20is%20given%20a%20location%20%24%20x%20%24%20%2C%20a%20defensive%20strength%20%24%20d%20%24%20%2C%20and%20a%20certain%20amount%20of%20gold%20%24%20g%20%24%20.%5Cn%5CnA%20spaceship%20can%20attack%20a%20base%20if%20both%20of%20these%20conditions%20hold%3A%5Cn%5Cn-%20the%20spaceship%27s%20attacking%20strength%20is%20greater%20or%20equal%20than%20the%20defensive%20strength%20of%20the%20base%5Cn-%20the%20spaceship%27s%20fuel%20is%20greater%20or%20equal%20to%20the%20shortest%20distance%2C%20computed%20as%20the%20number%20of%20wormholes%2C%20between%20the%20spaceship%27s%20node%20and%20the%20base%27s%20node%5Cn%5CnThe%20rebels%20are%20very%20proud%20fighters.%20So%2C%20if%20a%20spaceship%20cannot%20attack%20any%20base%2C%20no%20rebel%20pilot%20will%20accept%20to%20operate%20it.%5Cn%5CnIf%20a%20spaceship%20is%20operated%2C%20the%20profit%20generated%20by%20that%20spaceship%20is%20equal%20to%20the%20gold%20of%20the%20base%20it%20attacks%20minus%20the%20price%20to%20operate%20the%20spaceship.%20Note%20that%20this%20might%20be%20negative.%20A%20spaceship%20that%20is%20operated%20will%20attack%20the%20base%20that%20maximizes%20its%20profit.%5Cn%5CnDarth%20Vader%20likes%20to%20appear%20rich%20at%20all%20times.%20Therefore%2C%20whenever%20a%20base%20is%20attacked%20and%20its%20gold%20stolen%2C%20he%20makes%20sure%20to%20immediately%20refill%20that%20base%20with%20gold.%5Cn%5CnTherefore%2C%20for%20the%20purposes%20of%20the%20rebels%2C%20multiple%20spaceships%20can%20attack%20the%20same%20base%2C%20in%20which%20case%20each%20spaceship%20will%20still%20receive%20all%20the%20gold%20of%20that%20base.%5Cn%5CnThe%20rebels%20have%20tasked%20Heidi%20and%20the%20Doctor%20to%20decide%20which%20set%20of%20spaceships%20to%20operate%20in%20order%20to%20maximize%20the%20total%20profit.%5Cn%5CnHowever%2C%20as%20the%20war%20has%20been%20going%20on%20for%20a%20long%20time%2C%20the%20pilots%20have%20formed%20unbreakable%20bonds%2C%20and%20some%20of%20them%20refuse%20to%20operate%20spaceships%20if%20their%20friends%20are%20not%20also%20operating%20spaceships.%5Cn%5CnThey%20have%20a%20list%20of%20%24%20k%20%24%20dependencies%20of%20the%20form%20%24%20s_1%2C%20s_2%20%24%20%2C%20denoting%20that%20spaceship%20%24%20s_1%20%24%20can%20be%20operated%20only%20if%20spaceship%20%24%20s_2%20%24%20is%20also%20operated.%22%2C%22inputFormat%22%3A%22The%20first%20line%20of%20input%20contains%20integers%20%24%20n%20%24%20and%20%24%20m%20%24%20%28%20%24%201%20%5C%5Cleq%20n%20%5C%5Cleq%20100%20%24%20%2C%20%24%200%20%5C%5Cleq%20m%20%5C%5Cleq%2010000%20%24%20%29%2C%20the%20number%20of%20nodes%20and%20the%20number%20of%20edges%2C%20respectively.%5Cn%5CnThe%20next%20%24%20m%20%24%20lines%20contain%20integers%20%24%20u%20%24%20and%20%24%20v%20%24%20%28%20%24%201%20%5C%5Cleq%20u%2C%20v%20%5C%5Cleq%20n%20%24%20%29%20denoting%20an%20undirected%20edge%20between%20the%20two%20nodes.%5Cn%5CnThe%20next%20line%20contains%20integers%20%24%20s%20%24%20%2C%20%24%20b%20%24%20and%20%24%20k%20%24%20%28%20%24%201%20%5C%5Cleq%20s%2C%20b%20%5C%5Cleq%2010%5E5%20%24%20%2C%20%24%200%20%5C%5Cleq%20k%20%5C%5Cleq%201000%20%24%20%29%2C%20the%20number%20of%20spaceships%2C%20bases%2C%20and%20dependencies%2C%20respectively.%5Cn%5CnThe%20next%20%24%20s%20%24%20lines%20contain%20integers%20%24%20x%2C%20a%2C%20f%2C%20p%20%24%20%28%20%24%201%20%5C%5Cleq%20x%20%5C%5Cleq%20n%20%24%20%2C%20%24%200%20%5C%5Cleq%20a%2C%20f%2C%20p%20%5C%5Cleq%2010%5E9%20%24%20%29%2C%20denoting%20the%20location%2C%20attack%2C%20fuel%2C%20and%20price%20of%20the%20spaceship.%20Ships%20are%20numbered%20from%20%24%201%20%24%20to%20%24%20s%20%24%20.%5Cn%5CnThe%20next%20%24%20b%20%24%20lines%20contain%20integers%20%24%20x%2C%20d%2C%20g%20%24%20%28%20%24%201%20%5C%5Cleq%20x%20%5C%5Cleq%20n%20%24%20%2C%20%24%200%20%5C%5Cleq%20d%2C%20g%20%5C%5Cleq%2010%5E9%20%24%20%29%2C%20denoting%20the%20location%2C%20defence%2C%20and%20gold%20of%20the%20base.%5Cn%5CnThe%20next%20%24%20k%20%24%20lines%20contain%20integers%20%24%20s_1%20%24%20and%20%24%20s_2%20%24%20%28%20%24%201%20%5C%5Cleq%20s_1%2C%20s_2%20%5C%5Cleq%20s%20%24%20%29%2C%20denoting%20a%20dependency%20of%20%24%20s_1%20%24%20on%20%24%20s_2%20%24%20.%22%2C%22outputFormat%22%3A%22Print%20a%20single%20integer%2C%20the%20maximum%20total%20profit%20that%20can%20be%20achieved.%22%2C%22samples%22%3A%5B%5B%22%5Cn6%207%5Cn1%202%5Cn2%203%5Cn3%204%5Cn4%206%5Cn6%205%5Cn4%204%5Cn3%206%5Cn4%202%202%5Cn1%2010%202%205%5Cn3%208%202%207%5Cn5%201%200%202%5Cn6%205%204%201%5Cn3%207%206%5Cn5%202%203%5Cn4%202%5Cn3%202%5Cn%22%2C%22%5Cn2%5Cn%22%5D%5D%2C%22hint%22%3A%22The%20optimal%20strategy%20is%20to%20operate%20spaceships%201%2C%202%2C%20and%204%2C%20which%20will%20attack%20bases%201%2C%201%2C%20and%202%2C%20respectively.%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B4000%5D%2C%22memory%22%3A%5B512000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F1184%5C%2FB3%22%2C%22id%22%3A%221184B3%22%7D%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Atrue%2C%22totalSubmit%22%3A1%2C%22totalAccepted%22%3A1%2C%22pid%22%3A%22CF1184B3%22%2C%22title%22%3A%22The%20Doctor%20Meets%20Vader%20%28Hard%29%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22The%20Doctor%20Meets%20Vader%20%28Hard%29%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1572920822;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>The Doctor Meets Vader (Hard)</h1>
<h2>题目描述</h2>
<div>The rebels have saved enough gold to launch a full-scale attack. Now the situation is flipped, the rebels will send out the spaceships to attack the Empire bases!
The galaxy can be represented as an undirected graph with $ n $ planets (nodes) and $ m $ wormholes (edges), each connecting two planets.
A total of $ s $ rebel spaceships and $ b $ empire bases are located at different planets in the galaxy.
Each spaceship is given a location $ x $ , denoting the index of the planet on which it is located, an attacking strength $ a $ , a certain amount of fuel $ f $ , and a price to operate $ p $ .
Each base is given a location $ x $ , a defensive strength $ d $ , and a certain amount of gold $ g $ .
A spaceship can attack a base if both of these conditions hold:
- the spaceship's attacking strength is greater or equal than the defensive strength of the base
- the spaceship's fuel is greater or equal to the shortest distance, computed as the number of wormholes, between the spaceship's node and the base's node
The rebels are very proud fighters. So, if a spaceship cannot attack any base, no rebel pilot will accept to operate it.
If a spaceship is operated, the profit generated by that spaceship is equal to the gold of the base it attacks minus the price to operate the spaceship. Note that this might be negative. A spaceship that is operated will attack the base that maximizes its profit.
Darth Vader likes to appear rich at all times. Therefore, whenever a base is attacked and its gold stolen, he makes sure to immediately refill that base with gold.
Therefore, for the purposes of the rebels, multiple spaceships can attack the same base, in which case each spaceship will still receive all the gold of that base.
The rebels have tasked Heidi and the Doctor to decide which set of spaceships to operate in order to maximize the total profit.
However, as the war has been going on for a long time, the pilots have formed unbreakable bonds, and some of them refuse to operate spaceships if their friends are not also operating spaceships.
They have a list of $ k $ dependencies of the form $ s_1, s_2 $ , denoting that spaceship $ s_1 $ can be operated only if spaceship $ s_2 $ is also operated.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line of input contains integers $ n $ and $ m $ ( $ 1 \leq n \leq 100 $ , $ 0 \leq m \leq 10000 $ ), the number of nodes and the number of edges, respectively.
The next $ m $ lines contain integers $ u $ and $ v $ ( $ 1 \leq u, v \leq n $ ) denoting an undirected edge between the two nodes.
The next line contains integers $ s $ , $ b $ and $ k $ ( $ 1 \leq s, b \leq 10^5 $ , $ 0 \leq k \leq 1000 $ ), the number of spaceships, bases, and dependencies, respectively.
The next $ s $ lines contain integers $ x, a, f, p $ ( $ 1 \leq x \leq n $ , $ 0 \leq a, f, p \leq 10^9 $ ), denoting the location, attack, fuel, and price of the spaceship. Ships are numbered from $ 1 $ to $ s $ .
The next $ b $ lines contain integers $ x, d, g $ ( $ 1 \leq x \leq n $ , $ 0 \leq d, g \leq 10^9 $ ), denoting the location, defence, and gold of the base.
The next $ k $ lines contain integers $ s_1 $ and $ s_2 $ ( $ 1 \leq s_1, s_2 \leq s $ ), denoting a dependency of $ s_1 $ on $ s_2 $ .</div>
<h3>输出格式</h3>
<br />
<div>Print a single integer, the maximum total profit that can be achieved.</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>
6 7
1 2
2 3
3 4
4 6
6 5
4 4
3 6
4 2 2
1 10 2 5
3 8 2 7
5 1 0 2
6 5 4 1
3 7 6
5 2 3
4 2
3 2
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>
2
</code></pre>
<h2>说明</h2>
<div>The optimal strategy is to operate spaceships 1, 2, and 4, which will attack bases 1, 1, and 2, respectively.</div>
</article>
</div>
</div>
</body>
</html>
