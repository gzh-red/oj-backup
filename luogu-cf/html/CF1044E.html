<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Grid Sort - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573400934:Utqt/pQ3pwZ9WmsjZ1wCOvZvBVShGBq9qAjhXTdhMJw=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22You%20are%20given%20an%20%24%20n%20%5C%5Ctimes%20m%20%24%20grid.%20Each%20grid%20cell%20is%20filled%20with%20a%20unique%20integer%20from%20%24%201%20%24%20to%20%24%20nm%20%24%20so%20that%20each%20integer%20appears%20exactly%20once.%5Cn%5CnIn%20one%20operation%2C%20you%20can%20choose%20an%20arbitrary%20cycle%20of%20the%20grid%20and%20move%20all%20integers%20along%20that%20cycle%20one%20space%20over.%20Here%2C%20a%20cycle%20is%20any%20sequence%20that%20satisfies%20the%20following%20conditions%3A%5Cn%5Cn-%20There%20are%20at%20least%20four%20squares.%5Cn-%20Each%20square%20appears%20at%20most%20once.%5Cn-%20Every%20pair%20of%20adjacent%20squares%2C%20and%20also%20the%20first%20and%20last%20squares%2C%20share%20an%20edge.%5Cn%5CnFor%20example%2C%20if%20we%20had%20the%20following%20grid%3A%5Cn%5Cn%20%21%5B%5D%28https%3A%5C%2F%5C%2Fcdn.luogu.com.cn%5C%2Fupload%5C%2Fvjudge_pic%5C%2FCF1044E%5C%2Fddc1310958686d8165141874c4116974e680c504.png%29We%20can%20choose%20an%20arbitrary%20cycle%20like%20this%20one%3A%5Cn%5Cn%20%21%5B%5D%28https%3A%5C%2F%5C%2Fcdn.luogu.com.cn%5C%2Fupload%5C%2Fvjudge_pic%5C%2FCF1044E%5C%2F7e671f37a2d95c9ff29f9b01e59e68feea0624a5.png%29To%20get%20the%20following%20grid%3A%5Cn%5Cn%20%21%5B%5D%28https%3A%5C%2F%5C%2Fcdn.luogu.com.cn%5C%2Fupload%5C%2Fvjudge_pic%5C%2FCF1044E%5C%2F0080a8fe7414955dbaf5a00f8b4368121f12f705.png%29In%20this%20particular%20case%2C%20the%20chosen%20cycle%20can%20be%20represented%20as%20the%20sequence%20%24%20%5B1%2C%202%2C%203%2C%206%2C%205%2C%208%2C%207%2C%204%5D%20%24%20%2C%20the%20numbers%20are%20in%20the%20direction%20that%20we%20want%20to%20rotate%20them%20in.%5Cn%5CnFind%20any%20sequence%20of%20operations%20to%20sort%20the%20grid%20so%20that%20the%20array%20created%20by%20concatenating%20the%20rows%20from%20the%20highest%20to%20the%20lowest%20is%20sorted%20%28look%20at%20the%20first%20picture%20above%29.%5Cn%5CnNote%20you%20do%20not%20need%20to%20minimize%20number%20of%20operations%20or%20sum%20of%20cycle%20lengths.%20The%20only%20constraint%20is%20that%20the%20sum%20of%20all%20cycles%20lengths%20must%20not%20be%20greater%20than%20%24%2010%5E5%20%24%20.%20We%20can%20show%20that%20an%20answer%20always%20exists%20under%20the%20given%20constraints.%20Output%20any%20valid%20sequence%20of%20moves%20that%20will%20sort%20the%20grid.%22%2C%22inputFormat%22%3A%22The%20first%20line%20contains%20two%20integers%20%24%20n%20%24%20and%20%24%20m%20%24%20%28%20%24%203%20%5C%5Cleq%20n%2Cm%20%5C%5Cleq%2020%20%24%20%29%20%5Cu2014%20the%20dimensions%20of%20the%20grid.%5Cn%5CnEach%20of%20the%20next%20%24%20n%20%24%20lines%20contains%20%24%20m%20%24%20integers%20%24%20x_%7Bi%2C1%7D%2C%20x_%7Bi%2C2%7D%2C%20%5C%5Cldots%2C%20x_%7Bi%2C%20m%7D%20%24%20%28%20%24%201%20%5C%5Cleq%20x_%7Bi%2Cj%7D%20%5C%5Cleq%20nm%20%24%20%29%2C%20denoting%20the%20values%20of%20the%20block%20in%20row%20%24%20i%20%24%20and%20column%20%24%20j%20%24%20.%5Cn%5CnIt%20is%20guaranteed%20that%20all%20%24%20x_%7Bi%2Cj%7D%20%24%20are%20distinct.%22%2C%22outputFormat%22%3A%22First%2C%20print%20a%20single%20integer%20%24%20k%20%24%20%2C%20the%20number%20of%20operations%20%28%20%24%20k%20%5C%5Cgeq%200%20%24%20%29.%5Cn%5CnOn%20each%20of%20the%20next%20%24%20k%20%24%20lines%2C%20print%20a%20cycle%20as%20follows%3A%5Cn%5Cn%20%24%20%24%24%24s%5C%5C%20y_1%5C%5C%20y_2%5C%5C%20%5C%5Cldots%5C%5C%20y_s%20%24%20%24%20%3C%5C%2Fp%3E%3Cp%3EHere%2C%20%20%24%20s%20%24%20%20is%20the%20number%20of%20blocks%20to%20move%20%28%20%24%20s%20%5C%5C%5C%5Cgeq%204%20%24%20%29.%20Here%20we%20have%20block%20%20%24%20y%5C%5C_1%20%24%20%20moving%20to%20where%20block%20%20%24%20y%5C%5C_2%20%24%20%20is%2C%20block%20%20%24%20y%5C%5C_2%20%24%20%20moving%20to%20where%20block%20%20%24%20y%5C%5C_3%20%24%20%20is%2C%20and%20so%20on%20with%20block%20%20%24%20y%5C%5C_s%20%24%20%20moving%20to%20where%20block%20%20%24%20y%5C%5C_1%20%24%20%20is.%3C%5C%2Fp%3E%3Cp%3EThe%20sum%20of%20%20%24%20s%20%24%20%20over%20all%20operations%20must%20be%20at%20most%20%20%24%2010%5E5%24%24%24.%22%2C%22samples%22%3A%5B%5B%223%203%5Cn4%201%202%5Cn7%206%203%5Cn8%205%209%5Cn%22%2C%221%5Cn8%201%204%207%208%205%206%203%202%22%5D%2C%5B%223%205%5Cn1%202%203%205%2010%5Cn11%206%204%2014%209%5Cn12%207%208%2013%2015%5Cn%22%2C%223%5Cn4%204%2014%2013%208%5Cn4%205%2010%209%204%5Cn4%2012%207%206%2011%5Cn%22%5D%5D%2C%22hint%22%3A%22The%20first%20sample%20is%20the%20case%20in%20the%20statement.%20Here%2C%20we%20can%20use%20the%20cycle%20in%20reverse%20order%20to%20sort%20the%20grid.%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B2000%5D%2C%22memory%22%3A%5B256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F1044%5C%2FE%22%2C%22id%22%3A%221044E%22%7D%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Atrue%2C%22totalSubmit%22%3A0%2C%22totalAccepted%22%3A0%2C%22pid%22%3A%22CF1044E%22%2C%22title%22%3A%22Grid%20Sort%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Grid%20Sort%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1572920822;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Grid Sort</h1>
<h2>题目描述</h2>
<div>You are given an $ n \times m $ grid. Each grid cell is filled with a unique integer from $ 1 $ to $ nm $ so that each integer appears exactly once.
In one operation, you can choose an arbitrary cycle of the grid and move all integers along that cycle one space over. Here, a cycle is any sequence that satisfies the following conditions:
- There are at least four squares.
- Each square appears at most once.
- Every pair of adjacent squares, and also the first and last squares, share an edge.
For example, if we had the following grid:
![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF1044E/ddc1310958686d8165141874c4116974e680c504.png)We can choose an arbitrary cycle like this one:
![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF1044E/7e671f37a2d95c9ff29f9b01e59e68feea0624a5.png)To get the following grid:
![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF1044E/0080a8fe7414955dbaf5a00f8b4368121f12f705.png)In this particular case, the chosen cycle can be represented as the sequence $ [1, 2, 3, 6, 5, 8, 7, 4] $ , the numbers are in the direction that we want to rotate them in.
Find any sequence of operations to sort the grid so that the array created by concatenating the rows from the highest to the lowest is sorted (look at the first picture above).
Note you do not need to minimize number of operations or sum of cycle lengths. The only constraint is that the sum of all cycles lengths must not be greater than $ 10^5 $ . We can show that an answer always exists under the given constraints. Output any valid sequence of moves that will sort the grid.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line contains two integers $ n $ and $ m $ ( $ 3 \leq n,m \leq 20 $ ) — the dimensions of the grid.
Each of the next $ n $ lines contains $ m $ integers $ x_{i,1}, x_{i,2}, \ldots, x_{i, m} $ ( $ 1 \leq x_{i,j} \leq nm $ ), denoting the values of the block in row $ i $ and column $ j $ .
It is guaranteed that all $ x_{i,j} $ are distinct.</div>
<h3>输出格式</h3>
<br />
<div>First, print a single integer $ k $ , the number of operations ( $ k \geq 0 $ ).
On each of the next $ k $ lines, print a cycle as follows:
$ $$$s\ y_1\ y_2\ \ldots\ y_s $ $ </p><p>Here, $ s $ is the number of blocks to move ( $ s \\geq 4 $ ). Here we have block $ y\_1 $ moving to where block $ y\_2 $ is, block $ y\_2 $ moving to where block $ y\_3 $ is, and so on with block $ y\_s $ moving to where block $ y\_1 $ is.</p><p>The sum of $ s $ over all operations must be at most $ 10^5$$$.</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>3 3
4 1 2
7 6 3
8 5 9
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>1
8 1 4 7 8 5 6 3 2</code></pre>
<h3>输入样例 #2</h3>
<pre><code>3 5
1 2 3 5 10
11 6 4 14 9
12 7 8 13 15
</code></pre>
<h3>输出样例 #2</h3>
<pre><code>3
4 4 14 13 8
4 5 10 9 4
4 12 7 6 11
</code></pre>
<h2>说明</h2>
<div>The first sample is the case in the statement. Here, we can use the cycle in reverse order to sort the grid.</div>
</article>
</div>
</div>
</body>
</html>
