<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Archaeology - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573391432:vdh054/mvcsql+K+4QJR+OUlclnrS5SsE6t5yTLAULc=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22This%20time%20you%20should%20help%20a%20team%20of%20researchers%20on%20an%20island%20in%20the%20Pacific%20Ocean.%20They%20research%20the%20culture%20of%20the%20ancient%20tribes%20that%20used%20to%20inhabit%20the%20island%20many%20years%20ago.%5Cn%5CnOverall%20they%27ve%20dug%20out%20%24%20n%20%24%20villages.%20Some%20pairs%20of%20villages%20were%20connected%20by%20roads.%20People%20could%20go%20on%20the%20roads%20in%20both%20directions.%20Overall%20there%20were%20exactly%20%24%20n-1%20%24%20roads%2C%20and%20from%20any%20village%20one%20could%20get%20to%20any%20other%20one.%5Cn%5CnThe%20tribes%20were%20not%20peaceful%20and%20they%20had%20many%20wars.%20As%20a%20result%20of%20the%20wars%2C%20some%20villages%20were%20destroyed%20completely.%20During%20more%20peaceful%20years%20some%20of%20the%20villages%20were%20restored.%5Cn%5CnAt%20each%20moment%20of%20time%20people%20used%20only%20those%20roads%20that%20belonged%20to%20some%20shortest%20way%20between%20two%20villages%20that%20existed%20at%20the%20given%20moment.%20In%20other%20words%2C%20people%20used%20the%20minimum%20subset%20of%20roads%20in%20such%20a%20way%2C%20that%20it%20was%20possible%20to%20get%20from%20any%20existing%20village%20to%20any%20other%20existing%20one.%20Note%20that%20throughout%20the%20island%27s%20whole%20history%2C%20there%20existed%20exactly%20%24%20n-1%20%24%20roads%20that%20have%20been%20found%20by%20the%20researchers.%20There%20never%20were%20any%20other%20roads.%5Cn%5CnThe%20researchers%20think%20that%20observing%20the%20total%20sum%20of%20used%20roads%5Cu2019%20lengths%20at%20different%20moments%20of%20time%20can%20help%20to%20better%20understand%20the%20tribes%27%20culture%20and%20answer%20several%20historical%20questions.%5Cn%5CnYou%20will%20be%20given%20the%20full%20history%20of%20the%20tribes%27%20existence.%20Your%20task%20is%20to%20determine%20the%20total%20length%20of%20used%20roads%20at%20some%20moments%20of%20time.%22%2C%22inputFormat%22%3A%22The%20first%20line%20contains%20an%20integer%20%24%20n%20%24%20%28%20%24%201%3C%3Dn%3C%3D10%5E%7B5%7D%20%24%20%29%20%5Cu2014%20the%20number%20of%20villages.%20The%20next%20%24%20n-1%20%24%20lines%20describe%20the%20roads.%20The%20%24%20i%20%24%20-th%20of%20these%20lines%20contains%20three%20integers%20%24%20a_%7Bi%7D%20%24%20%2C%20%24%20b_%7Bi%7D%20%24%20and%20%24%20c_%7Bi%7D%20%24%20%28%20%24%201%3C%3Da_%7Bi%7D%2Cb_%7Bi%7D%3C%3Dn%20%24%20%2C%20%24%20a_%7Bi%7D%5Cu2260b_%7Bi%7D%20%24%20%2C%20%24%201%3C%3Dc_%7Bi%7D%3C%3D10%5E%7B9%7D%20%24%20%2C%20%24%201%3C%3Di%26lt%3Bn%20%24%20%29%20%5Cu2014%20the%20numbers%20of%20villages%20that%20are%20connected%20by%20the%20%24%20i%20%24%20-th%20road%20and%20the%20road%27s%20length.%20The%20numbers%20in%20the%20lines%20are%20separated%20by%20a%20space.%5Cn%5CnThe%20next%20line%20contains%20an%20integer%20%24%20q%20%24%20%28%20%24%201%3C%3Dq%3C%3D10%5E%7B5%7D%20%24%20%29%20%5Cu2014%20the%20number%20of%20queries.%20Then%20follow%20%24%20q%20%24%20queries%2C%20one%20per%20line%2C%20ordered%20by%20time.%20Each%20query%20belongs%20to%20one%20of%20three%20types%3A%5Cn%5Cn-%20%5C%22%2B%20%20%24%20x%20%24%20%5C%22%20%5Cu2014%20village%20number%20%24%20x%20%24%20is%20restored%20%28%20%24%201%3C%3Dx%3C%3Dn%20%24%20%29.%5Cn-%20%5C%22-%20%20%24%20x%20%24%20%5C%22%20%5Cu2014%20village%20number%20%24%20x%20%24%20is%20destroyed%20%28%20%24%201%3C%3Dx%3C%3Dn%20%24%20%29.%5Cn-%20%5C%22%3F%5C%22%20%5Cu2014%20the%20archaeologists%20want%20to%20know%20the%20total%20length%20of%20the%20roads%20which%20were%20used%20for%20that%20time%20period.%5Cn%5CnIt%20is%20guaranteed%20that%20the%20queries%20do%20not%20contradict%20each%20other%2C%20that%20is%2C%20there%20won%27t%20be%20queries%20to%20destroy%20non-existing%20villages%20or%20restore%20the%20already%20existing%20ones.%20It%20is%20guaranteed%20that%20we%20have%20at%20least%20one%20query%20of%20type%20%5C%22%3F%5C%22.%20It%20is%20also%20guaranteed%20that%20one%20can%20get%20from%20any%20village%20to%20any%20other%20one%20by%20the%20given%20roads.%5Cn%5CnAt%20the%20initial%20moment%20of%20time%20no%20village%20is%20considered%20to%20exist.%22%2C%22outputFormat%22%3A%22For%20each%20query%20of%20type%20%5C%22%3F%5C%22%20print%20the%20total%20length%20of%20used%20roads%20on%20a%20single%20line.%20You%20should%20print%20the%20answers%20to%20the%20queries%20in%20the%20order%2C%20in%20which%20they%20are%20given%20in%20the%20input.%5Cn%5CnPlease%20do%20not%20use%20the%20%25lld%20specifier%20to%20read%20or%20write%2064-bit%20integers%20in%20%5Cu0421%2B%2B.%20It%20is%20preferred%20to%20use%20cin%2C%20cout%20streams%20or%20the%20%25I64d%20specifier.%22%2C%22samples%22%3A%5B%5B%226%5Cn1%202%201%5Cn1%203%205%5Cn4%201%207%5Cn4%205%203%5Cn6%204%202%5Cn10%5Cn%2B%203%5Cn%2B%201%5Cn%3F%5Cn%2B%206%5Cn%3F%5Cn%2B%205%5Cn%3F%5Cn-%206%5Cn-%203%5Cn%3F%5Cn%22%2C%225%5Cn14%5Cn17%5Cn10%5Cn%22%5D%5D%2C%22hint%22%3A%22%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B2000%5D%2C%22memory%22%3A%5B256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F176%5C%2FE%22%2C%22id%22%3A%22176E%22%7D%2C%22translation%22%3A%22%5Cu6709%5Cu4e00%5Cu68f5%20%24n%24%20%5Cu4e2a%5Cu70b9%5Cu7684%5Cu5e26%5Cu6743%5Cu6811%5Cuff0c%5Cu6bcf%5Cu4e2a%5Cu70b9%5Cu90fd%5Cu662f%5Cu9ed1%5Cu8272%5Cu6216%5Cu767d%5Cu8272%5Cuff0c%5Cu6700%5Cu521d%5Cu6240%5Cu6709%5Cu70b9%5Cu90fd%5Cu662f%5Cu767d%5Cu8272%5Cu7684%5Cu3002%5Cu6709%20%24q%24%20%5Cu4e2a%5Cu8be2%5Cu95ee%5Cuff1a%5Cr%5Cn%5Cr%5Cn-%20%5Cu628a%5Cu70b9%20%24x%24%20%5Cu4ece%5Cu767d%5Cu8272%5Cu53d8%5Cu6210%5Cu9ed1%5Cu8272%5Cu3002%5Cr%5Cn-%20%5Cu628a%5Cu70b9%20%24x%24%20%5Cu4ece%5Cu9ed1%5Cu8272%5Cu53d8%5Cu6210%5Cu767d%5Cu8272%5Cu3002%5Cr%5Cn-%20%5Cu67e5%5Cu8be2%5Cu9ed1%5Cu70b9%5Cu7684%5Cu5bfc%5Cu51fa%5Cu5b50%5Cu6811%20%24%28%24%5Cu7528%5Cu6700%5Cu5c11%5Cu7684%5Cu8fb9%5Cu628a%2A%2A%5Cu6240%5Cu6709%5Cu7684%2A%2A%5Cu9ed1%5Cu70b9%5Cu8fde%5Cu901a%5Cu8d77%5Cu6765%5Cu7684%5Cu6811%24%29%24%20%5Cu7684%5Cu603b%5Cu8fb9%5Cu6743%5Cu548c%5Cu3002%5Cr%5Cn%5Cr%5Cn%5Cu4fdd%5Cu8bc1%20%241%20%5C%5Cleq%20n%2C%20q%20%5C%5Cleq%2010%5E5%2C%201%20%5C%5Cleq%20x%20%5C%5Cleq%20n%24%5Cu3002%22%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Afalse%2C%22totalSubmit%22%3A45%2C%22totalAccepted%22%3A20%2C%22pid%22%3A%22CF176E%22%2C%22title%22%3A%22Archaeology%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Archaeology%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1573286098;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Archaeology</h1>
<h2>题意翻译</h2>
<div>有一棵 $n$ 个点的带权树，每个点都是黑色或白色，最初所有点都是白色的。有 $q$ 个询问：
- 把点 $x$ 从白色变成黑色。
- 把点 $x$ 从黑色变成白色。
- 查询黑点的导出子树 $($用最少的边把**所有的**黑点连通起来的树$)$ 的总边权和。
保证 $1 \leq n, q \leq 10^5, 1 \leq x \leq n$。</div>
<h2>题目描述</h2>
<div>This time you should help a team of researchers on an island in the Pacific Ocean. They research the culture of the ancient tribes that used to inhabit the island many years ago.
Overall they've dug out $ n $ villages. Some pairs of villages were connected by roads. People could go on the roads in both directions. Overall there were exactly $ n-1 $ roads, and from any village one could get to any other one.
The tribes were not peaceful and they had many wars. As a result of the wars, some villages were destroyed completely. During more peaceful years some of the villages were restored.
At each moment of time people used only those roads that belonged to some shortest way between two villages that existed at the given moment. In other words, people used the minimum subset of roads in such a way, that it was possible to get from any existing village to any other existing one. Note that throughout the island's whole history, there existed exactly $ n-1 $ roads that have been found by the researchers. There never were any other roads.
The researchers think that observing the total sum of used roads’ lengths at different moments of time can help to better understand the tribes' culture and answer several historical questions.
You will be given the full history of the tribes' existence. Your task is to determine the total length of used roads at some moments of time.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line contains an integer $ n $ ( $ 1<=n<=10^{5} $ ) — the number of villages. The next $ n-1 $ lines describe the roads. The $ i $ -th of these lines contains three integers $ a_{i} $ , $ b_{i} $ and $ c_{i} $ ( $ 1<=a_{i},b_{i}<=n $ , $ a_{i}≠b_{i} $ , $ 1<=c_{i}<=10^{9} $ , $ 1<=i&lt;n $ ) — the numbers of villages that are connected by the $ i $ -th road and the road's length. The numbers in the lines are separated by a space.
The next line contains an integer $ q $ ( $ 1<=q<=10^{5} $ ) — the number of queries. Then follow $ q $ queries, one per line, ordered by time. Each query belongs to one of three types:
- "+ $ x $ " — village number $ x $ is restored ( $ 1<=x<=n $ ).
- "- $ x $ " — village number $ x $ is destroyed ( $ 1<=x<=n $ ).
- "?" — the archaeologists want to know the total length of the roads which were used for that time period.
It is guaranteed that the queries do not contradict each other, that is, there won't be queries to destroy non-existing villages or restore the already existing ones. It is guaranteed that we have at least one query of type "?". It is also guaranteed that one can get from any village to any other one by the given roads.
At the initial moment of time no village is considered to exist.</div>
<h3>输出格式</h3>
<br />
<div>For each query of type "?" print the total length of used roads on a single line. You should print the answers to the queries in the order, in which they are given in the input.
Please do not use the %lld specifier to read or write 64-bit integers in С++. It is preferred to use cin, cout streams or the %I64d specifier.</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>6
1 2 1
1 3 5
4 1 7
4 5 3
6 4 2
10
+ 3
+ 1
?
+ 6
?
+ 5
?
- 6
- 3
?
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>5
14
17
10
</code></pre>
</article>
</div>
</div>
</body>
</html>
