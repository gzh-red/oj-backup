<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Constrained Tree - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573394934:Pi9kP8IPtcXteGywBei8/xIqmQdBBL5Kxjd1Bl78e/Q=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22You%20need%20to%20find%20a%20binary%20tree%20of%20size%20%24%20n%20%24%20that%20satisfies%20a%20given%20set%20of%20%24%20c%20%24%20constraints.%20Suppose%20that%20the%20nodes%20of%20the%20unknown%20binary%20tree%20are%20labeled%20using%20a%20pre-order%20traversal%20starting%20with%20%24%201%20%24%20.%20For%20the%20%24%20i%20%24%20-th%20constraint%20you%20are%20given%20two%20labels%2C%20%24%20a_%7Bi%7D%20%24%20and%20%24%20b_%7Bi%7D%20%24%20and%20a%20direction%2C%20left%20or%20right.%20In%20case%20of%20left%20direction%2C%20%24%20b_%7Bi%7D%20%24%20is%20an%20element%20of%20the%20subtree%20rooted%20at%20%24%20a_%7Bi%7D%20%24%20%27s%20left%20child.%20Similarly%20in%20the%20case%20of%20right%20direction%20%24%20b_%7Bi%7D%20%24%20is%20an%20element%20of%20the%20subtree%20rooted%20at%20%24%20a_%7Bi%7D%20%24%20%27s%20right%20child.%22%2C%22inputFormat%22%3A%22The%20first%20line%20of%20input%20contains%20two%20integers%20%24%20n%20%24%20and%20%24%20c%20%24%20.%20The%20next%20%24%20c%20%24%20lines%20contain%202%20integers%20%24%20a_%7Bi%7D%20%24%20%2C%20%24%20b_%7Bi%7D%20%24%20%28%20%24%201%3C%3Da_%7Bi%7D%2Cb_%7Bi%7D%3C%3Dn%20%24%20%29%20and%20either%20%5C%22LEFT%5C%22%20or%20%5C%22RIGHT%5C%22%20denoting%20whether%20%24%20b%20%24%20is%20in%20the%20subtree%20rooted%20at%20%24%20a_%7Bi%7D%20%24%20%27s%20left%20child%20or%20in%20the%20subtree%20rooted%20at%20%24%20a_%7Bi%7D%20%24%20%27s%20right%20child.%5Cn%5CnThe%20problem%20consists%20of%20multiple%20subproblems.%20The%20subproblems%20have%20different%20constraints%20on%20the%20input.%20You%20will%20get%20some%20score%20for%20the%20correct%20submission%20of%20the%20subproblem.%20The%20description%20of%20the%20subproblems%20follows.%5Cn%5Cn-%20In%20subproblem%20D1%20%28%20%24%209%20%24%20points%29%2C%20the%20constraints%20%24%201%3C%3Dn%3C%3D100%20%24%20%2C%20%24%201%3C%3Dc%3C%3D50%20%24%20will%20hold.%5Cn-%20In%20subproblem%20D2%20%28%20%24%208%20%24%20points%29%2C%20the%20constraints%20%24%201%3C%3Dn%3C%3D1000000%20%24%20%2C%20%24%201%3C%3Dc%3C%3D100000%20%24%20will%20hold.%22%2C%22outputFormat%22%3A%22Output%20will%20be%20on%20a%20single%20line.%5Cn%5CnAny%20binary%20tree%20that%20satisfies%20the%20constraints%20will%20be%20accepted.%20The%20tree%27s%20nodes%20should%20be%20printed%20out%20as%20%24%20n%20%24%20space%20separated%20labels%20representing%20an%20in-order%20traversal%2C%20using%20the%20pre-order%20numbers%20as%20labels%20of%20vertices.%5Cn%5CnIf%20there%20are%20no%20trees%20that%20satisfy%20the%20constraints%2C%20print%20%5C%22IMPOSSIBLE%5C%22%20%28without%20quotes%29.%22%2C%22samples%22%3A%5B%5B%223%202%5Cn1%202%20LEFT%5Cn1%203%20RIGHT%5Cn%22%2C%222%201%203%5Cn%22%5D%2C%5B%223%202%5Cn1%202%20RIGHT%5Cn1%203%20LEFT%5Cn%22%2C%22IMPOSSIBLE%5Cn%22%5D%5D%2C%22hint%22%3A%22Consider%20the%20first%20sample%20test.%20We%20need%20to%20find%20a%20tree%20with%203%20nodes%20that%20satisfies%20the%20following%20two%20constraints.%20The%20node%20labeled%202%20with%20pre-order%20traversal%20should%20be%20in%20the%20left%20subtree%20of%20the%20node%20labeled%201%20with%20pre-order%20traversal%3B%20the%20node%20labeled%203%20with%20pre-order%20traversal%20should%20be%20in%20the%20right%20subtree%20of%20the%20node%20labeled%201.%20There%20is%20only%20one%20tree%20with%20three%20nodes%20that%20satisfies%20these%20constraints%20and%20its%20in-order%20traversal%20is%20%24%20%282%2C1%2C3%29%20%24%20.%5Cn%5CnPre-order%20is%20the%20%5C%22root%20%5Cu2013%20left%20subtree%20%5Cu2013%20right%20subtree%5C%22%20order.%20In-order%20is%20the%20%5C%22left%20subtree%20%5Cu2013%20root%20%5Cu2013%20right%20subtree%5C%22%20order.%5Cn%5CnFor%20other%20information%20regarding%20in-order%20and%20pre-order%2C%20see%20%5Bhttp%3A%5C%2F%5C%2Fen.wikipedia.org%5C%2Fwiki%5C%2FTree%5C%5C_traversal%5D%28http%3A%5C%2F%5C%2Fen.wikipedia.org%5C%2Fwiki%5C%2FTree_traversal%29.%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B2000%5D%2C%22memory%22%3A%5B256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F513%5C%2FD2%22%2C%22id%22%3A%22513D2%22%7D%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Atrue%2C%22totalSubmit%22%3A0%2C%22totalAccepted%22%3A0%2C%22pid%22%3A%22CF513D2%22%2C%22title%22%3A%22Constrained%20Tree%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Constrained%20Tree%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1573306449;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Constrained Tree</h1>
<h2>题目描述</h2>
<div>You need to find a binary tree of size $ n $ that satisfies a given set of $ c $ constraints. Suppose that the nodes of the unknown binary tree are labeled using a pre-order traversal starting with $ 1 $ . For the $ i $ -th constraint you are given two labels, $ a_{i} $ and $ b_{i} $ and a direction, left or right. In case of left direction, $ b_{i} $ is an element of the subtree rooted at $ a_{i} $ 's left child. Similarly in the case of right direction $ b_{i} $ is an element of the subtree rooted at $ a_{i} $ 's right child.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line of input contains two integers $ n $ and $ c $ . The next $ c $ lines contain 2 integers $ a_{i} $ , $ b_{i} $ ( $ 1<=a_{i},b_{i}<=n $ ) and either "LEFT" or "RIGHT" denoting whether $ b $ is in the subtree rooted at $ a_{i} $ 's left child or in the subtree rooted at $ a_{i} $ 's right child.
The problem consists of multiple subproblems. The subproblems have different constraints on the input. You will get some score for the correct submission of the subproblem. The description of the subproblems follows.
- In subproblem D1 ( $ 9 $ points), the constraints $ 1<=n<=100 $ , $ 1<=c<=50 $ will hold.
- In subproblem D2 ( $ 8 $ points), the constraints $ 1<=n<=1000000 $ , $ 1<=c<=100000 $ will hold.</div>
<h3>输出格式</h3>
<br />
<div>Output will be on a single line.
Any binary tree that satisfies the constraints will be accepted. The tree's nodes should be printed out as $ n $ space separated labels representing an in-order traversal, using the pre-order numbers as labels of vertices.
If there are no trees that satisfy the constraints, print "IMPOSSIBLE" (without quotes).</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>3 2
1 2 LEFT
1 3 RIGHT
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>2 1 3
</code></pre>
<h3>输入样例 #2</h3>
<pre><code>3 2
1 2 RIGHT
1 3 LEFT
</code></pre>
<h3>输出样例 #2</h3>
<pre><code>IMPOSSIBLE
</code></pre>
<h2>说明</h2>
<div>Consider the first sample test. We need to find a tree with 3 nodes that satisfies the following two constraints. The node labeled 2 with pre-order traversal should be in the left subtree of the node labeled 1 with pre-order traversal; the node labeled 3 with pre-order traversal should be in the right subtree of the node labeled 1. There is only one tree with three nodes that satisfies these constraints and its in-order traversal is $ (2,1,3) $ .
Pre-order is the "root – left subtree – right subtree" order. In-order is the "left subtree – root – right subtree" order.
For other information regarding in-order and pre-order, see [http://en.wikipedia.org/wiki/Tree\_traversal](http://en.wikipedia.org/wiki/Tree_traversal).</div>
</article>
</div>
</div>
</body>
</html>
