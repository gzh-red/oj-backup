<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Game with Two Trees - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573391713:fbwOEDXH7Fc18g0S20+fEHOVfEYYKT2W4XEXR4myDiA=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22The%20Smart%20Beaver%20from%20ABBYY%20has%20come%20up%20with%20a%20new%20developing%20game%20for%20children.%20The%20Beaver%20thinks%20that%20this%20game%20will%20help%20children%20to%20understand%20programming%20better.%5Cn%5CnThe%20main%20object%20of%20the%20game%20is%20finite%20rooted%20trees%2C%20each%20of%20their%20edges%20contains%20some%20lowercase%20English%20letter.%20Vertices%20on%20any%20tree%20are%20always%20numbered%20sequentially%20from%20%24%201%20%24%20to%20%24%20m%20%24%20%2C%20where%20%24%20m%20%24%20is%20the%20number%20of%20vertices%20in%20the%20tree.%20Before%20describing%20the%20actual%20game%2C%20let%27s%20introduce%20some%20definitions.%5Cn%5CnWe%27ll%20assume%20that%20the%20sequence%20of%20vertices%20with%20numbers%20%24%20v_%7B1%7D%20%24%20%2C%20%24%20v_%7B2%7D%20%24%20%2C%20%24%20...%20%24%20%2C%20%24%20v_%7Bk%7D%20%24%20%28%20%24%20k%3E%3D1%20%24%20%29%20is%20a%20forward%20path%2C%20if%20for%20any%20integer%20%24%20i%20%24%20from%20%24%201%20%24%20to%20%24%20k-1%20%24%20vertex%20%24%20v_%7Bi%7D%20%24%20is%20a%20direct%20ancestor%20of%20vertex%20%24%20v_%7Bi%2B1%7D%20%24%20.%20If%20we%20sequentially%20write%20out%20all%20letters%20from%20the%20the%20edges%20of%20the%20given%20path%20from%20%24%20v_%7B1%7D%20%24%20to%20%24%20v_%7Bk%7D%20%24%20%2C%20we%20get%20some%20string%20%28%20%24%20k%3D1%20%24%20gives%20us%20an%20empty%20string%29.%20We%27ll%20say%20that%20such%20string%20corresponds%20to%20forward%20path%20%24%20v_%7B1%7D%20%24%20%2C%20%24%20v_%7B2%7D%20%24%20%2C%20%24%20...%20%24%20%2C%20%24%20v_%7Bk%7D%20%24%20.%5Cn%5CnWe%27ll%20assume%20that%20the%20sequence%20of%20tree%20vertices%20with%20numbers%20%24%20v_%7B1%7D%20%24%20%2C%20%24%20v_%7B2%7D%20%24%20%2C%20%24%20...%20%24%20%2C%20%24%20v_%7Bk%7D%20%24%20%28%20%24%20k%3E%3D1%20%24%20%29%20is%20a%20backward%20path%20if%20for%20any%20integer%20%24%20i%20%24%20from%20%24%201%20%24%20to%20%24%20k-1%20%24%20vertex%20%24%20v_%7Bi%7D%20%24%20is%20the%20direct%20descendant%20of%20vertex%20%24%20v_%7Bi%2B1%7D%20%24%20.%20If%20we%20sequentially%20write%20out%20all%20the%20letters%20from%20the%20edges%20of%20the%20given%20path%20from%20%24%20v_%7B1%7D%20%24%20to%20%24%20v_%7Bk%7D%20%24%20%2C%20we%20get%20some%20string%20%28%20%24%20k%3D1%20%24%20gives%20us%20an%20empty%20string%29.%20We%27ll%20say%20that%20such%20string%20corresponds%20to%20backward%20path%20%24%20v_%7B1%7D%20%24%20%2C%20%24%20v_%7B2%7D%20%24%20%2C%20%24%20...%20%24%20%2C%20%24%20v_%7Bk%7D%20%24%20.%5Cn%5CnNow%20let%27s%20describe%20the%20game%20that%20the%20Smart%20Beaver%20from%20ABBYY%20has%20come%20up%20with.%20The%20game%20uses%20two%20rooted%20trees%2C%20each%20of%20which%20initially%20consists%20of%20one%20vertex%20with%20number%20%24%201%20%24%20.%20The%20player%20is%20given%20some%20sequence%20of%20operations.%20Each%20operation%20is%20characterized%20by%20three%20values%20%28%20%24%20t%20%24%20%2C%20%24%20v%20%24%20%2C%20%24%20c%20%24%20%29%20where%3A%5Cn%5Cn-%20%24%20t%20%24%20is%20the%20number%20of%20the%20tree%20on%20which%20the%20operation%20is%20executed%20%28%20%24%201%20%24%20or%20%24%202%20%24%20%29%3B%5Cn-%20%24%20v%20%24%20is%20the%20vertex%20index%20in%20this%20tree%20%28it%20is%20guaranteed%20that%20the%20tree%20contains%20a%20vertex%20with%20this%20index%29%3B%5Cn-%20%24%20c%20%24%20is%20a%20lowercase%20English%20letter.%5Cn%5CnThe%20actual%20operation%20is%20as%20follows%3A%20vertex%20%24%20v%20%24%20of%20tree%20%24%20t%20%24%20gets%20a%20new%20descendant%20with%20number%20%24%20m%2B1%20%24%20%28where%20%24%20m%20%24%20is%20the%20current%20number%20of%20vertices%20in%20tree%20%24%20t%20%24%20%29%2C%20and%20there%20should%20be%20letter%20%24%20c%20%24%20put%20on%20the%20new%20edge%20from%20vertex%20%24%20v%20%24%20to%20vertex%20%24%20m%2B1%20%24%20.%5Cn%5CnWe%27ll%20say%20that%20an%20ordered%20group%20of%20three%20integers%20%28%20%24%20i%20%24%20%2C%20%24%20j%20%24%20%2C%20%24%20q%20%24%20%29%20is%20a%20good%20combination%20if%3A%5Cn%5Cn-%20%24%201%3C%3Di%3C%3Dm_%7B1%7D%20%24%20%2C%20where%20%24%20m_%7B1%7D%20%24%20is%20the%20number%20of%20vertices%20in%20the%20first%20tree%3B%5Cn-%20%24%201%3C%3Dj%2Cq%3C%3Dm_%7B2%7D%20%24%20%2C%20where%20%24%20m_%7B2%7D%20%24%20is%20the%20number%20of%20vertices%20in%20the%20second%20tree%3B%5Cn-%20there%20exists%20a%20forward%20path%20%24%20v_%7B1%7D%20%24%20%2C%20%24%20v_%7B2%7D%20%24%20%2C%20%24%20...%20%24%20%2C%20%24%20v_%7Bk%7D%20%24%20such%20that%20%24%20v_%7B1%7D%3Dj%20%24%20and%20%24%20v_%7Bk%7D%3Dq%20%24%20in%20the%20second%20tree%3B%5Cn-%20the%20string%20that%20corresponds%20to%20the%20forward%20path%20in%20the%20second%20tree%20from%20vertex%20%24%20j%20%24%20to%20vertex%20%24%20q%20%24%20equals%20the%20string%20that%20corresponds%20to%20the%20backward%20path%20in%20the%20first%20tree%20from%20vertex%20%24%20i%20%24%20to%20vertex%20%24%201%20%24%20%28note%20that%20both%20paths%20are%20determined%20uniquely%29.%5Cn%5CnYour%20task%20is%20to%20calculate%20the%20number%20of%20existing%20good%20combinations%20after%20each%20operation%20on%20the%20trees.%22%2C%22inputFormat%22%3A%22The%20first%20line%20contains%20integer%20%24%20n%20%24%20%5Cu2014%20the%20number%20of%20operations%20on%20the%20trees.%20Next%20%24%20n%20%24%20lines%20specify%20the%20operations%20in%20the%20order%20of%20their%20execution.%20Each%20line%20has%20form%20%5C%22%20%24%20t%20%24%20%24%20v%20%24%20%24%20c%20%24%20%5C%22%2C%20where%20%24%20t%20%24%20is%20the%20number%20of%20the%20tree%2C%20%24%20v%20%24%20is%20the%20vertex%20index%20in%20this%20tree%2C%20and%20%24%20c%20%24%20is%20a%20lowercase%20English%20letter.%5Cn%5CnTo%20get%20the%20full%20points%20for%20the%20first%20group%20of%20tests%20it%20is%20sufficient%20to%20solve%20the%20problem%20with%20%24%201%3C%3Dn%3C%3D700%20%24%20.%5Cn%5CnTo%20get%20the%20full%20points%20for%20the%20second%20group%20of%20tests%20it%20is%20sufficient%20to%20solve%20the%20problem%20with%20%24%201%3C%3Dn%3C%3D7000%20%24%20.%5Cn%5CnTo%20get%20the%20full%20points%20for%20the%20third%20group%20of%20tests%20it%20is%20sufficient%20to%20solve%20the%20problem%20with%20%24%201%3C%3Dn%3C%3D100000%20%24%20.%22%2C%22outputFormat%22%3A%22Print%20exactly%20%24%20n%20%24%20lines%2C%20each%20containing%20one%20integer%20%5Cu2014%20the%20number%20of%20existing%20good%20combinations%20after%20the%20corresponding%20operation%20from%20the%20input.%5Cn%5CnPlease%2C%20do%20not%20use%20the%20%25lld%20specifier%20to%20read%20or%20write%2064-bit%20integers%20in%20%5Cu0421%2B%2B.%20It%20is%20preferred%20to%20use%20the%20cin%2C%20cout%20streams%20or%20the%20%25I64d%20specifier.%22%2C%22samples%22%3A%5B%5B%225%5Cn1%201%20a%5Cn2%201%20a%5Cn1%202%20b%5Cn2%201%20b%5Cn2%203%20a%5Cn%22%2C%221%5Cn3%5Cn3%5Cn4%5Cn7%5Cn%22%5D%5D%2C%22hint%22%3A%22After%20the%20first%20operation%20the%20only%20good%20combination%20was%20%24%20%281%2C1%2C1%29%20%24%20.%20After%20the%20second%20operation%20new%20good%20combinations%20appeared%2C%20%24%20%282%2C1%2C2%29%20%24%20and%20%24%20%281%2C2%2C2%29%20%24%20.%20The%20third%20operation%20didn%27t%20bring%20any%20good%20combinations.%20The%20fourth%20operation%20added%20good%20combination%20%24%20%281%2C3%2C3%29%20%24%20.%20Finally%2C%20the%20fifth%20operation%20resulted%20in%20as%20much%20as%20three%20new%20good%20combinations%20%5Cu2014%20%24%20%281%2C4%2C4%29%20%24%20%2C%20%24%20%282%2C3%2C4%29%20%24%20and%20%24%20%283%2C1%2C4%29%20%24%20.%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B1000%5D%2C%22memory%22%3A%5B256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F207%5C%2FC2%22%2C%22id%22%3A%22207C2%22%7D%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Atrue%2C%22totalSubmit%22%3A0%2C%22totalAccepted%22%3A0%2C%22pid%22%3A%22CF207C2%22%2C%22title%22%3A%22Game%20with%20Two%20Trees%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Game%20with%20Two%20Trees%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1573286098;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Game with Two Trees</h1>
<h2>题目描述</h2>
<div>The Smart Beaver from ABBYY has come up with a new developing game for children. The Beaver thinks that this game will help children to understand programming better.
The main object of the game is finite rooted trees, each of their edges contains some lowercase English letter. Vertices on any tree are always numbered sequentially from $ 1 $ to $ m $ , where $ m $ is the number of vertices in the tree. Before describing the actual game, let's introduce some definitions.
We'll assume that the sequence of vertices with numbers $ v_{1} $ , $ v_{2} $ , $ ... $ , $ v_{k} $ ( $ k>=1 $ ) is a forward path, if for any integer $ i $ from $ 1 $ to $ k-1 $ vertex $ v_{i} $ is a direct ancestor of vertex $ v_{i+1} $ . If we sequentially write out all letters from the the edges of the given path from $ v_{1} $ to $ v_{k} $ , we get some string ( $ k=1 $ gives us an empty string). We'll say that such string corresponds to forward path $ v_{1} $ , $ v_{2} $ , $ ... $ , $ v_{k} $ .
We'll assume that the sequence of tree vertices with numbers $ v_{1} $ , $ v_{2} $ , $ ... $ , $ v_{k} $ ( $ k>=1 $ ) is a backward path if for any integer $ i $ from $ 1 $ to $ k-1 $ vertex $ v_{i} $ is the direct descendant of vertex $ v_{i+1} $ . If we sequentially write out all the letters from the edges of the given path from $ v_{1} $ to $ v_{k} $ , we get some string ( $ k=1 $ gives us an empty string). We'll say that such string corresponds to backward path $ v_{1} $ , $ v_{2} $ , $ ... $ , $ v_{k} $ .
Now let's describe the game that the Smart Beaver from ABBYY has come up with. The game uses two rooted trees, each of which initially consists of one vertex with number $ 1 $ . The player is given some sequence of operations. Each operation is characterized by three values ( $ t $ , $ v $ , $ c $ ) where:
- $ t $ is the number of the tree on which the operation is executed ( $ 1 $ or $ 2 $ );
- $ v $ is the vertex index in this tree (it is guaranteed that the tree contains a vertex with this index);
- $ c $ is a lowercase English letter.
The actual operation is as follows: vertex $ v $ of tree $ t $ gets a new descendant with number $ m+1 $ (where $ m $ is the current number of vertices in tree $ t $ ), and there should be letter $ c $ put on the new edge from vertex $ v $ to vertex $ m+1 $ .
We'll say that an ordered group of three integers ( $ i $ , $ j $ , $ q $ ) is a good combination if:
- $ 1<=i<=m_{1} $ , where $ m_{1} $ is the number of vertices in the first tree;
- $ 1<=j,q<=m_{2} $ , where $ m_{2} $ is the number of vertices in the second tree;
- there exists a forward path $ v_{1} $ , $ v_{2} $ , $ ... $ , $ v_{k} $ such that $ v_{1}=j $ and $ v_{k}=q $ in the second tree;
- the string that corresponds to the forward path in the second tree from vertex $ j $ to vertex $ q $ equals the string that corresponds to the backward path in the first tree from vertex $ i $ to vertex $ 1 $ (note that both paths are determined uniquely).
Your task is to calculate the number of existing good combinations after each operation on the trees.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line contains integer $ n $ — the number of operations on the trees. Next $ n $ lines specify the operations in the order of their execution. Each line has form " $ t $ $ v $ $ c $ ", where $ t $ is the number of the tree, $ v $ is the vertex index in this tree, and $ c $ is a lowercase English letter.
To get the full points for the first group of tests it is sufficient to solve the problem with $ 1<=n<=700 $ .
To get the full points for the second group of tests it is sufficient to solve the problem with $ 1<=n<=7000 $ .
To get the full points for the third group of tests it is sufficient to solve the problem with $ 1<=n<=100000 $ .</div>
<h3>输出格式</h3>
<br />
<div>Print exactly $ n $ lines, each containing one integer — the number of existing good combinations after the corresponding operation from the input.
Please, do not use the %lld specifier to read or write 64-bit integers in С++. It is preferred to use the cin, cout streams or the %I64d specifier.</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>5
1 1 a
2 1 a
1 2 b
2 1 b
2 3 a
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>1
3
3
4
7
</code></pre>
<h2>说明</h2>
<div>After the first operation the only good combination was $ (1,1,1) $ . After the second operation new good combinations appeared, $ (2,1,2) $ and $ (1,2,2) $ . The third operation didn't bring any good combinations. The fourth operation added good combination $ (1,3,3) $ . Finally, the fifth operation resulted in as much as three new good combinations — $ (1,4,4) $ , $ (2,3,4) $ and $ (3,1,4) $ .</div>
</article>
</div>
</div>
</body>
</html>
