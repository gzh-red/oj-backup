<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Random Function and Tree - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573394559:tBMkNYY60cFg5/bWGDQUlQEvgHpQEcNJkrnBzVzI69g=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22You%20have%20a%20rooted%20tree%20consisting%20of%20%24%20n%20%24%20vertices.%20Let%27s%20number%20them%20with%20integers%20from%20%24%201%20%24%20to%20%24%20n%20%24%20inclusive.%20The%20root%20of%20the%20tree%20is%20the%20vertex%20%24%201%20%24%20.%20For%20each%20%24%20i%3E1%20%24%20direct%20parent%20of%20the%20vertex%20%24%20i%20%24%20is%20%24%20p_%7Bi%7D%20%24%20.%20We%20say%20that%20vertex%20%24%20i%20%24%20is%20child%20for%20its%20direct%20parent%20%24%20p_%7Bi%7D%20%24%20.%5Cn%5CnYou%20have%20initially%20painted%20all%20the%20vertices%20with%20red%20color.%20You%20like%20to%20repaint%20some%20vertices%20of%20the%20tree.%20To%20perform%20painting%20you%20use%20the%20function%20paint%20that%20you%20call%20with%20the%20root%20of%20the%20tree%20as%20an%20argument.%20Here%20is%20the%20pseudocode%20of%20this%20function%3A%5Cn%5Cn%60%3Cbr%3E%3C%5C%2Fbr%3Ecount%20%3D%200%20%5C%2F%5C%2F%20global%20integer%20variable%20%3Cbr%3E%3C%5C%2Fbr%3E%3Cbr%3E%3C%5C%2Fbr%3Ernd%28%29%20%7B%20%5C%2F%5C%2F%20this%20function%20is%20used%20in%20paint%20code%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20return%200%20or%201%20equiprobably%3Cbr%3E%3C%5C%2Fbr%3E%7D%3Cbr%3E%3C%5C%2Fbr%3E%3Cbr%3E%3C%5C%2Fbr%3Epaint%28s%29%20%7B%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20if%20%28count%20is%20even%29%20then%20paint%20s%20with%20white%20color%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20else%20paint%20s%20with%20black%20color%3Cbr%3E%3C%5C%2Fbr%3E%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20count%20%3D%20count%20%2B%201%3Cbr%3E%3C%5C%2Fbr%3E%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20if%20rnd%28%29%20%3D%201%20then%20children%20%3D%20%5Barray%20of%20vertex%20s%20children%20in%20ascending%20order%20of%20their%20numbers%5D%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20else%20children%20%3D%20%5Barray%20of%20vertex%20s%20children%20in%20descending%20order%20of%20their%20numbers%5D%3Cbr%3E%3C%5C%2Fbr%3E%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20for%20child%20in%20children%20%7B%20%5C%2F%5C%2F%20iterating%20over%20children%20array%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20%20%20%20if%20rnd%28%29%20%3D%201%20then%20paint%28child%29%20%5C%2F%5C%2F%20calling%20paint%20recursively%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%7D%3Cbr%3E%3C%5C%2Fbr%3E%7D%3Cbr%3E%3C%5C%2Fbr%3E%60As%20a%20result%20of%20this%20function%2C%20some%20vertices%20may%20change%20their%20colors%20to%20white%20or%20black%20and%20some%20of%20them%20may%20remain%20red.%5Cn%5CnYour%20task%20is%20to%20determine%20the%20number%20of%20distinct%20possible%20colorings%20of%20the%20vertices%20of%20the%20tree.%20We%20will%20assume%20that%20the%20coloring%20is%20possible%20if%20there%20is%20a%20nonzero%20probability%20to%20get%20this%20coloring%20with%20a%20single%20call%20of%20%24%20paint%281%29%20%24%20.%20We%20assume%20that%20the%20colorings%20are%20different%20if%20there%20is%20a%20pair%20of%20vertices%20that%20are%20painted%20with%20different%20colors%20in%20these%20colorings.%20Since%20the%20required%20number%20may%20be%20very%20large%2C%20find%20its%20remainder%20of%20division%20by%20%24%201000000007%20%24%20%28%20%24%2010%5E%7B9%7D%2B7%20%24%20%29.%22%2C%22inputFormat%22%3A%22You%20have%20a%20rooted%20tree%20consisting%20of%20%24%20n%20%24%20vertices.%20Let%27s%20number%20them%20with%20integers%20from%20%24%201%20%24%20to%20%24%20n%20%24%20inclusive.%20The%20root%20of%20the%20tree%20is%20the%20vertex%20%24%201%20%24%20.%20For%20each%20%24%20i%3E1%20%24%20direct%20parent%20of%20the%20vertex%20%24%20i%20%24%20is%20%24%20p_%7Bi%7D%20%24%20.%20We%20say%20that%20vertex%20%24%20i%20%24%20is%20child%20for%20its%20direct%20parent%20%24%20p_%7Bi%7D%20%24%20.%5Cn%5CnYou%20have%20initially%20painted%20all%20the%20vertices%20with%20red%20color.%20You%20like%20to%20repaint%20some%20vertices%20of%20the%20tree.%20To%20perform%20painting%20you%20use%20the%20function%20paint%20that%20you%20call%20with%20the%20root%20of%20the%20tree%20as%20an%20argument.%20Here%20is%20the%20pseudocode%20of%20this%20function%3A%5Cn%5Cn%60%3Cbr%3E%3C%5C%2Fbr%3Ecount%20%3D%200%20%5C%2F%5C%2F%20global%20integer%20variable%20%3Cbr%3E%3C%5C%2Fbr%3E%3Cbr%3E%3C%5C%2Fbr%3Ernd%28%29%20%7B%20%5C%2F%5C%2F%20this%20function%20is%20used%20in%20paint%20code%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20return%200%20or%201%20equiprobably%3Cbr%3E%3C%5C%2Fbr%3E%7D%3Cbr%3E%3C%5C%2Fbr%3E%3Cbr%3E%3C%5C%2Fbr%3Epaint%28s%29%20%7B%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20if%20%28count%20is%20even%29%20then%20paint%20s%20with%20white%20color%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20else%20paint%20s%20with%20black%20color%3Cbr%3E%3C%5C%2Fbr%3E%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20count%20%3D%20count%20%2B%201%3Cbr%3E%3C%5C%2Fbr%3E%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20if%20rnd%28%29%20%3D%201%20then%20children%20%3D%20%5Barray%20of%20vertex%20s%20children%20in%20ascending%20order%20of%20their%20numbers%5D%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20else%20children%20%3D%20%5Barray%20of%20vertex%20s%20children%20in%20descending%20order%20of%20their%20numbers%5D%3Cbr%3E%3C%5C%2Fbr%3E%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20for%20child%20in%20children%20%7B%20%5C%2F%5C%2F%20iterating%20over%20children%20array%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20%20%20%20if%20rnd%28%29%20%3D%201%20then%20paint%28child%29%20%5C%2F%5C%2F%20calling%20paint%20recursively%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%7D%3Cbr%3E%3C%5C%2Fbr%3E%7D%3Cbr%3E%3C%5C%2Fbr%3E%60As%20a%20result%20of%20this%20function%2C%20some%20vertices%20may%20change%20their%20colors%20to%20white%20or%20black%20and%20some%20of%20them%20may%20remain%20red.%5Cn%5CnYour%20task%20is%20to%20determine%20the%20number%20of%20distinct%20possible%20colorings%20of%20the%20vertices%20of%20the%20tree.%20We%20will%20assume%20that%20the%20coloring%20is%20possible%20if%20there%20is%20a%20nonzero%20probability%20to%20get%20this%20coloring%20with%20a%20single%20call%20of%20%24%20paint%281%29%20%24%20.%20We%20assume%20that%20the%20colorings%20are%20different%20if%20there%20is%20a%20pair%20of%20vertices%20that%20are%20painted%20with%20different%20colors%20in%20these%20colorings.%20Since%20the%20required%20number%20may%20be%20very%20large%2C%20find%20its%20remainder%20of%20division%20by%20%24%201000000007%20%24%20%28%20%24%2010%5E%7B9%7D%2B7%20%24%20%29.%22%2C%22outputFormat%22%3A%22Print%20a%20single%20integer%20%5Cu2014%20the%20answer%20to%20the%20problem%20modulo%20%24%201000000007%20%24%20%28%20%24%2010%5E%7B9%7D%2B7%20%24%20%29%22%2C%22samples%22%3A%5B%5B%224%5Cn1%202%201%5Cn%22%2C%228%5Cn%22%5D%2C%5B%223%5Cn1%201%5Cn%22%2C%225%5Cn%22%5D%5D%2C%22hint%22%3A%22All%20possible%20coloring%20patterns%20of%20the%20first%20sample%20are%20given%20below.%5Cn%5Cn%20%21%5B%5D%28https%3A%5C%2F%5C%2Fcdn.luogu.com.cn%5C%2Fupload%5C%2Fvjudge_pic%5C%2FCF482D%5C%2F19d967abe6f79007d166ea0e6fd74474e906140d.png%29%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B1000%5D%2C%22memory%22%3A%5B256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F482%5C%2FD%22%2C%22id%22%3A%22482D%22%7D%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Atrue%2C%22totalSubmit%22%3A2%2C%22totalAccepted%22%3A2%2C%22pid%22%3A%22CF482D%22%2C%22title%22%3A%22Random%20Function%20and%20Tree%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Random%20Function%20and%20Tree%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1573306449;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Random Function and Tree</h1>
<h2>题目描述</h2>
<div>You have a rooted tree consisting of $ n $ vertices. Let's number them with integers from $ 1 $ to $ n $ inclusive. The root of the tree is the vertex $ 1 $ . For each $ i>1 $ direct parent of the vertex $ i $ is $ p_{i} $ . We say that vertex $ i $ is child for its direct parent $ p_{i} $ .
You have initially painted all the vertices with red color. You like to repaint some vertices of the tree. To perform painting you use the function paint that you call with the root of the tree as an argument. Here is the pseudocode of this function:
`<br></br>count = 0 // global integer variable <br></br><br></br>rnd() { // this function is used in paint code<br></br> return 0 or 1 equiprobably<br></br>}<br></br><br></br>paint(s) {<br></br> if (count is even) then paint s with white color<br></br> else paint s with black color<br></br><br></br> count = count + 1<br></br><br></br> if rnd() = 1 then children = [array of vertex s children in ascending order of their numbers]<br></br> else children = [array of vertex s children in descending order of their numbers]<br></br><br></br> for child in children { // iterating over children array<br></br> if rnd() = 1 then paint(child) // calling paint recursively<br></br> }<br></br>}<br></br>`As a result of this function, some vertices may change their colors to white or black and some of them may remain red.
Your task is to determine the number of distinct possible colorings of the vertices of the tree. We will assume that the coloring is possible if there is a nonzero probability to get this coloring with a single call of $ paint(1) $ . We assume that the colorings are different if there is a pair of vertices that are painted with different colors in these colorings. Since the required number may be very large, find its remainder of division by $ 1000000007 $ ( $ 10^{9}+7 $ ).</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>You have a rooted tree consisting of $ n $ vertices. Let's number them with integers from $ 1 $ to $ n $ inclusive. The root of the tree is the vertex $ 1 $ . For each $ i>1 $ direct parent of the vertex $ i $ is $ p_{i} $ . We say that vertex $ i $ is child for its direct parent $ p_{i} $ .
You have initially painted all the vertices with red color. You like to repaint some vertices of the tree. To perform painting you use the function paint that you call with the root of the tree as an argument. Here is the pseudocode of this function:
`<br></br>count = 0 // global integer variable <br></br><br></br>rnd() { // this function is used in paint code<br></br> return 0 or 1 equiprobably<br></br>}<br></br><br></br>paint(s) {<br></br> if (count is even) then paint s with white color<br></br> else paint s with black color<br></br><br></br> count = count + 1<br></br><br></br> if rnd() = 1 then children = [array of vertex s children in ascending order of their numbers]<br></br> else children = [array of vertex s children in descending order of their numbers]<br></br><br></br> for child in children { // iterating over children array<br></br> if rnd() = 1 then paint(child) // calling paint recursively<br></br> }<br></br>}<br></br>`As a result of this function, some vertices may change their colors to white or black and some of them may remain red.
Your task is to determine the number of distinct possible colorings of the vertices of the tree. We will assume that the coloring is possible if there is a nonzero probability to get this coloring with a single call of $ paint(1) $ . We assume that the colorings are different if there is a pair of vertices that are painted with different colors in these colorings. Since the required number may be very large, find its remainder of division by $ 1000000007 $ ( $ 10^{9}+7 $ ).</div>
<h3>输出格式</h3>
<br />
<div>Print a single integer — the answer to the problem modulo $ 1000000007 $ ( $ 10^{9}+7 $ )</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>4
1 2 1
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>8
</code></pre>
<h3>输入样例 #2</h3>
<pre><code>3
1 1
</code></pre>
<h3>输出样例 #2</h3>
<pre><code>5
</code></pre>
<h2>说明</h2>
<div>All possible coloring patterns of the first sample are given below.
![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF482D/19d967abe6f79007d166ea0e6fd74474e906140d.png)</div>
</article>
</div>
</div>
</body>
</html>
