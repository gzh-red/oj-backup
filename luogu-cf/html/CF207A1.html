<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Beaver&#039;s Calculator 1.0 - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573391701:Cx44q8I48EjimerV48O5yAeeA91JawZwXFR9o/grYo8=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22The%20Smart%20Beaver%20from%20ABBYY%20has%20once%20again%20surprised%20us%21%20He%20has%20developed%20a%20new%20calculating%20device%2C%20which%20he%20called%20the%20%5C%22Beaver%27s%20Calculator%20%24%201.0%20%24%20%5C%22.%20It%20is%20very%20peculiar%20and%20it%20is%20planned%20to%20be%20used%20in%20a%20variety%20of%20scientific%20problems.%5Cn%5CnTo%20test%20it%2C%20the%20Smart%20Beaver%20invited%20%24%20n%20%24%20scientists%2C%20numbered%20from%20%24%201%20%24%20to%20%24%20n%20%24%20.%20The%20%24%20i%20%24%20-th%20scientist%20brought%20%24%20k_%7Bi%7D%20%24%20calculating%20problems%20for%20the%20device%20developed%20by%20the%20Smart%20Beaver%20from%20ABBYY.%20The%20problems%20of%20the%20%24%20i%20%24%20-th%20scientist%20are%20numbered%20from%20%24%201%20%24%20to%20%24%20k_%7Bi%7D%20%24%20%2C%20and%20they%20must%20be%20calculated%20sequentially%20in%20the%20described%20order%2C%20since%20calculating%20each%20problem%20heavily%20depends%20on%20the%20results%20of%20calculating%20of%20the%20previous%20ones.%5Cn%5CnEach%20problem%20of%20each%20of%20the%20%24%20n%20%24%20scientists%20is%20described%20by%20one%20integer%20%24%20a_%7Bi%2Cj%7D%20%24%20%2C%20where%20%24%20i%20%24%20%28%20%24%201%3C%3Di%3C%3Dn%20%24%20%29%20is%20the%20number%20of%20the%20scientist%2C%20%24%20j%20%24%20%28%20%24%201%3C%3Dj%3C%3Dk_%7Bi%7D%20%24%20%29%20is%20the%20number%20of%20the%20problem%2C%20and%20%24%20a_%7Bi%2Cj%7D%20%24%20is%20the%20number%20of%20resource%20units%20the%20calculating%20device%20needs%20to%20solve%20this%20problem.%5Cn%5CnThe%20calculating%20device%20that%20is%20developed%20by%20the%20Smart%20Beaver%20is%20pretty%20unusual.%20It%20solves%20problems%20sequentially%2C%20one%20after%20another.%20After%20some%20problem%20is%20solved%20and%20before%20the%20next%20one%20is%20considered%2C%20the%20calculating%20device%20allocates%20or%20frees%20resources.%5Cn%5CnThe%20most%20expensive%20operation%20for%20the%20calculating%20device%20is%20freeing%20resources%2C%20which%20works%20much%20slower%20than%20allocating%20them.%20It%20is%20therefore%20desirable%20that%20each%20next%20problem%20for%20the%20calculating%20device%20requires%20no%20less%20resources%20than%20the%20previous%20one.%5Cn%5CnYou%20are%20given%20the%20information%20about%20the%20problems%20the%20scientists%20offered%20for%20the%20testing.%20You%20need%20to%20arrange%20these%20problems%20in%20such%20an%20order%20that%20the%20number%20of%20adjacent%20%5C%22bad%5C%22%20pairs%20of%20problems%20in%20this%20list%20is%20minimum%20possible.%20We%20will%20call%20two%20consecutive%20problems%20in%20this%20list%20a%20%5C%22bad%20pair%5C%22%20if%20the%20problem%20that%20is%20performed%20first%20requires%20more%20resources%20than%20the%20one%20that%20goes%20after%20it.%20Do%20not%20forget%20that%20the%20problems%20of%20the%20same%20scientist%20must%20be%20solved%20in%20a%20fixed%20order.%22%2C%22inputFormat%22%3A%22The%20first%20line%20contains%20integer%20%24%20n%20%24%20%5Cu2014%20the%20number%20of%20scientists.%20To%20lessen%20the%20size%20of%20the%20input%2C%20each%20of%20the%20next%20%24%20n%20%24%20lines%20contains%20five%20integers%20%24%20k_%7Bi%7D%20%24%20%2C%20%24%20a_%7Bi%2C1%7D%20%24%20%2C%20%24%20x_%7Bi%7D%20%24%20%2C%20%24%20y_%7Bi%7D%20%24%20%2C%20%24%20m_%7Bi%7D%20%24%20%28%20%24%200%3C%3Da_%7Bi%2C1%7D%3Cm_%7Bi%7D%3C%3D10%5E%7B9%7D%20%24%20%2C%20%24%201%3C%3Dx_%7Bi%7D%2Cy_%7Bi%7D%3C%3D10%5E%7B9%7D%20%24%20%29%20%5Cu2014%20the%20number%20of%20problems%20of%20the%20%24%20i%20%24%20-th%20scientist%2C%20the%20resources%20the%20first%20problem%20requires%20and%20three%20parameters%20that%20generate%20the%20subsequent%20values%20of%20%24%20a_%7Bi%2Cj%7D%20%24%20.%20For%20all%20%24%20j%20%24%20from%20%24%202%20%24%20to%20%24%20k_%7Bi%7D%20%24%20%2C%20inclusive%2C%20you%20should%20calculate%20value%20%24%20a_%7Bi%2Cj%7D%20%24%20by%20formula%20%24%20a_%7Bi%2Cj%7D%3D%28a_%7Bi%2Cj-1%7D%2Ax_%7Bi%7D%2By_%7Bi%7D%29%20%24%20%24%20mod%20%24%20%24%20m_%7Bi%7D%20%24%20%2C%20where%20%24%20a%20%24%20%24%20mod%20%24%20%24%20b%20%24%20is%20the%20operation%20of%20taking%20the%20remainder%20of%20division%20of%20number%20%24%20a%20%24%20by%20number%20%24%20b%20%24%20.%5Cn%5CnTo%20get%20the%20full%20points%20for%20the%20first%20group%20of%20tests%20it%20is%20sufficient%20to%20solve%20the%20problem%20with%20%24%20n%3D2%20%24%20%2C%20%24%201%3C%3Dk_%7Bi%7D%3C%3D2000%20%24%20.%5Cn%5CnTo%20get%20the%20full%20points%20for%20the%20second%20group%20of%20tests%20it%20is%20sufficient%20to%20solve%20the%20problem%20with%20%24%20n%3D2%20%24%20%2C%20%24%201%3C%3Dk_%7Bi%7D%3C%3D200000%20%24%20.%5Cn%5CnTo%20get%20the%20full%20points%20for%20the%20third%20group%20of%20tests%20it%20is%20sufficient%20to%20solve%20the%20problem%20with%20%24%201%3C%3Dn%3C%3D5000%20%24%20%2C%20%24%201%3C%3Dk_%7Bi%7D%3C%3D5000%20%24%20.%22%2C%22outputFormat%22%3A%22On%20the%20first%20line%20print%20a%20single%20number%20%5Cu2014%20the%20number%20of%20%5C%22bad%5C%22%20pairs%20in%20the%20optimal%20order.%5Cn%5CnIf%20the%20total%20number%20of%20problems%20does%20not%20exceed%20%24%20200000%20%24%20%2C%20also%20print%20%21%5B%5D%28https%3A%5C%2F%5C%2Fcdn.luogu.com.cn%5C%2Fupload%5C%2Fvjudge_pic%5C%2FCF207A1%5C%2F164f25ac652d4daff28e37b1d12b21721c94c6e1.png%29%20lines%20%5Cu2014%20the%20optimal%20order%20of%20the%20problems.%20On%20each%20of%20these%20lines%20print%20two%20integers%20separated%20by%20a%20single%20space%20%5Cu2014%20the%20required%20number%20of%20resources%20for%20the%20problem%20and%20the%20number%20of%20the%20scientist%20who%20offered%20this%20problem%2C%20respectively.%20The%20scientists%20are%20numbered%20from%20%24%201%20%24%20to%20%24%20n%20%24%20in%20the%20order%20of%20input.%22%2C%22samples%22%3A%5B%5B%222%5Cn2%201%201%201%2010%5Cn2%203%201%201%2010%5Cn%22%2C%220%5Cn1%201%5Cn2%201%5Cn3%202%5Cn4%202%5Cn%22%5D%2C%5B%222%5Cn3%2010%202%203%201000%5Cn3%20100%201%20999%201000%5Cn%22%2C%222%5Cn10%201%5Cn23%201%5Cn49%201%5Cn100%202%5Cn99%202%5Cn98%202%5Cn%22%5D%5D%2C%22hint%22%3A%22In%20the%20first%20sample%20%24%20n%3D2%20%24%20%2C%20%24%20k_%7B1%7D%3D2%20%24%20%2C%20%24%20a_%7B1%2C1%7D%3D1%20%24%20%2C%20%24%20a_%7B1%2C2%7D%3D2%20%24%20%2C%20%24%20k_%7B2%7D%3D2%20%24%20%2C%20%24%20a_%7B2%2C1%7D%3D3%20%24%20%2C%20%24%20a_%7B2%2C2%7D%3D4%20%24%20.%20We%27ve%20got%20two%20scientists%2C%20each%20of%20them%20has%20two%20calculating%20problems.%20The%20problems%20of%20the%20first%20scientist%20require%20%24%201%20%24%20and%20%24%202%20%24%20resource%20units%2C%20the%20problems%20of%20the%20second%20one%20require%20%24%203%20%24%20and%20%24%204%20%24%20resource%20units.%20Let%27s%20list%20all%20possible%20variants%20of%20the%20calculating%20order%20%28each%20problem%20is%20characterized%20only%20by%20the%20number%20of%20resource%20units%20it%20requires%29%3A%20%24%20%281%2C2%2C3%2C4%29%20%24%20%2C%20%24%20%281%2C3%2C2%2C4%29%20%24%20%2C%20%24%20%283%2C1%2C2%2C4%29%20%24%20%2C%20%24%20%281%2C3%2C4%2C2%29%20%24%20%2C%20%24%20%283%2C4%2C1%2C2%29%20%24%20%2C%20%24%20%283%2C1%2C4%2C2%29%20%24%20.%5Cn%5CnSequence%20of%20problems%20%24%20%281%2C3%2C2%2C4%29%20%24%20has%20one%20%5C%22bad%5C%22%20pair%20%28%20%24%203%20%24%20and%20%24%202%20%24%20%29%2C%20%24%20%283%2C1%2C4%2C2%29%20%24%20has%20two%20%5C%22bad%5C%22%20pairs%20%28%20%24%203%20%24%20and%20%24%201%20%24%20%2C%20%24%204%20%24%20and%20%24%202%20%24%20%29%2C%20and%20%24%20%281%2C2%2C3%2C4%29%20%24%20has%20no%20%5C%22bad%5C%22%20pairs.%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B3000%5D%2C%22memory%22%3A%5B256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F207%5C%2FA1%22%2C%22id%22%3A%22207A1%22%7D%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Atrue%2C%22totalSubmit%22%3A0%2C%22totalAccepted%22%3A0%2C%22pid%22%3A%22CF207A1%22%2C%22title%22%3A%22Beaver%27s%20Calculator%201.0%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Beaver%27s%20Calculator%201.0%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1573295103;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Beaver&#039;s Calculator 1.0</h1>
<h2>题目描述</h2>
<div>The Smart Beaver from ABBYY has once again surprised us! He has developed a new calculating device, which he called the "Beaver's Calculator $ 1.0 $ ". It is very peculiar and it is planned to be used in a variety of scientific problems.
To test it, the Smart Beaver invited $ n $ scientists, numbered from $ 1 $ to $ n $ . The $ i $ -th scientist brought $ k_{i} $ calculating problems for the device developed by the Smart Beaver from ABBYY. The problems of the $ i $ -th scientist are numbered from $ 1 $ to $ k_{i} $ , and they must be calculated sequentially in the described order, since calculating each problem heavily depends on the results of calculating of the previous ones.
Each problem of each of the $ n $ scientists is described by one integer $ a_{i,j} $ , where $ i $ ( $ 1<=i<=n $ ) is the number of the scientist, $ j $ ( $ 1<=j<=k_{i} $ ) is the number of the problem, and $ a_{i,j} $ is the number of resource units the calculating device needs to solve this problem.
The calculating device that is developed by the Smart Beaver is pretty unusual. It solves problems sequentially, one after another. After some problem is solved and before the next one is considered, the calculating device allocates or frees resources.
The most expensive operation for the calculating device is freeing resources, which works much slower than allocating them. It is therefore desirable that each next problem for the calculating device requires no less resources than the previous one.
You are given the information about the problems the scientists offered for the testing. You need to arrange these problems in such an order that the number of adjacent "bad" pairs of problems in this list is minimum possible. We will call two consecutive problems in this list a "bad pair" if the problem that is performed first requires more resources than the one that goes after it. Do not forget that the problems of the same scientist must be solved in a fixed order.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line contains integer $ n $ — the number of scientists. To lessen the size of the input, each of the next $ n $ lines contains five integers $ k_{i} $ , $ a_{i,1} $ , $ x_{i} $ , $ y_{i} $ , $ m_{i} $ ( $ 0<=a_{i,1}<m_{i}<=10^{9} $ , $ 1<=x_{i},y_{i}<=10^{9} $ ) — the number of problems of the $ i $ -th scientist, the resources the first problem requires and three parameters that generate the subsequent values of $ a_{i,j} $ . For all $ j $ from $ 2 $ to $ k_{i} $ , inclusive, you should calculate value $ a_{i,j} $ by formula $ a_{i,j}=(a_{i,j-1}*x_{i}+y_{i}) $ $ mod $ $ m_{i} $ , where $ a $ $ mod $ $ b $ is the operation of taking the remainder of division of number $ a $ by number $ b $ . To get the full points for the first group of tests it is sufficient to solve the problem with $ n=2 $ , $ 1<=k_{i}<=2000 $ . To get the full points for the second group of tests it is sufficient to solve the problem with $ n=2 $ , $ 1<=k_{i}<=200000 $ . To get the full points for the third group of tests it is sufficient to solve the problem with $ 1<=n<=5000 $ , $ 1<=k_{i}<=5000 $ .</div>
<h3>输出格式</h3>
<br />
<div>On the first line print a single number — the number of "bad" pairs in the optimal order.
If the total number of problems does not exceed $ 200000 $ , also print ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF207A1/164f25ac652d4daff28e37b1d12b21721c94c6e1.png) lines — the optimal order of the problems. On each of these lines print two integers separated by a single space — the required number of resources for the problem and the number of the scientist who offered this problem, respectively. The scientists are numbered from $ 1 $ to $ n $ in the order of input.</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>2
2 1 1 1 10
2 3 1 1 10
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>0
1 1
2 1
3 2
4 2
</code></pre>
<h3>输入样例 #2</h3>
<pre><code>2
3 10 2 3 1000
3 100 1 999 1000
</code></pre>
<h3>输出样例 #2</h3>
<pre><code>2
10 1
23 1
49 1
100 2
99 2
98 2
</code></pre>
<h2>说明</h2>
<div>In the first sample $ n=2 $ , $ k_{1}=2 $ , $ a_{1,1}=1 $ , $ a_{1,2}=2 $ , $ k_{2}=2 $ , $ a_{2,1}=3 $ , $ a_{2,2}=4 $ . We've got two scientists, each of them has two calculating problems. The problems of the first scientist require $ 1 $ and $ 2 $ resource units, the problems of the second one require $ 3 $ and $ 4 $ resource units. Let's list all possible variants of the calculating order (each problem is characterized only by the number of resource units it requires): $ (1,2,3,4) $ , $ (1,3,2,4) $ , $ (3,1,2,4) $ , $ (1,3,4,2) $ , $ (3,4,1,2) $ , $ (3,1,4,2) $ .
Sequence of problems $ (1,3,2,4) $ has one "bad" pair ( $ 3 $ and $ 2 $ ), $ (3,1,4,2) $ has two "bad" pairs ( $ 3 $ and $ 1 $ , $ 4 $ and $ 2 $ ), and $ (1,2,3,4) $ has no "bad" pairs.</div>
</article>
</div>
</div>
</body>
</html>
