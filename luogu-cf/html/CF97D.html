<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Robot in Basement - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573390758:UNb0rnGsq5aAoIsrtG5xK6MhxNwErZChak1IBtHJD/M=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3A%22%22%2C%22description%22%3A%22The%20Professor%20has%20lost%20his%20home%20robot%20yet%20again.%20After%20some%20thinking%20Professor%20understood%20that%20he%20had%20left%20the%20robot%20in%20the%20basement.%5Cn%5CnThe%20basement%20in%20Professor%27s%20house%20is%20represented%20by%20a%20rectangle%20%24%20n%5Cu00d7m%20%24%20%2C%20split%20into%20%24%201%5Cu00d71%20%24%20squares.%20Some%20squares%20are%20walls%20which%20are%20impassable%3B%20other%20squares%20are%20passable.%20You%20can%20get%20from%20any%20passable%20square%20to%20any%20other%20passable%20square%20moving%20through%20edge-adjacent%20passable%20squares.%20One%20passable%20square%20is%20the%20exit%20from%20the%20basement.%20The%20robot%20is%20placed%20exactly%20in%20one%20passable%20square.%20Also%20the%20robot%20may%20be%20placed%20in%20the%20exit%20square.%5Cn%5CnProfessor%20is%20scared%20of%20going%20to%20the%20dark%20basement%20looking%20for%20the%20robot%20at%20night.%20However%2C%20he%20has%20a%20basement%20plan%20and%20the%20robot%27s%20remote%20control.%20Using%20the%20remote%2C%20Professor%20can%20send%20signals%20to%20the%20robot%20to%20shift%20one%20square%20left%2C%20right%2C%20up%20or%20down.%20When%20the%20robot%20receives%20a%20signal%2C%20it%20moves%20in%20the%20required%20direction%20if%20the%20robot%27s%20neighboring%20square%20in%20the%20given%20direction%20is%20passable.%20Otherwise%2C%20the%20robot%20stays%20idle.%5Cn%5CnProfessor%20wrote%20a%20sequence%20of%20%24%20k%20%24%20commands%20on%20a%20piece%20of%20paper.%20He%20thinks%20that%20the%20sequence%20can%20lead%20the%20robot%20out%20of%20the%20basement%2C%20wherever%20it%27s%20initial%20position%20might%20be.%20Professor%20programmed%20another%20robot%20to%20press%20the%20required%20buttons%20on%20the%20remote%20according%20to%20the%20notes%20on%20the%20piece%20of%20paper.%20Professor%20was%20just%20about%20to%20run%20the%20program%20and%20go%20to%20bed%2C%20when%20he%20had%20an%20epiphany.%5Cn%5CnExecuting%20each%20command%20takes%20some%20energy%20and%20Professor%20doesn%27t%20want%20to%20get%20huge%20electricity%20bill%20at%20the%20end%20of%20the%20month.%20That%27s%20why%20he%20wants%20to%20find%20in%20the%20sequence%20he%20has%20written%20out%20the%20minimal%20possible%20prefix%20that%20would%20guarantee%20to%20lead%20the%20robot%20out%20to%20the%20exit%20after%20the%20prefix%20is%20fulfilled.%20And%20that%27s%20the%20problem%20Professor%20challenges%20you%20with%20at%20this%20late%20hour.%22%2C%22inputFormat%22%3A%22The%20first%20line%20contains%20three%20integers%20%24%20n%20%24%20%2C%20%24%20m%20%24%20and%20%24%20k%20%24%20%28%20%24%203%3C%3Dn%2Cm%3C%3D150%20%24%20%2C%20%24%201%3C%3Dk%3C%3D10%5E%7B5%7D%20%24%20%29.%20Next%20%24%20n%20%24%20lines%20contain%20%24%20m%20%24%20characters%20each%20%5Cu2014%20that%20is%20the%20Professor%27s%20basement%27s%20description%3A%20%5C%22%5C%5C%23%5C%22%20stands%20for%20a%20wall%2C%20%5C%22.%5C%22%20stands%20for%20a%20passable%20square%20and%20%5C%22E%5C%22%20stands%20for%20the%20exit%20from%20the%20basement%20%28this%20square%20also%20is%20passable%29.%20It%20is%20possible%20to%20get%20from%20each%20passable%20square%20to%20the%20exit%2C%20all%20squares%20located%20by%20the%20%24%20n%5Cu00d7m%20%24%20rectangle%27s%20perimeter%20are%20the%20walls.%20Exactly%20one%20square%20is%20the%20exit%20from%20the%20basement.%20The%20last%20line%20contains%20%24%20k%20%24%20characters%2C%20the%20description%20of%20the%20sequence%20of%20commands%20that%20Professor%20has%20written%20out%20on%20a%20piece%20of%20paper.%20%5C%22L%5C%22%2C%20%5C%22R%5C%22%2C%20%5C%22U%5C%22%2C%20%5C%22D%5C%22%20stand%20for%20commands%20left%2C%20right%2C%20up%20and%20down%20correspondingly.%22%2C%22outputFormat%22%3A%22Print%20in%20the%20output%20file%20the%20length%20of%20the%20smallest%20possible%20prefix%20that%20will%20lead%20the%20robot%20to%20the%20exit%20square.%20In%20other%20words%2C%20wherever%20the%20robot%20had%20been%20positioned%20initially%2C%20it%20should%20be%20positioned%20in%20the%20exit%20square%20after%20all%20the%20commands%20from%20the%20prefix%20are%20fulfilled%20%28during%20doing%20commands%20the%20robot%20can%20come%20and%20leave%20the%20exit%20square%2C%20but%20only%20the%20last%20position%20of%20the%20robot%20is%20interesting%20for%20us%29.%20If%20Professor%20is%20mistaken%20and%20no%20prefix%20%28including%20the%20whole%20sequence%29%20can%20bring%20the%20robot%20to%20the%20exit%2C%20print%20%5C%22-1%5C%22%20%28without%20the%20quotes%29.%20If%20there%20is%20the%20only%20passable%20square%20and%20it%20is%20the%20exit%2C%20print%20%5C%220%5C%22%20%28without%20the%20quotes%29.%22%2C%22samples%22%3A%5B%5B%225%205%207%5Cn%23%23%23%23%23%5Cn%23...%23%5Cn%23...%23%5Cn%23E..%23%5Cn%23%23%23%23%23%5CnUULLDDR%5Cn%22%2C%226%5Cn%22%5D%2C%5B%225%205%207%5Cn%23%23%23%23%23%5Cn%23.%23.%23%5Cn%23...%23%5Cn%23E..%23%5Cn%23%23%23%23%23%5CnUULLDDR%5Cn%22%2C%22-1%5Cn%22%5D%2C%5B%225%203%202%5Cn%23%23%23%5Cn%23.%23%5Cn%23.%23%5Cn%23E%23%5Cn%23%23%23%5CnDD%5Cn%22%2C%222%5Cn%22%5D%5D%2C%22hint%22%3A%22%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B4000%5D%2C%22memory%22%3A%5B256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F97%5C%2FD%22%2C%22id%22%3A%2297D%22%7D%2C%22translation%22%3A%22%5Cu5728%5Cu4e00%5Cu4e2an%2Am%5Cuff08n%5Cuff0cm%20%3C%3D%20150%29%20%5Cu7684%5Cu7f51%5Cu683c%5Cu4e0a%5Cuff0c%5Cu6709%5Cu4e00%5Cu4e9b%5Cu683c%5Cu5b50%5Cu662f%5Cu969c%5Cu788d%5Cu7684%5Cuff0c%5Cu5e76%5Cu4e14%5Cu7f51%5Cu683c%5Cu8fb9%5Cu754c%5Cu4e0a%5Cu7684%5Cu683c%5Cu5b50%5Cu5747%5Cu662f%5Cu969c%5Cu788d%5Cu7684%5Cuff0c%5Cu53e6%5Cu6709%5Cu4e00%5Cu4e2a%5Cu975e%5Cu969c%5Cu788d%5Cu7684%5Cu683c%5Cu5b50%5Cu662f%5Cu51fa%5Cu53e3%5Cu3002%5Cu4e00%5Cu4e2a%5Cu673a%5Cu5668%5Cu4eba%5Cu53ef%5Cu4ee5%5Cu6839%5Cu636e%5Cu7a0b%5Cu5e8f%5Cu5728%5Cu8be5%5Cu7f51%5Cu683c%5Cu4e0a%5Cu884c%5Cu8d70%5Cu3002%5Cu4e00%5Cu6bb5%5Cu7a0b%5Cu5e8f%5Cu662f%5Cu4e00%5Cu4e2a%5Cu7531UDLR%5Cu56db%5Cu79cd%5Cu6307%5Cu4ee4%5Cu7ec4%5Cu6210%5Cu7684%5Cu5b57%5Cu7b26%5Cu4e32%5Cuff0c%5Cu673a%5Cu5668%5Cu4eba%5Cu4f1a%5Cu4f9d%5Cu6b21%5Cu6267%5Cu884c%5Cu6bcf%5Cu4e2a%5Cu547d%5Cu4ee4%5Cuff0c%5Cu4e00%5Cu4e2a%5Cu6307%5Cu4ee4%5Cu4f1a%5Cu4f7f%5Cu673a%5Cu5668%5Cu4eba%5Cu5411%5Cu6307%5Cu5b9a%5Cu7684%5Cu65b9%5Cu5411%5Cu79fb%5Cu52a8%5Cu4e00%5Cu683c%5Cuff0c%5Cu5982%5Cu679c%5Cu5bf9%5Cu5e94%5Cu7684%5Cu683c%5Cu5b50%5Cu4e3a%5Cu969c%5Cu788d%5Cu5219%5Cu4e0d%5Cu52a8%5Cuff0c%5Cu73b0%5Cu5728%5Cu7ed9%5Cu5b9a%5Cu4e00%5Cu683c%5Cu957f%5Cu5ea6%5Cu4e3al%5Cuff08l%20%3C%3D%201e5%29%5Cu7684%5Cu7a0b%5Cu5e8f%5Cuff0c%5Cu6c42%5Cu5b83%5Cu7684%5Cu4e00%5Cu4e2a%5Cu6700%5Cu77ed%5Cu524d%5Cu7f00p%5Cuff0c%5Cu4f7f%5Cu5f97%5Cu5bf9%5Cu4e8e%5Cu4e00%5Cu5f00%5Cu59cb%5Cu7684%5Cu7f51%5Cu683c%5Cu4e0a%5Cu4efb%5Cu610f%5Cu975e%5Cu969c%5Cu788d%5Cu4f4d%5Cu7f6e%5Cu90fd%5Cu662f%5Cu673a%5Cu5668%5Cu4eba%5Cuff0c%5Cu5728%5Cu6267%5Cu884c%5Cu5b8c%5Cu7a0b%5Cu5e8fp%5Cu4e4b%5Cu540e%5Cu90fd%5Cu505c%5Cu5728%5Cu51fa%5Cu53e3%5Cu4e0a%5Cu3002%5Cn%5CnTranslated%20by%20%40jiangyige%20%22%2C%22tags%22%3A%5B1%5D%2C%22wantsTranslation%22%3Afalse%2C%22totalSubmit%22%3A95%2C%22totalAccepted%22%3A26%2C%22pid%22%3A%22CF97D%22%2C%22title%22%3A%22Robot%20in%20Basement%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%7B%22id%22%3A60123%2C%22title%22%3A%22%5Cu6c42%5Cu52a9%5Cu5404%5Cu4f4ddalao%5Cuff0cWA%5Cu4e86%5Cu7b2c12%5Cu4e2a%5Cu70b9%22%2C%22forum%22%3A%7B%22id%22%3A12223%2C%22name%22%3A%22CF97D%20Robot%20in%20Basement%22%2C%22slug%22%3A%22CF97D%22%7D%7D%2C%7B%22id%22%3A43654%2C%22title%22%3A%22%5Cu7ffb%5Cu8bd1%22%2C%22forum%22%3A%7B%22id%22%3A12223%2C%22name%22%3A%22CF97D%20Robot%20in%20Basement%22%2C%22slug%22%3A%22CF97D%22%7D%7D%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%7B%22pid%22%3A%22P3967%22%2C%22title%22%3A%22%5BTJOI2014%5D%5Cu5339%5Cu914d%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22P%22%7D%2C%7B%22pid%22%3A%22CF364D%22%2C%22title%22%3A%22Ghd%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22CF%22%7D%2C%7B%22pid%22%3A%22CF52C%22%2C%22title%22%3A%22Circular%20RMQ%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22CF%22%7D%2C%7B%22pid%22%3A%22P4306%22%2C%22title%22%3A%22%5BJSOI2010%5D%5Cu8fde%5Cu901a%5Cu6570%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22P%22%7D%2C%7B%22pid%22%3A%22CF1167F%22%2C%22title%22%3A%22Scalar%20Queries%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22CF%22%7D%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Robot%20in%20Basement%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1572920822;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Robot in Basement</h1>
<h2>题意翻译</h2>
<div>在一个n*m（n，m <= 150) 的网格上，有一些格子是障碍的，并且网格边界上的格子均是障碍的，另有一个非障碍的格子是出口。一个机器人可以根据程序在该网格上行走。一段程序是一个由UDLR四种指令组成的字符串，机器人会依次执行每个命令，一个指令会使机器人向指定的方向移动一格，如果对应的格子为障碍则不动，现在给定一格长度为l（l <= 1e5)的程序，求它的一个最短前缀p，使得对于一开始的网格上任意非障碍位置都是机器人，在执行完程序p之后都停在出口上。
Translated by @jiangyige </div>
<h2>题目描述</h2>
<div>The Professor has lost his home robot yet again. After some thinking Professor understood that he had left the robot in the basement.
The basement in Professor's house is represented by a rectangle $ n×m $ , split into $ 1×1 $ squares. Some squares are walls which are impassable; other squares are passable. You can get from any passable square to any other passable square moving through edge-adjacent passable squares. One passable square is the exit from the basement. The robot is placed exactly in one passable square. Also the robot may be placed in the exit square.
Professor is scared of going to the dark basement looking for the robot at night. However, he has a basement plan and the robot's remote control. Using the remote, Professor can send signals to the robot to shift one square left, right, up or down. When the robot receives a signal, it moves in the required direction if the robot's neighboring square in the given direction is passable. Otherwise, the robot stays idle.
Professor wrote a sequence of $ k $ commands on a piece of paper. He thinks that the sequence can lead the robot out of the basement, wherever it's initial position might be. Professor programmed another robot to press the required buttons on the remote according to the notes on the piece of paper. Professor was just about to run the program and go to bed, when he had an epiphany.
Executing each command takes some energy and Professor doesn't want to get huge electricity bill at the end of the month. That's why he wants to find in the sequence he has written out the minimal possible prefix that would guarantee to lead the robot out to the exit after the prefix is fulfilled. And that's the problem Professor challenges you with at this late hour.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line contains three integers $ n $ , $ m $ and $ k $ ( $ 3<=n,m<=150 $ , $ 1<=k<=10^{5} $ ). Next $ n $ lines contain $ m $ characters each — that is the Professor's basement's description: "\#" stands for a wall, "." stands for a passable square and "E" stands for the exit from the basement (this square also is passable). It is possible to get from each passable square to the exit, all squares located by the $ n×m $ rectangle's perimeter are the walls. Exactly one square is the exit from the basement. The last line contains $ k $ characters, the description of the sequence of commands that Professor has written out on a piece of paper. "L", "R", "U", "D" stand for commands left, right, up and down correspondingly.</div>
<h3>输出格式</h3>
<br />
<div>Print in the output file the length of the smallest possible prefix that will lead the robot to the exit square. In other words, wherever the robot had been positioned initially, it should be positioned in the exit square after all the commands from the prefix are fulfilled (during doing commands the robot can come and leave the exit square, but only the last position of the robot is interesting for us). If Professor is mistaken and no prefix (including the whole sequence) can bring the robot to the exit, print "-1" (without the quotes). If there is the only passable square and it is the exit, print "0" (without the quotes).</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>5 5 7
#####
#...#
#...#
#E..#
#####
UULLDDR
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>6
</code></pre>
<h3>输入样例 #2</h3>
<pre><code>5 5 7
#####
#.#.#
#...#
#E..#
#####
UULLDDR
</code></pre>
<h3>输出样例 #2</h3>
<pre><code>-1
</code></pre>
<h3>输入样例 #3</h3>
<pre><code>5 3 2
###
#.#
#.#
#E#
###
DD
</code></pre>
<h3>输出样例 #3</h3>
<pre><code>2
</code></pre>
</article>
</div>
</div>
</body>
</html>
