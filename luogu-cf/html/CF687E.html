<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>TOF - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573396684:KPxTkvKNeHFmz2O21W5gRP74M/pzsRykjSQ6prEZnIs=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22Today%20Pari%20gave%20Arya%20a%20cool%20graph%20problem.%20Arya%20wrote%20a%20non-optimal%20solution%20for%20it%2C%20because%20he%20believes%20in%20his%20ability%20to%20optimize%20non-optimal%20solutions.%20In%20addition%20to%20being%20non-optimal%2C%20his%20code%20was%20buggy%20and%20he%20tried%20a%20lot%20to%20optimize%20it%2C%20so%20the%20code%20also%20became%20dirty%21%20He%20keeps%20getting%20Time%20Limit%20Exceeds%20and%20he%20is%20disappointed.%20Suddenly%20a%20bright%20idea%20came%20to%20his%20mind%21%5Cn%5CnHere%20is%20how%20his%20dirty%20code%20looks%20like%3A%5Cn%5Cn%60%3Cbr%3E%3C%5C%2Fbr%3Edfs%28v%29%3Cbr%3E%3C%5C%2Fbr%3E%7B%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20set%20count%5Bv%5D%20%3D%20count%5Bv%5D%20%2B%201%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20if%28count%5Bv%5D%20%3C%201000%29%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20%7B%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20%20%20%20%20%20foreach%20u%20in%20neighbors%5Bv%5D%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20%20%20%20%20%20%7B%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%28visited%5Bu%5D%20is%20equal%20to%20false%29%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7B%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20dfs%28u%29%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20%20%20%20%20%20%7D%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20%7D%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20set%20visited%5Bv%5D%20%3D%20true%3Cbr%3E%3C%5C%2Fbr%3E%7D%3Cbr%3E%3C%5C%2Fbr%3E%3Cbr%3E%3C%5C%2Fbr%3Emain%28%29%3Cbr%3E%3C%5C%2Fbr%3E%7B%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20input%20the%20digraph%28%29%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20TOF%28%29%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20foreach%201%3C%3Di%3C%3Dn%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20%7B%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20%20%20%20%20%20set%20count%5Bi%5D%20%3D%200%20%2C%20visited%5Bi%5D%20%3D%20false%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20%7D%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20foreach%201%20%3C%3D%20v%20%3C%3D%20n%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20%7B%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20%20%20%20%20%20if%28visited%5Bv%5D%20is%20equal%20to%20false%29%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20%20%20%20%20%20%7B%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20dfs%28v%29%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20%20%20%20%20%20%7D%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20%7D%3Cbr%3E%3C%5C%2Fbr%3E%20%20%20%20%20...%20%5C%2F%5C%2F%20And%20do%20something%20cool%20and%20magical%20but%20we%20can%27t%20tell%20you%20what%21%3Cbr%3E%3C%5C%2Fbr%3E%7D%3Cbr%3E%3C%5C%2Fbr%3E%60He%20asks%20you%20to%20write%20the%20TOF%20function%20in%20order%20to%20optimize%20the%20running%20time%20of%20the%20code%20with%20minimizing%20the%20number%20of%20calls%20of%20the%20dfs%20function.%20The%20input%20is%20a%20directed%20graph%20and%20in%20the%20TOF%20function%20you%20have%20to%20rearrange%20the%20edges%20of%20the%20graph%20in%20the%20list%20neighbors%20for%20each%20vertex.%20The%20number%20of%20calls%20of%20dfs%20function%20depends%20on%20the%20arrangement%20of%20neighbors%20of%20each%20vertex.%22%2C%22inputFormat%22%3A%22The%20first%20line%20of%20the%20input%20contains%20two%20integers%20%24%20n%20%24%20and%20%24%20m%20%24%20%28%20%24%201%3C%3Dn%2Cm%3C%3D5000%20%24%20%29%20%5Cu2014%20the%20number%20of%20vertices%20and%20then%20number%20of%20directed%20edges%20in%20the%20input%20graph.%5Cn%5CnEach%20of%20the%20next%20%24%20m%20%24%20lines%20contains%20a%20pair%20of%20integers%20%24%20u_%7Bi%7D%20%24%20and%20%24%20v_%7Bi%7D%20%24%20%28%20%24%201%3C%3Du_%7Bi%7D%2Cv_%7Bi%7D%3C%3Dn%20%24%20%29%2C%20meaning%20there%20is%20a%20directed%20%21%5B%5D%28https%3A%5C%2F%5C%2Fcdn.luogu.com.cn%5C%2Fupload%5C%2Fvjudge_pic%5C%2FCF687E%5C%2F7598ba83246bf3fe4f0a4896c607816bd55544b6.png%29%20edge%20in%20the%20input%20graph.%5Cn%5CnYou%20may%20assume%20that%20the%20graph%20won%27t%20contain%20any%20self-loops%20and%20there%20is%20at%20most%20one%20edge%20between%20any%20unordered%20pair%20of%20vertices.%22%2C%22outputFormat%22%3A%22Print%20a%20single%20integer%20%5Cu2014%20the%20minimum%20possible%20number%20of%20dfs%20calls%20that%20can%20be%20achieved%20with%20permuting%20the%20edges.%22%2C%22samples%22%3A%5B%5B%223%203%5Cn1%202%5Cn2%203%5Cn3%201%5Cn%22%2C%222998%5Cn%22%5D%2C%5B%226%207%5Cn1%202%5Cn2%203%5Cn3%201%5Cn3%204%5Cn4%205%5Cn5%206%5Cn6%204%5Cn%22%2C%223001%5Cn%22%5D%5D%2C%22hint%22%3A%22%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B1000%5D%2C%22memory%22%3A%5B256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F687%5C%2FE%22%2C%22id%22%3A%22687E%22%7D%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Atrue%2C%22totalSubmit%22%3A0%2C%22totalAccepted%22%3A0%2C%22pid%22%3A%22CF687E%22%2C%22title%22%3A%22TOF%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22TOF%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1572920822;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>TOF</h1>
<h2>题目描述</h2>
<div>Today Pari gave Arya a cool graph problem. Arya wrote a non-optimal solution for it, because he believes in his ability to optimize non-optimal solutions. In addition to being non-optimal, his code was buggy and he tried a lot to optimize it, so the code also became dirty! He keeps getting Time Limit Exceeds and he is disappointed. Suddenly a bright idea came to his mind!
Here is how his dirty code looks like:
`<br></br>dfs(v)<br></br>{<br></br> set count[v] = count[v] + 1<br></br> if(count[v] < 1000)<br></br> {<br></br> foreach u in neighbors[v]<br></br> {<br></br> if(visited[u] is equal to false)<br></br> {<br></br> dfs(u)<br></br> }<br></br> break<br></br> }<br></br> }<br></br> set visited[v] = true<br></br>}<br></br><br></br>main()<br></br>{<br></br> input the digraph()<br></br> TOF()<br></br> foreach 1<=i<=n<br></br> {<br></br> set count[i] = 0 , visited[i] = false<br></br> }<br></br> foreach 1 <= v <= n<br></br> {<br></br> if(visited[v] is equal to false)<br></br> {<br></br> dfs(v)<br></br> }<br></br> }<br></br> ... // And do something cool and magical but we can't tell you what!<br></br>}<br></br>`He asks you to write the TOF function in order to optimize the running time of the code with minimizing the number of calls of the dfs function. The input is a directed graph and in the TOF function you have to rearrange the edges of the graph in the list neighbors for each vertex. The number of calls of dfs function depends on the arrangement of neighbors of each vertex.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line of the input contains two integers $ n $ and $ m $ ( $ 1<=n,m<=5000 $ ) — the number of vertices and then number of directed edges in the input graph.
Each of the next $ m $ lines contains a pair of integers $ u_{i} $ and $ v_{i} $ ( $ 1<=u_{i},v_{i}<=n $ ), meaning there is a directed ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF687E/7598ba83246bf3fe4f0a4896c607816bd55544b6.png) edge in the input graph.
You may assume that the graph won't contain any self-loops and there is at most one edge between any unordered pair of vertices.</div>
<h3>输出格式</h3>
<br />
<div>Print a single integer — the minimum possible number of dfs calls that can be achieved with permuting the edges.</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>3 3
1 2
2 3
3 1
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>2998
</code></pre>
<h3>输入样例 #2</h3>
<pre><code>6 7
1 2
2 3
3 1
3 4
4 5
5 6
6 4
</code></pre>
<h3>输出样例 #2</h3>
<pre><code>3001
</code></pre>
</article>
</div>
</div>
</body>
</html>
