<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Two-Paths - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573400293:LCNPWJrilUX1L296zHE7u2dLhgXIW6LHQuY65nv77Xo=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3A%22%22%2C%22description%22%3A%22You%20are%20given%20a%20weighted%20tree%20%28undirected%20connected%20graph%20with%20no%20cycles%2C%20loops%20or%20multiple%20edges%29%20with%20%24%20n%20%24%20vertices.%20The%20edge%20%24%20%5C%5C%7Bu_j%2C%20v_j%5C%5C%7D%20%24%20has%20weight%20%24%20w_j%20%24%20.%20Also%20each%20vertex%20%24%20i%20%24%20has%20its%20own%20value%20%24%20a_i%20%24%20assigned%20to%20it.%5Cn%5CnLet%27s%20call%20a%20path%20starting%20in%20vertex%20%24%20u%20%24%20and%20ending%20in%20vertex%20%24%20v%20%24%20%2C%20where%20each%20edge%20can%20appear%20no%20more%20than%20twice%20%28regardless%20of%20direction%29%2C%20a%202-path.%20Vertices%20can%20appear%20in%20the%202-path%20multiple%20times%20%28even%20start%20and%20end%20vertices%29.%5Cn%5CnFor%20some%202-path%20%24%20p%20%24%20profit%20%24%20%5C%5Ctext%7BPr%7D%28p%29%20%3D%20%5C%5Csum%5C%5Climits_%7Bv%20%5C%5Cin%20%5C%5Ctext%7Bdistinct%20vertices%20in%20%7D%20p%7D%7Ba_v%7D%20-%20%5C%5Csum%5C%5Climits_%7Be%20%5C%5Cin%20%5C%5Ctext%7Bdistinct%20edges%20in%20%7D%20p%7D%7Bk_e%20%5C%5Ccdot%20w_e%7D%20%24%20%2C%20where%20%24%20k_e%20%24%20is%20the%20number%20of%20times%20edge%20%24%20e%20%24%20appears%20in%20%24%20p%20%24%20.%20That%20is%2C%20vertices%20are%20counted%20once%2C%20but%20edges%20are%20counted%20the%20number%20of%20times%20they%20appear%20in%20%24%20p%20%24%20.%5Cn%5CnYou%20are%20about%20to%20answer%20%24%20m%20%24%20queries.%20Each%20query%20is%20a%20pair%20of%20vertices%20%24%20%28qu%2C%20qv%29%20%24%20.%20For%20each%20query%20find%202-path%20%24%20p%20%24%20from%20%24%20qu%20%24%20to%20%24%20qv%20%24%20with%20maximal%20profit%20%24%20%5C%5Ctext%7BPr%7D%28p%29%20%24%20.%22%2C%22inputFormat%22%3A%22The%20first%20line%20contains%20two%20integers%20%24%20n%20%24%20and%20%24%20q%20%24%20%28%20%24%202%20%5C%5Cle%20n%20%5C%5Cle%203%20%5C%5Ccdot%2010%5E5%20%24%20%2C%20%24%201%20%5C%5Cle%20q%20%5C%5Cle%204%20%5C%5Ccdot%2010%5E5%20%24%20%29%20%5Cu2014%20the%20number%20of%20vertices%20in%20the%20tree%20and%20the%20number%20of%20queries.%5Cn%5CnThe%20second%20line%20contains%20%24%20n%20%24%20space-separated%20integers%20%24%20a_1%2C%20a_2%2C%20%5C%5Cdots%2C%20a_n%20%24%20%24%20%281%20%5C%5Cle%20a_i%20%5C%5Cle%2010%5E9%29%20%24%20%5Cu2014%20the%20values%20of%20the%20vertices.%5Cn%5CnNext%20%24%20n%20-%201%20%24%20lines%20contain%20descriptions%20of%20edges%3A%20each%20line%20contains%20three%20space%20separated%20integers%20%24%20u_i%20%24%20%2C%20%24%20v_i%20%24%20and%20%24%20w_i%20%24%20%28%20%24%201%20%5C%5Cle%20u_i%2C%20v_i%20%5C%5Cle%20n%20%24%20%2C%20%24%20u_i%20%5C%5Cneq%20v_i%20%24%20%2C%20%24%201%20%5C%5Cle%20w_i%20%5C%5Cle%2010%5E9%20%24%20%29%20%5Cu2014%20there%20is%20edge%20%24%20%5C%5C%7Bu_i%2C%20v_i%5C%5C%7D%20%24%20with%20weight%20%24%20w_i%20%24%20in%20the%20tree.%5Cn%5CnNext%20%24%20q%20%24%20lines%20contain%20queries%20%28one%20per%20line%29.%20Each%20query%20contains%20two%20integers%20%24%20qu_i%20%24%20and%20%24%20qv_i%20%24%20%24%20%281%20%5C%5Cle%20qu_i%2C%20qv_i%20%5C%5Cle%20n%29%20%24%20%5Cu2014%20endpoints%20of%20the%202-path%20you%20need%20to%20find.%22%2C%22outputFormat%22%3A%22For%20each%20query%20print%20one%20integer%20per%20line%20%5Cu2014%20maximal%20profit%20%24%20%5C%5Ctext%7BPr%7D%28p%29%20%24%20of%20the%20some%202-path%20%24%20p%20%24%20with%20the%20corresponding%20endpoints.%22%2C%22samples%22%3A%5B%5B%227%206%5Cn6%205%205%203%202%201%202%5Cn1%202%202%5Cn2%203%202%5Cn2%204%201%5Cn4%205%201%5Cn6%204%202%5Cn7%203%2025%5Cn1%201%5Cn4%204%5Cn5%206%5Cn6%204%5Cn3%204%5Cn3%207%5Cn%22%2C%229%5Cn9%5Cn9%5Cn8%5Cn12%5Cn-14%5Cn%22%5D%5D%2C%22hint%22%3A%22Explanation%20of%20queries%3A%5Cn%5Cn1.%20%24%20%281%2C%201%29%20%24%20%5Cu2014%20one%20of%20the%20optimal%202-paths%20is%20the%20following%3A%20%24%201%20%5C%5Crightarrow%202%20%5C%5Crightarrow%204%20%5C%5Crightarrow%205%20%5C%5Crightarrow%204%20%5C%5Crightarrow%202%20%5C%5Crightarrow%203%20%5C%5Crightarrow%202%20%5C%5Crightarrow%201%20%24%20.%20%24%20%5C%5Ctext%7BPr%7D%28p%29%20%3D%20%28a_1%20%2B%20a_2%20%2B%20a_3%20%2B%20a_4%20%2B%20a_5%29%20-%20%282%20%5C%5Ccdot%20w%281%2C2%29%20%2B%202%20%5C%5Ccdot%20w%282%2C3%29%20%2B%202%20%5C%5Ccdot%20w%282%2C4%29%20%2B%202%20%5C%5Ccdot%20w%284%2C5%29%29%20%3D%2021%20-%202%20%5C%5Ccdot%2012%20%3D%209%20%24%20.%5Cn2.%20%24%20%284%2C%204%29%20%24%20%3A%20%24%204%20%5C%5Crightarrow%202%20%5C%5Crightarrow%201%20%5C%5Crightarrow%202%20%5C%5Crightarrow%203%20%5C%5Crightarrow%202%20%5C%5Crightarrow%204%20%24%20.%20%24%20%5C%5Ctext%7BPr%7D%28p%29%20%3D%20%28a_1%20%2B%20a_2%20%2B%20a_3%20%2B%20a_4%29%20-%202%20%5C%5Ccdot%20%28w%281%2C2%29%20%2B%20w%282%2C3%29%20%2B%20w%282%2C4%29%29%20%3D%2019%20-%202%20%5C%5Ccdot%2010%20%3D%209%20%24%20.%5Cn3.%20%24%20%285%2C%206%29%20%24%20%3A%20%24%205%20%5C%5Crightarrow%204%20%5C%5Crightarrow%202%20%5C%5Crightarrow%203%20%5C%5Crightarrow%202%20%5C%5Crightarrow%201%20%5C%5Crightarrow%202%20%5C%5Crightarrow%204%20%5C%5Crightarrow%206%20%24%20.%5Cn4.%20%24%20%286%2C%204%29%20%24%20%3A%20%24%206%20%5C%5Crightarrow%204%20%5C%5Crightarrow%202%20%5C%5Crightarrow%201%20%5C%5Crightarrow%202%20%5C%5Crightarrow%203%20%5C%5Crightarrow%202%20%5C%5Crightarrow%204%20%24%20.%5Cn5.%20%24%20%283%2C%204%29%20%24%20%3A%20%24%203%20%5C%5Crightarrow%202%20%5C%5Crightarrow%201%20%5C%5Crightarrow%202%20%5C%5Crightarrow%204%20%24%20.%5Cn6.%20%24%20%283%2C%207%29%20%24%20%3A%20%24%203%20%5C%5Crightarrow%202%20%5C%5Crightarrow%201%20%5C%5Crightarrow%202%20%5C%5Crightarrow%204%20%5C%5Crightarrow%205%20%5C%5Crightarrow%204%20%5C%5Crightarrow%202%20%5C%5Crightarrow%203%20%5C%5Crightarrow%207%20%24%20.%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B3500%5D%2C%22memory%22%3A%5B256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F1000%5C%2FG%22%2C%22id%22%3A%221000G%22%7D%2C%22translation%22%3A%22%5Cu7ed9%5Cu4f60%5Cu4e00%5Cu68f5%20%24n%24%20%5Cu4e2a%5Cu8282%5Cu70b9%5Cu7684%5Cu6811%5Cuff0c%5Cu6bcf%5Cu6761%5Cu8fb9%5Cu6709%5Cu6743%5Cu503c%20%24w%24%20%2C%5Cu6bcf%5Cu4e2a%5Cu70b9%5Cu6709%5Cu6743%5Cu503c%20%24a%24%20%5Cuff0c%5Cu6743%5Cu503c%5Cu8303%5Cu56f4%5Cu90fd%5Cu662f%20%24%5B1%2C10%5E9%5D%24%20%5Cu3002%5Cn%5Cn%5Cu5b9a%5Cu4e492-Path%5Cu4e3a%5Cu6bcf%5Cu6761%5Cu8fb9%5Cu6700%5Cu591a%5Cu7ecf%5Cu8fc7%5Cu4e24%5Cu6b21%5Cu7684%5Cu8def%5Cu5f84%5Cuff0c%5Cu8def%5Cu5f84%5Cu6743%5Cu503c%5Cu4e3a%20%24%5C%5Csum%20a_v-%5C%5Csum%20w_e%20k_e%24%20%2C%20%24k_e%24%20%5Cu8868%5Cu793a%5Cu6bcf%5Cu6761%5Cu8fb9%5Cu7684%5Cu7ecf%5Cu8fc7%5Cu6b21%5Cu6570%5Cu3002%5Cn%5Cn%5Cu6709%20%24Q%24%20%5Cu4e2a%5Cu8be2%5Cu95ee%5Cuff0c%5Cu6bcf%5Cu6b21%5Cu8be2%5Cu95ee%5Cu4ece%20%24x%24%20%5Cu5230%20%24y%24%20%5Cuff0c%5Cu6700%5Cu5927%5Cu6743%5Cu503c2-Path%5Cu7684%5Cu6743%5Cu503c%5Cu3002%5Cn%5Cn%5Cu611f%5Cu8c22%40litble%20%5Cu63d0%5Cu4f9b%5Cu7ffb%5Cu8bd1%22%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Afalse%2C%22totalSubmit%22%3A35%2C%22totalAccepted%22%3A20%2C%22pid%22%3A%22CF1000G%22%2C%22title%22%3A%22Two-Paths%22%2C%22difficulty%22%3A6%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%7B%22id%22%3A47074%2C%22title%22%3A%22%5Cu7ffb%5Cu8bd1%22%2C%22forum%22%3A%7B%22id%22%3A26764%2C%22name%22%3A%22CF1000G%20Two-Paths%22%2C%22slug%22%3A%22CF1000G%22%7D%7D%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Two-Paths%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1572920822;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Two-Paths</h1>
<h2>题意翻译</h2>
<div>给你一棵 $n$ 个节点的树，每条边有权值 $w$ ,每个点有权值 $a$ ，权值范围都是 $[1,10^9]$ 。
定义2-Path为每条边最多经过两次的路径，路径权值为 $\sum a_v-\sum w_e k_e$ , $k_e$ 表示每条边的经过次数。
有 $Q$ 个询问，每次询问从 $x$ 到 $y$ ，最大权值2-Path的权值。
感谢@litble 提供翻译</div>
<h2>题目描述</h2>
<div>You are given a weighted tree (undirected connected graph with no cycles, loops or multiple edges) with $ n $ vertices. The edge $ \{u_j, v_j\} $ has weight $ w_j $ . Also each vertex $ i $ has its own value $ a_i $ assigned to it.
Let's call a path starting in vertex $ u $ and ending in vertex $ v $ , where each edge can appear no more than twice (regardless of direction), a 2-path. Vertices can appear in the 2-path multiple times (even start and end vertices).
For some 2-path $ p $ profit $ \text{Pr}(p) = \sum\limits_{v \in \text{distinct vertices in } p}{a_v} - \sum\limits_{e \in \text{distinct edges in } p}{k_e \cdot w_e} $ , where $ k_e $ is the number of times edge $ e $ appears in $ p $ . That is, vertices are counted once, but edges are counted the number of times they appear in $ p $ .
You are about to answer $ m $ queries. Each query is a pair of vertices $ (qu, qv) $ . For each query find 2-path $ p $ from $ qu $ to $ qv $ with maximal profit $ \text{Pr}(p) $ .</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line contains two integers $ n $ and $ q $ ( $ 2 \le n \le 3 \cdot 10^5 $ , $ 1 \le q \le 4 \cdot 10^5 $ ) — the number of vertices in the tree and the number of queries.
The second line contains $ n $ space-separated integers $ a_1, a_2, \dots, a_n $ $ (1 \le a_i \le 10^9) $ — the values of the vertices.
Next $ n - 1 $ lines contain descriptions of edges: each line contains three space separated integers $ u_i $ , $ v_i $ and $ w_i $ ( $ 1 \le u_i, v_i \le n $ , $ u_i \neq v_i $ , $ 1 \le w_i \le 10^9 $ ) — there is edge $ \{u_i, v_i\} $ with weight $ w_i $ in the tree.
Next $ q $ lines contain queries (one per line). Each query contains two integers $ qu_i $ and $ qv_i $ $ (1 \le qu_i, qv_i \le n) $ — endpoints of the 2-path you need to find.</div>
<h3>输出格式</h3>
<br />
<div>For each query print one integer per line — maximal profit $ \text{Pr}(p) $ of the some 2-path $ p $ with the corresponding endpoints.</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>7 6
6 5 5 3 2 1 2
1 2 2
2 3 2
2 4 1
4 5 1
6 4 2
7 3 25
1 1
4 4
5 6
6 4
3 4
3 7
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>9
9
9
8
12
-14
</code></pre>
<h2>说明</h2>
<div>Explanation of queries:
1. $ (1, 1) $ — one of the optimal 2-paths is the following: $ 1 \rightarrow 2 \rightarrow 4 \rightarrow 5 \rightarrow 4 \rightarrow 2 \rightarrow 3 \rightarrow 2 \rightarrow 1 $ . $ \text{Pr}(p) = (a_1 + a_2 + a_3 + a_4 + a_5) - (2 \cdot w(1,2) + 2 \cdot w(2,3) + 2 \cdot w(2,4) + 2 \cdot w(4,5)) = 21 - 2 \cdot 12 = 9 $ .
2. $ (4, 4) $ : $ 4 \rightarrow 2 \rightarrow 1 \rightarrow 2 \rightarrow 3 \rightarrow 2 \rightarrow 4 $ . $ \text{Pr}(p) = (a_1 + a_2 + a_3 + a_4) - 2 \cdot (w(1,2) + w(2,3) + w(2,4)) = 19 - 2 \cdot 10 = 9 $ .
3. $ (5, 6) $ : $ 5 \rightarrow 4 \rightarrow 2 \rightarrow 3 \rightarrow 2 \rightarrow 1 \rightarrow 2 \rightarrow 4 \rightarrow 6 $ .
4. $ (6, 4) $ : $ 6 \rightarrow 4 \rightarrow 2 \rightarrow 1 \rightarrow 2 \rightarrow 3 \rightarrow 2 \rightarrow 4 $ .
5. $ (3, 4) $ : $ 3 \rightarrow 2 \rightarrow 1 \rightarrow 2 \rightarrow 4 $ .
6. $ (3, 7) $ : $ 3 \rightarrow 2 \rightarrow 1 \rightarrow 2 \rightarrow 4 \rightarrow 5 \rightarrow 4 \rightarrow 2 \rightarrow 3 \rightarrow 7 $ .</div>
</article>
</div>
</div>
</body>
</html>
