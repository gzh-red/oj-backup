<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Optimizer - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573402402:14uQ29Cz2I+byLjIpVViSBpRpt5thgYEBC7GsHqWL3s=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22Let%27s%20analyze%20a%20program%20written%20on%20some%20strange%20programming%20language.%20The%20variables%20in%20this%20language%20have%20names%20consisting%20of%20%24%201%20%24%20to%20%24%204%20%24%20characters%2C%20and%20each%20character%20is%20a%20lowercase%20or%20an%20uppercase%20Latin%20letter%2C%20or%20a%20digit.%20There%20is%20an%20extra%20constraint%20that%20the%20first%20character%20should%20not%20be%20a%20digit.%5Cn%5CnThere%20are%20four%20types%20of%20operations%20in%20the%20program%2C%20each%20denoted%20by%20one%20of%20the%20characters%3A%20%24%2C%20%5E%2C%20%5C%5C%23%20or%20%26.%5Cn%5CnEach%20line%20of%20the%20program%20has%20one%20of%20the%20following%20formats%3A%5Cn%5Cn-%20%3Clvalue%3E%3D%3Crvalue%3E%2C%20where%20%3Clvalue%3E%20and%20%3Crvalue%3E%20are%20valid%20variable%20names%3B%5Cn-%20%3Clvalue%3E%3D%3Carg1%3E%3Cop%3E%3Carg2%3E%2C%20where%20%3Clvalue%3E%2C%20%3Carg1%3E%20and%20%3Carg2%3E%20are%20valid%20variable%20names%2C%20and%20%3Cop%3E%20is%20an%20operation%20character.%5Cn%5CnThe%20program%20is%20executed%20line-by-line%2C%20and%20the%20result%20of%20execution%20is%20stored%20in%20a%20variable%20having%20the%20name%20res.%20If%20res%20is%20never%20assigned%20in%20the%20program%2C%20then%20the%20result%20will%20be%20equal%20to%20the%20value%20of%20res%20before%20running%20the%20program.%5Cn%5CnTwo%20programs%20are%20called%20equivalent%20if%20no%20matter%20which%20operations%20do%20characters%20%24%2C%20%5E%2C%20%5C%5C%23%20and%20%26%20denote%20%28but%2C%20obviously%2C%20performing%20the%20same%20operation%20on%20the%20same%20arguments%20gives%20the%20same%20result%29%20and%20which%20values%20do%20variables%20have%20before%20execution%20of%20program%2C%20the%20value%20of%20res%20after%20running%20the%20first%20program%20is%20equal%20to%20the%20value%20of%20res%20after%20running%20the%20second%20program%20%28the%20programs%20are%20executed%20independently%29.%5Cn%5CnYou%20are%20given%20a%20program%20consisting%20of%20%24%20n%20%24%20lines.%20Your%20task%20is%20to%20write%20a%20program%20consisting%20of%20minimum%20possible%20number%20of%20lines%20that%20is%20equivalent%20to%20the%20program%20you%20are%20given.%22%2C%22inputFormat%22%3A%22The%20first%20line%20contains%20one%20integer%20%24%20n%20%24%20%28%20%24%201%20%5C%5Cle%20n%20%5C%5Cle%201000%20%24%20%29%20%5Cu2014%20the%20number%20of%20lines%20in%20the%20program.%5Cn%5CnThen%20%24%20n%20%24%20lines%20follow%20%5Cu2014%20the%20program%20itself.%20Each%20line%20corresponds%20to%20the%20format%20described%20in%20the%20statement%20and%20has%20no%20extra%20whitespaces.%22%2C%22outputFormat%22%3A%22In%20the%20first%20line%20print%20%24%20k%20%24%20%5Cu2014%20the%20minimum%20number%20of%20lines%20in%20the%20equivalent%20program.%5Cn%5CnThen%20print%20%24%20k%20%24%20lines%20without%20any%20whitespaces%20%5Cu2014%20an%20equivalent%20program%20having%20exactly%20%24%20k%20%24%20lines%2C%20in%20the%20same%20format%20it%20is%20described%20in%20the%20statement.%22%2C%22samples%22%3A%5B%5B%22%5Cn4%5Cnc%3Daa%23bb%5Cnd12%3Dc%5Cnres%3Dc%5Ed12%5Cntmp%3Daa%24c%5Cn%22%2C%22%5Cn2%5Cnaaaa%3Daa%23bb%5Cnres%3Daaaa%5Eaaaa%5Cn%22%5D%2C%5B%22%5Cn2%5Cnmax%3Daaaa%24bbbb%5Cnmin%3Dbbbb%5Eaaaa%5Cn%22%2C%22%5Cn0%22%5D%5D%2C%22hint%22%3A%22%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B1000%5D%2C%22memory%22%3A%5B256000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22CodeForces%22%2C%22link%22%3A%22http%3A%5C%2F%5C%2Fcodeforces.com%5C%2Fproblemset%5C%2Fproblem%5C%2F1156%5C%2FG%22%2C%22id%22%3A%221156G%22%7D%2C%22translation%22%3A%22%5Cu4f60%5Cu8981%5Cu5206%5Cu6790%5Cu4e00%5Cu6bb5%5Cu7528%5Cu4e00%5Cu79cd%5Cu795e%5Cu5947%5Cu7684%5Cu8bed%5Cu8a00%5Cu5199%5Cu7684%5Cu7a0b%5Cu5e8f%5Cu3002%5Cr%5Cn%5Cr%5Cn%5Cu8fd9%5Cu79cd%5Cu8bed%5Cu8a00%5Cu7684%5Cu53d8%5Cu91cf%5Cu662f%5Cu4e00%5Cu4e2a%5Cu957f%5Cu5ea6%5Cu4e0d%5Cu8d85%5Cu8fc7%244%24%5Cu7684%5Cu5b57%5Cu7b26%5Cu4e32%5Cuff0c%5Cu6bcf%5Cu4e00%5Cu4e2a%5Cu5b57%5Cu7b26%5Cu662f%5Cu4e00%5Cu4e2a%5Cu62c9%5Cu4e01%5Cu5b57%5Cu6bcd%5Cu6216%5Cu8005%5Cu6570%5Cu5b57%5Cu3002%5Cu7279%5Cu522b%5Cu7684%5Cuff0c%5Cu6570%5Cu5b57%5Cu4e0d%5Cu80fd%5Cu4f5c%5Cu4e3a%5Cu53d8%5Cu91cf%5Cu540d%5Cu7684%5Cu5f00%5Cu5934%5Cu3002%5Cr%5Cn%5Cr%5Cn%5Cu8fd9%5Cu79cd%5Cu8bed%5Cu8a00%5Cu6709%5Cu56db%5Cu79cd%5Cu8fd0%5Cu7b97%5Cu7b26%5Cuff0c%5Cu5206%5Cu522b%5Cu662f%24%2C%5E%2C%23%2C%26%5Cu3002%5Cr%5Cn%5Cr%5Cn%5Cu6bcf%5Cu4e00%5Cu884c%5Cu7a0b%5Cu5e8f%5Cu6709%5Cu4ee5%5Cu4e0b%5Cu4e24%5Cu79cd%5Cu683c%5Cu5f0f%5Cuff1a%5Cr%5Cn%5Cr%5Cn%60%60%60cpp%5Cr%5Cn1%5Cu3001%3Clvalue%3E%3D%3Crvalue%3E%5Cuff0c%5Cu8868%5Cu793a%5Cu628a%3Crvalue%3E%5Cu7684%5Cu503c%5Cu8d4b%5Cu7ed9%3Clvalue%3E%5Cuff0c%5Cu5176%5Cu4e2d%3Clvalue%3E%5Cu548c%3Crvalue%3E%5Cu90fd%5Cu662f%5Cu5408%5Cu6cd5%5Cu53d8%5Cu91cf%5Cu540d%5Cu3002%5Cr%5Cn2%5Cu3001%3Clvalue%3E%3D%3Carg1%3E%3Cop%3E%3Carg2%3E%5Cuff0c%5Cu5176%5Cu4e2d%3Clvalue%3E%2C%3Carg1%3E%5Cu548c%3Carg2%3E%5Cu90fd%5Cu662f%5Cu5408%5Cu6cd5%5Cu53d8%5Cu91cf%5Cu540d%5Cuff0c%3Cop%3E%5Cu662f%5Cu8fd0%5Cu7b97%5Cu7b26%5Cu3002%5Cr%5Cn%60%60%60%5Cr%5Cn%5Cr%5Cn%5Cu8fd9%5Cu79cd%5Cu8bed%5Cu8a00%5Cu662f%5Cu4e00%5Cu884c%5Cu4e00%5Cu884c%5Cu8fd0%5Cu884c%5Cu7684%5Cuff0c%5Cu8fd0%5Cu884c%5Cu7ed3%5Cu679c%5Cu662f%5Cu4e00%5Cu4e2a%5Cu53eb%5Cu505a%5C%22res%5C%22%5Cu7684%5Cu53d8%5Cu91cf%5Cu3002%5Cu5982%5Cu679cres%5Cu6ca1%5Cu6709%5Cu51fa%5Cu73b0%5Cuff0c%5Cu90a3%5Cu4e48%5Cu8fd0%5Cu884c%5Cu7ed3%5Cu679c%5Cu5c31%5Cu662f%5Cu6267%5Cu884c%5Cu8fd9%5Cu6bb5%5Cu7a0b%5Cu5e8f%5Cu4e4b%5Cu524dres%5Cu7684%5Cu503c%5Cu3002%5Cr%5Cn%5Cr%5Cn%5Cu4e24%5Cu6bb5%5Cu7a0b%5Cu5e8f%5Cu88ab%5Cu79f0%5Cu4f5c%5Cu7b49%5Cu4ef7%5Cu7684%5Cuff0c%5Cu5f53%5Cu4e14%5Cu4ec5%5Cu5f53%5Cu65e0%5Cu8bba%5Cu8fd0%5Cu7b97%5Cu7b26%5Cu4ee3%5Cu8868%5Cu4ec0%5Cu4e48%5Cu8fd0%5Cu7b97%5Cuff0c%5Cu6240%5Cu6709%5Cu53d8%5Cu91cf%5Cu521d%5Cu59cb%5Cu503c%5Cu662f%5Cu4ec0%5Cu4e48%5Cuff0c%5Cu8fd9%5Cu4e24%5Cu6bb5%5Cu7a0b%5Cu5e8f%5Cu7684%5Cu7ed3%5Cu679c%5Cu90fd%5Cu662f%5Cu4e00%5Cu6837%5Cu7684%5Cu3002%5Cr%5Cn%5Cr%5Cn%5Cu4f60%5Cu6709%5Cu4e00%5Cu6bb5%24n%24%5Cu884c%5Cu7684%5Cu7a0b%5Cu5e8f%5Cu3002%5Cu4f60%5Cu9700%5Cu8981%5Cu5199%5Cu51fa%5Cu4e00%5Cu6bb5%5Cu884c%5Cu6570%5Cu6700%5Cu5c11%5Cu7684%5Cu7b49%5Cu4ef7%5Cu7684%5Cu7a0b%5Cu5e8f%5Cu3002%22%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Afalse%2C%22totalSubmit%22%3A12%2C%22totalAccepted%22%3A4%2C%22pid%22%3A%22CF1156G%22%2C%22title%22%3A%22Optimizer%22%2C%22difficulty%22%3A7%2C%22type%22%3A%22CF%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22Optimizer%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1572920822;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>Optimizer</h1>
<h2>题意翻译</h2>
<div>你要分析一段用一种神奇的语言写的程序。
这种语言的变量是一个长度不超过$4$的字符串，每一个字符是一个拉丁字母或者数字。特别的，数字不能作为变量名的开头。
这种语言有四种运算符，分别是$,^,#,&。
每一行程序有以下两种格式：
```cpp
1、<lvalue>=<rvalue>，表示把<rvalue>的值赋给<lvalue>，其中<lvalue>和<rvalue>都是合法变量名。
2、<lvalue>=<arg1><op><arg2>，其中<lvalue>,<arg1>和<arg2>都是合法变量名，<op>是运算符。
```
这种语言是一行一行运行的，运行结果是一个叫做"res"的变量。如果res没有出现，那么运行结果就是执行这段程序之前res的值。
两段程序被称作等价的，当且仅当无论运算符代表什么运算，所有变量初始值是什么，这两段程序的结果都是一样的。
你有一段$n$行的程序。你需要写出一段行数最少的等价的程序。</div>
<h2>题目描述</h2>
<div>Let's analyze a program written on some strange programming language. The variables in this language have names consisting of $ 1 $ to $ 4 $ characters, and each character is a lowercase or an uppercase Latin letter, or a digit. There is an extra constraint that the first character should not be a digit.
There are four types of operations in the program, each denoted by one of the characters: $, ^, \# or &.
Each line of the program has one of the following formats:
- <lvalue>=<rvalue>, where <lvalue> and <rvalue> are valid variable names;
- <lvalue>=<arg1><op><arg2>, where <lvalue>, <arg1> and <arg2> are valid variable names, and <op> is an operation character.
The program is executed line-by-line, and the result of execution is stored in a variable having the name res. If res is never assigned in the program, then the result will be equal to the value of res before running the program.
Two programs are called equivalent if no matter which operations do characters $, ^, \# and & denote (but, obviously, performing the same operation on the same arguments gives the same result) and which values do variables have before execution of program, the value of res after running the first program is equal to the value of res after running the second program (the programs are executed independently).
You are given a program consisting of $ n $ lines. Your task is to write a program consisting of minimum possible number of lines that is equivalent to the program you are given.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line contains one integer $ n $ ( $ 1 \le n \le 1000 $ ) — the number of lines in the program.
Then $ n $ lines follow — the program itself. Each line corresponds to the format described in the statement and has no extra whitespaces.</div>
<h3>输出格式</h3>
<br />
<div>In the first line print $ k $ — the minimum number of lines in the equivalent program.
Then print $ k $ lines without any whitespaces — an equivalent program having exactly $ k $ lines, in the same format it is described in the statement.</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>
4
c=aa#bb
d12=c
res=c^d12
tmp=aa$c
</code></pre>
<h3>输出样例 #1</h3>
<pre><code>
2
aaaa=aa#bb
res=aaaa^aaaa
</code></pre>
<h3>输入样例 #2</h3>
<pre><code>
2
max=aaaa$bbbb
min=bbbb^aaaa
</code></pre>
<h3>输出样例 #2</h3>
<pre><code>
0</code></pre>
</article>
</div>
</div>
</body>
</html>
